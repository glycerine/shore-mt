<!-- Warning: Do not edit this file. -->
<!-- It was created automatically by yam2html.pl 1.3  -->
<!-- on Mon Oct 27 09:41:08 CST 1997 from file manssm/rtree.ssm -->
<!DOCTYPE HTML public "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
<TITLE>
ss_m::rtree(ssm) -- Shore Reference Manual
</TITLE>
<LINK REV="made" HREF="mailto:solomon@cs.wisc.edu">
</HEAD>

<BODY>

<!-- .so tmac.man.local -->
<H1><A NAME="HRR.0">
bulkld_md_index, create_md_assoc, create_md_index, destroy_md_assoc, destroy_md_index, find_md_assoc, print_md_index, draw_rtree rtree_stats - Class ss_m Methods for R*tree (multi-dimensional) Index Operations

</A></H1><HR>
<H1>
CONTENTS
</H1>
<UL>
<LI>
<A HREF="#HRR.1">SYNOPSIS</A>
</LI>
<LI>
<A HREF="#HRR.2">DESCRIPTION</A>
<UL>
<LI>
<A HREF="#HRR.2.1">Common Parameters</A>
</LI>
</UL>
</LI>
<LI>
<A HREF="#HRR.3">ERRORS</A>
</LI>
<LI>
<A HREF="#HRR.4">EXAMPLES</A>
</LI>
<LI>
<A HREF="#HRR.5">VERSION</A>
</LI>
<LI>
<A HREF="#HRR.6">SPONSORSHIP</A>
</LI>
<LI>
<A HREF="#HRR.7">COPYRIGHT</A>
</LI>
<LI>
<A HREF="#HRR.8">SEE ALSO</A>
</LI></UL><HR>
<H1><A NAME="HRR.1">SYNOPSIS</A></H1>
<BLOCKQUOTE><PRE>
#include &lt;sm_vas.h&gt;  // includes sm.h (where they are declared)

static rc_t                 create_md_index(
    const lvid_t&amp;               lvid,
    ndx_t                       ntype,
    store_property_t            property,
    serial_t&amp;                   liid,
    int2                        dim=2);
static rc_t                 destroy_md_index(
    const lvid_t&amp;               lvid,
    const serial_t&amp;             liid);
static rc_t                 bulkld_md_index(
    const lvid_t&amp;               lvid,
    const serial_t&amp;             liid,
    const lvid_t&amp;               s_lvid,
    const serial_t&amp;             s_liid,
    sm_du_stats_t&amp;              stats,
    int2                        hff=65,
    int2                        hef=120,
    nbox_t*                     universe=NULL);
static rc_t                 bulkld_md_index(
    const lvid_t&amp;               lvid,
    const serial_t&amp;             liid,
    sort_stream_i&amp;              sorted_stream,
    sm_du_stats_t&amp;              stats,
    int2                        hff=65,
    int2                        hef=120,
    nbox_t*                     universe=NULL);
static rc_t                 create_md_assoc(
    const lvid_t&amp;               lvid,
    const serial_t&amp;             liid,
    const nbox_t&amp;               key,
    const vec_t&amp;                el);
static rc_t                 destroy_md_assoc(
    const lvid_t&amp;               lvid,
    const serial_t&amp;             liid,
    const nbox_t&amp;               key,
    const vec_t&amp;                el);
static rc_t                 find_md_assoc(
    const lvid_t&amp;               lvid,
    const serial_t&amp;             liid,
    const nbox_t&amp;               key,
    void*                       el,
    smsize_t&amp;                   elen,
    bool&amp;                       found);
static rc_t                 print_md_index(
    const lvid_t&amp;               lvid,
    const serial_t&amp;             liid);
static rc_t                 draw_rtree(
    const lvid_t&amp;               lvid,
    const serial_t&amp;             liid);
static rc_t                 rtree_stats(
    const lvid_t&amp;               lvid,
    const serial_t&amp;             liid,
    rtree_stats_t&amp;              stat,
    uint2                       size = 0,
    uint2*                      ovp = NULL,
    bool                        audit = false);


</PRE></BLOCKQUOTE>
<HR>
<H1><A NAME="HRR.2">DESCRIPTION</A></H1>

The above class
 <strong>ss_m</strong>
methods all deal with manipulating multi-dimensional (md)
indexes.  So far, the only type of multi-dimension index provided
by the SSM is the R*tree.  See 
<A HREF="../ssmapi/ssmapi.html">The Shore Storage Manager Programming Interface</A>
for more information on R*trees.

<H2><A NAME="HRR.2.1">Common Parameters</A></H2>
<P>
There are a number of common parameters for these methods:
<DL>
<DT>lvid</DT><DD>
Logical volume ID of volume containing an index.
</DD>
<DT>liid</DT><DD>
Logical index ID, the serial number of an index.
</DD>
<DT>key</DT><DD>
A n-dimensional box,
<A HREF="nbox_t.common.html"><STRONG>nbox_t(common)</STRONG></A>,
that is the key portion of an index entry.
</DD>
<DT>el</DT><DD>
A vector pointing to the element portion of an index entry.

<P>
</DD>
</DL>
<strong>create_md_index(lvid, ntype, property, liid, dim)</strong>
<DL>
<PP>
The
 <strong>create_md_index</strong>
method creates a new B+tree index on the volume
 <em>lvid,</em>
and returns its serial number in
 <em>liid.</em>
The
 <em>ntype</em>
parameter specifies the type of implementation used for the index.
The only valid value for the
 <em>ntype</em>
parameter is
<strong>t_rtree,</strong>
indicating an R*tree.
The 
 <em>property</em>
parameter specifies whether the index is temporary or not.
See
<A HREF="enum.ssm.html"><STRONG>enum(ssm)</STRONG></A>
for more information on
<strong>store_property_t.</strong>
The
 <em>dim</em>
parameter specifies the number of dimensions for the index.
<strong>Note:</strong>
only 2 dimensions are currently supported.

<P>
</DL>
<strong>destroy_md_index(lvid, liid)</strong>
<DL>
<PP>
The
 <strong>destroy_index</strong>
method destroys the index and deallocates all space used by it.
The space is not available for reuse until
the transaction destroying the index commits.

<P>
</DL>
<strong>bulkld_md_index(lvid, liid, s_lvid, s_lfid, stats, hff, hef, universe)</strong>
<DL>
<PP>
This
 <strong>bulkld_md_index</strong>
method bulk loads the
<strong>empty</strong>
index, identified by
 <em>lvid</em>
and
 <em>liid.</em>
The entries to load are located, in sorted order, in the
file identified by
 <em>s_lvid</em>
and 
 <em>s_lfid.</em>
The header of each record in the file contains the key (see
<A HREF="nbox_t.common.html"><STRONG>nbox_t(common)</STRONG></A>).
and the body contains the element (value) associated with the key.
This file must have been sorted by 
<A HREF="sort.ssm.html"><STRONG>sort(ssm)</STRONG></A>
using the
<strong>t_spatial</strong>
key type to get a spatial linear order (Hilbert curve).
Statistics for the newly loaded index are returned in
 <em>stats,</em>
specifically in the
 <em>rtree</em>field.
<PP>
The
 <em>hff</em>
parameter is a heuristic fill factor and
 <em>hef</em>
is a heuristic expansion
factor.  They are used to determine when an Rtree page should
stop accepting new entries to reduce the degree of overlap during
bulk loading.
Since bulk loading requires some linear order to map
2-d keys to 1-d disk locations, there definitely will be some
loss of spatial
clustering.  Thus, packing entries 100% to a 
rtree page could result in a very large overlap between
leaf pages.  These heuristics parameters are designed to
minimize this problem.  It is recommended that
the default values always be used.
The default values are chosen to be the best on the average
case. But they not guaranteed best for the worst case (skewed data).
<PP>
The
VA universe
parameter is a &quot;box&quot; specifying the boundaries of the &quot;space&quot; containing
the loaded keys.  A more compact index can be built if this parameter
is provided, but it is not necessary.

<P>
</DL>
<strong>bulkld_md_index(lvid, liid, sorted_stream, stats, hff, hef, universe)</strong>
<DL>
<PP>
This
 <strong>bulkld_md_index</strong>
method is identical to the one above except that rather than
getting entries from a file, the entries come from
 <em>sorted_stream.</em>
<strong>Note:</strong>
this method has not been extensively tested and may change in the
future.  See
<A HREF="sort_stream_i.ssm.html"><STRONG>sort_stream_i(ssm)</STRONG></A>
for more information.

<P>
</DL>
<strong>create_md_assoc(lvid, liid, key, el)</strong>
<DL>
<PP>
The 
 <strong>create_md_assoc</strong>
method adds a new entry associating
 <em>key</em>
with the element (value)
 <em>el.</em>

<P>
</DL>
<strong>destroy_md_assoc(lvid, liid, key, el)</strong>
<DL>
<PP>
The
 <strong>destroy_md_assoc</strong>
method destroys the entry associating
 <em>key</em>
with the element (value)
 <em>el.</em>

<P>
</DL>
<strong>find_md_assoc(lvid, liid, key, el, elen, found)</strong>
<DL>
<PP>
The
 <strong>find_assoc</strong>
method finds
 <em>key</em>
in the index and and writes the associated element
 (only the first one found) to the address specified by
 <em>el.</em>
At most
 <em>elen</em>
bytes will be written.  If the element is not needed, set
 <em>elen</em>
to 0.  If
 <em>key</em>
is found, then
 <em>found</em>
will be set to 
<strong>true.</strong>
A more comprehensive lookup facility, allowing range searches,
is available from the class .FN scan_rt_i described in .SA
scan_rt_i(ssm)

<P>
</DL>
<strong>print_md_index(lvid, liid)</strong>
<DL>
<PP>
The
 <strong>print_md_index</strong>
method is prints the contents of the index.  It is meant to
be a debugging utility.

<P>
</DL>
<strong>draw_rtree(lvid, liid)</strong>
<DL>
<PP>
The
 <strong>draw_rtree</strong>
method generates a &quot;gremlin&quot; file for
visualizing an R*-tree graphically.
This method is an unsupported debugging utility.

<P>
</DL>
<strong>rtree_stats(lvid, liid, stat, size, ovp, audit)</strong>
<DL>
<PP>
The
 <strong>rtree_stats</strong>
method is an unsupported debugging utility for gathering
more detailed statistics on an R*tree.
The
 <em>stats</em>
parameter is filled with the regular Rtree stats gathered
by
 <strong>ss_m::get_du_statistics().</strong>
The
 <em>ovp</em>
parameter is an array that will be filled with overlap
percentage for each level of the R*tree.
The
 <em>size</em>
parameter is the size of the array.
If the 
 <em>audit</em>
parameter is
<strong>true,</strong>
the stats structure is audited.

</DL>
<HR>
<H1><A NAME="HRR.3">ERRORS</A></H1>

All of the above methods return a
 <strong>w_rc_t</strong>
error code.  If an error occurs during a method that is updating
persistent data (the create, destroy, and bulk load method will
update data) then the index could be in an inconsistent state.
The caller then has the choice of aborting the transaction or rolling
back to the nearest save-point (see
<A HREF="transaction.ssm.html"><STRONG>transaction(ssm)</STRONG></A>
).

<P>
See
<A HREF="errors.ssm.html"><STRONG>errors(ssm)</STRONG></A>
for more information on error handling.

<HR>
<H1><A NAME="HRR.4">EXAMPLES</A></H1>
To Do.

<HR>
<H1><A NAME="HRR.5">VERSION</A></H1>
This manual page applies to Version 1.1.1 of the Shore software.
<HR>
<H1><A NAME="HRR.6">SPONSORSHIP</A></H1>
The Shore project is sponsored by the Advanced Research Project Agency, ARPA
order number 018 (formerly 8230), monitored by the U.S. Army Research
Laboratory under contract DAAB07-91-C-Q518.
<HR>
<H1><A NAME="HRR.7">COPYRIGHT</A></H1>
Copyright &#169; 1994, 1995, 1996, 1997,
Computer Sciences Department, University of
Wisconsin -- Madison. All Rights Reserved.
<HR>
<H1><A NAME="HRR.8">SEE ALSO</A></H1>
<A HREF="scan_rt_i.ssm.html"><STRONG>scan_rt_i(ssm)</STRONG></A>
<A HREF="sort_stream_i.ssm.html"><STRONG>sort_stream_i(ssm)</STRONG></A>
<A HREF="intro.ssm.html"><STRONG>intro(ssm)</STRONG></A>


</BODY>
</HTML>
