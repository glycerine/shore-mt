<!-- Warning: Do not edit this file. -->
<!-- It was created automatically by yam2html.pl 1.3  -->
<!-- on Mon Oct 27 09:41:11 CST 1997 from file mancommon/latch_t.common -->
<!DOCTYPE HTML public "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
<TITLE>
latch_t(common) -- Shore Reference Manual
</TITLE>
<LINK REV="made" HREF="mailto:solomon@cs.wisc.edu">
</HEAD>

<BODY>

<!-- .so tmac.man.local -->
<H1><A NAME="HRR.0">
latch_t - Thread Synchronization Latches
</A></H1><HR>
<H1>
CONTENTS
</H1>
<UL>
<LI>
<A HREF="#HRR.1">SYNOPSIS</A>
</LI>
<LI>
<A HREF="#HRR.2">DESCRIPTION</A>
</LI>
<LI>
<A HREF="#HRR.3">VERSION</A>
</LI>
<LI>
<A HREF="#HRR.4">SPONSORSHIP</A>
</LI>
<LI>
<A HREF="#HRR.5">COPYRIGHT</A>
</LI>
<LI>
<A HREF="#HRR.6">SEE ALSO</A>
</LI>
<LI>
<A HREF="#HRR.7">BUGS</A>
</LI></UL><HR>
<H1><A NAME="HRR.1">SYNOPSIS</A></H1>
<BLOCKQUOTE><PRE>
<TT>#include &lt;latch.h&gt;</TT>


// these are defined outside of class latch_t due to bugs in
// some C++ compilers
enum latch_mode_t { LATCH_NL = 0, LATCH_SH = 1, LATCH_EX = 2 };

class latch_t : public sthread_named_base_t {

public:
    NORET			latch_t(const char* const desc = 0);
    NORET			~latch_t()	{};
#ifdef DEBUG
    friend ostream&amp; operator&lt;&lt;(ostream&amp;, const latch_t&amp; l);
#endif

    inline void 		setname(const char *const desc);
    w_rc_t			acquire(
	latch_mode_t 		    m, 
	int 			    timeout = sthread_base_t::WAIT_FOREVER);
    w_rc_t			upgrade_if_not_block(
	bool&amp; 			    would_block);
    void   			release();
    bool 			is_locked() const;
    bool 			is_hot() const;
    int    			lock_cnt() const;
    int				num_holders() const;
    int				held_by(const sthread_t* t) const;
    bool 			is_mine() const;

private:  // disabled methods
    NORET			latch_t(const latch_t&amp;);
    latch_t&amp;   			operator=(const latch_t&amp;);
};

</PRE></BLOCKQUOTE>
<HR>
<H1><A NAME="HRR.2">DESCRIPTION</A></H1>
<P>

Latches are a read/write synchronization mechanism for threads,
as opposed to locks which are used for synchronizing transactions.
Latches are much lighter weight than locks, have no symbolic names,
and have no deadlock detection.

<P>
<strong>latch_t(desc)</strong>
<DL>
<PP>
The constructor for a latch takes an string descriptor (name) for
the latch.  This name is useful for debugging and for the
output operator.

<P>
</DL>
<strong>setname(desc)</strong>
<DL>
<PP>
This method is used to change the descriptor associated with a latch.

<P>
</DL>
<strong>acquire(mode, timeout)</strong>
<DL>
<PP>
The
 <strong>acquire</strong>
method attempts to acquire the latch (for the thread that is running)
in the desired
 <em>mode.</em>
Valid values for
 <em>mode</em>
are:
 <strong>LATCH_SH</strong>
indicating shared mode and
 <strong>LATCH_EX</strong>
indicating exclusive mode.
If the latch cannot be acquired within the 
 <em>timeout,</em>
the method will return with a
<tt>stTIMEOUT</tt>
error.
The number of times a latch is acquired by a thread is
counted, so a corresponding call to
 <strong>release</strong>
must be made for every successful call to
 <strong>acquire.</strong>

<P>
</DL>
<strong>upgrade_if_not_block(would_block)</strong>
<DL>
<PP>
The
 <strong>upgrade_if_not_block</strong>
method attempts to upgrade the latch from shared to exclusive mode.
If the upgrade would cause the thread to block, then the
upgrade is not performed and
 <em>would_block</em>
is set to
 <strong>true.</strong>

<P>
</DL>
<strong>release()</strong>
<DL>
<PP>
The
 <strong>release</strong>
method releases the latch for the thread that calls it.

<P>
</DL>
<strong>is_locked()</strong>
<DL>
<PP>
The
 <strong>is_locked</strong>
method returns
 <strong>true</strong>
if any thread holds the latch.

<P>
</DL>
<strong>is_hot()</strong>
<DL>
<PP>
The
 <strong>is_hot</strong>
method returns
 <strong>true</strong>
if any thread is waiting for the latch.

<P>
</DL>
<strong>lock_cnt()</strong>
<DL>
<PP>
The
 <strong>lock_cnt</strong>
method returns the total number of outstanding acquires.

<P>
</DL>
<strong>num_holders()</strong>
<DL>
<PP>
The
 <strong>num_holders</strong>
method returns the total number of threads holding the latch.

<P>
</DL>
<strong>held_by(thread)</strong>
<DL>
<PP>
The
 <strong>held_by</strong>
method returns the number of times the latch is held by the thread
 <em>thread.</em>

<P>
</DL>
<strong>is_mine()</strong>
<DL>
<PP>
The
 <strong>is_mine</strong>
method returns
 <strong>true</strong>
if the calling thread hold the latch in exclusive mode.


</DL>
<HR>
<H1><A NAME="HRR.3">VERSION</A></H1>
This manual page applies to Version 1.1.1 of the Shore software.
<HR>
<H1><A NAME="HRR.4">SPONSORSHIP</A></H1>
The Shore project is sponsored by the Advanced Research Project Agency, ARPA
order number 018 (formerly 8230), monitored by the U.S. Army Research
Laboratory under contract DAAB07-91-C-Q518.
<HR>
<H1><A NAME="HRR.5">COPYRIGHT</A></H1>
Copyright &#169; 1994, 1995, 1996, 1997,
Computer Sciences Department, University of
Wisconsin -- Madison. All Rights Reserved.

<HR>
<H1><A NAME="HRR.6">SEE ALSO</A></H1>

<A HREF="rsrc.common.html"><STRONG>rsrc(common)</STRONG></A>,
<A HREF="lock.ssm.html"><STRONG>lock(ssm)</STRONG></A>,
<A HREF="intro.common.html"><STRONG>intro(common)</STRONG></A>.

<HR>
<H1><A NAME="HRR.7">BUGS</A></H1>

There is a limitation of four share-mode (LATCH_SH) holders for
a latch.  Any additional threads attempting to acquire the latch
will block.

</BODY>
</HTML>
