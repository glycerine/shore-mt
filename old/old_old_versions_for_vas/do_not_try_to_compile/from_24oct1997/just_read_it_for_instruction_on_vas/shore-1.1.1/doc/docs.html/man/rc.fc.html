<!-- Warning: Do not edit this file. -->
<!-- It was created automatically by yam2html.pl 1.3  -->
<!-- on Mon Oct 27 09:41:13 CST 1997 from file manfc/rc.fc -->
<!DOCTYPE HTML public "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
<TITLE>
rc(fc) -- Shore Reference Manual
</TITLE>
<LINK REV="made" HREF="mailto:solomon@cs.wisc.edu">
</HEAD>

<BODY>

<!-- .so tmac.man.local -->
<H1><A NAME="HRR.0">
w_rc_t - Shore return code
</A></H1><HR>
<H1>
CONTENTS
</H1>
<UL>
<LI>
<A HREF="#HRR.1">SYNOPSIS</A>
</LI>
<LI>
<A HREF="#HRR.2">DESCRIPTION</A>
</LI>
<LI>
<A HREF="#HRR.3">MACROS</A>
</LI>
<LI>
<A HREF="#HRR.4">DISPLAYING ERROR MESSAGES</A>
</LI>
<LI>
<A HREF="#HRR.5">REFERENCE COUNTING</A>
</LI>
<LI>
<A HREF="#HRR.6">FORGETTING TO RETURN A W_RC_T</A>
</LI>
<LI>
<A HREF="#HRR.7">RC-LITE</A>
</LI>
<LI>
<A HREF="#HRR.8">VERSION</A>
</LI>
<LI>
<A HREF="#HRR.9">SPONSORSHIP</A>
</LI>
<LI>
<A HREF="#HRR.10">COPYRIGHT</A>
</LI>
<LI>
<A HREF="#HRR.11">SEE ALSO</A>
</LI></UL><HR>
<H1><A NAME="HRR.1">SYNOPSIS</A></H1>
<BLOCKQUOTE><PRE>
<TT>#include &lt;w.h&gt;</TT>
<TT>#include &lt;w_rc.h&gt;</TT>
class w_rc_t;
class w_rc_i;
</PRE></BLOCKQUOTE>
<HR>
<H1><A NAME="HRR.2">DESCRIPTION</A></H1>
<P>
The class
 <em>w_rc_t</em>
encapsulates integer error codes,
prints error messages for the error codes,
lets you build and print stack traces when error codes
are returned, and prints an error message if 
the error codes are not evaluated (checked for errors).
<P>
If a function returns a
 <em>w_rc_t</em>
that is ignored, the  
 <em>w_rc_t</em>
prints the message
<BLOCKQUOTE><PRE>
Error not checked
</PRE></BLOCKQUOTE>
when the instance is destroyed.  The error message
is printed by the
 <strong>error_not_checked</strong>
method, making it a useful debugging breakpoint.
The 
 <em>w_rc_t</em>
maintain reference counts on the various 
 <em>w_error_t</em>
structures for the purpose of collecting
garbage.
<HR>
<H1><A NAME="HRR.3">MACROS</A></H1>
<P>
Use the following macros to create and manipulate return codes:
<DL>
<DT>rc = RC(e)</DT><DD>
Constructs an instance of
 <em>w_rc_t</em>
containing the current line and file information
and the error code 
 <em>e.</em>
If 
 <em>e</em>
is the constant
 <em>w_error_t::no_error,</em>
the resulting 
return code's Boolean conversion operator returns 
 <em>false,</em>
otherwise it returns 
 <em>true.</em>
returns 
</DD>
<DT>RCOK</DT><DD>
Constructs an instance of
 <em>w_rc_t</em>
that signifies no error;
equivalent to 
<BLOCKQUOTE><PRE>
	w_rc_t(w_error_t::no_error);
</DD>
</DL>
</PRE></BLOCKQUOTE>
<DL>
<DT>rc = RC_AUGMENT(rc)</DT><DD>
Adds the current line number and file name to the 
information stored in 
 <em>rc.</em>
</DD>
<DT>rc = RC_PUSH(rc, e)</DT><DD>
Pushes a new error code,
 <em>e,</em>
onto the stack along with the
current line number and file name.
</DD>
</DL>
<HR>
<H1><A NAME="HRR.4">DISPLAYING ERROR MESSAGES</A></H1>
<P>
Printing an instance of 
 <em>w_rc_t</em>
descriptive string for the error code to be printed,
along with the stack trace  (line numbers and file names).
<BLOCKQUOTE><PRE>
	...
	return RC(eUSERABORT);

	...
	w_rc_t rc = RC(eUSERABORT);

	cerr &lt;&lt; rc &lt;&lt; endl;
</PRE></BLOCKQUOTE>
<HR>
<H1><A NAME="HRR.5">REFERENCE COUNTING</A></H1>
<P>
References to 
 <em>w_rc_t</em>
structures are counted.
Return codes that are 
destroyed without being checked
cause this message to be printed to the 
standard error stream:
<BLOCKQUOTE><PRE>
Error not checked
</PRE></BLOCKQUOTE>
<P>
Checking a return code amounts to seeing if
its Boolean conversion operator is true or false:
<BLOCKQUOTE><PRE>
	// call method z, which returns
	// an instance of w_rc_t
	rc = z(); 
	if(rc) {
		// error case
	} else {
		// z() returned RCOK
	}
</PRE></BLOCKQUOTE>

<HR>
<H1><A NAME="HRR.6">FORGETTING TO RETURN A W_RC_T</A></H1>

Sometime a function that returns a
 <strong>w_rc_t</strong>
will not due so due to a bug.  The compiler should
catch this, but we've seen gcc miss it.  As a result,
your program may crash with a stack trace something
like this (from gdb):
<BLOCKQUOTE><PRE>
    #0  0xef7991dc in strrchr ()
    #1  0x44a0 in __ls__FR7ostreamRC9w_error_t (o=@0x10c33c, obj=@0xa000)
        at w_error.c:197
    #2  0xa8728 in __ls__FR7ostreamRC6w_rc_t (o=@0x10c33c, obj=@0xeffff840)
        at w_rc.c:81
    #3  0xa8690 in fatal__6w_rc_t (this=0xeffff840) at w_rc.c:56
    #4  0x3ba4 in main (argc=-268437392, argv=0xeffff914) at hello.C:154
</PRE></BLOCKQUOTE>

<HR>
<H1><A NAME="HRR.7">RC-LITE</A></H1>
<P>
When Shore is configured with -DCHEAP_RC (not the default),
a lighter-weight implementation of the class
 <em>w_rc_t</em>
is used (it is found in
<TT>#include &lt;w_cheaprc.h&gt;</TT>
) in order to reduce processing costs.
In this case, all the macros described here are defined, but
many of them do nothing, since the cheaper implementation
of the class maintains no stack trace, line numbers, or file names.
All it stores is a single integer representing a single error,
and it does no reference-counting. 
<HR>
<H1><A NAME="HRR.8">VERSION</A></H1>
This manual page applies to Version 1.1.1 of the Shore software.
<HR>
<H1><A NAME="HRR.9">SPONSORSHIP</A></H1>
The Shore project is sponsored by the Advanced Research Project Agency, ARPA
order number 018 (formerly 8230), monitored by the U.S. Army Research
Laboratory under contract DAAB07-91-C-Q518.
<HR>
<H1><A NAME="HRR.10">COPYRIGHT</A></H1>
Copyright &#169; 1994, 1995, 1996, 1997,
Computer Sciences Department, University of
Wisconsin -- Madison. All Rights Reserved.
<HR>
<H1><A NAME="HRR.11">SEE ALSO</A></H1>
<A HREF="error.fc.html"><STRONG>error(fc)</STRONG></A>
and
<A HREF="intro.fc.html"><STRONG>intro(fc)</STRONG></A>.
</BODY>
</HTML>
