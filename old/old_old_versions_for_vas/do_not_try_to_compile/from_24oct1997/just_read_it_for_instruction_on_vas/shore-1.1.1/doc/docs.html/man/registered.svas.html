<!-- Warning: Do not edit this file. -->
<!-- It was created automatically by yam2html.pl 1.3  -->
<!-- on Mon Oct 27 09:41:03 CST 1997 from file mansvas/registered.svas -->
<!DOCTYPE HTML public "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
<TITLE>
registered(svas) -- Shore Reference Manual
</TITLE>
<LINK REV="made" HREF="mailto:solomon@cs.wisc.edu">
</HEAD>

<BODY>

<!-- .so tmac.man.local -->
<H1><A NAME="HRR.0">
mkRegistered, mkLink, reName, rmLink1, rmLink2 - creating and destroying registered Shore objects
</A></H1><HR>
<H1>
CONTENTS
</H1>
<UL>
<LI>
<A HREF="#HRR.1">SYNOPSIS</A>
</LI>
<LI>
<A HREF="#HRR.2">DESCRIPTION</A>
</LI>
<LI>
<A HREF="#HRR.3">ARGUMENTS</A>
</LI>
<LI>
<A HREF="#HRR.4">ENVIRONMENT</A>
</LI>
<LI>
<A HREF="#HRR.5">ERRORS</A>
</LI>
<LI>
<A HREF="#HRR.6">BUGS</A>
</LI>
<LI>
<A HREF="#HRR.7">VERSION</A>
</LI>
<LI>
<A HREF="#HRR.8">SPONSORSHIP</A>
</LI>
<LI>
<A HREF="#HRR.9">COPYRIGHT</A>
</LI>
<LI>
<A HREF="#HRR.10">SEE ALSO</A>
</LI></UL><HR>
<H1><A NAME="HRR.1">SYNOPSIS</A></H1>
<BLOCKQUOTE><PRE>
VASResult       shore_vas::mkRegistered(
    const Path          name, 
    mode_t              mode,
    const lrid_t        &amp;typeobj,
    const vec_t         &amp;core,   // initial core value
    const vec_t         &amp;heap,   // initial heap value
    ObjectOffset        tstart, // where TEXT starts
    lrid_t              *result  
);

VASResult       shore_vas::mkRegistered(
    const Path          name,
    mode_t              mode,
    const lrid_t        &amp;typeobj,
    ObjectSize          csize,    // size of uninitialized core
    ObjectSize          hsize,    // size of uninitialized heap
    ObjectOffset        tstart, // where TEXT starts
    lrid_t              *result
);

VASResult       shore_vas::mkLink(
    const Path          oldname,
    const Path          newname
);

VASResult       shore_vas::reName(
    const Path          oldname,
    const Path          newname
);

// The following two methods must be used in sequence:
VASResult       shore_vas::rmLink1(
    const Path          name,
    lrid_t              *obj,
    bool		*must_remove
);

VASResult       shore_vas::rmLink2(
    const lrid_t        &amp;obj
);
</PRE></BLOCKQUOTE>
<HR>
<H1><A NAME="HRR.2">DESCRIPTION</A></H1>
These methods are used to create, destroy, and rename 
registered objects other than directories.
<P>
<strong>NB:</strong>
The SVAS does not check for type integrity.
That is the job of the type system.
So, for example, the SVAS would not notice
if 
 <strong>mkRegistered</strong>
were called with 
<BLOCKQUOTE><PRE>
typeobj == UnixFile, tstart == NoText,
</PRE></BLOCKQUOTE>
and
<BLOCKQUOTE><PRE>
core.size() &gt; 0.
</PRE></BLOCKQUOTE>
Similarly, 
an object of an SDL-defined type can be
removed by EFSD, and no integrity maintenance
is done.
<strong>This will be added. (TODO-integrity maintenance in the server).</strong>
<P>
The 
 <strong>mkRegistered</strong>
methods
create objects with initial data  (the first form)
or with uninitialized data (the second form).
The caller is responsible for the integrity
of the object's type. 
The Shore Value-Added server does not interpret the
type object and does not verify the legitimacy of the
data written.
<P>
The method
 <strong>mkLink</strong>
creates a new entry in a directory.
The new entry refers to an existing registered object.
The object need not be in the same directory as the
new entry, but it must be on the same file system (volume) as the
new entry's directory.
The target of a cannot be a directory (unless the caller is the
super-user) or a symbolic link
(if a symbolic link is named, it is followed), 
and the target must be a registered object.
<P>
The method
 <strong>reName</strong>
effectively changes the name of an object from
 <em>oldname</em>
to 
 <em>newname.</em>
If 
 <em>newname</em>
already exists,
it is removed.
If 
 <em>newname</em>
is a directory, it must be empty,
and its prefix must not include the 
object named by 
 <em>oldname.</em>
The caller must have write access to the
last directories in
 <em>newname</em>
and
 <em>oldname.</em>
If 
 <em>oldname</em>
is a directory, the caller must also have write
permission it.
If the final component of 
 <em>oldname</em>
is a symbolic link, the symbolic
link is renamed.
If 
 <em>newname</em>already<em>exists,</em>
both objects must reside on the same file system,
and both objects must be of the same kind (directories or
non-directories).
<P>
To remove a registered object takes one or two steps,
depending on the object's type and its reference (link) count.
The first step is to call
 <strong>rmLink1,</strong>
which decrements the object's reference count, and destroys
the object if it can.
If it cannot, and the caller must destroy the object
by calling 
 <strong>rmLink2,</strong>
 <strong>rmLink1</strong>returns<strong>TRUE</strong>in
 <em>*must_remove.</em>
There are three cases:
<DL>
<DT>1</DT><DD>
The object's reference count does not reach zero; the object
is not destroyed, regardless of its type.
 <strong>RmLink1</strong>returns<strong>FALSE</strong>in<strong>*must_remove.</strong>
</DD>
<DT>2</DT><DD>
The object is a file system type (other than a directory -- directories
are removed with 
 <strong>rmDir)</strong>
and the reference count reaches zero;
 <strong>rmLink1</strong>destroys<strong>the</strong>object.
 <strong>RmLink1</strong>returns<strong>FALSE</strong>in<strong>*must_remove.</strong>
</DD>
<DT>3</DT><DD>
The reference count reaches zero 
and the object is not a file system type.
The caller has to perform some work to maintain type integrity
before the object can be destroyed, so 
 <strong>rmLink1</strong>
returns TRUE in *must_remove.
<P>
</DD>
</DL>
If the caller attempts to commit the transaction
without calling 
 <strong>rmLink2</strong>
after 
 <strong>rmLink1</strong>returned<strong>TRUE</strong>in
 <em>*must_remove,</em>
or the caller tries to call
 <strong>rmLink2</strong>
on an object 
without first calling
 <strong>rmLink1,</strong>
the Shore Value-Added Server aborts the transaction and
returns in error.
<HR>
<H1><A NAME="HRR.3">ARGUMENTS</A></H1>
 <em>Name</em>
is the name of the object of interest.
It can be a full pathname, a relative pathname, or 
simply the file name.
If it is a file name, the current working directory is assumed
to be the directory in which the object is to reside (or resides,
in the case of removal).
 <em>Mode</em>
is bit mask that specifies the 
<A HREF="permissions.svas.html">permissions</A>
for the object.
 <em>Typeobj</em>
is the logical object identifier of the object that describes
the type of the object to be created.
The type object must already exist and be frozen.
<P>
In the first form of 
<em>mkRegistered,</em>
 <em>core</em>
and 
 <em>heap</em>
are vectors containing initial values of the core
and heap.
In the second form,
 <em>csize</em>
and 
 <em>hsize</em>
indicate the sizes of the core and heap, but not their values.
 <em>Tstart</em>
is the offset, from the beginning of the object,
at which the TEXT field starts.
If the object has no TEXT, 
the value 
<strong>NoText</strong>
should be given.
<P>
If the object is created without problems, the 
resulting object identifier is returned in 
<em>*result.</em>
(There is no way to assign a pre-allocated object
identifier to a registered object.)
<P>
Removing objects takes two steps.
In the first step,
the object is identified by its
pathname.
The object's identifier is returned in
 <em>*obj</em>
if obj is non-null when the function
 <strong>rmLink1</strong>
is called.
The link count for the object is decremented, and 
if it reaches zero,
the value TRUE is placed in 
 <em>*must_remove.</em>
(
 <em>Must_remove</em>
must not be null. )
If TRUE is returned, the caller must 
complete the removal of the object by calling
 <strong>rmLink2</strong>
after 
performing all the integrity maintenance required  by the type system.
<HR>
<H1><A NAME="HRR.4">ENVIRONMENT</A></H1>
These methods are available to both client and
server processes.
They can be used only in a transaction.
<HR>
<H1><A NAME="HRR.5">ERRORS</A></H1>
<P>
Deadlocks can occur while locks are being acquired.  See
<A HREF="transaction.svas.html"><STRONG>transaction(svas)</STRONG></A> 
for information about deadlocks.
<P>
A complete list of errors is in
<A HREF="errors.svas.html"><STRONG>errors(svas)</STRONG></A>.
<HR>
<H1><A NAME="HRR.6">BUGS</A></H1>
Integrity maintenance isn't done on the server.
<P>
Hard links to type objects aren't maintained on the server.
<HR>
<H1><A NAME="HRR.7">VERSION</A></H1>
This manual page applies to Version 1.1.1 of the Shore software.
<HR>
<H1><A NAME="HRR.8">SPONSORSHIP</A></H1>
The Shore project is sponsored by the Advanced Research Project Agency, ARPA
order number 018 (formerly 8230), monitored by the U.S. Army Research
Laboratory under contract DAAB07-91-C-Q518.
<HR>
<H1><A NAME="HRR.9">COPYRIGHT</A></H1>
Copyright &#169; 1994, 1995, 1996, 1997,
Computer Sciences Department, University of
Wisconsin -- Madison. All Rights Reserved.
<HR>
<H1><A NAME="HRR.10">SEE ALSO</A></H1>
<A HREF="errors.svas.html"><STRONG>errors(svas)</STRONG></A>,
<A HREF="transaction.svas.html"><STRONG>transaction(svas)</STRONG></A>,
and
<A HREF="text.svas.html"><STRONG>text(svas)</STRONG></A>.
</BODY>
</HTML>
