<!-- Warning: Do not edit this file. -->
<!-- It was created automatically by yam2html.pl 1.3  -->
<!-- on Mon Oct 27 09:41:03 CST 1997 from file mansvas/poolscan.svas -->
<!DOCTYPE HTML public "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
<TITLE>
poolscan(svas) -- Shore Reference Manual
</TITLE>
<LINK REV="made" HREF="mailto:solomon@cs.wisc.edu">
</HEAD>

<BODY>

<!-- .so tmac.man.local -->
<H1><A NAME="HRR.0">
PoolScan - locate the objects in a Shore pool
</A></H1><HR>
<H1>
CONTENTS
</H1>
<UL>
<LI>
<A HREF="#HRR.1">SYNOPSIS</A>
</LI>
<LI>
<A HREF="#HRR.2">DESCRIPTION</A>
</LI>
<LI>
<A HREF="#HRR.3">ARGUMENTS</A>
</LI>
<LI>
<A HREF="#HRR.4">ENVIRONMENT</A>
</LI>
<LI>
<A HREF="#HRR.5">BUGS</A>
</LI>
<LI>
<A HREF="#HRR.6">VERSION</A>
</LI>
<LI>
<A HREF="#HRR.7">SPONSORSHIP</A>
</LI>
<LI>
<A HREF="#HRR.8">COPYRIGHT</A>
</LI>
<LI>
<A HREF="#HRR.9">SEE ALSO</A>
</LI></UL><HR>
<H1><A NAME="HRR.1">SYNOPSIS</A></H1>
<BLOCKQUOTE><PRE>
VASResult       shore_vas::openPoolScan(
	const lrid_t  &amp;pool,   
	Cookie        *cookie
);
VASResult       shore_vas::openPoolScan(
	const   Path   name,   
	Cookie		   *cookie
);

// get oid of next object in pool
VASResult       shore_vas::nextPoolScan(
	Cookie       	*cookie,
	bool      	*eof,    // TRUE if no result
						// if FALSE, result is legit
	lrid_t        	*result,
	LockMode      	lock=NL,
	SysProps      	*sysprops = 0 // optional
);

VASResult       shore_vas::nextPoolScan(
	Cookie			*cookie,
	bool        	*eof,    // TRUE if no result
						// if FALSE, result is legit
	lrid_t        	*result,     // snapped ref
	ObjectOffset  	offset,
	ObjectSize    	requested,  // -- could be WholeObject
	const vec_t   	&amp;buf,    // -- where to put it
	ObjectSize    	*used = 0,   // - amount copied
	ObjectSize    	*more = 0,   // requested amt not copied
	LockMode      	lock=NL,
	SysProps      	*sysprops = 0 // optional
);


VASResult       shore_vas::closePoolScan(
	const Cookie	&amp;cookie
);
</PRE></BLOCKQUOTE>
<HR>
<H1><A NAME="HRR.2">DESCRIPTION</A></H1>
 <strong>OpenPoolScan</strong>
establishes context for the caller
(the 
 <em>cookie</em>),
in which the given pool is locked and
scanned.
A scan on a pool can be opened by naming the pool (by path)
or by giving the pool's object identifier.
 <strong>NextPoolScan</strong>
retrieves information about the next object in the pool,
within the context of the open scan.
 <strong>ClosePoolScan</strong>
closes the scan and discards all the context information.
<HR>
<H1><A NAME="HRR.3">ARGUMENTS</A></H1>
The argument
 <em>cookie</em>
is a pointer into the caller's address space, 
from which the SVAS retrieves opaque context information on each
operation, and into which the SVAS writes context information  
after each operation.
<P>
The argument
 <em>eof</em>
is also a pointer into the caller's address space, 
where the SVAS writes the value TRUE (1)
if the operation yielded no object, and FALSE (0)
if the operation resulted in another object.
If 
<em>*eof</em>
is returned TRUE, the values of the other return arguments
are meaningful.
<P>
The argument
 <em>result</em>
points to an area in the caller's address space where the
SVAS will write the logical object identifier for the next
object in the pool.  
 <em>result</em>
may not be a null pointer.
The value written into
 <em>*result</em>
is the snapped form of the object's identifier.
<P>
The argument
 <em>sysprops</em>
points to an area in the caller's address space where the
SVAS will place the system properties of the object,  if
 <em>sysprops</em>
is a non-null pointer.
<P>
The argument 
 <em>lock</em>
can be used to increase (but not decrease) the
strength of the lock acquired on the object when
it is inspected by the SVAS.
<P>
The second form of
 <strong>nextPoolScan</strong>
takes several more arguments, whose purpose is
to make the method as general as 
 <strong>readObj.</strong>
They allow the object to be read in full or in part,
by the scan.
<HR>
<H1><A NAME="HRR.4">ENVIRONMENT</A></H1>
These methods are available on the client and server.
All these methods acquire locks, and so they can deadlock.
TODO: need a note about what kinds of locks are acquired.
<HR>
<H1><A NAME="HRR.5">BUGS</A></H1>
A transaction can have no more than one pool scan open at any time. (TODO: extend SSM)
<HR>
<H1><A NAME="HRR.6">VERSION</A></H1>
This manual page applies to Version 1.1.1 of the Shore software.
<HR>
<H1><A NAME="HRR.7">SPONSORSHIP</A></H1>
The Shore project is sponsored by the Advanced Research Project Agency, ARPA
order number 018 (formerly 8230), monitored by the U.S. Army Research
Laboratory under contract DAAB07-91-C-Q518.
<HR>
<H1><A NAME="HRR.8">COPYRIGHT</A></H1>
Copyright &#169; 1994, 1995, 1996, 1997,
Computer Sciences Department, University of
Wisconsin -- Madison. All Rights Reserved.
<HR>
<H1><A NAME="HRR.9">SEE ALSO</A></H1>
<A HREF="sysprops.svas.html"><STRONG>sysprops(svas)</STRONG></A>,
<A HREF="readObj.svas.html"><STRONG>readObj(svas)</STRONG></A>,
<A HREF="mkVolRef.svas.html"><STRONG>mkVolRef(svas)</STRONG></A>,
<A HREF="errors.svas.html"><STRONG>errors(svas)</STRONG></A>,
and
<A HREF="transaction.svas.html"><STRONG>transaction(svas)</STRONG></A>.
</BODY>
</HTML>
