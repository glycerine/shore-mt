<!-- Warning: Do not edit this file. -->
<!-- It was created automatically by yam2html.pl 1.3  -->
<!-- on Mon Oct 27 09:41:07 CST 1997 from file manssm/file.ssm -->
<!DOCTYPE HTML public "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
<TITLE>
ss_m::file/record(ssm) -- Shore Reference Manual
</TITLE>
<LINK REV="made" HREF="mailto:solomon@cs.wisc.edu">
</HEAD>

<BODY>

<!-- .so tmac.man.local -->
<H1><A NAME="HRR.0">
append_rec, create_file, create_id, create_rec, create_rec_id, destroy_file, destroy_rec, lfid_of_lrid, truncate_rec, update_rec, update_rec_hdr - Class ss_m Methods for File/Record Operations

</A></H1><HR>
<H1>
CONTENTS
</H1>
<UL>
<LI>
<A HREF="#HRR.1">SYNOPSIS</A>
</LI>
<LI>
<A HREF="#HRR.2">DESCRIPTION</A>
<UL>
<LI>
<A HREF="#HRR.2.1">Common Parameters</A>
</LI>
</UL>
</LI>
<LI>
<A HREF="#HRR.3">UNINITIALIZED DATA</A>
</LI>
<LI>
<A HREF="#HRR.4">ERRORS</A>
</LI>
<LI>
<A HREF="#HRR.5">EXAMPLES</A>
</LI>
<LI>
<A HREF="#HRR.6">VERSION</A>
</LI>
<LI>
<A HREF="#HRR.7">SPONSORSHIP</A>
</LI>
<LI>
<A HREF="#HRR.8">COPYRIGHT</A>
</LI>
<LI>
<A HREF="#HRR.9">SEE ALSO</A>
</LI></UL><HR>
<H1><A NAME="HRR.1">SYNOPSIS</A></H1>
<BLOCKQUOTE><PRE>
#include &lt;sm_vas.h&gt;  // which includes sm.h


    static rc_t            create_file(
    const lvid_t&amp;             lvid, 
    serial_t&amp;                 lfid,
    store_property_t          property);

    static rc_t            destroy_file(
    const lvid_t&amp;             lvid,
    const serial_t&amp;           lfid); 

    static rc_t            create_rec(
    const lvid_t&amp;             lvid, 
    const serial_t&amp;           lfid,
    const vec_t&amp;              hdr, 
    smsize_t                  len_hint,
    const vec_t&amp;              data, 
    serial_t&amp;                 lrid); 

    static rc_t            create_id(
    const lvid_t&amp;             lvid, 
    int                       id_count, 
    serial_t&amp;                 id_start); 

    static rc_t            create_rec_id(
    const lvid_t&amp;             lvid, 
    const serial_t&amp;           lfid,
    const vec_t&amp;              hdr,
    smsize_t                  len_hint,
    const vec_t&amp;              data, 
    const serial_t&amp;          lrid); 

    static rc_t            destroy_rec(
    const lvid_t&amp;             lvid, 
    const serial_t&amp;           lrid);

    static rc_t            update_rec(
    const lvid_t&amp;             lvid, 
    const serial_t&amp;           lrid,
    smsize_t                  start, 
    const vec_t&amp;              data);

    static rc_t            update_rec_hdr(
        const lvid_t&amp;         lvid, 
    const serial_t&amp;           lrid,
    smsize_t                  start, 
    const vec_t&amp;              hdr);

    static rc_t            append_rec(
    const lvid_t&amp;             lvid, 
    const serial_t&amp;           lrid,
    const vec_t&amp;              data);

    static rc_t            truncate_rec(
    const lvid_t&amp;             lvid, 
    const serial_t&amp;           lrid, 
    smsize_t                  amount);

    // lfid_of_lrid converts a logical record ID into a logical file ID
    static rc_t            lfid_of_lrid(
    const lvid_t&amp;             lvid, 
    const serial_t&amp;           lrid,
    serial_t&amp;                 lfid);

</PRE></BLOCKQUOTE>
<HR>
<H1><A NAME="HRR.2">DESCRIPTION</A></H1>

The above class
 <strong>ss_m</strong>
methods all deal with manipulating files and records.

<H2><A NAME="HRR.2.1">Common Parameters</A></H2>
<P>
There are a number of common parameters for these methods:
<DL>
<DT>lvid</DT><DD>
Logical volume ID of volume containing a file/record.
</DD>
<DT>lfid</DT><DD>
Logical file ID, the serial number of a file.
</DD>
<DT>lrid</DT><DD>
Logical record ID, the serial number of a record.
</DD>
<DT>data</DT><DD>
A vector pointing to data used to fill/overwrite the body of a record.
</DD>
<DT>hdr</DT><DD>
A vector pointing to data used to fill/overwrite the header of a record.

<P>
</DD>
</DL>
<strong>create_file(lvid, lfid, property)</strong>
<DL>
<PP>
The
 <strong>create_file</strong>
method creates a new file on the volume
 <em>lvid,</em>
and returns its serial number in
 <em>lfid.</em>
The 
 <em>property</em>
parameter specifies whether the file is temporary or not.
See
<A HREF="enum.ssm.html"><STRONG>enum(ssm)</STRONG></A>
for more information on file properties.
<P>
</DL>
<DL>
<PP>
See the &quot;ROOT INDEX METHODS&quot; section of
<A HREF="volume.ssm.html"><STRONG>volume(ssm)</STRONG></A>
for information on how to keep track of the files on a volume.

<P>
</DL>
<strong>destroy_file(lvid, lfid)</strong>
<DL>
<PP>
The
 <strong>destroy_file</strong>
method destroys all records in the file and deallocates space used
by a file.  The space used by the file is not available for reuse until
the transaction destroying the file commits.

<P>
</DL>
<strong>create_rec(lvid, lfid, hdr, len_hint, data, lrid)</strong>
<DL>
<PP>
The 
 <strong>create_rec</strong>
method creates a record in a file.  The ID of the new record is
returned in the
 <em>lrid</em>
parameter.  The
 <em>len_hint</em>
parameter is a &quot;hint&quot; about the final length of the record.  If the
creation will be followed by appends,
 <em>len_hint</em>
should ideally be set to the final length of the record.  This will
allow the SM to place the record in a location with sufficient
contiguous space for the record.  A value of 0 should be used
if the final length is unknown.
No order is defined on the records in a file: when a new record
is created, the I/O subsystem may place the record anywhere in the
file.

<P>
</DL>
<strong>create_id(lvid, id_count, id_start)</strong>
<DL>
<PP>
The
 <strong>create_id</strong>
method generates
 <em>id_count</em>
new IDs that can be used later
by
 <strong>create_rec_id</strong>
to associate a records with the IDs.
The first ID is returned in
 <em>id_start.</em>
The other IDs should be obtained by calling
 <strong>id_start::increment(1)</strong>
 <em>id_count</em>
-1 times.

<P>
</DL>
<strong>create_rec_id(lvid, lfid, hdr, len_hint, data, lrid)</strong>
<DL>
<PP>
The
 <strong>create_rec_id</strong>
method is identical to
 <strong>create_rec</strong>
except that the record ID is specified by the caller with the
 <em>lrid</em>
parameter rather than being generated and returned in
 <em>lrid</em>
as is done in
 <strong>create_rec.</strong>

<P>
</DL>
<strong>destroy_rec(lvid, lrid)</strong>
<DL>
<PP>
The
 <strong>destroy_rec</strong>
method destroys the specified record.

<P>
</DL>
<strong>update_rec(lvid, lrid, start, data)</strong>
<DL>
<PP>
The
 <strong>update_rec</strong>
method updates a range of bytes in the body of the record specified by
 <em>lvid, lrid</em>.
The byte offset, from the beginning of the record body, for the
beginning of the range is specified by the
 <em>start</em>
parameter.  The length of the range is the length of the
 <em>data</em>
vector.  The range is replaced by the bytes pointed to by the
 <em>data</em>
parameter.  Note that 
 <strong>update_rec</strong>
cannot be used to change the size of the record.  It is an error
to specify a starting location and vector length that imply updating
beyond the end of the record.

<P>
</DL>
<strong>update_rec_hdr(lvid, lrid, start, hdr)</strong>
<DL>
<PP>
The
 <strong>update_rec_hdr</strong>
method updates a range of bytes in the header of the record
specified by
 <em>lvid, lrid</em>.
The byte offset, from the beginning of the header, for the beginning
of the range is specified by the
 <em>start</em>
parameter.  The length of the range is the length of the
 <em>hdr</em>
vector.  The range is replaced by the bytes pointed to by the
 <em>hdr</em>
parameter.
<PP>
<strong>Note:</strong>
There are no methods for appending to a record header or truncating
a record header (as there are for a record body).  If these methods
would be useful for you, please contact the Shore developers.

<P>
</DL>
<strong>append_rec(lvid, lrid, data)</strong>
<DL>
<PP>
The
 <strong>append_rec</strong>
method appends the bytes pointed to by
 <em>data</em>
to the end of the record body.

<P>
</DL>
<strong>truncate_rec(lvid, lrid, amount)</strong>
<DL>
<PP>
The
 <strong>truncate_rec</strong>
method removes
 <em>amount</em>
bytes from the end of a record body.

<P>
</DL>
<strong>lfid_of_lrid(lvid, lrid, lfid)</strong>
<DL>
<PP>
The
 <strong>lfid_of_lrid</strong>
method returns, in
 <em>lfid,</em>
the ID of file containing the record,
 <em>lrid.</em>

</DL>
<HR>
<H1><A NAME="HRR.3">UNINITIALIZED DATA</A></H1>
<P>
The functions 
 <strong>create_rec,</strong>
 <strong>append_rec,</strong>
and
 <strong>update_rec</strong>
can be used to write blocks of data
that are all zeroes, with minimal logging.
This is useful, for example, when a value-added server 
creates a record of a known size but with uninitialized
data.
To make use of this feature, these functions are called
with data vectors of a specialized type,
 <em>zvec_t,</em>
whose constructor takes only a size:
<BLOCKQUOTE><PRE>
    rc_t    rc;
    char    h[HEADER_SIZE];
    vec_t   hdr(h, sizeof(h));

    // ... fill in hdr

    // create a vector representing 1000 
    // contiuous bytes of zeroes
    zvec_t  zdata(1000);

    rc = ss_m::create_rec(lvid, lfid, hdr,
        HEADER_SIZE + 1000, zdata, result);
</PRE></BLOCKQUOTE>


<HR>
<H1><A NAME="HRR.4">ERRORS</A></H1>

All of the above methods return a
 <strong>w_rc_t</strong>
error code.  If an error occurs during a method that is updating
persistent data (the create, update, append, and truncate methods will
update data) then the record/file could be in an inconsistent state.
The caller then has the choice of aborting the transaction or rolling
back to the nearest save-point (see
<A HREF="transaction.ssm.html"><STRONG>transaction(ssm)</STRONG></A>
).

<P>
See
<A HREF="errors.ssm.html"><STRONG>errors(ssm)</STRONG></A>
for more information on error handling.

<HR>
<H1><A NAME="HRR.5">EXAMPLES</A></H1>
To Do.

<HR>
<H1><A NAME="HRR.6">VERSION</A></H1>
This manual page applies to Version 1.1.1 of the Shore software.
<HR>
<H1><A NAME="HRR.7">SPONSORSHIP</A></H1>
The Shore project is sponsored by the Advanced Research Project Agency, ARPA
order number 018 (formerly 8230), monitored by the U.S. Army Research
Laboratory under contract DAAB07-91-C-Q518.
<HR>
<H1><A NAME="HRR.8">COPYRIGHT</A></H1>
Copyright &#169; 1994, 1995, 1996, 1997,
Computer Sciences Department, University of
Wisconsin -- Madison. All Rights Reserved.
<HR>
<H1><A NAME="HRR.9">SEE ALSO</A></H1>
<A HREF="vec_t.common.html"><STRONG>vec_t(common)</STRONG></A>,
<A HREF="pin_i.ssm.html"><STRONG>pin_i(ssm)</STRONG></A>,
<A HREF="scan_file_i.ssm.html"><STRONG>scan_file_i(ssm)</STRONG></A>,
<A HREF="intro.ssm.html"><STRONG>intro(ssm)</STRONG></A>,

</BODY>
</HTML>
