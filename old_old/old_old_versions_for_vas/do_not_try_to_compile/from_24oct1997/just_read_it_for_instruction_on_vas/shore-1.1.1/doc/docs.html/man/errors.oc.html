<!-- Warning: Do not edit this file. -->
<!-- It was created automatically by yam2html.pl 1.3  -->
<!-- on Mon Oct 27 09:40:55 CST 1997 from file manoc/errors.oc -->
<!DOCTYPE HTML public "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
<TITLE>
errors(oc) -- Shore Reference Manual
</TITLE>
<LINK REV="made" HREF="mailto:solomon@cs.wisc.edu">
</HEAD>

<BODY>

<!-- .so tmac.man.local -->
<H1><A NAME="HRR.0">
errors - error codes and messages for the Shore language-independent
library
</A></H1><HR>
<H1>
CONTENTS
</H1>
<UL>
<LI>
<A HREF="#HRR.1">SYNOPSIS</A>
</LI>
<LI>
<A HREF="#HRR.2">DESCRIPTION</A>
</LI>
<LI>
<A HREF="#HRR.3">ERROR HANDLER</A>
</LI>
<LI>
<A HREF="#HRR.4">BUGS</A>
</LI>
<LI>
<A HREF="#HRR.5">VERSION</A>
</LI>
<LI>
<A HREF="#HRR.6">SPONSORSHIP</A>
</LI>
<LI>
<A HREF="#HRR.7">COPYRIGHT</A>
</LI>
<LI>
<A HREF="#HRR.8">SEE ALSO</A>
</LI></UL><HR>
<H1><A NAME="HRR.1">SYNOPSIS</A></H1>
<BLOCKQUOTE><PRE>
#include &lt;ShoreApp.h&gt;
class Shore;
</PRE></BLOCKQUOTE>
<HR>
<H1><A NAME="HRR.2">DESCRIPTION</A></H1>
<P>
Errors in Shore are indicated by an unsigned integer
wrapped in a mechanism that includes stack
traces and other debugging aids.
The mechanism is the class
 <strong>shrc,</strong>
which is the return-type for most Shore and
and object cache methods.
<P>
The domain of error codes is an extension of the
Unix error codes found in 
<TT>#include &lt;errno.h&gt;</TT>.
Each layer of the Shore software adds its
own extension to the domain.
The Shore object cache compresses all the extensions
into the set of error codes 
found in 
<TT>#include &lt;errno.h&gt;</TT>,
extended by the list below.
The left column shows
<strong>#define -ed</strong>
constants; the right column is a
brief description of the meaning of the error.
<BLOCKQUOTE><PRE>
Manifest constant     -  Meaning
________________________________________________________
SH_AlreadyInitialized - Object cache already initialized
SH_NotInitialized     - Object cache not initialized
SH_OptionsNotInitialized - Process_options or default_options not called yet
SH_BadObject         - Invalid object
SH_BadVolume         - Invalid volume
SH_BadPool           - Invalid pool
SH_BadType           - Invalid type
SH_BadLockMode       - Invalid lock mode
SH_NotAPool          - Object is not a pool
SH_NotADir           - Object is not a directory
SH_ScanAlreadyOpen   - Scan is already open
SH_ScanNotOpen       - Scan is not open
SH_EndOfScan         - Reached EOF in scan
SH_ScanBufTooSmall   - Buffer provided by user is too small
SH_OutOfMemory       - Out of memory
SH_TxNotAllowed      - This operation cannot be performed in a transaction
SH_TxRequired        - This operation must be performed in a transaction
SH_TxAborted         - The transaction was aborted
SH_NotFound          - The named object was not found
SH_Already           - The requested operation was already performed
SH_ROFailure         - Failure in remote operation
SH_Internal          - Object cache internal error
SH_NoIndex           - Index operation attempted on object with no indexes
SH_NoSuchIndex       - Index operation attempted on non-index
SH_DuplicateEntry    - Operation on unique index would cause duplicate entries

</PRE></BLOCKQUOTE>
<P>
To create a return code representing the
error code X, use the 
macro
<tt>RC(X)</tt>
as follows:
<BLOCKQUOTE><PRE>
	return RC(EINVAL);
	// or 
	return RC(SH_TxAborted);
</PRE></BLOCKQUOTE>
<P>
To print an error code and its stack trace, simply
print the return code.
You can print the descriptive string, without
the entire stack trace, with the method
<BLOCKQUOTE><PRE>
static int Shore::perror(shrc &amp;)
</PRE></BLOCKQUOTE>
and you can print the descriptive string for
an integer with the method
<BLOCKQUOTE><PRE>
static int Shore::perror(int)
</PRE></BLOCKQUOTE>
For example:
<BLOCKQUOTE><PRE>
	shrc rc;
	rc = ...

	// print stack trace, etc
	if(rc) {
		cerr &lt;&lt; rc &lt;&lt; endl;
	}

	// print error string only
	if(rc) {
		cerr &lt;&lt; Shore::perror(rc) &lt;&lt; endl;
	}
</PRE></BLOCKQUOTE>
<P>
Lower layers can return other error codes,
too numerous to mention.
They are mostly self-describing, when printed.
When any lower layers return an error, the
object cache converts the error code to an appropriate
one of the above error codes.
If there is no obvious good conversion, the object cache
pushes SH_ROFailure on the top of the error code's stack, 
leaving the lower layer's error code and stack trace in place.
<P>
This means that you can write programs that check for
specific errors, and the only set of values you need to check
is the set of Unix error codes (found in 
<tt>&lt;errno.h&gt;</tt>
and the above set of 
<tt>SH_*</tt>
values.
You check for specific values by invoking the
macro 
<tt>RC(),</tt>
which accepts an integer and returns an
 <em>shrc</em>:
<BLOCKQUOTE><PRE>
	shrc rc;
	rc =  ...

	if( rc == RC(EINVAL) || rc == RC(SH_Already) ) {
		...
	}
</PRE></BLOCKQUOTE>
<HR>
<H1><A NAME="HRR.3">ERROR HANDLER</A></H1>
<P>
If the object cache
encounters an error while following a
reference (
 <em>Ref&lt;T&gt;</em>
), it calls a error-handling function.
There is a default function, which you
can override.
<BLOCKQUOTE><PRE>
void
my_error_handler(shrc rc)
{
	cerr &lt;&lt; &quot;ERROR IN DEREFERENCE  : &quot; &lt;&lt; rc &lt;&lt; endl;
	cerr &lt;&lt; &quot;To debug this, put a breakpoint in my_error_handler()&quot;
	&lt;&lt;endl;
}

<!-- ...  -->

//
// replace the default error-handler with my function
//
(void) Shore::set_error_handler(my_error_handler);

</PRE></BLOCKQUOTE>
<P>
The default handler,
<BLOCKQUOTE><PRE>
void default_error_handler(shrc rc)
</PRE></BLOCKQUOTE>
simply prints 
 <em>rc.</em>
<HR>
<H1><A NAME="HRR.4">BUGS</A></H1>
<HR>
<H1><A NAME="HRR.5">VERSION</A></H1>
This manual page applies to Version 1.1.1 of the Shore software.
<HR>
<H1><A NAME="HRR.6">SPONSORSHIP</A></H1>
The Shore project is sponsored by the Advanced Research Project Agency, ARPA
order number 018 (formerly 8230), monitored by the U.S. Army Research
Laboratory under contract DAAB07-91-C-Q518.
<HR>
<H1><A NAME="HRR.7">COPYRIGHT</A></H1>
Copyright &#169; 1994, 1995, 1996, 1997,
Computer Sciences Department, University of
Wisconsin -- Madison. All Rights Reserved.
<HR>
<H1><A NAME="HRR.8">SEE ALSO</A></H1>
<A HREF="intro.oc.html"><STRONG>intro(oc)</STRONG></A>,
<A HREF="init.oc.html"><STRONG>init(oc)</STRONG></A>,
<A HREF="process_options.oc.html"><STRONG>process_options(oc)</STRONG></A>.
</BODY>
</HTML>
