<!-- Warning: Do not edit this file. -->
<!-- It was created automatically by yam2html.pl 1.3  -->
<!-- on Mon Oct 27 09:41:04 CST 1997 from file mansvas/sysprops.svas -->
<!DOCTYPE HTML public "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
<TITLE>
sysprops(svas) -- Shore Reference Manual
</TITLE>
<LINK REV="made" HREF="mailto:solomon@cs.wisc.edu">
</HEAD>

<BODY>

<!-- .so tmac.man.local -->
<H1><A NAME="HRR.0">
sysprops - system properties of Shore Objects
</A></H1><HR>
<H1>
CONTENTS
</H1>
<UL>
<LI>
<A HREF="#HRR.1">SYNOPSIS</A>
</LI>
<LI>
<A HREF="#HRR.2">DESCRIPTION</A>
</LI>
<LI>
<A HREF="#HRR.3">ARGUMENTS</A>
</LI>
<LI>
<A HREF="#HRR.4">ENVIRONMENT</A>
</LI>
<LI>
<A HREF="#HRR.5">ERRORS</A>
</LI>
<LI>
<A HREF="#HRR.6">VERSION</A>
</LI>
<LI>
<A HREF="#HRR.7">SPONSORSHIP</A>
</LI>
<LI>
<A HREF="#HRR.8">COPYRIGHT</A>
</LI>
<LI>
<A HREF="#HRR.9">SEE ALSO</A>
</LI></UL><HR>
<H1><A NAME="HRR.1">SYNOPSIS</A></H1>
<BLOCKQUOTE><PRE>
typedef serial_t_guts   Ref;
typedef  recsize_t      ObjectOffset;
typedef  recsize_t      ObjectSize;


struct AnonProps {
    Ref     pool;  /* Ref&lt;Pool&gt; or Ref&lt;Module&gt; (same volume) */
};
struct RegProps {
    short   nlink;
    mode_t  mode;
    uid_t   uid;
    gid_t   gid;
    time_t  atime;
    time_t  mtime;
    time_t  ctime;
};

struct SysProps {
    lvid_t          volume; /* like device */
    Ref             ref;    /* like inode */
    Ref             type;
    ObjectSize      csize;
    ObjectSize      hsize;
    ObjectOffset    tstart;
    int             nindex;
    ObjectKind      tag;
    union    {
    // case  KindAnonymous :
        AnonProps ap;

    // case  KindRegistered :
        RegProps rp;

    // case  KindTransient :

    } specific_u;
};

// for registered objects:
VASResult       shore_vas::sysprops(
    const Path          name,   // Shore path --
    SysProps            *sysprops
);

// for anonymous objects
// or registered objects when not
// following symlinks or cross-references 
// in the path lookup
VASResult       shore_vas::sysprops(
    const lrid_t        &amp;loid,
    SysProps            *sysprops,
    bool		wholepage=FALSE, 
    LockMode            lock=S,
    bool		*is_unix_file=NULL,
    bool		*page_cached=NULL
);
</PRE></BLOCKQUOTE>
<HR>
<H1><A NAME="HRR.2">DESCRIPTION</A></H1>
The type
 <strong>SysProps</strong>
describes the properties of every Shore object.
It is Shore's analog of 
 <tt>struct stat</tt>.
<P>
The functions
 <strong>sysprops</strong>
retrieve the system properties
of an object, 
in the form of a
 <em>sysprops</em>
structure.  
<P>
The contents of the structure have the following meanings:
<DL>
<DT>volume</DT><DD>
The logical volume identifier for the volume on which the
object resides.
</DD>
<DT>ref</DT><DD>
The serial number of the object.
Volume and ref, together form the logical OID of the object.
</DD>
<DT>csize</DT><DD>
The size of the object's core.
This is fixed.
</DD>
<DT>hsize</DT><DD>
The size of the object's heap.
</DD>
<DT>tstart</DT><DD>
The offset, in bytes, from the start of the object,
of the object's
<A HREF="text.svas.html">TEXT</A>
attribute.
</DD>
<DT>nindex</DT><DD>
The number of manual indexes that this object contains.
(This reflects only the number that the Language Binding
said the object would contain.  It does not reflect the number
of manual indexes that have actually been added to the object.
There is no nice way to tell how many indexes have been added
to the object; it is assumed that the transaction that creates
the object also creates the indexes, or has its own mechanism, 
for managing the indexes attached to an object.)
</DD>
<DT>tag</DT><DD>
Indicates if the object is anonymous, 
<A HREF="pool.svas.html">anonymous,</A>
<A HREF="file_system.svas.html">registered,</A>
or
<A HREF="transient.svas.html">transient.</A>
</DD>
<DT>specific_u.ap.pool</DT><DD>
If the object is anonymous, this is the 
serial number of the object's pool.
</DD>
<DT>specific_u.rp.nlink</DT><DD>
The number of hard (directory) links to the object.
</DD>
<DT>specific_u.rp.mode</DT><DD>
The number of hard (directory) links to the object.
</DD>
<DT>specific_u.rp.uid</DT><DD>
The user ID of the owner of the object.
</DD>
<DT>specific_u.rp.gid</DT><DD>
The group ID of the group of the object.
</DD>
<DT>specific_u.rp.atime</DT><DD>
The access time of the object (set by
<A HREF="utimes.svas.html">utimes).</A>
</DD>
<DT>specific_u.rp.mtime</DT><DD>
The modification time of the object (set by
<A HREF="utimes.svas.html">utimes</A>
and by updates to the object).
</DD>
<DT>specific_u.rp.ctime</DT><DD>
The status-change time of the object (set by
<A HREF="utimes.svas.html">utimes,</A>
<A HREF="permissions.svas.html">chMod,</A>
<A HREF="permissions.svas.html">chOwn,</A>
and
<A HREF="permissions.svas.html">chGrp).</A>
</DD>
</DL>
<HR>
<H1><A NAME="HRR.3">ARGUMENTS</A></H1>
In the first form, which is used for 
<A HREF="file_system.svas.html">registered objects,</A>
the argument
 <em>name</em>
is a pathname for the object.
A 
<A HREF="lockObj.svas.html">share lock</A>
is acquired for each component directory in the path.
<P>
The second form is used for registered objects
when their OIDs are known,
and for
<A HREF="pool.svas.html">anonymous objects.</A>
This form of 
 <strong>sysprops</strong>
has three arguments with default values.
<P>
 <em>Wholepage,</em>
if TRUE, requests the SVAS to bring an entire
page of objects into the client's address space,
if it can.
This happens if and only if the requested object 
is anonymous, is a 
<A HREF="object.svas.html">small object,</A>
and
the caller is the client (not another value-added server).
If the entire page is copied, the entire page is locked.
<P>
The argument 
 <em>lock</em>
can cause the SVAS to acquire a lock
stronger lock than the default share lock
on the object (or page of objects).
<P>
The argument
 <em>is_unix_file</em>
is a pointer to a (pre-allocated) Boolean variable in the
caller's address space.
If the pointer is non-NULL,
the SVAS returns TRUE if
the object has a 
<A HREF="text.svas.html">TEXT</A>
attribute. 
<P>
In both forms, the
system properties are written into the caller's address space
at the location to which  
the argument
 <em>sysprops</em>
points.
This space must have been allocated by the caller prior to calling
the function.
<P>
The argument
 <em>page_cached</em>
is an (optional) output argument into which 
the SVAS writes 
 <em>true</em>
if the function resulted in a page of small (anonymous) objects being
cached.
See
<A HREF="page.svas.html"><STRONG>page(svas)</STRONG></A>
for information about how to use the page of cached objects.
<HR>
<H1><A NAME="HRR.4">ENVIRONMENT</A></H1>
Both functions are available in both the server and client
environments, but for servers,
the argument
 <em>wholepage</em>
is ignored.
<P>
 <strong>Sysprops</strong>
can be used only in a transaction.
<HR>
<H1><A NAME="HRR.5">ERRORS</A></H1>
The return values are valid only if 
 <strong>sysprops</strong>
returns ST_OK.
<P>
Deadlocks can occur while locks are being acquired.  See
<A HREF="transaction.svas.html"><STRONG>transaction(svas)</STRONG></A> 
for information about deadlocks.
<P>
A complete list of errors is in
<A HREF="errors.svas.html"><STRONG>errors(svas)</STRONG></A>.
<HR>
<H1><A NAME="HRR.6">VERSION</A></H1>
This manual page applies to Version 1.1.1 of the Shore software.
<HR>
<H1><A NAME="HRR.7">SPONSORSHIP</A></H1>
The Shore project is sponsored by the Advanced Research Project Agency, ARPA
order number 018 (formerly 8230), monitored by the U.S. Army Research
Laboratory under contract DAAB07-91-C-Q518.
<HR>
<H1><A NAME="HRR.8">COPYRIGHT</A></H1>
Copyright &#169; 1994, 1995, 1996, 1997,
Computer Sciences Department, University of
Wisconsin -- Madison. All Rights Reserved.
<HR>
<H1><A NAME="HRR.9">SEE ALSO</A></H1>
<A HREF="permissions.svas.html"><STRONG>permissions(svas)</STRONG></A>,
<A HREF="errors.svas.html"><STRONG>errors(svas)</STRONG></A>,
<A HREF="text.svas.html"><STRONG>text(svas)</STRONG></A>,
<A HREF="file_system.svas.html"><STRONG>file_system(svas)</STRONG></A>,
<A HREF="lockObj.svas.html"><STRONG>lockObj(svas)</STRONG></A>,
<A HREF="pool.svas.html"><STRONG>pool(svas)</STRONG></A>,
<A HREF="object.svas.html"><STRONG>object(svas)</STRONG></A>,
<A HREF="utimes.svas.html"><STRONG>utimes(svas)</STRONG></A>,
and
<A HREF="transaction.svas.html"><STRONG>transaction(svas)</STRONG></A>.
</BODY>
</HTML>
