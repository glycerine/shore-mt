<!-- Warning: Do not edit this file. -->
<!-- It was created automatically by yam2html.pl 1.3  -->
<!-- on Mon Oct 27 09:41:01 CST 1997 from file mansvas/manualindex.svas -->
<!DOCTYPE HTML public "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
<TITLE>
manualindex(svas) -- Shore Reference Manual
</TITLE>
<LINK REV="made" HREF="mailto:solomon@cs.wisc.edu">
</HEAD>

<BODY>

<!-- .so tmac.man.local -->
<H1><A NAME="HRR.0">
manualindex - manual indexes in Shore 
</A></H1><HR>
<H1>
CONTENTS
</H1>
<UL>
<LI>
<A HREF="#HRR.1">SYNOPSIS</A>
</LI>
<LI>
<A HREF="#HRR.2">DESCRIPTION</A>
</LI>
<LI>
<A HREF="#HRR.3">ARGUMENTS</A>
</LI>
<LI>
<A HREF="#HRR.4">ENVIRONMENT</A>
</LI>
<LI>
<A HREF="#HRR.5">ERRORS</A>
</LI>
<LI>
<A HREF="#HRR.6">VERSION</A>
</LI>
<LI>
<A HREF="#HRR.7">SPONSORSHIP</A>
</LI>
<LI>
<A HREF="#HRR.8">COPYRIGHT</A>
</LI>
<LI>
<A HREF="#HRR.9">SEE ALSO</A>
</LI></UL><HR>
<H1><A NAME="HRR.1">SYNOPSIS</A></H1>
<BLOCKQUOTE><PRE>
enum IndexKind { LHash, BTree, UniqueBTree, RTree, RDTree };
struct IndexId {
	lrid_t		obj;
	int			i;
};
typedef IndexId IndexId;

VASResult       shore_vas::addIndex(
    const IndexId       &amp;iid, 
    IndexKind           indexKind
);

VASResult       shore_vas::dropIndex(
    const IndexId       &amp;iid, 
);

VASResult       shore_vas::statIndex(
    const IndexId       &amp;iid, 
);

VASResult       shore_vas::insertIndexElem(
    const IndexId       &amp;iid, 
    const vec_t         &amp;key,
    const vec_t         &amp;value
);
VASResult       shore_vas::removeIndexElem(
    const IndexId       &amp;iid, 
    const vec_t         &amp;key,
    const vec_t         &amp;value
);

VASResult       shore_vas::removeIndexElem(
    const IndexId       &amp;iid, 
    const vec_t         &amp;key,
    int                 *numremoved // # elems removed
);

VASResult       shore_vas::findIndexElem(
    const IndexId       &amp;iid, 
    const vec_t         &amp;key,
    const vec_t         &amp;value, 
    ObjectSize          *vallen,
    bool		*found
);
</PRE></BLOCKQUOTE>
<HR>
<H1><A NAME="HRR.2">DESCRIPTION</A></H1>
Manual indexes in Shore
are appendages to Shore objects.
An object can have a fixed number of manual indexes.
When the object is created, the number of indexes is
given, and the SVAS allocates space in the object's metadata
to store the given number of serial numbers for those indexes.
The indexes are not created until the 
language binding layer calls the method
 <strong>addIndex,</strong>
at which time an index is created and its serial number is
placed in the object's metadata.
The language binding may also call
 <strong>dropIndex</strong>
to remove an index from an object.
If an object with indexes is destroyed, all the manual indexes
associated with the object are destroyed by the SVAS.
<P>
The language binding may call
 <strong>insertIndexElem</strong>
and
 <strong>removeIndexElem</strong>
to update indexes.
When keys are known, the language binding layer
locates values associated with the keys by calling
 <strong>findIndexElem.</strong>
Indexes are scanned with a set of methods
that are described in
<A HREF="indexscan.svas.html"><STRONG>indexscan(svas)</STRONG></A>.
<P>
The Shore Value-Added Server maintains
an array of the logical identifiers 
of the indexes that are &quot;contained&quot; in an object.
The array has origin 0, and by repeatedly
calling
 <strong>indexId,</strong>
the identifiers of the indexes in an object
can be discovered.
<P>
The disk space used for an index and its
entries is not reflected in the system
properties of the containing object,
but it can be computed by calling
 <strong>statIndex</strong>
on each index contained in an object.
<HR>
<H1><A NAME="HRR.3">ARGUMENTS</A></H1>
The argument
 <em>iid</em>
identifies the index by identifying
the object that &quot;owns&quot; the index,
and the ordinal number of the index for that object.
<P>
When an index is created, its type must be given
in
 <em>indexKind.</em>
There is no default index type.
TODO add references for index types (btree, rtree, etc).
<P>
An index is part of an object, 
and when it is manipulated, 
the system properties of the &quot;owning&quot; object
are checked for access permission.
The object is thereby locked.
<P>
To insert a key-value pair into an index,
both the the key and value are treated as
byte-strings.
They need not be located in contiguous memory 
the caller's address space, since vectors are
used to describe both the key and value. 
 
InsertIndexElem
does not change the vectors or the values identified by the vectors.
<P>
To remove one key-value pair, 
use the first form of 
 <strong>removeIndexElem,</strong>
in  which the caller provides both the key and value.
To remove all the values associated with a key in a non-unique
index, use the second form of 
 <strong>removeIndexElem,</strong>
in which only the key is given.
The SVAS returns the number of key-value pairs
removed in 
<em>*numremoved.</em>
<em>Numremoved</em>
may not be a null pointer.
<P>
To find a value associated with a known key,
use the method
<em>findIndexElem.</em>
The caller passes in the key and the
value is returned.
The value is placed in caller's address space 
in the place or places identified by
the argument
 <em>value.</em>
The caller is responsible for allocating this space,
and it must be large enough to accommodate any of the
values associated with the given key.
The SVAS writes the length of the value returned into
 <em>vallen.</em>
The vector
 <em>value</em>
is passed as a
<em>const reference</em>
because the vector is not modified, even though
<em>the memory areas that are identified by this vector are updated.</em>
If
<em>eof</em>
is not null, 
 <strong>findIndexElement</strong>
writes 
 <strong>TRUE</strong>(1)
into 
<em>*eof</em>
if there is a value associated with the given key.
If there is no value for the key,
it writes
 <strong>FALSE</strong>(0)
in 
<em>*eof.</em>
<HR>
<H1><A NAME="HRR.4">ENVIRONMENT</A></H1>
All these methods are used in transactions,
and can be invoked by clients and by value-added servers.
<HR>
<H1><A NAME="HRR.5">ERRORS</A></H1>
<P>
Deadlocks can occur while locks are being acquired.  See
<A HREF="transaction.svas.html"><STRONG>transaction(svas)</STRONG></A> 
for information about deadlocks.
<P>
A complete list of errors is in
<A HREF="errors.svas.html"><STRONG>errors(svas)</STRONG></A>.
<HR>
<H1><A NAME="HRR.6">VERSION</A></H1>
This manual page applies to Version 1.1.1 of the Shore software.
<HR>
<H1><A NAME="HRR.7">SPONSORSHIP</A></H1>
The Shore project is sponsored by the Advanced Research Project Agency, ARPA
order number 018 (formerly 8230), monitored by the U.S. Army Research
Laboratory under contract DAAB07-91-C-Q518.
<HR>
<H1><A NAME="HRR.8">COPYRIGHT</A></H1>
Copyright &#169; 1994, 1995, 1996, 1997,
Computer Sciences Department, University of
Wisconsin -- Madison. All Rights Reserved.
<HR>
<H1><A NAME="HRR.9">SEE ALSO</A></H1>
<A HREF="registered.svas.html"><STRONG>registered(svas)</STRONG></A>,
<A HREF="transaction.svas.html"><STRONG>transaction(svas)</STRONG></A>,
<A HREF="errors.svas.html"><STRONG>errors(svas)</STRONG></A>
and
<A HREF="indexscan.svas.html"><STRONG>indexscan(svas)</STRONG></A>.
</BODY>
</HTML>
