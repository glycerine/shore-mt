<!-- Warning: Do not edit this file. -->
<!-- It was created automatically by yam2html.pl 1.3  -->
<!-- on Mon Oct 27 09:41:00 CST 1997 from file mansvas/indexscan.svas -->
<!DOCTYPE HTML public "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
<TITLE>
indexscan(svas) -- Shore Reference Manual
</TITLE>
<LINK REV="made" HREF="mailto:solomon@cs.wisc.edu">
</HEAD>

<BODY>

<!-- .so tmac.man.local -->
<H1><A NAME="HRR.0">
indexscan - scanning Shore indexes
</A></H1><HR>
<H1>
CONTENTS
</H1>
<UL>
<LI>
<A HREF="#HRR.1">SYNOPSIS</A>
</LI>
<LI>
<A HREF="#HRR.2">DESCRIPTION</A>
</LI>
<LI>
<A HREF="#HRR.3">ARGUMENTS</A>
</LI>
<LI>
<A HREF="#HRR.4">ENVIRONMENT</A>
</LI>
<LI>
<A HREF="#HRR.5">BUGS</A>
</LI>
<LI>
<A HREF="#HRR.6">ERRORS</A>
</LI>
<LI>
<A HREF="#HRR.7">VERSION</A>
</LI>
<LI>
<A HREF="#HRR.8">SPONSORSHIP</A>
</LI>
<LI>
<A HREF="#HRR.9">COPYRIGHT</A>
</LI>
<LI>
<A HREF="#HRR.10">SEE ALSO</A>
</LI></UL><HR>
<H1><A NAME="HRR.1">SYNOPSIS</A></H1>
<BLOCKQUOTE><PRE>

enum CompareOp { 
    badOp=0x0, eqOp=0x1, gtOp=0x2, geOp=0x3, ltOp=0x4, leOp=0x5
};
struct IndexId {
	lrid_t		obj;
	int			i;
};
typedef IndexId IndexId;

VASResult       shore_vas::openIndexScan(
    const IndexId       &amp;iid, 
    CompareOp           lc,
    const vec_t         &amp;lbound,
    CompareOp           uc,
    const vec_t         &amp;ubound,
    Cookie              *cookie
);
VASResult       shore_vas::nextIndexScan(
    Cookie              *cookie,
    const vec_t         &amp;key,
    ObjectSize          *keylen,
    const vec_t         &amp;value,
    ObjectSize          *vallen,
    bool                *eof=0   
);
VASResult       shore_vas::closeIndexScan(
    const Cookie        &amp;cookie
);
</PRE></BLOCKQUOTE>
<HR>
<H1><A NAME="HRR.2">DESCRIPTION</A></H1>
Manual indexes in Shore are 
attributes of objects.
The language binding layer creates, destroys, and updates indexes
with the methods
described in
<A HREF="manualindex.svas.html"><STRONG>manualindex(svas)</STRONG></A>.
<P>
When keys are known, the key-value pairs can be located
with 
 <strong>findIndexElem,</strong>
which is also described in 
<A HREF="manualindex.svas.html"><STRONG>manualindex(svas)</STRONG></A>.
<P>
The methods described here are used to locate
ranges of key-value pairs in an index.
The range of an index scan
is limited by upper- and lower-bounds that are
given when the scan is 
<em>opened.</em>
Opening a scan establishes context for the
scan.
Each key-value pair withing the given range
is returned by a distinct invocation of the
method
 <strong>nextIndexScan.</strong>
The scan must be closed with
 <strong>closeIndexScan.</strong>
<P>
Only one scan can be open in any transaction at any time.
An index cannot be updated when a scan is open on the index.
<HR>
<H1><A NAME="HRR.3">ARGUMENTS</A></H1>
The argument
 <em>iid</em>
identifies the manual index. 
<P>
Opening a scan creates a context in which
the method
 <strong>nextIndexScan</strong>
works.
 <strong>OpenIndexScan</strong>
returns a 
 <em>cookie,</em>
which is a value that is meaningful
to the Shore Value-Added Server, but is opaque
to the caller.
The cookie identifies the context of the scan to the
SVAS.
The value written into 
<em>*cookie</em>
by the 
 <strong>openIndexScan</strong>
must be left undisturbed between
calls to any of these methods.
<P>
The range of the scan are determined by
the argument pairs
 <em>lc, lbound</em>
and
 <em>uc, ubound.</em>
A lower- or upper-bound
is a vector with one element,
which identifies a byte string
that is compared with the keys in the index.
<P>
The lowest and highest possible values for bounds are 
<em>negative infinity,</em>
and
<em>positive infinity,</em>
which are static members of the class 
<em>vec_t.</em>
The following example always scans an entire index called
&quot;index&quot;:
<BLOCKQUOTE><PRE>
    class shore_vas *v;
    Cookie       context;
	IndexId		 iid

	iid.oid = ...
	iid.i = 1;
    ...
    v-&gt;openIndexScan(iid, geOp, vec_t::neg_inf,
                    leOp, vec_t::pos_inf, &amp;context);
</PRE></BLOCKQUOTE>
<P>
The method
 <strong>nextIndexScan</strong>
returns key-value pairs for which the key falls within
the bounds of the scan.
Each time it is called, the next key-value pair 
is returned.
The key is placed in caller's address space 
in the place or places identified by
the argument
 <em>key.</em>
The caller is responsible for allocating this space,
and it must be large enough to accommodate any of the
keys in the range of the scan.
The SVAS writes the length of the key returned into
 <em>keylen.</em>
The value is treated the same way.
Both vectors,
 <em>key</em>
and 
 <em>value</em>
are passed as
<em>const references</em>
because the vectors are not modified, but
<em>the memory areas that are identified by these vectors are updated.</em>
The values
<em>*keylen</em>
and
<em>*vallen</em>
are ignored by 
 <strong>nextIndexScan.</strong>
<P>
<HR>
<H1><A NAME="HRR.4">ENVIRONMENT</A></H1>
and can be invoked by clients and by value-added servers.
<P>
TODO: need a note about what kinds of locks are acquired.
<HR>
<H1><A NAME="HRR.5">BUGS</A></H1>
<strong>NB:</strong>
A transaction can have no more than one pool scan open at any time. (TODO: extend SSM)
<P>
<strong>NB:</strong>
index keys are not typed. (Typed keys are forthcoming. (TODO))
<HR>
<H1><A NAME="HRR.6">ERRORS</A></H1>
<P>
If a key or value is larger than the memory given in an output vector
argument, the Shore Storage Manager returns an error (eRECWONTFIT).
See 
<A HREF="errors.ssm.html"><STRONG>errors(ssm)</STRONG></A>
for more information about these errors.
<P>
Deadlocks can occur while locks are being acquired.  See
<A HREF="transaction.svas.html"><STRONG>transaction(svas)</STRONG></A> 
for information about deadlocks.
<P>
A complete list of errors is in
<A HREF="errors.svas.html"><STRONG>errors(svas)</STRONG></A>.
<HR>
<H1><A NAME="HRR.7">VERSION</A></H1>
This manual page applies to Version 1.1.1 of the Shore software.
<HR>
<H1><A NAME="HRR.8">SPONSORSHIP</A></H1>
The Shore project is sponsored by the Advanced Research Project Agency, ARPA
order number 018 (formerly 8230), monitored by the U.S. Army Research
Laboratory under contract DAAB07-91-C-Q518.
<HR>
<H1><A NAME="HRR.9">COPYRIGHT</A></H1>
Copyright &#169; 1994, 1995, 1996, 1997,
Computer Sciences Department, University of
Wisconsin -- Madison. All Rights Reserved.
<HR>
<H1><A NAME="HRR.10">SEE ALSO</A></H1>
<A HREF="registered.svas.html"><STRONG>registered(svas)</STRONG></A>,
<A HREF="transaction.svas.html"><STRONG>transaction(svas)</STRONG></A>,
<A HREF="errors.svas.html"><STRONG>errors(svas)</STRONG></A>,
<A HREF="errors.ssm.html"><STRONG>errors(ssm)</STRONG></A>
and
<A HREF="manualindex.svas.html"><STRONG>manualindex(svas)</STRONG></A>.
</BODY>
</HTML>
