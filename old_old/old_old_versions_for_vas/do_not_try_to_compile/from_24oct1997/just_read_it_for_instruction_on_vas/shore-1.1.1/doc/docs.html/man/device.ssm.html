<!-- Warning: Do not edit this file. -->
<!-- It was created automatically by yam2html.pl 1.3  -->
<!-- on Mon Oct 27 09:41:06 CST 1997 from file manssm/device.ssm -->
<!DOCTYPE HTML public "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
<TITLE>
ss_m::device(ssm) -- Shore Reference Manual
</TITLE>
<LINK REV="made" HREF="mailto:solomon@cs.wisc.edu">
</HEAD>

<BODY>

<!-- .so tmac.man.local -->
<H1><A NAME="HRR.0">
format_dev, mount_dev, dismount_dev, dismount_all, list_devices, list_volumes, get_device_quota - Class ss_m Methods for Device Management
</A></H1><HR>
<H1>
CONTENTS
</H1>
<UL>
<LI>
<A HREF="#HRR.1">SYNOPSIS</A>
</LI>
<LI>
<A HREF="#HRR.2">DESCRIPTION</A>
</LI>
<LI>
<A HREF="#HRR.3">ERRORS</A>
</LI>
<LI>
<A HREF="#HRR.4">TRANSACTION ISSUES</A>
</LI>
<LI>
<A HREF="#HRR.5">EXAMPLES</A>
</LI>
<LI>
<A HREF="#HRR.6">VERSION</A>
</LI>
<LI>
<A HREF="#HRR.7">SPONSORSHIP</A>
</LI>
<LI>
<A HREF="#HRR.8">COPYRIGHT</A>
</LI>
<LI>
<A HREF="#HRR.9">SEE ALSO</A>
</LI></UL><HR>
<H1><A NAME="HRR.1">SYNOPSIS</A></H1>
<BLOCKQUOTE><PRE>
#include &lt;sm_vas.h&gt;  // which includes sm.h

static rc_t      format_dev(
    const char*            device,
    uint4                  quota_in_KB,
    bool                   force);
static rc_t      mount_dev(
    const char*            device,
    u_int&amp;                 vol_cnt,
    devid_t&amp;               devid,
    vid_t                  local_vid = vid_t::null);
static rc_t      dismount_dev(const char* device);
static rc_t      dismount_all();
static rc_t      list_devices(
    const char**&amp;          dev_list,
    devid_t*&amp;              devid_list,
    u_int&amp;                 dev_cnt);
static rc_t      list_volumes(
    const char*            device,
    lvid_t*&amp;               lvid_list,
    u_int&amp;                 lvid_cnt);
static rc_t      get_device_quota(
    const char*            device, 
    smksize_t&amp;             quota_KB, 
    smksize_t&amp;             quota_used_KB);

</PRE></BLOCKQUOTE>

<HR>
<H1><A NAME="HRR.2">DESCRIPTION</A></H1>

The above class
 <strong>ss_m</strong>
methods all deal with managing the devices
that hold volumes.
<P>
A device is either an operating system file or operating system
device and is identified by a path name (absolute or relative).
A device has a quota.  A device may have multiple volumes on it
(in the current implementation the maximum number of volumes
is 1).
<P>
A volume is where data are stored.  A volume is identified
uniquely and persistently by a logical volume ID (lvid_t).
Volumes can be used whenever the device they are located
on is mounted by the SM.  Volumes have a quota.  The
sum of the quotas of all the volumes on a device cannot
exceed the device quota.  Methods for volume management are
described in
<A HREF="volume.ssm.html"><STRONG>volume(ssm)</STRONG></A>.

<P>
<strong>format_dev(device, quota_in_KB, force)</strong>
<DL>
<PP>
The
 <strong>format_dev</strong>
method is used to format a storage device for use in holding
volumes.  The 
 <em>device</em>
parameter the path-name of the device to format.  The
 <em>quota_in_KB</em>
is the quota (maximum usable space) for the device, specified
in kilobytes.  Setting the
 <em>force</em>
parameter to
<strong>true</strong>
indicates that the device should be formatted even if
 <em>device</em>
already exists.  Setting it to
<strong>false</strong>
 will generate the POSIX error,
<strong>EEXIST</strong>
indicating that
 <em>device</em>
already exists.  Since raw-devices always &quot;exist&quot;,
<strong>true</strong>
must always be used.
The SM will now allow a device to be formatted if it is already
mounted.

<P>
</DL>
<strong>mount_dev(device, vol_cnt, devid, local_vid)</strong>
<DL>
<PP>
The
 <strong>mount_dev</strong>
method makes all volumes on a device available for access.
The number of volumes on the device is returned in
 <em>vol_cnt.</em>The
 <strong>list_devices</strong>
method described below can be used to determine the IDs of
the volumes on the device.
The ID of the device (unique only to the server) is returned in
 <em>devid.</em>Device<em>IDs</em>are<em>not</em>used<em>as</em>parameters<em>in</em>any<em>server</em>methods,
but some VASs may find them useful for their own purposes.
The
 <em>local_vid</em>
parameter is only meant to be a temporary hack for those VASs using the
physical ID version of the SM interface.
 <em>Local_vid</em>
is used to specify the
local handle that should be when a volume is mounted.  The default value,
 <strong>vid_t::null</strong>
indicates that the SM can use any number it wants to use.
<P>
</DL>
<DL>
<PP>
It is OK to mount a device multiple times, as long as
 <em>device</em>
is always the same (ie. you cannot specify another path that is a
hard/soft link to the path given in previous mount requests).
Device mounts are not reference counted, so only a single
 <strong>dismount_dev</strong>
call is necessary to dismount a device.


<P>
</DL>
<strong>dismount_dev(device)</strong>
<DL>
<PP>
The
 <strong>dismount_dev</strong>
method flushes all cached pages on the device and makes all volumes
on the device unavailable.
<strong>Note:</strong>
Currently, there is no check made to make sure no transactions
are using a device when it is dismounted.  If a transaction
operation accesses a volume on a device that is no longer mounted, an
error is returned from the operation.  If a transaction previously 
accessed a volume on a device that is no longer mounted, and the
transaction aborts, a fatal error will occur, shutting down
the server.

<P>
</DL>
<strong>dismount_all()</strong>
<DL>
<PP>
The
 <strong>dismount_all</strong>
method dismount all mounted devices.

<P>
</DL>
<strong>list_devices(dev_list, devid_list, dev_cnt)</strong>
<DL>
<PP>
The
 <strong>list_devices</strong>
method returns, in
 <em>dev_list,</em>
an array of char* pointers to the names of
all mounted devices.  Note that the use of a char*'s is 
a temporary hack until a standard string class is available.
The char* pointers are pointing directly into the device
mount table.
The
 <em>devid_list</em>
is changed to point to an array of device IDs. 
<strong>Note:</strong>
 <em>dev_list</em>
and
 <em>devid_list</em>
 must be deleted with delete [] by the
caller if they are not null (0).  They will be null
if an error is returned or if there are no devices.
The
 <em>dev_cnt</em>
parameter is the number of elements in the returned
lists.

<P>
</DL>
<strong>list_volumes(device, lvid_list, lvid_cnt)</strong>
<DL>
<PP>
The
 <strong>list_volumes</strong>
method returns, via lvid_list, an array containing the 
IDs of all volumes on
 <em>device.</em>
The
 <em>lvid_cnt</em>
parameter is set to the length of the list returned.
 <em>Lvid_list</em>must<em>be</em>deleted<em>with</em>delete<em>[]</em>by<em>the</em>caller<em>if</em>
lvid_list is not null (0).  lvid_list will be null
if an error is returned or if there are no volumes on the device.

<P>
</DL>
<strong>get_device_quota(device, quota_KB, quota_used_KB)</strong>
<DL>
<PP>
The
 <strong>get_device_quota</strong>
method returns the quota (in K-bytes) in
 <em>quota_KB</em>
and the amount of the quota, allocated to volumes on the device, in
 <em>quota_used_KB.</em>


</DL>
<HR>
<H1><A NAME="HRR.3">ERRORS</A></H1>

All of the above methods return a
 <strong>w_rc_t</strong>
error code.

<P>
See
<A HREF="errors.ssm.html"><STRONG>errors(ssm)</STRONG></A>
for more information on error handling.

<HR>
<H1><A NAME="HRR.4">TRANSACTION ISSUES</A></H1>
<P>
Many of the above methods cannot be run in the scope of
a transaction.  The reason for this restriction is to avoid
the implication that rolling back (aborting) the transaction
would rollback the effect of the method.


<HR>
<H1><A NAME="HRR.5">EXAMPLES</A></H1>
TODO

<HR>
<H1><A NAME="HRR.6">VERSION</A></H1>
This manual page applies to Version 1.1.1 of the Shore software.
<HR>
<H1><A NAME="HRR.7">SPONSORSHIP</A></H1>
The Shore project is sponsored by the Advanced Research Project Agency, ARPA
order number 018 (formerly 8230), monitored by the U.S. Army Research
Laboratory under contract DAAB07-91-C-Q518.
<HR>
<H1><A NAME="HRR.8">COPYRIGHT</A></H1>
Copyright &#169; 1994, 1995, 1996, 1997,
Computer Sciences Department, University of
Wisconsin -- Madison. All Rights Reserved.
<HR>
<H1><A NAME="HRR.9">SEE ALSO</A></H1>
<A HREF="intro.ssm.html"><STRONG>intro(ssm)</STRONG></A>,
<A HREF="volume.ssm.html"><STRONG>volume(ssm)</STRONG></A>.

</BODY>
</HTML>
