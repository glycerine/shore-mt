<!-- Warning: Do not edit this file. -->
<!-- It was created automatically by yam2html.pl 1.3  -->
<!-- on Mon Oct 27 09:41:08 CST 1997 from file manssm/lock.ssm -->
<!DOCTYPE HTML public "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
<TITLE>
ss_m::lock(ssm) -- Shore Reference Manual
</TITLE>
<LINK REV="made" HREF="mailto:solomon@cs.wisc.edu">
</HEAD>

<BODY>

<!-- .so tmac.man.local -->
<H1><A NAME="HRR.0">
lock, unlock, query_lock, set_lock_cache_enable, lock_cache_enabled - Class ss_m Methods for Locking

</A></H1><HR>
<H1>
CONTENTS
</H1>
<UL>
<LI>
<A HREF="#HRR.1">SYNOPSIS</A>
</LI>
<LI>
<A HREF="#HRR.2">DESCRIPTION</A>
<UL>
<LI>
<A HREF="#HRR.2.1">Lock Cache Control</A>
</LI>
<LI>
<A HREF="#HRR.2.2">Escalation</A>
</LI>
</UL>
</LI>
<LI>
<A HREF="#HRR.3">ERRORS</A>
</LI>
<LI>
<A HREF="#HRR.4">EXAMPLES</A>
</LI>
<LI>
<A HREF="#HRR.5">VERSION</A>
</LI>
<LI>
<A HREF="#HRR.6">SPONSORSHIP</A>
</LI>
<LI>
<A HREF="#HRR.7">COPYRIGHT</A>
</LI>
<LI>
<A HREF="#HRR.8">SEE ALSO</A>
</LI></UL><HR>
<H1><A NAME="HRR.1">SYNOPSIS</A></H1>
<BLOCKQUOTE><PRE>
#include &lt;sm_vas.h&gt;  // which includes sm.h

static rc_t                 lock(
    const lvid_t&amp;               lvid,
    lock_mode_t                 mode,
    lock_duration_t             duration = t_long,
    long                        timeout = WAIT_SPECIFIED_BY_XCT);

static rc_t                 lock(
    const lvid_t&amp;               lvid,
    const serial_t&amp;             serial,
    lock_mode_t                 mode,
    lock_duration_t             duration = t_long,
    long                        timeout = WAIT_SPECIFIED_BY_XCT);

static rc_t                 unlock(
    const lvid_t&amp;               lvid,
    const serial_t&amp;             serial);

static rc_t                 query_lock(
    const lvid_t&amp;               lvid,
    const serial_t&amp;             serial,
    lock_mode_t&amp;                mode,
    bool                        implicit = FALSE);

static rc_t                 set_lock_cache_enable(bool enable);
static rc_t                 lock_cache_enabled(bool&amp; enabled);

static rc_t                 set_escalation_thresholds(
    int4                        toPage,
    int4                        toStore,
    int4                        toVolume);

static rc_t                 get_escalation_thresholds(
    int4&amp;                       toPage,
    int4&amp;                       toStore,
    int4&amp;                       toVolume);

static rc_t                 dont_escalate(
    const lockid_t&amp;             n,
    bool                        passOnToDescendants = true);
static rc_t                 dont_escalate(
    const lvid_t&amp;               lvid,
    const serial_t&amp;             serial,
    bool                        passOnToDescendants = true);
static rc_t                 dont_escalate(
    const lvid_t&amp;               lvid,
    bool                        passOnToDescendants = true);

</PRE></BLOCKQUOTE>
<HR>
<H1><A NAME="HRR.2">DESCRIPTION</A></H1>

For a discussion of the locking done by the SSM is found in
<A HREF="../overview/overview.html">An Overview of Shore.</A>

<P>
Locks are acquired implicitly by many 
 <strong>ss_m</strong>
methods.  
For those situations where more precise control of locking is
desired, the following methods allow explicit locking and unlocking.

<P>
<strong>lock(lvid, mode, duration, timeout)</strong>
<P>
<strong>lock(lvid, serial, mode, duration, timeout)</strong>
<DL>
<PP>
The
 <strong>lock</strong>
method is used to acquire a lock on volume, index, file or record.
The first version of the method locks the volume specified by
 <em>lvid.</em>
The second version locks the index, file or record specified by
 <em>lvid,serial.</em>
The
 <em>mode</em>
parameter specifies the lock mode to acquire.
Valid lock_mode_t values are listed in
<tt> basics.h</tt>.
The
 <em>duration</em>
parameter specifies how long the lock will be held.
Valid values (among those listed in <tt>basics.h</tt>) are:
t_instant, t_short and t_long.  The
 <em>timeout</em>
parameter specifies how long to wait for a lock.

<P>
</DL>
<strong>unlock(lvid, serial)</strong>
<DL>
<PP>
The
 <strong>unlock</strong>
method releases the most recently acquired lock on the file,
index, or record identified by
 <em>lvid,serial.</em>
Note, that only locks with duration
<strong>t_short</strong>
can be released before end-of-transaction.

<P>
</DL>
<strong>query_lock(lvid, serial, mode, implicit)</strong>
<DL>
<PP>
The
 <strong>query_lock</strong>
method the mode of the lock held on
 <em>lvid,serial</em>
by the current transaction.
The lock mode is returned in
 <em>mode</em>
and will be
<strong>NL</strong>
(no lock) if not locked.
If
 <em>implicit</em>
is 
<strong>false</strong>
then only explicit locks on 
 <em>lvid,serial</em>
will be considered.  For example, if file F is
<strong>SH</strong>
locked
and a query is made about a record in F, the mode returned
will be
<strong>NL.  However, if</strong>
 <em>implicit</em>
is
<strong>true,</strong>
then
<strong>SH</strong>
would be returned for this example.

</DL>
<H2><A NAME="HRR.2.1">Lock Cache Control</A></H2>
<P>
Each transaction has a cache of recently acquired locks
The following methods control the use of the cache.
These are not supported methods and may be removed
in later versions of the software.
Note: that the methods only affect the transaction
associated with the current thread.

<P>
<strong>set_lock_cache_enable(enable)</strong>
<DL>
<PP>
The
 <strong>set_lock_cache_enable</strong>
method turns on the cache if
 <em>enable</em>
is
<strong>true</strong>
and turns it off otherwise.

<P>
</DL>
<strong>lock_cache_enabled(enabled)</strong>
<DL>
<PP>
The
 <strong>lock_cache_enabled</strong>
method sets
 <em>enabled</em>
to
<strong>true</strong>
if the lock cache is on.

</DL>
<H2><A NAME="HRR.2.2">Escalation</A></H2>
<P>
The lock manager will escalate from a record lock to a page lock,
from a page lock to a store lock, and from a store lock to a volume
lock, to reduce the number of locks in the table.
You can control the thresholds for escalation throught the methods
 <strong>get_escalation_thresholds</strong>
and
 <strong>set_escalation_thresholds.</strong>
The default values are as follows:
<DL>
<DT>record-to-page</DT><DD>
5
</DD>
<DT>page-to-store</DT><DD>
25
</DD>
<DT>store-to-volume</DT><DD>
0 

<P>
</DD>
</DL>
In all cases, a threshold of 0 prevents escalation.

<P>
When escalation is in use, 
it be prevented on selected volumes or other lock-able
objects through the three 
 <strong>don_escalate</strong>
methods.
If the argument
 <em>passOnToDescendants</em>is
 <em>false,</em>
locks acquired on objects below the volume (or given lockid)
in the lock hierarchy will still be escalated according to the
thresholds.

<HR>
<H1><A NAME="HRR.3">ERRORS</A></H1>

TODO

<HR>
<H1><A NAME="HRR.4">EXAMPLES</A></H1>

TODO

<HR>
<H1><A NAME="HRR.5">VERSION</A></H1>
This manual page applies to Version 1.1.1 of the Shore software.
<HR>
<H1><A NAME="HRR.6">SPONSORSHIP</A></H1>
The Shore project is sponsored by the Advanced Research Project Agency, ARPA
order number 018 (formerly 8230), monitored by the U.S. Army Research
Laboratory under contract DAAB07-91-C-Q518.
<HR>
<H1><A NAME="HRR.7">COPYRIGHT</A></H1>
Copyright &#169; 1994, 1995, 1996, 1997,
Computer Sciences Department, University of
Wisconsin -- Madison. All Rights Reserved.
<HR>
<H1><A NAME="HRR.8">SEE ALSO</A></H1>
<A HREF="../overview/overview.html">An Overview of Shore</A>
,
<A HREF="transaction.ssm.html"><STRONG>transaction(ssm)</STRONG></A>
and 
<A HREF="intro.ssm.html"><STRONG>intro(ssm)</STRONG></A>.

</BODY>
</HTML>
