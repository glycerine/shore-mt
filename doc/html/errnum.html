<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Shore Storage Manager: Error Codes</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
    <li><a href="examples.html"><span>Examples</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<h1><a class="anchor" name="ERRNUM">Error Codes</a></h1>This page describes the error codes used in the various Shore Storage Manager modules.<p>
These numbers are generated by the Perl script <div class="fragment"><pre class="fragment"> tools/errors.pl
</pre></div><p>
This page is of interest to those who wish to use this tool to generate their own sets of error codes.<h2><a class="anchor" name="ERRNUM1">
Error Codes and Modules</a></h2>
Error codes are unsigned integers. Each error code has associated metadata, which consists of a descriptive string and a name (either by way of an enumeration, or by a C-preprocessor-defined name).<p>
The integer values associated with error code names, the descriptive strings, the enumerations, and the C Preprocessor macros are generated by the Perl script. Error codes are grouped into modules, so that all the error codes for a software module and their metadata are kept together. Each module is given a mask, which is folded into the values assigned to the errorcodes. This keeps the error codes for different software modules distinct. The software that manages error codes keeps a (global) list of all the modules of error codes. Each software layer that uses the error codes must invoke a method to `install' its module in the global list, preferably at server start-up time, in the main thread, using <a class="el" href="dc/dc2/classw__error__t.html#031955332b2936316155d89bbf87c081">w_error_t::insert</a>, which is called by a Perl-generated method &lt;class&gt;init_errorcodes();-<h2><a class="anchor" name="ERRNUM2">
Generating Sets of Error Codes</a></h2>
Generating the codes is best described by way of an example. The following example is taken from the Shore Storage Manager.<p>
The script takes one of two mutually exclusive options, and a file name. One or the other of the options (-d, -e) is required: <div class="fragment"><pre class="fragment"> $(SHORE_SOURCES)/tools/errors.pl -d &lt;input-file&gt;
    or
 $(SHORE_SOURCES)/tools/errors.pl -e &lt;input-file&gt;
</pre></div><p>
In the first case (-d) the named constants are generated as C preprocessor defined constants. The prefix of the generated names is capitalized and separated from the rest of the name by an underscore character.<p>
In the second case (-e) the named constants are generated as members of an anonymous enumeration. The prefix of the generated names is taken, case unchanged, from the input file. <div class="fragment"><pre class="fragment"> e = 0x00080000 <span class="stringliteral">"Storage Manager"</span> smlevel_0 {
 
 ASSERT          Assertion failed
 USERABORT       User initiated abort
 ... and so on ...
 }
</pre></div><p>
The input is parsed as follows. On the first line:<ul>
<li><b>e</b> A prefix used to generate the names of the constants for the error codes for this module. This prefix must not conflict with prefixes for other modules.</li><li><b>=</b> Separates the name prefix from the mask.</li><li><b>0x00080000</b> This mask is added into each named constant generated for this module. This mask must not conflict with the masks used in other modules.</li><li><b>"Storage Manager"</b> The name of the module.</li><li><b>smlevel_0</b> The name of a C++ class. If a class name is present, certain generated data structures and methods will be members of the class, such as init_errorcodes(), which will be &lt;class&gt;init_errorcodes(). If no class name appears, these entities will have global namescope.</li><li><b>{</b> Begins the set of error codes and descriptions for this module.</li></ul>
<p>
<ul>
<li>The next two lines define error codes:<ul>
<li>ASSERT</li><li>USERABORT These cause the named constants eASSERT and eUSERABORT to appear in an anonymous enumeration type. The values associated with eASSERT and eUSERABORT will contain the mask: <div class="fragment"><pre class="fragment">   <span class="keyword">enum</span> {
     eASSERT    = 0x80000,
     eUSERABORT = 0x80001,
     ...
   }
</pre></div> The string <b>"Assertion failed"</b> is the descriptive string associated with eASSERT. These descriptive strings will appear in arrays generated by the Perl script.</li></ul>
</li><li><b>}</b> Ends the set of error codes and descriptions for this module.</li></ul>
<p>
Blank lines may appear anywhere. Lines beginning with <b>#</b> are comments.<h2><a class="anchor" name="ERRNUM3">
Generated Files</a></h2>
The names of the files generated contain the prefix given on the first line of the module's input. In the above example, that prefix is <b>e</b>.<p>
The set of files generated is determined by the arguments with which the script is invoked: <h3><a class="anchor" name="errorspld">
errors.pl -d &lt;file&gt; :</a></h3>
<ul>
<li>&lt;prefix&gt;_error_def_gen.h<ul>
<li>defines C Preprocessor macros for the &lt;prefix&gt;_ERROR values, e.g., <div class="fragment"><pre class="fragment"><span class="preprocessor">        #define E_ASSERT 0x80000</span>
</pre></div></li></ul>
</li><li>&lt;prefix&gt;_errmsg_gen.h (same as with -e option)<ul>
<li>defines an array<div class="fragment"><pre class="fragment"> <span class="keyword">static</span> <span class="keywordtype">char</span>* &lt;prefix&gt;_errmsg[] 
</pre></div> containing the descriptive strings and <div class="fragment"><pre class="fragment"> const &lt;prefix&gt;_msg_size = &lt;number of error codes in <span class="keyword">this</span> module&gt; 
</pre></div>.</li></ul>
</li><li>&lt;prefix&gt;_einfo_gen.h (same as with -e option)<ul>
<li>defines an array<div class="fragment"><pre class="fragment"> &lt;<span class="keyword">class</span>&gt;::error_info[] 
</pre></div> of { integer, descriptive-string } pairs.</li><li>defines the method<div class="fragment"><pre class="fragment"> void &lt;class&gt;::init_errorcodes() 
</pre></div> to be called by the server at start-up to insert the module information into the global list; this is generated only if the module contains a class name.</li></ul>
</li><li>&lt;prefix&gt;_einfo_bakw_gen.h<ul>
<li>defines an array<div class="fragment"><pre class="fragment"> &lt;prefix&gt;_error_info_backw[] 
</pre></div> of { integer, string-name-of-macro } pairs.</li></ul>
</li></ul>
<h3><a class="anchor" name="errorsple">
errors.pl -e &lt;file&gt; :</a></h3>
<ul>
<li>&lt;prefix&gt;_error_enum_gen.h<ul>
<li>defines an enumeration for the &lt;prefix&gt;_ERROR values, e.g., <div class="fragment"><pre class="fragment">        <span class="keyword">enum</span> {
         eASSERT         = 0x80000,
         eUSERABORT      = 0x80001,
         ...
        }
</pre></div></li></ul>
</li><li>&lt;prefix&gt;_errmsg_gen.h (same as with -d option)<ul>
<li>defines an array<div class="fragment"><pre class="fragment"> <span class="keyword">static</span> <span class="keywordtype">char</span>* &lt;prefix&gt;_errmsg[] 
</pre></div> containing the descriptive strings and <div class="fragment"><pre class="fragment"> const &lt;prefix&gt;_msg_size = &lt;number of error codes in <span class="keyword">this</span> module&gt; 
</pre></div>.</li></ul>
</li><li>&lt;prefix&gt;_einfo_gen.h (same as with -d option)<ul>
<li>defines an array<div class="fragment"><pre class="fragment"> &lt;<span class="keyword">class</span>&gt;::error_info[] 
</pre></div> of { integer, descriptive-string } pairs.</li><li>defines the method<div class="fragment"><pre class="fragment"> void &lt;class&gt;::init_errorcodes() 
</pre></div> to be called by the server at start-up to insert the module information into the global list. This is generated only if the module contains a class name. </li></ul>
</li></ul>
<hr size="1"><address style="align: right;"><small>Generated on Mon Jan 2 15:13:58 2012 for Shore Storage Manager by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
