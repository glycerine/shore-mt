<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Shore Storage Manager: Programming Idioms</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
<link href="../../tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="../../main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="../../modules.html"><span>Modules</span></a></li>
    <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="../../classes.html"><span>Classes</span></a></li>
    <li><a href="../../files.html"><span>Files</span></a></li>
    <li><a href="../../dirs.html"><span>Directories</span></a></li>
    <li><a href="../../pages.html"><span>Related&nbsp;Pages</span></a></li>
    <li><a href="../../examples.html"><span>Examples</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<h1>Programming Idioms<br>
<small>
[<a class="el" href="../../dc/dc8/group___s_s_m_a_p_i.html">SHORE Storage Manager Application Programming Interface (SSM API)</a>]</small>
</h1>
<p>
Collaboration diagram for Programming Idioms:<center><table><tr><td><img src="../../d0/dcf/group___i_d_i_o_m_s.png" border="0" alt="" usemap="#db/d1d/d0_2dcf_2group______i__d__i__o__m__s_map">
<map name="db/d1d/d0_2dcf_2group______i__d__i__o__m__s_map">
<area href="../../dc/dc8/group___s_s_m_a_p_i.html" shape="rect" coords="5,5,472,32" alt="">
</map></td></tr></table></center>
The storage manager is written with programming idioms to make sure all return codes are checked, and as a user of the storage manager, you strongly encouraged to use these idioms.<p>
It is especially important that you understand the storage manager's <em>return</em> <em>code</em> type, <a class="el" href="../../db/dc7/classw__rc__t.html">w_rc_t</a>. Most of the storage manager methods return this type. The return code type is a dynamically-allocated class instance (except when RCOK, the default, non-error code, is returned: this is a static constant). Because it is heap-allocated, when the compiler generates code for its destruction, certain programming errors are nastier than in the case of returning an atomic type (e.g., int). For example, if you write a function with a <a class="el" href="../../db/dc7/classw__rc__t.html">w_rc_t</a> return type and neglect to give it a return value, your program will probably fail catastrophically. (You can avoid this problem by compiling with compiler warnings enabled.)<p>
The return code from a storage manager method should <em>always</em> be checked: <div class="fragment"><pre class="fragment"> <a class="code" href="../../db/dc7/classw__rc__t.html">w_rc_t</a> func(...)
 {
     ...
     <a class="code" href="../../db/dc7/classw__rc__t.html">w_rc_t</a> rc = <a class="code" href="../../d8/db0/group___s_s_m_f_i_l_e.html#gd35373a32c3480b5437e7d602065d6e5">ss_m::create_file</a>(...);
     <span class="keywordflow">if</span>(rc.<a class="code" href="../../db/dc7/classw__rc__t.html#a1c11327f611544881a9e1314c67f9ad">is_error</a>()) {
        ...
     }
     <span class="keywordflow">return</span> <a class="code" href="../../d1/d83/w__rc_8h.html#0f25e1835ee19d3905bd8ee2d2f0c86c">RCOK</a>;
 }
</pre></div> The act of calling<div class="fragment"><pre class="fragment"> rc.<a class="code" href="../../db/dc7/classw__rc__t.html#a1c11327f611544881a9e1314c67f9ad">is_error</a>() 
</pre></div> flags the return code as having been checked. The destructor for <a class="el" href="../../db/dc7/classw__rc__t.html">w_rc_t</a> can be made to issue an error if the return code was never checked for destruction. The message takes the form: <div class="fragment"><pre class="fragment"> Error not checked: rc=1. error in j_create_rec.cpp:176 Timed out waiting <span class="keywordflow">for</span> resource [0x40000]
</pre></div><p>
(When a return code is sent to an output stream, it prints a stack trace. The above message contains a stack trace with one level.)<p>
The error-not-checked checking happens if the storage manager is configured and built with <div class="fragment"><pre class="fragment"> --enable-checkrc 
</pre></div> . By default this configuration option is off so that it is off for a "production", that is, optimized build. When you are debugging your code, it is a good idea to configure the storage manager with it enabled.<p>
Several macros defined in <a class="el" href="../../d1/d83/w__rc_8h.html">w_rc.h</a> support writing and using methods and functions that return a <a class="el" href="../../db/dc7/classw__rc__t.html">w_rc_t</a>. <div class="fragment"><pre class="fragment"> <a class="code" href="../../db/dc7/classw__rc__t.html">w_rc_t</a>
 func(...)
 {
     <a class="code" href="../../d1/d83/w__rc_8h.html#d4e3baaf8c147337cd2af72942e14eb3">W_DO</a>(<a class="code" href="../../d8/db0/group___s_s_m_f_i_l_e.html#gd35373a32c3480b5437e7d602065d6e5">ss_m::create_file</a>(...));
     <span class="keywordflow">return</span> <a class="code" href="../../d1/d83/w__rc_8h.html#0f25e1835ee19d3905bd8ee2d2f0c86c">RCOK</a>;
 }
</pre></div><p>
The <a class="el" href="../../d1/d83/w__rc_8h.html#d4e3baaf8c147337cd2af72942e14eb3">W_DO</a> macro returns whatever the called function returns if that return code was an error code, otherwise, it falls through to the code below the macro call. This is the most-often used idiom.<p>
The RC_* macros let you construct a return code for a return value from a function. The normal, non-error return code is <a class="el" href="../../d1/d83/w__rc_8h.html#0f25e1835ee19d3905bd8ee2d2f0c86c">RCOK</a>.<p>
Return codes are described in some detail <a class="el" href="../../errnum.html">ERRNUM</a>. There you may also see how to create your own return codes for server modules.<p>
See the examples as well as <a class="el" href="../../d6/ddf/group___m_a_c_r_o_s.html">Significant C Preprocessor Macros</a> in <a class="el" href="../../d1/d83/w__rc_8h.html">w_rc.h</a>.<p>
The storage manager is written with programming idioms to make sure all return codes are checked, and as a user of the storage manager, you strongly encouraged to use these idioms.<p>
It is especially important that you understand the storage manager's <em>return</em> <em>code</em> type, <a class="el" href="../../db/dc7/classw__rc__t.html">w_rc_t</a>. Most of the storage manager methods return this type. The return code type is a dynamically-allocated class instance (except when RCOK, the default, non-error code, is returned: this is a static constant). Because it is heap-allocated, when the compiler generates code for its destruction, certain programming errors are nastier than in the case of returning an atomic type (e.g., int). For example, if you write a function with a <a class="el" href="../../db/dc7/classw__rc__t.html">w_rc_t</a> return type and neglect to give it a return value, your program will probably fail catastrophically. (You can avoid this problem by compiling with compiler warnings enabled.)<p>
The return code from a storage manager method should <em>always</em> be checked: <div class="fragment"><pre class="fragment"> <a class="code" href="../../db/dc7/classw__rc__t.html">w_rc_t</a> func(...)
 {
     ...
     <a class="code" href="../../db/dc7/classw__rc__t.html">w_rc_t</a> rc = <a class="code" href="../../d8/db0/group___s_s_m_f_i_l_e.html#gd35373a32c3480b5437e7d602065d6e5">ss_m::create_file</a>(...);
     <span class="keywordflow">if</span>(rc.<a class="code" href="../../db/dc7/classw__rc__t.html#a1c11327f611544881a9e1314c67f9ad">is_error</a>()) {
        ...
     }
     <span class="keywordflow">return</span> <a class="code" href="../../d1/d83/w__rc_8h.html#0f25e1835ee19d3905bd8ee2d2f0c86c">RCOK</a>;
 }
</pre></div> The act of calling<div class="fragment"><pre class="fragment"> rc.<a class="code" href="../../db/dc7/classw__rc__t.html#a1c11327f611544881a9e1314c67f9ad">is_error</a>() 
</pre></div> flags the return code as having been checked. The destructor for <a class="el" href="../../db/dc7/classw__rc__t.html">w_rc_t</a> can be made to issue an error if the return code was never checked for destruction. The message takes the form: <div class="fragment"><pre class="fragment"> Error not checked: rc=1. error in j_create_rec.cpp:176 Timed out waiting <span class="keywordflow">for</span> resource [0x40000]
</pre></div><p>
(When a return code is sent to an output stream, it prints a stack trace. The above message contains a stack trace with one level.)<p>
The error-not-checked checking happens if the storage manager is configured and built with <div class="fragment"><pre class="fragment"> --enable-checkrc 
</pre></div> . By default this configuration option is off so that it is off for a "production", that is, optimized build. When you are debugging your code, it is a good idea to configure the storage manager with it enabled.<p>
Several macros defined in <a class="el" href="../../d1/d83/w__rc_8h.html">w_rc.h</a> support writing and using methods and functions that return a <a class="el" href="../../db/dc7/classw__rc__t.html">w_rc_t</a>. <div class="fragment"><pre class="fragment"> <a class="code" href="../../db/dc7/classw__rc__t.html">w_rc_t</a>
 func(...)
 {
     <a class="code" href="../../d1/d83/w__rc_8h.html#d4e3baaf8c147337cd2af72942e14eb3">W_DO</a>(<a class="code" href="../../d8/db0/group___s_s_m_f_i_l_e.html#gd35373a32c3480b5437e7d602065d6e5">ss_m::create_file</a>(...));
     <span class="keywordflow">return</span> <a class="code" href="../../d1/d83/w__rc_8h.html#0f25e1835ee19d3905bd8ee2d2f0c86c">RCOK</a>;
 }
</pre></div><p>
The <a class="el" href="../../d1/d83/w__rc_8h.html#d4e3baaf8c147337cd2af72942e14eb3">W_DO</a> macro returns whatever the called function returns if that return code was an error code, otherwise, it falls through to the code below the macro call. This is the most-often used idiom.<p>
The RC_* macros let you construct a return code for a return value from a function. The normal, non-error return code is <a class="el" href="../../d1/d83/w__rc_8h.html#0f25e1835ee19d3905bd8ee2d2f0c86c">RCOK</a>.<p>
Return codes are described in some detail <a class="el" href="../../errnum.html">ERRNUM</a>. There you may also see how to create your own return codes for server modules.<p>
See the examples as well as <a class="el" href="../../d6/ddf/group___m_a_c_r_o_s.html">Significant C Preprocessor Macros</a> in <a class="el" href="../../d1/d83/w__rc_8h.html">w_rc.h</a>. 
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Mon Jan 2 15:14:00 2012 for Shore Storage Manager by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
