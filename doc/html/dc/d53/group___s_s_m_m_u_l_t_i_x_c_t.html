<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Shore Storage Manager: Multi-threaded Transactions</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
<link href="../../tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="../../main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="../../modules.html"><span>Modules</span></a></li>
    <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="../../classes.html"><span>Classes</span></a></li>
    <li><a href="../../files.html"><span>Files</span></a></li>
    <li><a href="../../dirs.html"><span>Directories</span></a></li>
    <li><a href="../../pages.html"><span>Related&nbsp;Pages</span></a></li>
    <li><a href="../../examples.html"><span>Examples</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<h1>Multi-threaded Transactions<br>
<small>
[<a class="el" href="../../d8/d1e/group___s_s_m_x_c_t.html">Transactions, Locking and Logging</a>]</small>
</h1>
<p>
Collaboration diagram for Multi-threaded Transactions:<center><table><tr><td><img src="../../dc/d53/group___s_s_m_m_u_l_t_i_x_c_t.png" border="0" alt="" usemap="#d8/de1/dc_2d53_2group______s__s__m__m__u__l__t__i__x__c__t_map">
<map name="d8/de1/dc_2d53_2group______s__s__m__m__u__l__t__i__x__c__t_map">
<area href="../../d8/d1e/group___s_s_m_x_c_t.html" shape="rect" coords="5,5,245,32" alt="">
</map></td></tr></table></center>
Certain operations may be performed while more than one thread is attached to a transaction (this functionality might be removed in a future release). Any number of attached threads may be read-only. The kinds of updates that can be made by multiple threads are limited by the need to avoid latch-mutex and latch-latch deadlocks.<p>
There are several reasons for this. 1) The multiple threads are not protected from each other by locks. 2) Interleaving of top-level actions is not supported with rollback; this means that for the duration of a top-level action, a thread needs access to the log that excludes all other threads in the same transaction.<p>
The internal logging protocol is this: T1: latch page, log update. Logging requires acquiring a mutex on the xct's log buffer. T2: performing any top-level action, acquires the mutex on the xct's log buffer before doing the action (latching the page).<p>
Thus, anything involving top-level actions is suspect. B-trees use top-level actions, as does file-page allocation, and creation/ destruction of stores (files, indexes). Thus, just about any kind of concurrent updates on the same page in the same transaction is problematic, and just about any update can result in latching extent-map or store-map pages. This activity could be disallowed by enforcing a strict rule that at most one update operation can be going on in a transaction at any time, however this is too restrictive.<p>
Multiple updating threads can work <b>if</b> <b>the</b> <b>data</b> <b>are</b> <b>partitioned</b> by volume. So a well-behaved server may use multiple-threaded transactions to do updates as long as the updates are on different <b>volumes</b>. It might also allow read-only transaction threads to be concurrent with a single updating thread.<p>
Savepoints and partial rollback may <em>not</em> be used with multi-threaded transactions. This is not enforced by the storage manager; it is poor behavior on the part of a server. For example, the behavior of the following is undefined:<ul>
<li>thread 1: attach, read, read, read, ...</li><li>thread 2: attach, save work, update, rollback If the two threads are reading and possibly updating the same data, the results are timing-dependent and could produce a latch- latch or latch-mutex deadlock.</li></ul>
<p>
Ongoing research at DIAS is investigating ways to extend the usefulness of parallelism within a transaction (multi-threaded transactions). Current thoughts about this are for servers to coordinate multiple transactions using two-phase commit or an optimized version of commit and abort for groups of local transactions. 
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Mon Jan 2 15:14:01 2012 for Shore Storage Manager by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
