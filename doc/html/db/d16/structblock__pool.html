<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Shore Storage Manager: block_pool&lt; T, Pool, MaxBytes &gt; Struct Template Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
<link href="../../tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="../../main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="../../modules.html"><span>Modules</span></a></li>
    <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
    <li id="current"><a href="../../classes.html"><span>Classes</span></a></li>
    <li><a href="../../files.html"><span>Files</span></a></li>
    <li><a href="../../dirs.html"><span>Directories</span></a></li>
    <li><a href="../../pages.html"><span>Related&nbsp;Pages</span></a></li>
    <li><a href="../../examples.html"><span>Examples</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="../../classes.html"><span>Alphabetical&nbsp;List</span></a></li>
    <li><a href="../../annotated.html"><span>Class&nbsp;List</span></a></li>
    <li><a href="../../hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
    <li><a href="../../functions.html"><span>Class&nbsp;Members</span></a></li>
  </ul></div>
<h1>block_pool&lt; T, Pool, MaxBytes &gt; Struct Template Reference</h1><!-- doxytag: class="block_pool" -->Collaboration diagram for block_pool&lt; T, Pool, MaxBytes &gt;:<p><center><img src="../../d3/daa/structblock__pool__coll__graph.png" border="0" usemap="#d5/da7/block__pool_3_01_t_00_01_pool_00_01_max_bytes_01_4__coll__map" alt="Collaboration graph"></center>
<map name="d5/da7/block__pool_3_01_t_00_01_pool_00_01_max_bytes_01_4__coll__map">
<area href="../../d2/d70/classmemory__block_1_1block__list.html" shape="rect" coords="223,96,409,123" alt="">
<area href="../../d2/d26/classmemory__block_1_1block__of__chips.html" shape="rect" coords="5,200,227,227" alt="">
<area href="../../d6/dbb/classmemory__block_1_1block__bits.html" shape="rect" coords="7,96,197,123" alt="">
<area href="../../da/def/classmemory__block_1_1pool__of__blocks.html" shape="rect" coords="205,5,427,32" alt="">
</map>
<center><font size="2">[<a target="top" href="../../graph_legend.html">legend</a>]</font></center><a href="../../d4/d9d/structblock__pool-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
<h3>template&lt;class T, class Pool = dynpool, size_t MaxBytes = 0&gt;<br>
 struct block_pool&lt; T, Pool, MaxBytes &gt;</h3>

A factory for speedier allocation from the heap. 
<p>
This allocator is intended for use in a multithreaded environment where many short-lived objects are created and released.<p>
Allocations are not thread safe, but deallocations are. This allows each thread to allocate objects cheaply, without worrying about who will eventually deallocate them (they must still be deallocated, of course). To use: give each thread its own allocator: that provides the thread-safety.<p>
The factory is backed by a global dynarray which manages block-level allocation; each block provides N chips to hand out to clients. The allocator maintains a cache of blocks just large enough that it can expect to recycle the oldest cached block as each active block is consumed; the cache can both grow and shrink to match demand.<p>
PROS:<ul>
<li>most allocations are extremely cheap -- no malloc(), no atomic ops</li><li>deallocations are also cheap -- one atomic op</li><li>completely immune to the ABA problem</li><li>memory can be redistributed among threads between bursts</li></ul>
<p>
CONS:<p>
<ul>
<li>each thread must have its own allocator, which means managing thread-local storage (if compilers ever support non-POD __thread objects, this problem would go away).</li></ul>
<p>
<ul>
<li>though threads attempt to keep their caches reasonably-sized, they will only do so at allocation or thread destruction time, leading to potential hoarding</li></ul>
<p>
<ul>
<li>memory leaks (or unexpectedly long-lived objects) are extremly expensive because they keep a whole block from being freed instead of just one object. However, the remaining chips of each block are at least available for reuse. </li></ul>

<p>

<p>
Definition at line <a class="el" href="../../d2/d85/block__alloc_8h-source.html#l00202">202</a> of file <a class="el" href="../../d2/d85/block__alloc_8h-source.html">block_alloc.h</a>.<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Types</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="98672499af162a1ac940cdd39f1055ee"></a><!-- doxytag: member="block_pool::BlockSize" ref="98672499af162a1ac940cdd39f1055ee" args="" -->
typedef <a class="el" href="../../d6/d4f/classmemory__block_1_1meta__block__size.html">memory_block::meta_block_size</a>&lt;<br>
 sizeof(T)&gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d16/structblock__pool.html#98672499af162a1ac940cdd39f1055ee">BlockSize</a></td></tr>

<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="122c8ec4f5bd2d8e61912f6719456a5f"></a><!-- doxytag: member="block_pool::block_pool" ref="122c8ec4f5bd2d8e61912f6719456a5f" args="()" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d16/structblock__pool.html#122c8ec4f5bd2d8e61912f6719456a5f">block_pool</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="7bec0504035a4da93c073bae0b98d2ac"></a><!-- doxytag: member="block_pool::acquire" ref="7bec0504035a4da93c073bae0b98d2ac" args="()" -->
void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d16/structblock__pool.html#7bec0504035a4da93c073bae0b98d2ac">acquire</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Acquire one object(chip) from the pool. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="3c8e7ef5b9961903e3d70cac92798964"></a><!-- doxytag: member="block_pool::recycle" ref="3c8e7ef5b9961903e3d70cac92798964" args="()" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d16/structblock__pool.html#3c8e7ef5b9961903e3d70cac92798964">recycle</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="32d5640f0584ede47554459e8726d187"></a><!-- doxytag: member="block_pool::dump" ref="32d5640f0584ede47554459e8726d187" args="() const " -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d16/structblock__pool.html#32d5640f0584ede47554459e8726d187">dump</a> () const </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="19180c6b3420369f3e2ede6d0663e8f7"></a><!-- doxytag: member="block_pool::freelist_size" ref="19180c6b3420369f3e2ede6d0663e8f7" args="() const " -->
size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d16/structblock__pool.html#19180c6b3420369f3e2ede6d0663e8f7">freelist_size</a> () const </td></tr>

<tr><td colspan="2"><br><h2>Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a0de5545ae4367be2e0509ea0ffb00eb"></a><!-- doxytag: member="block_pool::block_size" ref="a0de5545ae4367be2e0509ea0ffb00eb" args="()" -->
static size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d16/structblock__pool.html#a0de5545ae4367be2e0509ea0ffb00eb">block_size</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="c54ad89c8d9e792c08067b12b061a8c3"></a><!-- doxytag: member="block_pool::chip_count" ref="c54ad89c8d9e792c08067b12b061a8c3" args="()" -->
static size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d16/structblock__pool.html#c54ad89c8d9e792c08067b12b061a8c3">chip_count</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="5417b13707ad49c6755c40e24a3bdd91"></a><!-- doxytag: member="block_pool::chip_size" ref="5417b13707ad49c6755c40e24a3bdd91" args="()" -->
static size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d16/structblock__pool.html#5417b13707ad49c6755c40e24a3bdd91">chip_size</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a2434234e443fdd9efd08cb8d84705b5"></a><!-- doxytag: member="block_pool::get_static_pool" ref="a2434234e443fdd9efd08cb8d84705b5" args="()" -->
static Pool *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d16/structblock__pool.html#a2434234e443fdd9efd08cb8d84705b5">get_static_pool</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Each block_pool&lt;T&gt; has its own allocator, one per type T. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="9607a9e0c285e9df2e399c372e985218"></a><!-- doxytag: member="block_pool::release" ref="9607a9e0c285e9df2e399c372e985218" args="(void *ptr)" -->
static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d16/structblock__pool.html#9607a9e0c285e9df2e399c372e985218">release</a> (void *ptr)</td></tr>

</table>
<hr>The documentation for this struct was generated from the following file:<ul>
<li>src/fc/<a class="el" href="../../d2/d85/block__alloc_8h-source.html">block_alloc.h</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Mon Jan 2 15:14:04 2012 for Shore Storage Manager by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
