<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Shore Storage Manager: src/sm/sm_base.h File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
<link href="../../tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="../../main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="../../modules.html"><span>Modules</span></a></li>
    <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="../../classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="../../files.html"><span>Files</span></a></li>
    <li><a href="../../dirs.html"><span>Directories</span></a></li>
    <li><a href="../../pages.html"><span>Related&nbsp;Pages</span></a></li>
    <li><a href="../../examples.html"><span>Examples</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="../../globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="../../dir_ff5597eff5bf2afe4bf6bec877c08348.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="../../dir_a16d5816e087c7e428b1c1294e42443b.html">sm</a></div>
<h1>sm_base.h File Reference</h1><hr><a name="_details"></a><h2>Detailed Description</h2>

<p>
Definition in file <a class="el" href="../../d6/dbd/sm__base_8h-source.html">sm_base.h</a>.
<p>

<p>
<a href="../../d6/dbd/sm__base_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="32e8479f9b8c6cc43d2369ae61d825c8"></a><!-- doxytag: member="sm_base.h::SM_EXTENTSIZE" ref="32e8479f9b8c6cc43d2369ae61d825c8" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d81/sm__base_8h.html#32e8479f9b8c6cc43d2369ae61d825c8">SM_EXTENTSIZE</a>&nbsp;&nbsp;&nbsp;8</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="de1436730363458b995545399a13cd5b"></a><!-- doxytag: member="sm_base.h::SM_LOG_PARTITIONS" ref="de1436730363458b995545399a13cd5b" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d81/sm__base_8h.html#de1436730363458b995545399a13cd5b">SM_LOG_PARTITIONS</a>&nbsp;&nbsp;&nbsp;8</td></tr>

<tr><td colspan="2"><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="63f649f4bf015ba841b66fe404a4f46c"></a><!-- doxytag: member="sm_base.h::rc_t" ref="63f649f4bf015ba841b66fe404a4f46c" args="" -->
typedef <a class="el" href="../../db/dc7/classw__rc__t.html">w_rc_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d81/sm__base_8h.html#63f649f4bf015ba841b66fe404a4f46c">rc_t</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef <a class="el" href="../../db/dc7/classw__rc__t.html">w_rc_t</a>(*)&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d81/sm__base_8h.html#5f45f67e3588ef81c1e3c5df2a12db71">LOG_WARN_CALLBACK_FUNC</a> (<a class="el" href="../../df/dfa/classxct__i.html">xct_i</a> *iter, <a class="el" href="../../df/d32/classxct__t.html">xct_t</a> *&amp;victim, fileoff_t curr, fileoff_t thresh, const char *logfile)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Log space warning callback function type.  <a href="#5f45f67e3588ef81c1e3c5df2a12db71"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef <a class="el" href="../../d9/da0/classw__base__t.html#7d1c7ae407200662fd16b64de4dcde46">w_base_t::uint4_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d81/sm__base_8h.html#153f6a00e274a406577daef9db5d424b">partition_number_t</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Callback function type for restoring an archived log file.  <a href="#153f6a00e274a406577daef9db5d424b"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="983861ca62c4fa7750214330054dc25a"></a><!-- doxytag: member="sm_base.h::LOG_ARCHIVED_CALLBACK_FUNC" ref="983861ca62c4fa7750214330054dc25a" args="(const char *fname, partition_number_t num)" -->
typedef <a class="el" href="../../db/dc7/classw__rc__t.html">w_rc_t</a>(*)&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d81/sm__base_8h.html#983861ca62c4fa7750214330054dc25a">LOG_ARCHIVED_CALLBACK_FUNC</a> (const char *fname, <a class="el" href="../../de/d81/sm__base_8h.html#153f6a00e274a406577daef9db5d424b">partition_number_t</a> num)</td></tr>

<tr><td colspan="2"><br><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d81/sm__base_8h.html#7d2532d717c212d11c55bc6751ccfe5f">cmp_t</a> </td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Comparison types used in <a class="el" href="d2/dc8/classscan__index__i.html">scan_index_i</a><p>
Shorthand for CompareOp. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d81/sm__base_8h.html#c2a43921c12ddf1ac73eddedb2d25da5">escalation_options</a> </td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d81/sm__base_8h.html#47790a00c75bbc993e8375e9c224ed88">store_t</a> { , <a class="el" href="../../de/d81/sm__base_8h.html#47790a00c75bbc993e8375e9c224ed8899ddf891d46fd0a80256da81dc4bd53a">t_index</a>, 
<a class="el" href="../../de/d81/sm__base_8h.html#47790a00c75bbc993e8375e9c224ed88bd5d45ee3de8e221b96cd424da4c72c5">t_file</a>, 
<a class="el" href="../../de/d81/sm__base_8h.html#47790a00c75bbc993e8375e9c224ed88981db9fbf56a13e07d601ec9b74b9ea4">t_lgrec</a>
 }</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Types of stores.  <a href="../../de/d81/sm__base_8h.html#47790a00c75bbc993e8375e9c224ed88">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d81/sm__base_8h.html#18b9ecf3181582ef59abfd9c0b377594">ndx_t</a> </td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Index types. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d81/sm__base_8h.html#8a4ace36542f82f7a5e908a7df721a57">concurrency_t</a> </td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Lock granularities.  <a href="../../de/d81/sm__base_8h.html#8a4ace36542f82f7a5e908a7df721a57">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d81/sm__base_8h.html#f27d7360e7f0257bb33d6826074f60ff">pg_policy_t</a> </td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">File-compaction policy for creating records.  <a href="../../de/d81/sm__base_8h.html#f27d7360e7f0257bb33d6826074f60ff">More...</a><br></td></tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="5f45f67e3588ef81c1e3c5df2a12db71"></a><!-- doxytag: member="sm_base.h::LOG_WARN_CALLBACK_FUNC" ref="5f45f67e3588ef81c1e3c5df2a12db71" args="(xct_i *iter, xct_t *&amp;victim, fileoff_t curr, fileoff_t thresh, const char *logfile)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="../../db/dc7/classw__rc__t.html">w_rc_t</a>(*) <a class="el" href="../../de/d81/sm__base_8h.html#5f45f67e3588ef81c1e3c5df2a12db71">LOG_WARN_CALLBACK_FUNC</a>(<a class="el" href="../../df/dfa/classxct__i.html">xct_i</a> *iter, <a class="el" href="../../df/d32/classxct__t.html">xct_t</a> *&amp;victim, fileoff_t curr, fileoff_t thresh, const char *logfile)          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Log space warning callback function type. 
<p>
For more details of how this is used, see the constructor <a class="el" href="../../de/db0/group___s_s_m_i_n_i_t.html#g4b4479aa4533cf55b6baccc3758d08b2">ss_m::ss_m()</a>.<p>
Storage manager methods check the available log space. If the log is in danger of filling to the point that it will be impossible to abort a transaction, a callback is made to the server. The callback function is of this type. The danger point is a threshold determined by the option sm_log_warn.<p>
The callback function is meant to choose a victim xct and tell if the xct should be aborted by returning <a class="el" href="../../d1/d83/w__rc_8h.html#6497ffa8332a490d20e850da0dc6ca51">RC(eUSERABORT)</a>.<p>
Any other RC value is returned to the server through the call stack.<p>
The arguments: <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>iter</em>&nbsp;</td><td>Pointer to an iterator over all xcts. </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>victim</em>&nbsp;</td><td>Victim will be returned here. This is an in/out paramter and is initially populated with the transaction that is attached to the running thread. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>curr</em>&nbsp;</td><td>Bytes of log consumed by active transactions. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>thresh</em>&nbsp;</td><td>Threshhold just exceeded. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>logfile</em>&nbsp;</td><td>Character string name of oldest file to archive.</td></tr>
  </table>
</dl>
This function must be careful not to return the same victim more than once, even though the callback may be called many times before the victim is completely aborted.<p>
When this function has archived the given log file, it needs to notify the storage manager of that fact by calling ss_m::log_file_was_archived(logfile) 
<p>
Definition at line <a class="el" href="../../d6/dbd/sm__base_8h-source.html#l00264">264</a> of file <a class="el" href="../../d6/dbd/sm__base_8h-source.html">sm_base.h</a>.
</div>
</div><p>
<a class="anchor" name="153f6a00e274a406577daef9db5d424b"></a><!-- doxytag: member="sm_base.h::partition_number_t" ref="153f6a00e274a406577daef9db5d424b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="../../d9/da0/classw__base__t.html#7d1c7ae407200662fd16b64de4dcde46">w_base_t::uint4_t</a> <a class="el" href="../../de/d81/sm__base_8h.html#153f6a00e274a406577daef9db5d424b">partition_number_t</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Callback function type for restoring an archived log file. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fname</em>&nbsp;</td><td>Original file name (with path). </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>needed</em>&nbsp;</td><td>Partition number of the file needed.</td></tr>
  </table>
</dl>
An alternative to aborting a transaction (when the log fills) is to archive log files. The server can use the log directory name to locate these files, and may use the iterator and the static methods of <a class="el" href="../../df/d32/classxct__t.html">xct_t</a> to determine which log file(s) to archive.<p>
Archiving and removing the older log files will work only if the server also provides a LOG_ARCHIVED_CALLBACK_FUNCTION to restore the archived log files when the storage manager needs them for rollback. This is the function type used for that purpose.<p>
The function must locate the archived log file containing for the partition number <em>num</em>, which was a suffix of the original log file's name. The log file must be restored with its original name. <dl compact><dt><b>Examples: </b></dt><dd>
<a class="el" href="../../d0/d88/log__exceed_8cpp-example.html#a104">log_exceed.cpp</a>.</dl>
<p>
Definition at line <a class="el" href="../../d6/dbd/sm__base_8h-source.html#l00294">294</a> of file <a class="el" href="../../d6/dbd/sm__base_8h-source.html">sm_base.h</a>.
</div>
</div><p>
<hr><h2>Enumeration Type Documentation</h2>
<a class="anchor" name="47790a00c75bbc993e8375e9c224ed88"></a><!-- doxytag: member="sm_base.h::store_t" ref="47790a00c75bbc993e8375e9c224ed88" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="../../de/d81/sm__base_8h.html#47790a00c75bbc993e8375e9c224ed88">store_t</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Types of stores. 
<p>
<dl compact><dt><b>Enumerator: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" name="47790a00c75bbc993e8375e9c224ed8899ddf891d46fd0a80256da81dc4bd53a"></a><!-- doxytag: member="t_index" ref="47790a00c75bbc993e8375e9c224ed8899ddf891d46fd0a80256da81dc4bd53a" args="" -->t_index</em>&nbsp;</td><td>
a b-tree or r-tree index </td></tr>
<tr><td valign="top"><em><a class="anchor" name="47790a00c75bbc993e8375e9c224ed88bd5d45ee3de8e221b96cd424da4c72c5"></a><!-- doxytag: member="t_file" ref="47790a00c75bbc993e8375e9c224ed88bd5d45ee3de8e221b96cd424da4c72c5" args="" -->t_file</em>&nbsp;</td><td>
a file of records </td></tr>
<tr><td valign="top"><em><a class="anchor" name="47790a00c75bbc993e8375e9c224ed88981db9fbf56a13e07d601ec9b74b9ea4"></a><!-- doxytag: member="t_lgrec" ref="47790a00c75bbc993e8375e9c224ed88981db9fbf56a13e07d601ec9b74b9ea4" args="" -->t_lgrec</em>&nbsp;</td><td>
t_lgrec is used for storing large record pages and is always associated with some t_file store </td></tr>
</table>
</dl>

<p>
Definition at line <a class="el" href="../../d6/dbd/sm__base_8h-source.html#l00325">325</a> of file <a class="el" href="../../d6/dbd/sm__base_8h-source.html">sm_base.h</a>.
</div>
</div><p>
<a class="anchor" name="8a4ace36542f82f7a5e908a7df721a57"></a><!-- doxytag: member="sm_base.h::concurrency_t" ref="8a4ace36542f82f7a5e908a7df721a57" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="../../de/d81/sm__base_8h.html#8a4ace36542f82f7a5e908a7df721a57">concurrency_t</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Lock granularities. 
<p>
<ul>
<li>t_cc_bad Illegal</li><li>t_cc_none No locking</li><li>t_cc_record Record-level locking for files &amp; records</li><li>t_cc_page Page-level locking for files &amp; records</li><li>t_cc_file File-level locking for files &amp; records</li><li>t_cc_vol Volume-level locking for files and indexes</li><li>t_cc_kvl Key-value locking for B+-Tree indexes</li><li>t_cc_im Aries IM locking for B+-Tree indexes : experimental</li><li>t_cc_modkvl Modified key-value locking: experimental</li><li>t_cc_append Used internally<dl compact><dt><b><a class="el" href="../../todo.html#_todo000001">Todo:</a></b></dt><dd>true? </dd></dl>
</li></ul>

<p>
Definition at line <a class="el" href="../../d6/dbd/sm__base_8h-source.html#l00361">361</a> of file <a class="el" href="../../d6/dbd/sm__base_8h-source.html">sm_base.h</a>.
</div>
</div><p>
<a class="anchor" name="f27d7360e7f0257bb33d6826074f60ff"></a><!-- doxytag: member="sm_base.h::pg_policy_t" ref="f27d7360e7f0257bb33d6826074f60ff" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="../../de/d81/sm__base_8h.html#f27d7360e7f0257bb33d6826074f60ff">pg_policy_t</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
File-compaction policy for creating records. 
<p>
<ul>
<li>t_append : append new record to file (preserve order)</li><li>t_cache : look in cache for pages with space for new record (does not preserve order)</li><li>t_compact: keep file compact even if it means searching the file for space in which to create the file (does not preserve order)</li></ul>
<p>
These are masks - the following combinations are sensible:<p>
<ul>
<li>t_append -- preserve sort order</li><li>t_cache | t_append -- check the cache first, append if no luck</li><li>t_cache | t_compact | t_append -- append to file as a last resort </li></ul>

<p>
Definition at line <a class="el" href="../../d6/dbd/sm__base_8h-source.html#l00392">392</a> of file <a class="el" href="../../d6/dbd/sm__base_8h-source.html">sm_base.h</a>.
</div>
</div><p>
<hr size="1"><address style="align: right;"><small>Generated on Mon Jan 2 15:13:57 2012 for Shore Storage Manager by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
