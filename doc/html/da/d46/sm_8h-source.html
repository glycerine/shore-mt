<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Shore Storage Manager: src/sm/sm.h Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
<link href="../../tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="../../main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="../../modules.html"><span>Modules</span></a></li>
    <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="../../classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="../../files.html"><span>Files</span></a></li>
    <li><a href="../../dirs.html"><span>Directories</span></a></li>
    <li><a href="../../pages.html"><span>Related&nbsp;Pages</span></a></li>
    <li><a href="../../examples.html"><span>Examples</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="../../globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="../../dir_ff5597eff5bf2afe4bf6bec877c08348.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="../../dir_a16d5816e087c7e428b1c1294e42443b.html">sm</a></div>
<h1>sm.h</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* -*- mode:C++; c-basic-offset:4 -*-</span>
<a name="l00002"></a>00002 <span class="comment">     Shore-MT -- Multi-threaded port of the SHORE storage manager</span>
<a name="l00003"></a>00003 <span class="comment">   </span>
<a name="l00004"></a>00004 <span class="comment">                       Copyright (c) 2007-2009</span>
<a name="l00005"></a>00005 <span class="comment">      Data Intensive Applications and Systems Labaratory (DIAS)</span>
<a name="l00006"></a>00006 <span class="comment">               Ecole Polytechnique Federale de Lausanne</span>
<a name="l00007"></a>00007 <span class="comment">   </span>
<a name="l00008"></a>00008 <span class="comment">                         All Rights Reserved.</span>
<a name="l00009"></a>00009 <span class="comment">   </span>
<a name="l00010"></a>00010 <span class="comment">   Permission to use, copy, modify and distribute this software and</span>
<a name="l00011"></a>00011 <span class="comment">   its documentation is hereby granted, provided that both the</span>
<a name="l00012"></a>00012 <span class="comment">   copyright notice and this permission notice appear in all copies of</span>
<a name="l00013"></a>00013 <span class="comment">   the software, derivative works or modified versions, and any</span>
<a name="l00014"></a>00014 <span class="comment">   portions thereof, and that both notices appear in supporting</span>
<a name="l00015"></a>00015 <span class="comment">   documentation.</span>
<a name="l00016"></a>00016 <span class="comment">   </span>
<a name="l00017"></a>00017 <span class="comment">   This code is distributed in the hope that it will be useful, but</span>
<a name="l00018"></a>00018 <span class="comment">   WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00019"></a>00019 <span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. THE AUTHORS</span>
<a name="l00020"></a>00020 <span class="comment">   DISCLAIM ANY LIABILITY OF ANY KIND FOR ANY DAMAGES WHATSOEVER</span>
<a name="l00021"></a>00021 <span class="comment">   RESULTING FROM THE USE OF THIS SOFTWARE.</span>
<a name="l00022"></a>00022 <span class="comment">*/</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="comment">/*&lt;std-header orig-src='shore' incl-file-exclusion='SM_H'&gt;</span>
<a name="l00025"></a>00025 <span class="comment"></span>
<a name="l00026"></a>00026 <span class="comment"> $Id: sm.h,v 1.324 2012/01/02 17:02:17 nhall Exp $</span>
<a name="l00027"></a>00027 <span class="comment"></span>
<a name="l00028"></a>00028 <span class="comment">SHORE -- Scalable Heterogeneous Object REpository</span>
<a name="l00029"></a>00029 <span class="comment"></span>
<a name="l00030"></a>00030 <span class="comment">Copyright (c) 1994-99 Computer Sciences Department, University of</span>
<a name="l00031"></a>00031 <span class="comment">                      Wisconsin -- Madison</span>
<a name="l00032"></a>00032 <span class="comment">All Rights Reserved.</span>
<a name="l00033"></a>00033 <span class="comment"></span>
<a name="l00034"></a>00034 <span class="comment">Permission to use, copy, modify and distribute this software and its</span>
<a name="l00035"></a>00035 <span class="comment">documentation is hereby granted, provided that both the copyright</span>
<a name="l00036"></a>00036 <span class="comment">notice and this permission notice appear in all copies of the</span>
<a name="l00037"></a>00037 <span class="comment">software, derivative works or modified versions, and any portions</span>
<a name="l00038"></a>00038 <span class="comment">thereof, and that both notices appear in supporting documentation.</span>
<a name="l00039"></a>00039 <span class="comment"></span>
<a name="l00040"></a>00040 <span class="comment">THE AUTHORS AND THE COMPUTER SCIENCES DEPARTMENT OF THE UNIVERSITY</span>
<a name="l00041"></a>00041 <span class="comment">OF WISCONSIN - MADISON ALLOW FREE USE OF THIS SOFTWARE IN ITS</span>
<a name="l00042"></a>00042 <span class="comment">"AS IS" CONDITION, AND THEY DISCLAIM ANY LIABILITY OF ANY KIND</span>
<a name="l00043"></a>00043 <span class="comment">FOR ANY DAMAGES WHATSOEVER RESULTING FROM THE USE OF THIS SOFTWARE.</span>
<a name="l00044"></a>00044 <span class="comment"></span>
<a name="l00045"></a>00045 <span class="comment">This software was developed with support by the Advanced Research</span>
<a name="l00046"></a>00046 <span class="comment">Project Agency, ARPA order number 018 (formerly 8230), monitored by</span>
<a name="l00047"></a>00047 <span class="comment">the U.S. Army Research Laboratory under contract DAAB07-91-C-Q518.</span>
<a name="l00048"></a>00048 <span class="comment">Further funding for this work was provided by DARPA through</span>
<a name="l00049"></a>00049 <span class="comment">Rome Research Laboratory Contract No. F30602-97-2-0247.</span>
<a name="l00050"></a>00050 <span class="comment"></span>
<a name="l00051"></a>00051 <span class="comment">*/</span>
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 <span class="preprocessor">#ifndef SM_H</span>
<a name="l00054"></a>00054 <span class="preprocessor"></span><span class="preprocessor">#define SM_H</span>
<a name="l00055"></a>00055 <span class="preprocessor"></span>
<a name="l00056"></a>00056 <span class="preprocessor">#include "w_defines.h"</span>
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <span class="comment">/*  -- do not edit anything above this line --   &lt;/std-header&gt;*/</span>
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="comment">/*</span>
<a name="l00061"></a>00061 <span class="comment"> *  Stuff needed by value-added servers.  NOT meant to be included by</span>
<a name="l00062"></a>00062 <span class="comment"> *  internal SM .c files, except to the extent that they need these</span>
<a name="l00063"></a>00063 <span class="comment"> *  definitions used in the API.</span>
<a name="l00064"></a>00064 <span class="comment"> */</span>
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 <span class="preprocessor">#ifdef __GNUG__</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span><span class="preprocessor">#pragma interface</span>
<a name="l00068"></a>00068 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span>
<a name="l00070"></a>00070 <span class="preprocessor">#ifndef SM_INT_4_H</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span><span class="preprocessor">#include &lt;sm_int_4.h&gt;</span>
<a name="l00072"></a>00072 <span class="preprocessor">#endif</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span>
<a name="l00074"></a>00074 <span class="preprocessor">#ifndef SM_DU_STATS_H</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span><span class="preprocessor">#include &lt;sm_du_stats.h&gt;</span> <span class="comment">// declares sm_du_stats_t</span>
<a name="l00076"></a>00076 <span class="preprocessor">#endif</span>
<a name="l00077"></a>00077 <span class="preprocessor"></span>
<a name="l00078"></a>00078 <span class="preprocessor">#ifndef SM_STATS_H</span>
<a name="l00079"></a>00079 <span class="preprocessor"></span><span class="preprocessor">#include &lt;smstats.h&gt;</span> <span class="comment">// declares sm_stats_info_t and sm_config_info_t</span>
<a name="l00080"></a>00080 <span class="preprocessor">#endif</span>
<a name="l00081"></a>00081 <span class="preprocessor"></span>
<a name="l00082"></a>00082 <span class="preprocessor">#ifndef SM_S_H</span>
<a name="l00083"></a>00083 <span class="preprocessor"></span><span class="preprocessor">#include &lt;sm_s.h&gt;</span> <span class="comment">// declares key_type_s, rid_t, lsn_t</span>
<a name="l00084"></a>00084 <span class="preprocessor">#endif</span>
<a name="l00085"></a>00085 <span class="preprocessor"></span>
<a name="l00086"></a>00086 <span class="preprocessor">#ifndef LEXIFY_H</span>
<a name="l00087"></a>00087 <span class="preprocessor"></span><span class="preprocessor">#include &lt;lexify.h&gt;</span> <span class="comment">// declares sortorder with constants</span>
<a name="l00088"></a>00088 <span class="preprocessor">#endif</span>
<a name="l00089"></a>00089 <span class="preprocessor"></span>
<a name="l00090"></a>00090 <span class="preprocessor">#ifndef NBOX_H</span>
<a name="l00091"></a>00091 <span class="preprocessor"></span><span class="preprocessor">#include &lt;nbox.h&gt;</span>   <span class="comment">// key_info_t contains nbox_t</span>
<a name="l00092"></a>00092 <span class="preprocessor">#endif </span><span class="comment">/* NBOX_H */</span>
<a name="l00093"></a>00093 
<a name="l00094"></a>00094 <span class="preprocessor">#ifndef SORT_S_H</span>
<a name="l00095"></a>00095 <span class="preprocessor"></span><span class="preprocessor">#include &lt;sort_s.h&gt;</span> <span class="comment">// declares key_info_t</span>
<a name="l00096"></a>00096 <span class="preprocessor">#endif</span>
<a name="l00097"></a>00097 <span class="preprocessor"></span>
<a name="l00098"></a>00098 <span class="comment">/* DOXYGEN Documentation : */</span>
<a name="l00099"></a>00099 <span class="comment"></span>
<a name="l00100"></a>00100 <span class="comment">/**\addtogroup LOGSPACE </span>
<a name="l00101"></a>00101 <span class="comment"> *</span>
<a name="l00102"></a>00102 <span class="comment"> * Updates performed by transactions are logged so that</span>
<a name="l00103"></a>00103 <span class="comment"> * the can be rolled back (in the event of a transaction abort)</span>
<a name="l00104"></a>00104 <span class="comment"> * or restored (in the event of a crash).  Both the old and new values</span>
<a name="l00105"></a>00105 <span class="comment"> * of an updated location are logged.  This allows a steal, no-force</span>
<a name="l00106"></a>00106 <span class="comment"> * buffer management policy, which means the buffer manager is free</span>
<a name="l00107"></a>00107 <span class="comment"> * to write dirty pages to disk at any time and yet does not have</span>
<a name="l00108"></a>00108 <span class="comment"> * to write dirty pages for a a transaction to commit.</span>
<a name="l00109"></a>00109 <span class="comment"> *</span>
<a name="l00110"></a>00110 <span class="comment"> * The log is stored in a set of Unix files, all in the same directory,</span>
<a name="l00111"></a>00111 <span class="comment"> * whose path is determined by a run-time option.</span>
<a name="l00112"></a>00112 <span class="comment"> * The maximum size of the log is also determined by a run-time option.o</span>
<a name="l00113"></a>00113 <span class="comment"> * The proper value of the log size depends on</span>
<a name="l00114"></a>00114 <span class="comment"> * the expected transaction mix.  More specifically, it depends on the</span>
<a name="l00115"></a>00115 <span class="comment"> * age of the oldest (longest running) transaction in the system and</span>
<a name="l00116"></a>00116 <span class="comment"> * the amount of log space used by all active transactions. Here are</span>
<a name="l00117"></a>00117 <span class="comment"> * some general rules to determine the  amount  of  free  log  space</span>
<a name="l00118"></a>00118 <span class="comment"> * available in the system.</span>
<a name="l00119"></a>00119 <span class="comment"> * - Log records between the first log</span>
<a name="l00120"></a>00120 <span class="comment"> *   record generated by the oldest active transaction and the most</span>
<a name="l00121"></a>00121 <span class="comment"> *   recent log record generated by any transaction cannot be thrown</span>
<a name="l00122"></a>00122 <span class="comment"> *   away.</span>
<a name="l00123"></a>00123 <span class="comment"> * - Log records from a transaction are no longer needed</span>
<a name="l00124"></a>00124 <span class="comment"> *   once the transaction has committed or completely aborted and all</span>
<a name="l00125"></a>00125 <span class="comment"> *   updates have made it to disk. Aborting a transaction causes log space</span>
<a name="l00126"></a>00126 <span class="comment"> *   to be used, so space is reserved for aborting each transaction.</span>
<a name="l00127"></a>00127 <span class="comment"> *   Enough log space must be available to commit or abort all active</span>
<a name="l00128"></a>00128 <span class="comment"> *   transactions at all times.</span>
<a name="l00129"></a>00129 <span class="comment"> * </span>
<a name="l00130"></a>00130 <span class="comment"> * - Only space starting at the beginning of the log can be reused.  </span>
<a name="l00131"></a>00131 <span class="comment"> *   This space can be reused if it contains log records only for </span>
<a name="l00132"></a>00132 <span class="comment"> *   transactions meeting the previous rule.</span>
<a name="l00133"></a>00133 <span class="comment"> *</span>
<a name="l00134"></a>00134 <span class="comment"> * -  All storage manager calls that update records require log space twice</span>
<a name="l00135"></a>00135 <span class="comment"> *    the size of the space updated in the record. All calls that create,</span>
<a name="l00136"></a>00136 <span class="comment"> *    append, or truncate records require log space equal to the size</span>
<a name="l00137"></a>00137 <span class="comment"> *    created, inserted, or deleted. Log records generated by these calls</span>
<a name="l00138"></a>00138 <span class="comment"> *    (generally one per call) have an overhead of approximately 50 bytes.</span>
<a name="l00139"></a>00139 <span class="comment"> *</span>
<a name="l00140"></a>00140 <span class="comment"> * - The amount of log space reserved for aborting a transaction is equal to </span>
<a name="l00141"></a>00141 <span class="comment"> *   the amount of log space generated by the transaction plus a fudge </span>
<a name="l00142"></a>00142 <span class="comment"> *   factor. </span>
<a name="l00143"></a>00143 <span class="comment"> *   (Where btrees are concerned, a structure modification</span>
<a name="l00144"></a>00144 <span class="comment"> *   might be necessary on abort, using more space on abort, or might not be</span>
<a name="l00145"></a>00145 <span class="comment"> *   necessary on abort where it was done during forward processing, </span>
<a name="l00146"></a>00146 <span class="comment"> *   using less space on abort.)</span>
<a name="l00147"></a>00147 <span class="comment"> *</span>
<a name="l00148"></a>00148 <span class="comment"> * - The transaction assumes responsiblity for reserving space in the</span>
<a name="l00149"></a>00149 <span class="comment"> *   log so that it can abort, should it need to (without leaving an</span>
<a name="l00150"></a>00150 <span class="comment"> *   unrecoverable volume).  The transaction and the log cooperate to</span>
<a name="l00151"></a>00151 <span class="comment"> *   reserve space for the transaction's aborting.</span>
<a name="l00152"></a>00152 <span class="comment"> *</span>
<a name="l00153"></a>00153 <span class="comment"> * - When insufficient log space is available for a transaction, the </span>
<a name="l00154"></a>00154 <span class="comment"> *   transaction is (may be, depending on the server) aborted.</span>
<a name="l00155"></a>00155 <span class="comment"> *   The storage manager will return an error indication (out of log space)</span>
<a name="l00156"></a>00156 <span class="comment"> *   if it is unable to insert a log record into the log due to</span>
<a name="l00157"></a>00157 <span class="comment"> *   insufficient space.</span>
<a name="l00158"></a>00158 <span class="comment"> *</span>
<a name="l00159"></a>00159 <span class="comment"> * Checkpoints are taken periodically by the storage manager in order to </span>
<a name="l00160"></a>00160 <span class="comment"> * free log space and shorten recovery time.  Checkpoints are "fuzzy" </span>
<a name="l00161"></a>00161 <span class="comment"> * and can do not require the system to pause while they are completing.</span>
<a name="l00162"></a>00162 <span class="comment"> *</span>
<a name="l00163"></a>00163 <span class="comment"> * See the storage manager constructor ss_m::ss_m for more information</span>
<a name="l00164"></a>00164 <span class="comment"> * about handling out-of-logspace conditions.</span>
<a name="l00165"></a>00165 <span class="comment"> *</span>
<a name="l00166"></a>00166 <span class="comment"> */</span>
<a name="l00167"></a>00167 <span class="comment"></span>
<a name="l00168"></a>00168 <span class="comment">/**\addtogroup SSMOPT</span>
<a name="l00169"></a>00169 <span class="comment"> *</span>
<a name="l00170"></a>00170 <span class="comment"> * These are the run-time options for the storage manager.</span>
<a name="l00171"></a>00171 <span class="comment"> *</span>
<a name="l00172"></a>00172 <span class="comment"> * -sm_bufpoolsize : </span>
<a name="l00173"></a>00173 <span class="comment"> *      - type: number</span>
<a name="l00174"></a>00174 <span class="comment"> *      - description: This is the size of </span>
<a name="l00175"></a>00175 <span class="comment"> *      the buffer pool in Kb.  Must be large enough to hold at least 32 pages,</span>
<a name="l00176"></a>00176 <span class="comment"> *      so it depends on the configured page size.</span>
<a name="l00177"></a>00177 <span class="comment"> *      - default: none</span>
<a name="l00178"></a>00178 <span class="comment"> *      - required?: yes</span>
<a name="l00179"></a>00179 <span class="comment"> *</span>
<a name="l00180"></a>00180 <span class="comment"> * -sm_hugetlbfs_path</span>
<a name="l00181"></a>00181 <span class="comment"> *      - type: string (full absolute path name)</span>
<a name="l00182"></a>00182 <span class="comment"> *      - description: Needed only if you configured --with-hugetlbfs.</span>
<a name="l00183"></a>00183 <span class="comment"> *      - default: see \ref CONFIGOPT</span>
<a name="l00184"></a>00184 <span class="comment"> *      - required?: no</span>
<a name="l00185"></a>00185 <span class="comment"> *</span>
<a name="l00186"></a>00186 <span class="comment"> * -sm_reformat_log</span>
<a name="l00187"></a>00187 <span class="comment"> *      - type: Boolean</span>
<a name="l00188"></a>00188 <span class="comment"> *      - description: If "yes", your log will be clobbered and the storage</span>
<a name="l00189"></a>00189 <span class="comment"> *      manager will start up with an entirely new log.</span>
<a name="l00190"></a>00190 <span class="comment"> *      - default: no</span>
<a name="l00191"></a>00191 <span class="comment"> *      - required?: no</span>
<a name="l00192"></a>00192 <span class="comment"> *</span>
<a name="l00193"></a>00193 <span class="comment"> * -sm_logdir</span>
<a name="l00194"></a>00194 <span class="comment"> *      - type: string (relative or absolutee path name)</span>
<a name="l00195"></a>00195 <span class="comment"> *      - description: Location of the log files.</span>
<a name="l00196"></a>00196 <span class="comment"> *      - default: none</span>
<a name="l00197"></a>00197 <span class="comment"> *      - required?: yes</span>
<a name="l00198"></a>00198 <span class="comment"> *</span>
<a name="l00199"></a>00199 <span class="comment"> * -sm_logbufsize</span>
<a name="l00200"></a>00200 <span class="comment"> *      - type: number</span>
<a name="l00201"></a>00201 <span class="comment"> *      - description: size of log buffer in KB.</span>
<a name="l00202"></a>00202 <span class="comment"> *      Must be greater than or equal to the larger of</span>
<a name="l00203"></a>00203 <span class="comment"> *      (4 times the page size, 64 Kb)</span>
<a name="l00204"></a>00204 <span class="comment"> *      and less than or equal to</span>
<a name="l00205"></a>00205 <span class="comment"> *      128 times the page_size. This is the size of </span>
<a name="l00206"></a>00206 <span class="comment"> *      the log buffer in Kb.</span>
<a name="l00207"></a>00207 <span class="comment"> *      - default: 128</span>
<a name="l00208"></a>00208 <span class="comment"> *      - required?: no</span>
<a name="l00209"></a>00209 <span class="comment"> *</span>
<a name="l00210"></a>00210 <span class="comment"> * -sm_logsize</span>
<a name="l00211"></a>00211 <span class="comment"> *      - type: number</span>
<a name="l00212"></a>00212 <span class="comment"> *      - description: greater than or equal to 8256 </span>
<a name="l00213"></a>00213 <span class="comment"> *      This is the maximum size of the log in Kb.  It is a function of</span>
<a name="l00214"></a>00214 <span class="comment"> *      the log buffer size, and  the default is the minimum allowable for</span>
<a name="l00215"></a>00215 <span class="comment"> *      the default sm_logbufsize.</span>
<a name="l00216"></a>00216 <span class="comment"> *      - default: 128</span>
<a name="l00217"></a>00217 <span class="comment"> *      - required?: yes</span>
<a name="l00218"></a>00218 <span class="comment"> *</span>
<a name="l00219"></a>00219 <span class="comment"> * -sm_log_warn</span>
<a name="l00220"></a>00220 <span class="comment"> *      - type: number between 0 and 100 (percentage)</span>
<a name="l00221"></a>00221 <span class="comment"> *      - description: percentage of log that, when consumed by active</span>
<a name="l00222"></a>00222 <span class="comment"> *      transactions, triggers a callback warning of potential inability</span>
<a name="l00223"></a>00223 <span class="comment"> *      to roll back.   Should be less than 50.</span>
<a name="l00224"></a>00224 <span class="comment"> *      - default: 45</span>
<a name="l00225"></a>00225 <span class="comment"> *      - required?: no</span>
<a name="l00226"></a>00226 <span class="comment"> *</span>
<a name="l00227"></a>00227 <span class="comment"> * -sm_errlog</span>
<a name="l00228"></a>00228 <span class="comment"> *      - type: string (relative or absolute path name OR - )</span>
<a name="l00229"></a>00229 <span class="comment"> *      - description: Destination for error messages.  If "-" is given,</span>
<a name="l00230"></a>00230 <span class="comment"> *      the destination is stderr.</span>
<a name="l00231"></a>00231 <span class="comment"> *      - default: \b -</span>
<a name="l00232"></a>00232 <span class="comment"> *      - required?: no</span>
<a name="l00233"></a>00233 <span class="comment"> *</span>
<a name="l00234"></a>00234 <span class="comment"> * -sm_errlog_level</span>
<a name="l00235"></a>00235 <span class="comment"> *      - type: string  (one of none|emerg|fatal|internal|error|warning|info|debug)</span>
<a name="l00236"></a>00236 <span class="comment"> *      - description: filter.  Message of this priority or higher are issued to</span>
<a name="l00237"></a>00237 <span class="comment"> *      the error log; messages with lower priority are not issued.</span>
<a name="l00238"></a>00238 <span class="comment"> *      The priorities are listed from high to low. "none" means no logging</span>
<a name="l00239"></a>00239 <span class="comment"> *      will happen.</span>
<a name="l00240"></a>00240 <span class="comment"> *      - default: error</span>
<a name="l00241"></a>00241 <span class="comment"> *      - required?: no</span>
<a name="l00242"></a>00242 <span class="comment"> *</span>
<a name="l00243"></a>00243 <span class="comment"> * -sm_locktablesize : </span>
<a name="l00244"></a>00244 <span class="comment"> *      - type: number greater than or equal to 64</span>
<a name="l00245"></a>00245 <span class="comment"> *      - description: size of lock manager's hash table will be a prime</span>
<a name="l00246"></a>00246 <span class="comment"> *      number near and greater than the given number.</span>
<a name="l00247"></a>00247 <span class="comment"> *      - default: 64000 (yields a hash table with 65521 buckets)</span>
<a name="l00248"></a>00248 <span class="comment"> *      - required?: no</span>
<a name="l00249"></a>00249 <span class="comment"> *</span>
<a name="l00250"></a>00250 <span class="comment"> * -sm_lock_escalate_to_page_threshold</span>
<a name="l00251"></a>00251 <span class="comment"> *      - type: number greater than or equal to 0</span>
<a name="l00252"></a>00252 <span class="comment"> *      - description: after acquiring this many record locks on a page, the lock</span>
<a name="l00253"></a>00253 <span class="comment"> *      will be escalated to a page lock. A value of 0 disables escalation to a</span>
<a name="l00254"></a>00254 <span class="comment"> *      page lock.</span>
<a name="l00255"></a>00255 <span class="comment"> *      - default: 5</span>
<a name="l00256"></a>00256 <span class="comment"> *      - required?: no</span>
<a name="l00257"></a>00257 <span class="comment"> *</span>
<a name="l00258"></a>00258 <span class="comment"> * -sm_lock_escalate_to_store_threshold</span>
<a name="l00259"></a>00259 <span class="comment"> *      - type: number greater than or equal to 0</span>
<a name="l00260"></a>00260 <span class="comment"> *      - description: after acquiring this many page locks on in a store, </span>
<a name="l00261"></a>00261 <span class="comment"> *      the lock will be escalated to a store lock. </span>
<a name="l00262"></a>00262 <span class="comment"> *      A value of 0 disables escalation to a store lock.</span>
<a name="l00263"></a>00263 <span class="comment"> *      - default: 25</span>
<a name="l00264"></a>00264 <span class="comment"> *      - required?: no</span>
<a name="l00265"></a>00265 <span class="comment"> *      </span>
<a name="l00266"></a>00266 <span class="comment"> * -sm_lock_escalate_to_volume_threshold</span>
<a name="l00267"></a>00267 <span class="comment"> *      - type: number greater than or equal to 0</span>
<a name="l00268"></a>00268 <span class="comment"> *      - description: after acquiring this many store locks on in a volume, </span>
<a name="l00269"></a>00269 <span class="comment"> *      the lock will be escalated to a volume lock. </span>
<a name="l00270"></a>00270 <span class="comment"> *      A value of 0 disables escalation to a volume lock.</span>
<a name="l00271"></a>00271 <span class="comment"> *      - default: 0</span>
<a name="l00272"></a>00272 <span class="comment"> *      - required?: no</span>
<a name="l00273"></a>00273 <span class="comment"> *</span>
<a name="l00274"></a>00274 <span class="comment"> * -sm_cc_alg</span>
<a name="l00275"></a>00275 <span class="comment"> *      - type: string (one of file | page | record | none)</span>
<a name="l00276"></a>00276 <span class="comment"> *      - description: default locking granularity for file operations.</span>
<a name="l00277"></a>00277 <span class="comment"> *      This can be overridden on a per-transaction basis with</span>
<a name="l00278"></a>00278 <span class="comment"> *      ss_m::set_xct_lock_level().</span>
<a name="l00279"></a>00279 <span class="comment"> *      - default: record</span>
<a name="l00280"></a>00280 <span class="comment"> *      - required?: no</span>
<a name="l00281"></a>00281 <span class="comment"> *</span>
<a name="l00282"></a>00282 <span class="comment"> * -sm_backgroundflush</span>
<a name="l00283"></a>00283 <span class="comment"> *      - type: Boolean</span>
<a name="l00284"></a>00284 <span class="comment"> *      - description: Enables background-flushing of volumes.</span>
<a name="l00285"></a>00285 <span class="comment"> *      Must be set to "yes" for sm_num_page_writers to have any effect.</span>
<a name="l00286"></a>00286 <span class="comment"> *      - default: yes</span>
<a name="l00287"></a>00287 <span class="comment"> *      - required?: no</span>
<a name="l00288"></a>00288 <span class="comment"> *</span>
<a name="l00289"></a>00289 <span class="comment"> * -sm_num_page_writers</span>
<a name="l00290"></a>00290 <span class="comment"> *      - type: number</span>
<a name="l00291"></a>00291 <span class="comment"> *      - description: greater than or equal to 0; this is the number of</span>
<a name="l00292"></a>00292 <span class="comment"> *      background-flushing threads for each volume. If you have </span>
<a name="l00293"></a>00293 <span class="comment"> *      lots of threads, </span>
<a name="l00294"></a>00294 <span class="comment"> *      a huge buffer pool, and few volumes, you should increase this.</span>
<a name="l00295"></a>00295 <span class="comment"> *      If sm_backgroundflush is "no", this value is ignored.</span>
<a name="l00296"></a>00296 <span class="comment"> *      - default: 2</span>
<a name="l00297"></a>00297 <span class="comment"> *      - required?: no</span>
<a name="l00298"></a>00298 <span class="comment"> *</span>
<a name="l00299"></a>00299 <span class="comment"> * -sm_prefetch</span>
<a name="l00300"></a>00300 <span class="comment"> *      - type: Boolean</span>
<a name="l00301"></a>00301 <span class="comment"> *      - description: Enables prefetching for scans.</span>
<a name="l00302"></a>00302 <span class="comment"> *      - default: no</span>
<a name="l00303"></a>00303 <span class="comment"> *      - required?: no</span>
<a name="l00304"></a>00304 <span class="comment"> *</span>
<a name="l00305"></a>00305 <span class="comment"> * -sm_logging</span>
<a name="l00306"></a>00306 <span class="comment"> *      - type: Boolean</span>
<a name="l00307"></a>00307 <span class="comment"> *      - description: Allows you to turn off logging for a run of</span>
<a name="l00308"></a>00308 <span class="comment"> *      the storage manager. This is only for experimentation, to</span>
<a name="l00309"></a>00309 <span class="comment"> *      measure logging overhead in a limited way.</span>
<a name="l00310"></a>00310 <span class="comment"> *      Aborts, rollbacks and restart/recovery </span>
<a name="l00311"></a>00311 <span class="comment"> *      do not work without logging.   Independent concurrent</span>
<a name="l00312"></a>00312 <span class="comment"> *      transactions using btrees might not work without logging (this is</span>
<a name="l00313"></a>00313 <span class="comment"> *      not well-tested).</span>
<a name="l00314"></a>00314 <span class="comment"> *      Each time you start the server, you had better start with a</span>
<a name="l00315"></a>00315 <span class="comment"> *      clean device or a device that resulted from a clean shutdown</span>
<a name="l00316"></a>00316 <span class="comment"> *      of the prior run.</span>
<a name="l00317"></a>00317 <span class="comment"> *      - default: yes</span>
<a name="l00318"></a>00318 <span class="comment"> *      - required?: no</span>
<a name="l00319"></a>00319 <span class="comment"> *</span>
<a name="l00320"></a>00320 <span class="comment"> * -sm_lock_caching</span>
<a name="l00321"></a>00321 <span class="comment"> *      - type: Boolean</span>
<a name="l00322"></a>00322 <span class="comment"> *      - description: Enables caching of transaction locks in transaction.</span>
<a name="l00323"></a>00323 <span class="comment"> *      Can be turned off for experimentation. If no, the default is not</span>
<a name="l00324"></a>00324 <span class="comment"> *      to cache locks, but any transaction can turn on caching for itself</span>
<a name="l00325"></a>00325 <span class="comment"> *      by calling the ss_m method  set_lock_cache_enable(bool enable).</span>
<a name="l00326"></a>00326 <span class="comment"> *      - default: yes</span>
<a name="l00327"></a>00327 <span class="comment"> *      - required?: no</span>
<a name="l00328"></a>00328 <span class="comment"> *</span>
<a name="l00329"></a>00329 <span class="comment"> */</span>
<a name="l00330"></a>00330 
<a name="l00331"></a>00331 <span class="comment"></span>
<a name="l00332"></a>00332 <span class="comment">/**\addtogroup SSMXCT </span>
<a name="l00333"></a>00333 <span class="comment"> * All storage manager operations on data must be done within the scope of</span>
<a name="l00334"></a>00334 <span class="comment"> * a transaction (ss_m::begin_xct, ss_m::commit_xct, ss_m::abort_xct,</span>
<a name="l00335"></a>00335 <span class="comment"> * ss_m::chain_xct). </span>
<a name="l00336"></a>00336 <span class="comment"> *</span>
<a name="l00337"></a>00337 <span class="comment"> * A very few storage manager operations, such as formatting a volume, are</span>
<a name="l00338"></a>00338 <span class="comment"> * called outside the scope of a transaction and the storage manager begins</span>
<a name="l00339"></a>00339 <span class="comment"> * its own transaction to do the work.</span>
<a name="l00340"></a>00340 <span class="comment"> *</span>
<a name="l00341"></a>00341 <span class="comment"> * Operations that fail return an error indication and the storage </span>
<a name="l00342"></a>00342 <span class="comment"> * manager assumes that the server will thereafter abort the </span>
<a name="l00343"></a>00343 <span class="comment"> * transaction in which the error occurred, when abort is indicated.</span>
<a name="l00344"></a>00344 <span class="comment"> * Abort is indicated when eUSERABORT or eDEADLOCK is returned and </span>
<a name="l00345"></a>00345 <span class="comment"> * when the erver chooses to abort rather than to work around the problem </span>
<a name="l00346"></a>00346 <span class="comment"> * (whatever it might be, such as eRETRY).</span>
<a name="l00347"></a>00347 <span class="comment"> *</span>
<a name="l00348"></a>00348 <span class="comment"> * The storage manager does not enforce the aborting of any erroneous</span>
<a name="l00349"></a>00349 <span class="comment"> * transactions except, possibly, those that are in danger of </span>
<a name="l00350"></a>00350 <span class="comment"> * running out of log space.</span>
<a name="l00351"></a>00351 <span class="comment"> * (This is done with the destructor of the prologue used on each call</span>
<a name="l00352"></a>00352 <span class="comment"> * to the storage manager, see next paragraph).</span>
<a name="l00353"></a>00353 <span class="comment"> *</span>
<a name="l00354"></a>00354 <span class="comment"> * It is always the server's responsibility to abort.</span>
<a name="l00355"></a>00355 <span class="comment"> * When the storage manager </span>
<a name="l00356"></a>00356 <span class="comment"> * encounters a eLOGSPACEWARN condition (the log hasn't enough</span>
<a name="l00357"></a>00357 <span class="comment"> * space \e at \e this \e moment to abort the running transaction,</span>
<a name="l00358"></a>00358 <span class="comment"> * assuming a 1:1 ration of rollback-logging overhead to forward-processing</span>
<a name="l00359"></a>00359 <span class="comment"> * logging overhead), it does one of two things:</span>
<a name="l00360"></a>00360 <span class="comment"> * - passes the error code eLOGSPACEWARN up the call stack back to the server</span>
<a name="l00361"></a>00361 <span class="comment"> *   if the storage manager was constructed with no log-space-warning callback</span>
<a name="l00362"></a>00362 <span class="comment"> *   argument (see LOG_WARN_CALLBACK_FUNC, ss_m::ss_m).</span>
<a name="l00363"></a>00363 <span class="comment"> * - tries to abort a transaction before passing an error code back up</span>
<a name="l00364"></a>00364 <span class="comment"> *   the call stack to the server. Choosing a victim transaction to abort</span>
<a name="l00365"></a>00365 <span class="comment"> *   is done by the server in its log-space-warning callback function (passed</span>
<a name="l00366"></a>00366 <span class="comment"> *   in on ss_m::ss_m, q.v.</span>
<a name="l00367"></a>00367 <span class="comment"> *   Only if that callback function returns a non-null victim transaction</span>
<a name="l00368"></a>00368 <span class="comment"> *   and returns eUSERABORT does the storage manager abort that victim</span>
<a name="l00369"></a>00369 <span class="comment"> *   before returning eUSERABORT up the call stack. Any other</span>
<a name="l00370"></a>00370 <span class="comment"> *   error code returned by the callback function is just returned up</span>
<a name="l00371"></a>00371 <span class="comment"> *   the call stack.</span>
<a name="l00372"></a>00372 <span class="comment"> *</span>
<a name="l00373"></a>00373 <span class="comment"> * \section LOCKS Locks </span>
<a name="l00374"></a>00374 <span class="comment"> *</span>
<a name="l00375"></a>00375 <span class="comment"> * The storage manager automatically acquires the </span>
<a name="l00376"></a>00376 <span class="comment"> * necessary locks when the data are read or written.</span>
<a name="l00377"></a>00377 <span class="comment"> * The locks thus acquired are normally released at the end of a transaction,</span>
<a name="l00378"></a>00378 <span class="comment"> * thus, by default, transactions are two-phase and well-formed (degree 3).</span>
<a name="l00379"></a>00379 <span class="comment"> *</span>
<a name="l00380"></a>00380 <span class="comment"> * \subsection GRAN Lock Granularity</span>
<a name="l00381"></a>00381 <span class="comment"> * The fine-grained locks are normally used for records in files, but</span>
<a name="l00382"></a>00382 <span class="comment"> * provision is made for using coarser-grained locks.  The transaction</span>
<a name="l00383"></a>00383 <span class="comment"> * has a default lock level associated with it,</span>
<a name="l00384"></a>00384 <span class="comment"> * which governs the granularity of locks acquired by the storage manager</span>
<a name="l00385"></a>00385 <span class="comment"> * on behalf of the transaction.</span>
<a name="l00386"></a>00386 <span class="comment"> * The lock manager provides for lock escalation to coarser locks to</span>
<a name="l00387"></a>00387 <span class="comment"> * reduce the locking costs.  See \ref SSMLOCK and smlevel_0::concurrency_t. </span>
<a name="l00388"></a>00388 <span class="comment"> *</span>
<a name="l00389"></a>00389 <span class="comment"> * Key-value locking is normally used for B+-Trees. (See \ref MOH1.)</span>
<a name="l00390"></a>00390 <span class="comment"> * R*-Trees normally use coarse-granularity locking.</span>
<a name="l00391"></a>00391 <span class="comment"> * The locking protocol used with an index is determined when the</span>
<a name="l00392"></a>00392 <span class="comment"> * index is created.  A transaction may acquire coarse (index-level)</span>
<a name="l00393"></a>00393 <span class="comment"> * locks with explicit calls to the lock manager, but by default, </span>
<a name="l00394"></a>00394 <span class="comment"> * the granularity/level/protocol associated with the index is used.</span>
<a name="l00395"></a>00395 <span class="comment"> * See smlevel_0::concurrency_t. </span>
<a name="l00396"></a>00396 <span class="comment"> *</span>
<a name="l00397"></a>00397 <span class="comment"> * \section DISTXCT Distributed Transactions</span>
<a name="l00398"></a>00398 <span class="comment"> * Storage manager transactions may be used as "threads" (to </span>
<a name="l00399"></a>00399 <span class="comment"> * overload this term) of distributed transactions.  </span>
<a name="l00400"></a>00400 <span class="comment"> * Coordination of 2-phase commit must be done externally,</span>
<a name="l00401"></a>00401 <span class="comment"> * but the storage manager supports preparing the (local) transaction "thread" </span>
<a name="l00402"></a>00402 <span class="comment"> * for two-phase commit, and it will log the necessary </span>
<a name="l00403"></a>00403 <span class="comment"> * data for recovering in-doubt transactions.</span>
<a name="l00404"></a>00404 <span class="comment"> *</span>
<a name="l00405"></a>00405 <span class="comment"> * \section ATTACH Threads and Transactions</span>
<a name="l00406"></a>00406 <span class="comment"> * Transactions are not tied to storage manager threads (smthread_t, not</span>
<a name="l00407"></a>00407 <span class="comment"> * to be confused with a local "thread" of a distributed transaction) in any </span>
<a name="l00408"></a>00408 <span class="comment"> * way other than that a transaction must be \e attached to a</span>
<a name="l00409"></a>00409 <span class="comment"> * thread while any storage manager work is being done on behalf of </span>
<a name="l00410"></a>00410 <span class="comment"> * that transaction.   This is how the storage manager knows \e which</span>
<a name="l00411"></a>00411 <span class="comment"> * transaction is to acquire the locks and latches, etc.</span>
<a name="l00412"></a>00412 <span class="comment"> * But a thread can attach and detach from transactions at will, so</span>
<a name="l00413"></a>00413 <span class="comment"> * work may be performed by different threads each time the storage</span>
<a name="l00414"></a>00414 <span class="comment"> * manager is called on behalf of a given transaction; this allows the</span>
<a name="l00415"></a>00415 <span class="comment"> * server to keep a pool of threads to perform work and allows them to</span>
<a name="l00416"></a>00416 <span class="comment"> * perform work on behalf of any active transaction.</span>
<a name="l00417"></a>00417 <span class="comment"> *</span>
<a name="l00418"></a>00418 <span class="comment"> * \warning</span>
<a name="l00419"></a>00419 <span class="comment"> * While there are limited circumstances in which multiple threads can be</span>
<a name="l00420"></a>00420 <span class="comment"> * attached to the same transaction \e concurrently and perform storage </span>
<a name="l00421"></a>00421 <span class="comment"> * manager operations on behalf of that transaction concurrently,</span>
<a name="l00422"></a>00422 <span class="comment"> * which is a hold-over from the original storage manager, this </span>
<a name="l00423"></a>00423 <span class="comment"> * functionality may be deprecated soon.  The reason for this </span>
<a name="l00424"></a>00424 <span class="comment"> * is that it is extremely difficult to handle errors internally</span>
<a name="l00425"></a>00425 <span class="comment"> * when multiple threads are attached to a transaction because </span>
<a name="l00426"></a>00426 <span class="comment"> * partial rollback is impossible in the absence of multiple log streams</span>
<a name="l00427"></a>00427 <span class="comment"> * for a transaction.</span>
<a name="l00428"></a>00428 <span class="comment"> *</span>
<a name="l00429"></a>00429 <span class="comment"> * Under no circumstances may a thread attach to more than one transaction</span>
<a name="l00430"></a>00430 <span class="comment"> * at a time.</span>
<a name="l00431"></a>00431 <span class="comment"> *</span>
<a name="l00432"></a>00432 <span class="comment"> *</span>
<a name="l00433"></a>00433 <span class="comment"> * \section EXOTICA Exotica</span>
<a name="l00434"></a>00434 <span class="comment"> * The storage manager also provides </span>
<a name="l00435"></a>00435 <span class="comment"> * - partial rollback (ss_m::save_work and ss_m::rollback_work), </span>
<a name="l00436"></a>00436 <span class="comment"> *   which undoes actions but does not release locks,</span>
<a name="l00437"></a>00437 <span class="comment"> * - transaction chaining (ss_m::chain_xct), which commits, but retains locks</span>
<a name="l00438"></a>00438 <span class="comment"> *   and gives them to a new transaction,</span>
<a name="l00439"></a>00439 <span class="comment"> * - lock release (sm_quark_t, ss_m::unlock), allowing less-than-3-degree</span>
<a name="l00440"></a>00440 <span class="comment"> *   transactions.</span>
<a name="l00441"></a>00441 <span class="comment"> *</span>
<a name="l00442"></a>00442 <span class="comment"> *  To reduce the cost (particularly in logging) of loading databases,</span>
<a name="l00443"></a>00443 <span class="comment"> *  the storage manager provides for unlogged loading of stores.</span>
<a name="l00444"></a>00444 <span class="comment"> *  See \ref SSMSTORE.</span>
<a name="l00445"></a>00445 <span class="comment"> */</span>
<a name="l00446"></a>00446 
<a name="l00447"></a>00447 
<a name="l00448"></a>00448 <span class="comment"></span>
<a name="l00449"></a>00449 <span class="comment">/** \file sm_vas.h</span>
<a name="l00450"></a>00450 <span class="comment"> * \details</span>
<a name="l00451"></a>00451 <span class="comment"> * This is the include file that all value-added servers should</span>
<a name="l00452"></a>00452 <span class="comment"> * include to get the Shore Storage Manager API.</span>
<a name="l00453"></a>00453 <span class="comment"> *</span>
<a name="l00454"></a>00454 <span class="comment"> */</span>
<a name="l00455"></a>00455 <span class="comment">/********************************************************************/</span>
<a name="l00456"></a>00456 
<a name="l00457"></a>00457 <span class="keyword">class </span>page_p;
<a name="l00458"></a>00458 <span class="keyword">class </span><a class="code" href="../../df/d32/classxct__t.html">xct_t</a>;
<a name="l00459"></a>00459 <span class="keyword">class </span>device_m;
<a name="l00460"></a>00460 <span class="keyword">class </span><a class="code" href="../../d8/ddb/classvec__t.html">vec_t</a>;
<a name="l00461"></a>00461 <span class="keyword">class </span>log_m;
<a name="l00462"></a>00462 <span class="keyword">class </span>lock_m;
<a name="l00463"></a>00463 <span class="keyword">class </span>btree_m;
<a name="l00464"></a>00464 <span class="keyword">class </span>file_m;
<a name="l00465"></a>00465 <span class="keyword">class </span>pool_m;
<a name="l00466"></a>00466 <span class="keyword">class </span>dir_m;
<a name="l00467"></a>00467 <span class="keyword">class </span>chkpt_m;
<a name="l00468"></a>00468 <span class="keyword">class </span>lid_m; 
<a name="l00469"></a>00469 <span class="keyword">class </span>sm_stats_cache_t;
<a name="l00470"></a>00470 <span class="keyword">class </span><a class="code" href="../../d7/da2/classoption__group__t.html">option_group_t</a>;
<a name="l00471"></a>00471 <span class="keyword">class </span><a class="code" href="../../d9/d6e/classoption__t.html">option_t</a>;
<a name="l00472"></a>00472 <span class="keyword">class </span>prologue_rc_t;
<a name="l00473"></a>00473 <span class="keyword">class </span>rtree_m;
<a name="l00474"></a>00474 <span class="keyword">class </span><a class="code" href="../../da/d1c/classsort__stream__i.html">sort_stream_i</a>;
<a name="l00475"></a>00475 <span class="comment"></span>
<a name="l00476"></a>00476 <span class="comment">/**\addtogroup SSMSP  </span>
<a name="l00477"></a>00477 <span class="comment"> * A transaction may perform a partial rollback using savepoints.</span>
<a name="l00478"></a>00478 <span class="comment"> * The transaction populates a savepoint by calling ss_m::save_work,</span>
<a name="l00479"></a>00479 <span class="comment"> * then it may roll back to that point with ss_m::rollback_work.</span>
<a name="l00480"></a>00480 <span class="comment"> * Locks acquired between the save_work and rollback_work are \e not</span>
<a name="l00481"></a>00481 <span class="comment"> * released.</span>
<a name="l00482"></a>00482 <span class="comment"> */</span>
<a name="l00483"></a>00483 <span class="comment"></span>
<a name="l00484"></a>00484 <span class="comment">/**\brief A point to which a transaction can roll back.</span>
<a name="l00485"></a>00485 <span class="comment"> * \ingroup SSMSP</span>
<a name="l00486"></a>00486 <span class="comment"> *\details</span>
<a name="l00487"></a>00487 <span class="comment"> * A transaction an do partial rollbacks with</span>
<a name="l00488"></a>00488 <span class="comment"> * save_work  and rollback_work, which use this class to determine</span>
<a name="l00489"></a>00489 <span class="comment"> * how far to roll back.</span>
<a name="l00490"></a>00490 <span class="comment"> * It is nothing more than a log sequence number for the work done</span>
<a name="l00491"></a>00491 <span class="comment"> * to the point when save_work is called.</span>
<a name="l00492"></a>00492 <span class="comment"> */</span>
<a name="l00493"></a><a class="code" href="../../d1/da9/classsm__save__point__t.html">00493</a> <span class="keyword">class </span><a class="code" href="../../d1/da9/classsm__save__point__t.html">sm_save_point_t</a> : <span class="keyword">public</span> <a class="code" href="../../d2/d19/classlsn__t.html">lsn_t</a> {
<a name="l00494"></a>00494 <span class="keyword">public</span>:
<a name="l00495"></a><a class="code" href="../../d1/da9/classsm__save__point__t.html#a9191009af4aba8ab48c5dbe8b40f785">00495</a>     <a class="code" href="../../dd/d93/w__base_8h.html#45d83e292de0c4c2a60998a0b9e82332">NORET</a>            <a class="code" href="../../d1/da9/classsm__save__point__t.html#a9191009af4aba8ab48c5dbe8b40f785">sm_save_point_t</a>(): _tid(0,0) {};
<a name="l00496"></a><a class="code" href="../../d1/da9/classsm__save__point__t.html#8d662dddcfdbdd2099d45bf4fdd2f5cf">00496</a>     <span class="keyword">friend</span> ostream&amp; <a class="code" href="../../d1/da9/classsm__save__point__t.html#8d662dddcfdbdd2099d45bf4fdd2f5cf">operator&lt;&lt;</a>(ostream&amp; o, <span class="keyword">const</span> <a class="code" href="../../d1/da9/classsm__save__point__t.html">sm_save_point_t</a>&amp; p) {
<a name="l00497"></a>00497         <span class="keywordflow">return</span> o &lt;&lt; p.<a class="code" href="../../d1/da9/classsm__save__point__t.html#c1509423c0a73a2b99e52cd8446d6982">_tid</a> &lt;&lt; <span class="charliteral">':'</span> &lt;&lt; (<span class="keyword">const</span> <a class="code" href="../../d2/d19/classlsn__t.html">lsn_t</a>&amp;) p;
<a name="l00498"></a>00498     }
<a name="l00499"></a><a class="code" href="../../d1/da9/classsm__save__point__t.html#021259b54704669950cb6e6e2abe387b">00499</a>     <span class="keyword">friend</span> istream&amp; <a class="code" href="../../d1/da9/classsm__save__point__t.html#021259b54704669950cb6e6e2abe387b">operator&gt;&gt;</a>(istream&amp; i, <a class="code" href="../../d1/da9/classsm__save__point__t.html">sm_save_point_t</a>&amp; p) {
<a name="l00500"></a>00500         <span class="keywordtype">char</span> ch;
<a name="l00501"></a>00501         <span class="keywordflow">return</span> i &gt;&gt; p.<a class="code" href="../../d1/da9/classsm__save__point__t.html#c1509423c0a73a2b99e52cd8446d6982">_tid</a> &gt;&gt; ch &gt;&gt; (<a class="code" href="../../d2/d19/classlsn__t.html">lsn_t</a>&amp;) p;
<a name="l00502"></a>00502     }
<a name="l00503"></a><a class="code" href="../../d1/da9/classsm__save__point__t.html#d66b609a09b898ec58cd89b5f847852d">00503</a>     <a class="code" href="../../d8/d12/classtid__t.html">tid_t</a>            <a class="code" href="../../d1/da9/classsm__save__point__t.html#d66b609a09b898ec58cd89b5f847852d">tid</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _tid; }
<a name="l00504"></a>00504 <span class="keyword">private</span>:
<a name="l00505"></a><a class="code" href="../../d1/da9/classsm__save__point__t.html#651ece888375ea520b82f3fbef4dab0b">00505</a>     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="../../da/d44/classss__m.html">ss_m</a>;
<a name="l00506"></a>00506     <a class="code" href="../../d8/d12/classtid__t.html">tid_t</a>            _tid;
<a name="l00507"></a>00507 };
<a name="l00508"></a>00508 <span class="comment"></span>
<a name="l00509"></a>00509 <span class="comment">/**\addtogroup SSMQK  </span>
<a name="l00510"></a>00510 <span class="comment"> * A quark is a marker in the transaction's list of acquired locks.</span>
<a name="l00511"></a>00511 <span class="comment"> * One may release all short-duration locks acquired since the quark was inserted </span>
<a name="l00512"></a>00512 <span class="comment"> * into the list via sm_quark_t::open().</span>
<a name="l00513"></a>00513 <span class="comment"> * The lock manager modifies the locks acquired inside a quark</span>
<a name="l00514"></a>00514 <span class="comment"> * so that non-extent locks are no longer than short-duration.</span>
<a name="l00515"></a>00515 <span class="comment"> *</span>
<a name="l00516"></a>00516 <span class="comment"> * This is for experimentation only, and is \e not well-tested or supported.</span>
<a name="l00517"></a>00517 <span class="comment"> *</span>
<a name="l00518"></a>00518 <span class="comment"> * How used:</span>
<a name="l00519"></a>00519 <span class="comment"> * \code</span>
<a name="l00520"></a>00520 <span class="comment"> * sm_quark_t *q = new sm_quark_t;</span>
<a name="l00521"></a>00521 <span class="comment"> * q-&gt;open();  // inserts marker in transaction's list.</span>
<a name="l00522"></a>00522 <span class="comment"> * ...</span>
<a name="l00523"></a>00523 <span class="comment"> * q-&gt;close(); // frees short-duration locks to the marker.</span>
<a name="l00524"></a>00524 <span class="comment"> * delete q;</span>
<a name="l00525"></a>00525 <span class="comment"> * \endcode</span>
<a name="l00526"></a>00526 <span class="comment"> *</span>
<a name="l00527"></a>00527 <span class="comment"> * Deleting the quark without closing it causes it to be closed.</span>
<a name="l00528"></a>00528 <span class="comment"> * Quarks may \e not be used with multi-threaded transactions.</span>
<a name="l00529"></a>00529 <span class="comment"> *</span>
<a name="l00530"></a>00530 <span class="comment"> * Note that if a transaction has multiple threads attached when</span>
<a name="l00531"></a>00531 <span class="comment"> * a thread opens a quark, there is no way to determine where the</span>
<a name="l00532"></a>00532 <span class="comment"> * quark takes effect, and since it affects the locks acquired by</span>
<a name="l00533"></a>00533 <span class="comment"> * all threads of the transaction, it must be used very carefully</span>
<a name="l00534"></a>00534 <span class="comment"> * where multiply-threaded transactions are concerned.</span>
<a name="l00535"></a>00535 <span class="comment"> */</span>
<a name="l00536"></a>00536 <span class="comment"></span>
<a name="l00537"></a>00537 <span class="comment">/**\brief List of locks acquired by a transaction since</span>
<a name="l00538"></a>00538 <span class="comment"> * the quark was "opened".   </span>
<a name="l00539"></a>00539 <span class="comment"> * \ingroup SSMQK</span>
<a name="l00540"></a>00540 <span class="comment"> * \details</span>
<a name="l00541"></a>00541 <span class="comment"> * When a quark is closed (by calling close()), </span>
<a name="l00542"></a>00542 <span class="comment"> * the release_locks parameter indicates if all short-duration read</span>
<a name="l00543"></a>00543 <span class="comment"> * locks acquired during the quark should be released.</span>
<a name="l00544"></a>00544 <span class="comment"> * \note Quarks are an experimental feature for use </span>
<a name="l00545"></a>00545 <span class="comment"> * as a building block for a more general nested-transaction facility.</span>
<a name="l00546"></a>00546 <span class="comment"> *</span>
<a name="l00547"></a>00547 <span class="comment"> * \internal See lock_x.h</span>
<a name="l00548"></a>00548 <span class="comment"> */</span>
<a name="l00549"></a><a class="code" href="../../d3/dfc/classsm__quark__t.html">00549</a> <span class="keyword">class </span><a class="code" href="../../d3/dfc/classsm__quark__t.html">sm_quark_t</a> {
<a name="l00550"></a>00550 <span class="keyword">public</span>:
<a name="l00551"></a><a class="code" href="../../d3/dfc/classsm__quark__t.html#d7a1f4c520c1467272e1459c27cac96b">00551</a>     <a class="code" href="../../dd/d93/w__base_8h.html#45d83e292de0c4c2a60998a0b9e82332">NORET</a>            <a class="code" href="../../d3/dfc/classsm__quark__t.html#d7a1f4c520c1467272e1459c27cac96b">sm_quark_t</a>() {}
<a name="l00552"></a>00552     <a class="code" href="../../dd/d93/w__base_8h.html#45d83e292de0c4c2a60998a0b9e82332">NORET</a>            ~<a class="code" href="../../d3/dfc/classsm__quark__t.html">sm_quark_t</a>();
<a name="l00553"></a>00553 
<a name="l00554"></a>00554     <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            open();
<a name="l00555"></a>00555     <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            close(<span class="keywordtype">bool</span> release=<span class="keyword">true</span>);
<a name="l00556"></a>00556 
<a name="l00557"></a><a class="code" href="../../d3/dfc/classsm__quark__t.html#f2a4438b943c8885bdb48c72725328ec">00557</a>     <a class="code" href="../../d8/d12/classtid__t.html">tid_t</a>            <a class="code" href="../../d3/dfc/classsm__quark__t.html#f2a4438b943c8885bdb48c72725328ec">tid</a>()<span class="keyword">const </span>{ <span class="keywordflow">return</span> _tid; }
<a name="l00558"></a><a class="code" href="../../d3/dfc/classsm__quark__t.html#92284588b3ea0ba719e6b770c8973128">00558</a>     operator         bool()<span class="keyword">const </span>{ <span class="keywordflow">return</span> (_tid != <a class="code" href="../../d8/d12/classtid__t.html#36ecfc975edbc1782999c7c72f6a8340">tid_t::null</a>); }
<a name="l00559"></a>00559     <span class="keyword">friend</span> ostream&amp; operator&lt;&lt;(ostream&amp; o, <span class="keyword">const</span> <a class="code" href="../../d3/dfc/classsm__quark__t.html">sm_quark_t</a>&amp; q);
<a name="l00560"></a>00560     <span class="keyword">friend</span> istream&amp; operator&gt;&gt;(istream&amp; i, <a class="code" href="../../d3/dfc/classsm__quark__t.html">sm_quark_t</a>&amp; q);
<a name="l00561"></a>00561 
<a name="l00562"></a>00562 <span class="keyword">private</span>:
<a name="l00563"></a><a class="code" href="../../d3/dfc/classsm__quark__t.html#651ece888375ea520b82f3fbef4dab0b">00563</a>     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="../../da/d44/classss__m.html">ss_m</a>;
<a name="l00564"></a>00564     <a class="code" href="../../d8/d12/classtid__t.html">tid_t</a>            _tid;
<a name="l00565"></a>00565 
<a name="l00566"></a>00566     <span class="comment">// disable</span>
<a name="l00567"></a>00567     <a class="code" href="../../d3/dfc/classsm__quark__t.html#d7a1f4c520c1467272e1459c27cac96b">sm_quark_t</a>(<span class="keyword">const</span> <a class="code" href="../../d3/dfc/classsm__quark__t.html">sm_quark_t</a>&amp;);
<a name="l00568"></a>00568     <a class="code" href="../../d3/dfc/classsm__quark__t.html">sm_quark_t</a>&amp; operator=(<span class="keyword">const</span> <a class="code" href="../../d3/dfc/classsm__quark__t.html">sm_quark_t</a>&amp;);
<a name="l00569"></a>00569 
<a name="l00570"></a>00570 };
<a name="l00571"></a>00571 
<a name="l00572"></a>00572 <span class="keyword">class </span><a class="code" href="../../d3/d8b/classsm__store__info__t.html">sm_store_info_t</a>;
<a name="l00573"></a>00573 <span class="keyword">class </span>log_entry;
<a name="l00574"></a>00574 <span class="keyword">class </span>coordinator;
<a name="l00575"></a>00575 <span class="keyword">class </span>tape_t;<span class="comment"></span>
<a name="l00576"></a>00576 <span class="comment">/**\brief \b This \b is \b the \b SHORE \b Storage \b Manager \b API.</span>
<a name="l00577"></a>00577 <span class="comment"> *\details</span>
<a name="l00578"></a>00578 <span class="comment"> * Most of the API for using the storage manager is through this</span>
<a name="l00579"></a>00579 <span class="comment"> * interface class.</span>
<a name="l00580"></a>00580 <span class="comment"> */</span>
<a name="l00581"></a><a class="code" href="../../da/d44/classss__m.html">00581</a> <span class="keyword">class </span><a class="code" href="../../da/d44/classss__m.html">ss_m</a> : <span class="keyword">public</span> smlevel_top 
<a name="l00582"></a>00582 {
<a name="l00583"></a><a class="code" href="../../da/d44/classss__m.html#6d2bc04183cecb2bae0d30e929d9a7d4">00583</a>     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="../../d9/dda/classpin__i.html">pin_i</a>;
<a name="l00584"></a><a class="code" href="../../da/d44/classss__m.html#1124b8a127830de63b422b91a57c230a">00584</a>     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="../../da/d1c/classsort__stream__i.html">sort_stream_i</a>;
<a name="l00585"></a><a class="code" href="../../da/d44/classss__m.html#6b64ab1d13826e673da874305393705a">00585</a>     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="../../da/d44/classss__m.html#6b64ab1d13826e673da874305393705a">prologue_rc_t</a>;
<a name="l00586"></a><a class="code" href="../../da/d44/classss__m.html#742708b2695ebfb9c18008b1c2458d28">00586</a>     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="../../da/d44/classss__m.html#742708b2695ebfb9c18008b1c2458d28">log_entry</a>;
<a name="l00587"></a><a class="code" href="../../da/d44/classss__m.html#605af1652727ab8cfe9bb4770e725d0d">00587</a>     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="../../da/d44/classss__m.html#605af1652727ab8cfe9bb4770e725d0d">coordinator</a>;
<a name="l00588"></a><a class="code" href="../../da/d44/classss__m.html#4d972e3ecdec60b319e16f6bc7c61766">00588</a>     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="../../da/d44/classss__m.html#4d972e3ecdec60b319e16f6bc7c61766">tape_t</a>;
<a name="l00589"></a>00589 <span class="keyword">public</span>:
<a name="l00590"></a>00590 
<a name="l00591"></a><a class="code" href="../../da/d44/classss__m.html#95372aaf34985ed6fcb2f4cac71abd8f">00591</a>     <span class="keyword">typedef</span> <a class="code" href="../../de/d81/sm__base_8h.html#5f45f67e3588ef81c1e3c5df2a12db71">smlevel_0::LOG_WARN_CALLBACK_FUNC</a> <a class="code" href="../../da/d44/classss__m.html#95372aaf34985ed6fcb2f4cac71abd8f">LOG_WARN_CALLBACK_FUNC</a>;
<a name="l00592"></a><a class="code" href="../../da/d44/classss__m.html#3887d0b6a024e70a5d35b24e33095ef6">00592</a>     <span class="keyword">typedef</span> <a class="code" href="../../de/d81/sm__base_8h.html#983861ca62c4fa7750214330054dc25a">smlevel_0::LOG_ARCHIVED_CALLBACK_FUNC</a> <a class="code" href="../../da/d44/classss__m.html#3887d0b6a024e70a5d35b24e33095ef6">LOG_ARCHIVED_CALLBACK_FUNC</a>;
<a name="l00593"></a><a class="code" href="../../da/d44/classss__m.html#901caa62fd2c03e33bec050c30dd828b">00593</a>     <span class="keyword">typedef</span> <a class="code" href="../../de/d81/sm__base_8h.html#18b9ecf3181582ef59abfd9c0b377594">smlevel_0::ndx_t</a> <a class="code" href="../../da/d44/classss__m.html#901caa62fd2c03e33bec050c30dd828b">ndx_t</a>;
<a name="l00594"></a><a class="code" href="../../da/d44/classss__m.html#50662c89c6fd0f384a655ca11e78b861">00594</a>     <span class="keyword">typedef</span> <a class="code" href="../../de/d81/sm__base_8h.html#8a4ace36542f82f7a5e908a7df721a57">smlevel_0::concurrency_t</a> <a class="code" href="../../da/d44/classss__m.html#50662c89c6fd0f384a655ca11e78b861">concurrency_t</a>;
<a name="l00595"></a><a class="code" href="../../da/d44/classss__m.html#edafe8929d794c719d04856aac3621a4">00595</a>     <span class="keyword">typedef</span> smlevel_1::xct_state_t <a class="code" href="../../da/d44/classss__m.html#edafe8929d794c719d04856aac3621a4">xct_state_t</a>;
<a name="l00596"></a>00596 
<a name="l00597"></a><a class="code" href="../../da/d44/classss__m.html#a7a0a9b5677337b6d5a4e3f42d9fa149">00597</a>     <span class="keyword">typedef</span> <a class="code" href="../../d2/dc6/group___s_s_m_s_t_o_r_e.html#g2ae901018445773c66b1a4efc5876629">sm_store_property_t</a> <a class="code" href="../../da/d44/classss__m.html#a7a0a9b5677337b6d5a4e3f42d9fa149">store_property_t</a>;
<a name="l00598"></a>00598 
<a name="l00599"></a>00599 <span class="preprocessor">#ifdef COMMENT</span>
<a name="l00600"></a>00600 <span class="preprocessor"></span>    <span class="comment">//</span>
<a name="l00601"></a>00601     <span class="comment">// Below is most of the interface for the SHORE Storage Manager.</span>
<a name="l00602"></a>00602     <span class="comment">// The rest is located in pin.h, scan.h, and smthread.h</span>
<a name="l00603"></a>00603     <span class="comment">//</span>
<a name="l00604"></a>00604 
<a name="l00605"></a>00605     <span class="comment">//</span>
<a name="l00606"></a>00606     <span class="comment">// TEMPORARY FILES/INDEXES</span>
<a name="l00607"></a>00607     <span class="comment">//</span>
<a name="l00608"></a>00608     <span class="comment">// When a file or index is created there is a tmp_flag parameter</span>
<a name="l00609"></a>00609     <span class="comment">// that when true indicates that the file is temporary.</span>
<a name="l00610"></a>00610     <span class="comment">// Operations on a temporary file are not logged and the</span>
<a name="l00611"></a>00611     <span class="comment">// file will be gone the next time the volume is mounted.</span>
<a name="l00612"></a>00612     <span class="comment">//</span>
<a name="l00613"></a>00613     <span class="comment">// TODO: IMPLEMENTATION NOTE on Temporary Files/Indexes:</span>
<a name="l00614"></a>00614     <span class="comment">//        Temp files cannot be trusted after transaction abort.</span>
<a name="l00615"></a>00615     <span class="comment">//            They should be marked for removal.</span>
<a name="l00616"></a>00616     <span class="comment">//</span>
<a name="l00617"></a>00617     <span class="comment">// CODE STRUCTURE:</span>
<a name="l00618"></a>00618     <span class="comment">//    Almost all ss_m functions begin by creating a prologue object</span>
<a name="l00619"></a>00619     <span class="comment">//    whose constructor and descructor check for many common errors.</span>
<a name="l00620"></a>00620     <span class="comment">//    In addition most ss_m::OP() functions now call an ss_m::_OP()</span>
<a name="l00621"></a>00621     <span class="comment">//    function to do the real work.  The ss_m::OP functions should</span>
<a name="l00622"></a>00622     <span class="comment">//    not be called by other ss_m functions, instead the corresponding</span>
<a name="l00623"></a>00623     <span class="comment">//    ss_m::_OP function should be used.</span>
<a name="l00624"></a>00624     <span class="comment">//</span>
<a name="l00625"></a>00625 
<a name="l00626"></a>00626 <span class="preprocessor">#endif </span><span class="comment">/* COMMENT */</span>
<a name="l00627"></a>00627 
<a name="l00628"></a>00628   <span class="keyword">public</span>:<span class="comment"></span>
<a name="l00629"></a>00629 <span class="comment">    /**\brief Add storage manager options to the given options group.</span>
<a name="l00630"></a>00630 <span class="comment">     *\ingroup SSMINIT</span>
<a name="l00631"></a>00631 <span class="comment">     *\details</span>
<a name="l00632"></a>00632 <span class="comment">     * @param[in] grp The caller's option group, to which the</span>
<a name="l00633"></a>00633 <span class="comment">     * storage manager's options will be added for processing soon.</span>
<a name="l00634"></a>00634 <span class="comment">     *</span>
<a name="l00635"></a>00635 <span class="comment">     * Before the ss_m constructor can be called, setup_options</span>
<a name="l00636"></a>00636 <span class="comment">     * \b must be called.  This will install the storage manager's options and</span>
<a name="l00637"></a>00637 <span class="comment">     * initialize any that are not required.</span>
<a name="l00638"></a>00638 <span class="comment">     * Once all required options have been set, an ss_m can be constructed.</span>
<a name="l00639"></a>00639 <span class="comment">     *</span>
<a name="l00640"></a>00640 <span class="comment">     *\note This is not thread-safe.  The application (server) must prevent</span>
<a name="l00641"></a>00641 <span class="comment">     * concurrent calls to setup_options.</span>
<a name="l00642"></a>00642 <span class="comment">     */</span>
<a name="l00643"></a>00643     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a> <a class="code" href="../../de/db0/group___s_s_m_i_n_i_t.html#g455514e48179fdca8bc42fc491c1f0cb">setup_options</a>(<a class="code" href="../../d7/da2/classoption__group__t.html">option_group_t</a>* grp);
<a name="l00644"></a>00644 <span class="comment"></span>
<a name="l00645"></a>00645 <span class="comment">    /**\brief  Initialize the storage manager.</span>
<a name="l00646"></a>00646 <span class="comment">     * \ingroup SSMINIT</span>
<a name="l00647"></a>00647 <span class="comment">     * \details</span>
<a name="l00648"></a>00648 <span class="comment">     * @param[in] warn   A callback function. This is called </span>
<a name="l00649"></a>00649 <span class="comment">     * when/if the log is in danger of becoming "too full".</span>
<a name="l00650"></a>00650 <span class="comment">     * @param[in] get   A callback function. This is called </span>
<a name="l00651"></a>00651 <span class="comment">     * when the storage manager needs an archived log file to be restored.</span>
<a name="l00652"></a>00652 <span class="comment">     *</span>
<a name="l00653"></a>00653 <span class="comment">     * When an ss_m object is created, the storage manager initializes itself</span>
<a name="l00654"></a>00654 <span class="comment">     * and,</span>
<a name="l00655"></a>00655 <span class="comment">     * if the sthreads package has not already been initialized by virtue</span>
<a name="l00656"></a>00656 <span class="comment">     * of an sthread_t running, the sthreads package is initialized now.</span>
<a name="l00657"></a>00657 <span class="comment">     *</span>
<a name="l00658"></a>00658 <span class="comment">     * The log is read and recovery is performed (\ref MHLPS), </span>
<a name="l00659"></a>00659 <span class="comment">     * and control returns to</span>
<a name="l00660"></a>00660 <span class="comment">     * the caller, after which time</span>
<a name="l00661"></a>00661 <span class="comment">     * storage manager threads (instances of smthread_t) may be constructed and</span>
<a name="l00662"></a>00662 <span class="comment">     * storage manager may be used.</span>
<a name="l00663"></a>00663 <span class="comment">     *</span>
<a name="l00664"></a>00664 <span class="comment">     * The storage manager is used by invoking its static methods.  </span>
<a name="l00665"></a>00665 <span class="comment">     * You may use them as follows:</span>
<a name="l00666"></a>00666 <span class="comment">     * \code</span>
<a name="l00667"></a>00667 <span class="comment">     * ss_m *UNIQ = new ss_m();</span>
<a name="l00668"></a>00668 <span class="comment">     *</span>
<a name="l00669"></a>00669 <span class="comment">     * W_DO(UNIQ-&gt;mount_dev(...))</span>
<a name="l00670"></a>00670 <span class="comment">     *     // or</span>
<a name="l00671"></a>00671 <span class="comment">     * W_DO(ss_m::mount_dev(...))</span>
<a name="l00672"></a>00672 <span class="comment">     * \endcode</span>
<a name="l00673"></a>00673 <span class="comment">     * ).</span>
<a name="l00674"></a>00674 <span class="comment">     *</span>
<a name="l00675"></a>00675 <span class="comment">     * Only one ss_m object may be extant at any time. If you try</span>
<a name="l00676"></a>00676 <span class="comment">     * to create another while the one exists, a fatal error will occur</span>
<a name="l00677"></a>00677 <span class="comment">     * (your program will choke with a message about your mistake).</span>
<a name="l00678"></a>00678 <span class="comment">     *</span>
<a name="l00679"></a>00679 <span class="comment">     * The callback argument given to the storage manager constructor</span>
<a name="l00680"></a>00680 <span class="comment">     * is called when the storage manager determines that it is in danger</span>
<a name="l00681"></a>00681 <span class="comment">     * of running out of log space.  Heuristics are used to guess when</span>
<a name="l00682"></a>00682 <span class="comment">     * this is the case.  </span>
<a name="l00683"></a>00683 <span class="comment">     *</span>
<a name="l00684"></a>00684 <span class="comment">     * If the function \a warn archives and removes log files, the function</span>
<a name="l00685"></a>00685 <span class="comment">     * \a get must be provided to restore those log files when the</span>
<a name="l00686"></a>00686 <span class="comment">     * storage manager needs them.</span>
<a name="l00687"></a>00687 <span class="comment">     *</span>
<a name="l00688"></a>00688 <span class="comment">     * For details and examples, see  \ref smlevel_0::LOG_WARN_CALLBACK_FUNC, </span>
<a name="l00689"></a>00689 <span class="comment">     *  \ref smlevel_0::LOG_ARCHIVED_CALLBACK_FUNC, and </span>
<a name="l00690"></a>00690 <span class="comment">     *  \ref LOGSPACE.</span>
<a name="l00691"></a>00691 <span class="comment">     */</span>
<a name="l00692"></a>00692     <a class="code" href="../../de/db0/group___s_s_m_i_n_i_t.html#g4b4479aa4533cf55b6baccc3758d08b2">ss_m</a>(<a class="code" href="../../da/d44/classss__m.html#95372aaf34985ed6fcb2f4cac71abd8f">LOG_WARN_CALLBACK_FUNC</a> warn=NULL, <a class="code" href="../../da/d44/classss__m.html#3887d0b6a024e70a5d35b24e33095ef6">LOG_ARCHIVED_CALLBACK_FUNC</a> get=NULL);
<a name="l00693"></a>00693 <span class="comment"></span>
<a name="l00694"></a>00694 <span class="comment">    /**\brief  Shut down the storage manager.</span>
<a name="l00695"></a>00695 <span class="comment">     * \ingroup SSMINIT</span>
<a name="l00696"></a>00696 <span class="comment">     * \details</span>
<a name="l00697"></a>00697 <span class="comment">     * When the storage manager object is deleted, it shuts down.</span>
<a name="l00698"></a>00698 <span class="comment">     * Thereafter it is not usable until another ss_m object is </span>
<a name="l00699"></a>00699 <span class="comment">     * constructed.</span>
<a name="l00700"></a>00700 <span class="comment">     */</span>
<a name="l00701"></a>00701     <a class="code" href="../../de/db0/group___s_s_m_i_n_i_t.html#gbf91df5c36ea913868d386e6d94da4bf">~ss_m</a>();
<a name="l00702"></a>00702 <span class="comment"></span>
<a name="l00703"></a>00703 <span class="comment">    /**\brief Cause the storage manager's shutting down do be done cleanly </span>
<a name="l00704"></a>00704 <span class="comment">     * or to simulate a crash.</span>
<a name="l00705"></a>00705 <span class="comment">     * \ingroup SSMINIT</span>
<a name="l00706"></a>00706 <span class="comment">     * \details</span>
<a name="l00707"></a>00707 <span class="comment">     * @param[in] clean   True means shut down gracefully, false means simulate a crash.</span>
<a name="l00708"></a>00708 <span class="comment">     *</span>
<a name="l00709"></a>00709 <span class="comment">     * When the storage manager's destructor is called</span>
<a name="l00710"></a>00710 <span class="comment">     * the buffer pool is flushed to disk, unless this method is called </span>
<a name="l00711"></a>00711 <span class="comment">     * with \a clean == \e false.</span>
<a name="l00712"></a>00712 <span class="comment">     *</span>
<a name="l00713"></a>00713 <span class="comment">     * \note If this method is used, it</span>
<a name="l00714"></a>00714 <span class="comment">     * must be called after the storage manager is </span>
<a name="l00715"></a>00715 <span class="comment">     * constructed if it is to take effect. Each time the storage</span>
<a name="l00716"></a>00716 <span class="comment">     * manager is constructed, the state associated with this is set</span>
<a name="l00717"></a>00717 <span class="comment">     * to \e true, i.e., "shut down properly".</span>
<a name="l00718"></a>00718 <span class="comment">     *</span>
<a name="l00719"></a>00719 <span class="comment">     * \note This method is not thread-safe, only one thread should use this</span>
<a name="l00720"></a>00720 <span class="comment">     * at any time, presumably just before shutting down.</span>
<a name="l00721"></a>00721 <span class="comment">     */</span>
<a name="l00722"></a>00722     <span class="keyword">static</span> <span class="keywordtype">void</span>         <a class="code" href="../../de/db0/group___s_s_m_i_n_i_t.html#g0a05f7b1acd4451033424fb9e4615b54">set_shutdown_flag</a>(<span class="keywordtype">bool</span> clean);
<a name="l00723"></a>00723 <span class="comment"></span>
<a name="l00724"></a>00724 <span class="comment">    /**\brief Notify storage manager when a log file was archived by a</span>
<a name="l00725"></a>00725 <span class="comment">     * LOG_WARN_CALLBACK_FUNC.</span>
<a name="l00726"></a>00726 <span class="comment">     *</span>
<a name="l00727"></a>00727 <span class="comment">     * The arguments:</span>
<a name="l00728"></a>00728 <span class="comment">     * @param[in] logfile   Character string name of file archived.</span>
<a name="l00729"></a>00729 <span class="comment">     */</span>
<a name="l00730"></a>00730     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>         <a class="code" href="../../da/d44/classss__m.html#0b06d988dedf22a6c62fa9d3062e57dd">log_file_was_archived</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * logfile);
<a name="l00731"></a>00731 
<a name="l00732"></a>00732 <span class="keyword">private</span>:
<a name="l00733"></a>00733     <span class="keywordtype">void</span>                _construct_once(<a class="code" href="../../da/d44/classss__m.html#95372aaf34985ed6fcb2f4cac71abd8f">LOG_WARN_CALLBACK_FUNC</a> x=NULL,
<a name="l00734"></a>00734                                            <a class="code" href="../../da/d44/classss__m.html#3887d0b6a024e70a5d35b24e33095ef6">LOG_ARCHIVED_CALLBACK_FUNC</a> y=NULL);
<a name="l00735"></a>00735     <span class="keywordtype">void</span>                _destruct_once();
<a name="l00736"></a>00736 
<a name="l00737"></a>00737 
<a name="l00738"></a>00738 <span class="keyword">public</span>:<span class="comment"></span>
<a name="l00739"></a>00739 <span class="comment">    /**\addtogroup SSMXCT</span>
<a name="l00740"></a>00740 <span class="comment">     *</span>
<a name="l00741"></a>00741 <span class="comment">     * All work performed on behalf of a transaction must occur while that</span>
<a name="l00742"></a>00742 <span class="comment">     * transaction is "attached" to the thread that performs the work.</span>
<a name="l00743"></a>00743 <span class="comment">     * Creating a transaction attaches it to the thread that creates the transaction. </span>
<a name="l00744"></a>00744 <span class="comment">     * The thread may detach from the transaction and attach to another.</span>
<a name="l00745"></a>00745 <span class="comment">     * Multiple threads may attach to a single transaction and do work in certain circumstances.   See \ref SSMMULTIXCT</span>
<a name="l00746"></a>00746 <span class="comment">     *</span>
<a name="l00747"></a>00747 <span class="comment">     * </span>
<a name="l00748"></a>00748 <span class="comment">     */</span><span class="comment"></span>
<a name="l00749"></a>00749 <span class="comment">    /**\brief Begin a transaction </span>
<a name="l00750"></a>00750 <span class="comment">     *\ingroup SSMXCT</span>
<a name="l00751"></a>00751 <span class="comment">     * @param[in] timeout   Optional, controls blocking behavior.</span>
<a name="l00752"></a>00752 <span class="comment">     * \details</span>
<a name="l00753"></a>00753 <span class="comment">     *</span>
<a name="l00754"></a>00754 <span class="comment">     * Start a new transaction and "attach" it to this thread. </span>
<a name="l00755"></a>00755 <span class="comment">     * No running transaction may be attached to this thread.</span>
<a name="l00756"></a>00756 <span class="comment">     * </span>
<a name="l00757"></a>00757 <span class="comment">     * Storage manager methods that must block (e.g., to acquire a lock) </span>
<a name="l00758"></a>00758 <span class="comment">     * will use the timeout given.  </span>
<a name="l00759"></a>00759 <span class="comment">     * The default timeout is the one associated with this thread.</span>
<a name="l00760"></a>00760 <span class="comment">     *</span>
<a name="l00761"></a>00761 <span class="comment">     * \sa timeout_in_ms</span>
<a name="l00762"></a>00762 <span class="comment">     */</span>
<a name="l00763"></a>00763     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>           <a class="code" href="../../d8/d1e/group___s_s_m_x_c_t.html#ga18b22291428a1c82a18f4c170298aeb">begin_xct</a>(
<a name="l00764"></a>00764         <a class="code" href="../../d8/d69/smthread_8h.html#cf834513ff7853bf96601820e038ec9a">timeout_in_ms</a>            timeout = WAIT_SPECIFIED_BY_THREAD);
<a name="l00765"></a>00765 <span class="comment"></span>
<a name="l00766"></a>00766 <span class="comment">    /**\brief Begin an instrumented transaction. </span>
<a name="l00767"></a>00767 <span class="comment">     *\ingroup SSMXCT</span>
<a name="l00768"></a>00768 <span class="comment">     * @param[in] stats   Pointer to an allocated statistics-holding structure.</span>
<a name="l00769"></a>00769 <span class="comment">     * @param[in] timeout   Optional, controls blocking behavior.</span>
<a name="l00770"></a>00770 <span class="comment">     * \details</span>
<a name="l00771"></a>00771 <span class="comment">     * No running transaction may be already attached to this thread.</span>
<a name="l00772"></a>00772 <span class="comment">     * A new transaction is started and attached to the running thread.</span>
<a name="l00773"></a>00773 <span class="comment">     *</span>
<a name="l00774"></a>00774 <span class="comment">     * The transaction will be instrumented.</span>
<a name="l00775"></a>00775 <span class="comment">     * This structure is updated by the storage manager whenever a thread</span>
<a name="l00776"></a>00776 <span class="comment">     * detaches from this transaction.  The activity recorded during</span>
<a name="l00777"></a>00777 <span class="comment">     * the time the thread is attached to the transcation will be stored in</span>
<a name="l00778"></a>00778 <span class="comment">     * the per-transaction statistics.</span>
<a name="l00779"></a>00779 <span class="comment">     * \attention It is the client's </span>
<a name="l00780"></a>00780 <span class="comment">     * responsibility to delete the statistics-holding structure.</span>
<a name="l00781"></a>00781 <span class="comment">     * </span>
<a name="l00782"></a>00782 <span class="comment">     * Storage manager methods that must block (e.g., to acquire a lock) </span>
<a name="l00783"></a>00783 <span class="comment">     * will use the timeout given.  </span>
<a name="l00784"></a>00784 <span class="comment">     * The default timeout is the one associated with this thread.</span>
<a name="l00785"></a>00785 <span class="comment">     *</span>
<a name="l00786"></a>00786 <span class="comment">     * \sa timeout_in_ms</span>
<a name="l00787"></a>00787 <span class="comment">     */</span>
<a name="l00788"></a>00788     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>           <a class="code" href="../../d8/d1e/group___s_s_m_x_c_t.html#ga18b22291428a1c82a18f4c170298aeb">begin_xct</a>(
<a name="l00789"></a>00789         <a class="code" href="../../d9/dee/classsm__stats__info__t.html">sm_stats_info_t</a>*         stats,  <span class="comment">// allocated by caller</span>
<a name="l00790"></a>00790         <a class="code" href="../../d8/d69/smthread_8h.html#cf834513ff7853bf96601820e038ec9a">timeout_in_ms</a>            timeout = WAIT_SPECIFIED_BY_THREAD);
<a name="l00791"></a>00791 <span class="comment"></span>
<a name="l00792"></a>00792 <span class="comment">    /**\brief Begin a transaction and return the transaction id.</span>
<a name="l00793"></a>00793 <span class="comment">     *\ingroup SSMXCT</span>
<a name="l00794"></a>00794 <span class="comment">     * @param[out] tid      Transaction id of new transaction.</span>
<a name="l00795"></a>00795 <span class="comment">     * @param[in] timeout   Optional, controls blocking behavior.</span>
<a name="l00796"></a>00796 <span class="comment">     * \details</span>
<a name="l00797"></a>00797 <span class="comment">     *</span>
<a name="l00798"></a>00798 <span class="comment">     * No running transaction may be attached to this thread.</span>
<a name="l00799"></a>00799 <span class="comment">     * </span>
<a name="l00800"></a>00800 <span class="comment">     * Storage manager methods that must block (e.g., to acquire a lock) </span>
<a name="l00801"></a>00801 <span class="comment">     * will use the timeout given.  </span>
<a name="l00802"></a>00802 <span class="comment">     * The default timeout is the one associated with this thread.</span>
<a name="l00803"></a>00803 <span class="comment">     *</span>
<a name="l00804"></a>00804 <span class="comment">     * \sa timeout_in_ms</span>
<a name="l00805"></a>00805 <span class="comment">     */</span>
<a name="l00806"></a>00806     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>           <a class="code" href="../../d8/d1e/group___s_s_m_x_c_t.html#ga18b22291428a1c82a18f4c170298aeb">begin_xct</a>(
<a name="l00807"></a>00807         <a class="code" href="../../d8/d12/classtid__t.html">tid_t</a>&amp;                   tid,
<a name="l00808"></a>00808         <a class="code" href="../../d8/d69/smthread_8h.html#cf834513ff7853bf96601820e038ec9a">timeout_in_ms</a>            timeout = WAIT_SPECIFIED_BY_THREAD);
<a name="l00809"></a>00809 <span class="comment"></span>
<a name="l00810"></a>00810 <span class="comment">    /**\addtogroup SSM2PC  </span>
<a name="l00811"></a>00811 <span class="comment">     * The storage manager contains support for externally-coordinated</span>
<a name="l00812"></a>00812 <span class="comment">     * transactions that use</span>
<a name="l00813"></a>00813 <span class="comment">     * two-phase-commit with presumed abort.</span>
<a name="l00814"></a>00814 <span class="comment">     * The server must provide the coordination and the coordinator is</span>
<a name="l00815"></a>00815 <span class="comment">     * assumed to have its own stable storage, and it is assumed to recover</span>
<a name="l00816"></a>00816 <span class="comment">     * from failures in a "short time", the precise meaning of which is given below.</span>
<a name="l00817"></a>00817 <span class="comment">     * A prepared transaction, like an active transaction,</span>
<a name="l00818"></a>00818 <span class="comment">     * consumes log space and holds locks.</span>
<a name="l00819"></a>00819 <span class="comment">     * Even if a prepared transaction does not hold locks needed by </span>
<a name="l00820"></a>00820 <span class="comment">     * other transactions, it consumes resources in a way that can interfere </span>
<a name="l00821"></a>00821 <span class="comment">     * with other transactions.</span>
<a name="l00822"></a>00822 <span class="comment">     * If a prepared transaction remains in the system for a long time </span>
<a name="l00823"></a>00823 <span class="comment">     * while other transactions are running, eventually the storage </span>
<a name="l00824"></a>00824 <span class="comment">     * manager needs the log space used (reserved) by the prepared transaction.</span>
<a name="l00825"></a>00825 <span class="comment">     * A coordinator must resolve its prepared transactions</span>
<a name="l00826"></a>00826 <span class="comment">     * before the storage manager effectively runs out of </span>
<a name="l00827"></a>00827 <span class="comment">     * log space for other transactions in the system.</span>
<a name="l00828"></a>00828 <span class="comment">     * The amount of time involved is a function of the size of the log</span>
<a name="l00829"></a>00829 <span class="comment">     * and of the demands of the other transactions in the system.</span>
<a name="l00830"></a>00830 <span class="comment">     *</span>
<a name="l00831"></a>00831 <span class="comment">     * For the purpose of this discussion, the portion of a global </span>
<a name="l00832"></a>00832 <span class="comment">     * transaction that involves a single Shore Storage Manager transaction is </span>
<a name="l00833"></a>00833 <span class="comment">     * called a thread of the global transaction.</span>
<a name="l00834"></a>00834 <span class="comment">     *</span>
<a name="l00835"></a>00835 <span class="comment">     * A Shore transaction participates as a thread of a global transaction</span>
<a name="l00836"></a>00836 <span class="comment">     * as follows:</span>
<a name="l00837"></a>00837 <span class="comment">     - Start a storage-manager transaction with ss_m::begin_xct.</span>
<a name="l00838"></a>00838 <span class="comment">     - Acquire a global transaction identifier from the coordinator.</span>
<a name="l00839"></a>00839 <span class="comment">     - Indicate to the storage manager that this transaction is a </span>
<a name="l00840"></a>00840 <span class="comment">     thread of a global transaction, and associate the global transaction </span>
<a name="l00841"></a>00841 <span class="comment">     identifier with this thread by calling ss_m::enter_2pc.</span>
<a name="l00842"></a>00842 <span class="comment">     - Associate a coordinator with the transaction for recovery </span>
<a name="l00843"></a>00843 <span class="comment">     purposes, by calling ss_m::set_coordinator.</span>
<a name="l00844"></a>00844 <span class="comment">     - Prepare the thread of the transaction and get the storage manager's </span>
<a name="l00845"></a>00845 <span class="comment">     vote with ss_m::prepare_xct.  </span>
<a name="l00846"></a>00846 <span class="comment">     It is an error to commit a global transaction thread without first </span>
<a name="l00847"></a>00847 <span class="comment">     preparing it.  It is an error to do anything else </span>
<a name="l00848"></a>00848 <span class="comment">     in a transaction after it is prepared, except to end </span>
<a name="l00849"></a>00849 <span class="comment">     the transaction or retry the prepare (to get the vote again).</span>
<a name="l00850"></a>00850 <span class="comment">     - Convey the vote to the coordinator, and determine the transaction's </span>
<a name="l00851"></a>00851 <span class="comment">     fate from the coordinator.</span>
<a name="l00852"></a>00852 <span class="comment">     - End the thread with ss_m::commit_xct or ss_m::abort_xct.</span>
<a name="l00853"></a>00853 <span class="comment">     *</span>
<a name="l00854"></a>00854 <span class="comment">     * The storage manager </span>
<a name="l00855"></a>00855 <span class="comment">     * logs the minimal information required to effect a vote of the</span>
<a name="l00856"></a>00856 <span class="comment">     * transaction threads that are storage manager transactions,</span>
<a name="l00857"></a>00857 <span class="comment">     * and to recover such in-doubt transactions after restart.</span>
<a name="l00858"></a>00858 <span class="comment">     * Thus, after a crash/restart, the server may query the storage manager</span>
<a name="l00859"></a>00859 <span class="comment">     * about in-doubt (prepared) transactions with ss_m::query_prepared_xct,</span>
<a name="l00860"></a>00860 <span class="comment">     * which tells the caller the number and global transaction IDs associated</span>
<a name="l00861"></a>00861 <span class="comment">     * with prepared transactions.</span>
<a name="l00862"></a>00862 <span class="comment">     * Using this, the server contacts the coordinator and resumes the</span>
<a name="l00863"></a>00863 <span class="comment">     * voting.</span>
<a name="l00864"></a>00864 <span class="comment">     * The server may find the local transaction IDs and use ss_m::tid_to_xct</span>
<a name="l00865"></a>00865 <span class="comment">     * to attach these transactions  and to resolve them.</span>
<a name="l00866"></a>00866 <span class="comment">     * </span>
<a name="l00867"></a>00867 <span class="comment">     * Commit and abort of read-only transactions are the same,</span>
<a name="l00868"></a>00868 <span class="comment">     * as these transactions have no log entries.  Preparing read-only transactions</span>
<a name="l00869"></a>00869 <span class="comment">     * causes them to commit/abort and the vote returned is vote_readonly.</span>
<a name="l00870"></a>00870 <span class="comment">     * Once this vote is communicated to the coordinator and the coordinator</span>
<a name="l00871"></a>00871 <span class="comment">     * records it on stable storage, there is no need to involve this thread in</span>
<a name="l00872"></a>00872 <span class="comment">     * any further processing.  For this reason,</span>
<a name="l00873"></a>00873 <span class="comment">     * read-only transactions do not appear as prepared transactions at</span>
<a name="l00874"></a>00874 <span class="comment">     * recovery time.</span>
<a name="l00875"></a>00875 <span class="comment">     * </span>
<a name="l00876"></a>00876 <span class="comment">     */</span>
<a name="l00877"></a>00877 <span class="comment"></span>
<a name="l00878"></a>00878 <span class="comment">    /**\brief Make the attached transaction a thread of a distributed transaction.</span>
<a name="l00879"></a>00879 <span class="comment">     *\ingroup SSM2PC</span>
<a name="l00880"></a>00880 <span class="comment">     *</span>
<a name="l00881"></a>00881 <span class="comment">     * @param[in] gtid    Global transaction ID to associate with this transaction.  This will be logged when the transaction is prepared.</span>
<a name="l00882"></a>00882 <span class="comment">     * </span>
<a name="l00883"></a>00883 <span class="comment">     * \note This can be called at most once for a given transaction.</span>
<a name="l00884"></a>00884 <span class="comment">     * The transaction must be attached to the calling thread.</span>
<a name="l00885"></a>00885 <span class="comment">     * No other threads may be attached to the transaction.</span>
<a name="l00886"></a>00886 <span class="comment">     */</span>
<a name="l00887"></a>00887     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>           <a class="code" href="../../d2/dae/group___s_s_m2_p_c.html#gd9037a378e29f807286e84bc156d0584">enter_2pc</a>(<span class="keyword">const</span> <a class="code" href="../../d5/de1/classopaque__quantity.html">gtid_t</a> &amp;gtid); <span class="comment"></span>
<a name="l00888"></a>00888 <span class="comment">    /**\brief Assign a coordinator handle to this distributed transaction.</span>
<a name="l00889"></a>00889 <span class="comment">     *\ingroup SSM2PC</span>
<a name="l00890"></a>00890 <span class="comment">     * @param[in] h      Handle of the coordinator.  Not interpreted by</span>
<a name="l00891"></a>00891 <span class="comment">     * the storage manager.</span>
<a name="l00892"></a>00892 <span class="comment">     *</span>
<a name="l00893"></a>00893 <span class="comment">     * The storage manager associates this server handle with the transaction </span>
<a name="l00894"></a>00894 <span class="comment">     * so that when the transaction is prepared, this information is </span>
<a name="l00895"></a>00895 <span class="comment">     * written to the log. Upon recovery, if this transaction is still in doubt,</span>
<a name="l00896"></a>00896 <span class="comment">     * the value-added server can query the </span>
<a name="l00897"></a>00897 <span class="comment">     * storage manager for in-doubt transactions, get their server handles,</span>
<a name="l00898"></a>00898 <span class="comment">     * and resolve the transactions.</span>
<a name="l00899"></a>00899 <span class="comment">     * See query_prepared_xct and recover_2pc.</span>
<a name="l00900"></a>00900 <span class="comment">     */</span>
<a name="l00901"></a>00901     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>           <a class="code" href="../../d2/dae/group___s_s_m2_p_c.html#ge150c0d31d4cb1c21e43e0ad2e98d8ec">set_coordinator</a>(<span class="keyword">const</span> <a class="code" href="../../d5/de1/classopaque__quantity.html">server_handle_t</a> &amp;h); 
<a name="l00902"></a>00902 <span class="comment"></span>
<a name="l00903"></a>00903 <span class="comment">    /**\brief Prepare a thread of a distributed transaction.</span>
<a name="l00904"></a>00904 <span class="comment">     *\ingroup SSM2PC</span>
<a name="l00905"></a>00905 <span class="comment">     * @param[in] stats     Pointer to an allocated statistics-holding </span>
<a name="l00906"></a>00906 <span class="comment">     *                      structure.</span>
<a name="l00907"></a>00907 <span class="comment">     * @param[out] vote     This thread's vote.</span>
<a name="l00908"></a>00908 <span class="comment">     *</span>
<a name="l00909"></a>00909 <span class="comment">     * The storage manager will prepare the attached transaction (a thread</span>
<a name="l00910"></a>00910 <span class="comment">     * of a distributed transaction) for commit.</span>
<a name="l00911"></a>00911 <span class="comment">     * If this transaction has performed no logged updates, the </span>
<a name="l00912"></a>00912 <span class="comment">     * vote returned will be vote_readonly.</span>
<a name="l00913"></a>00913 <span class="comment">     * If this transaction can commit, the vote returned will be vote_commit.</span>
<a name="l00914"></a>00914 <span class="comment">     * If an error occurs during the prepare, the vote will be vote_abort.</span>
<a name="l00915"></a>00915 <span class="comment">     *</span>
<a name="l00916"></a>00916 <span class="comment">     * If the transaction is being instrumented, the </span>
<a name="l00917"></a>00917 <span class="comment">     * statistics-holding structure will be returned to the caller, </span>
<a name="l00918"></a>00918 <span class="comment">     * and the caller is responsible for its deallocation.</span>
<a name="l00919"></a>00919 <span class="comment">     */</span>
<a name="l00920"></a>00920     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>           <a class="code" href="../../d2/dae/group___s_s_m2_p_c.html#ge9b472f3492b226aa00c30134e35fc91">prepare_xct</a>(
<a name="l00921"></a>00921                             <a class="code" href="../../d9/dee/classsm__stats__info__t.html">sm_stats_info_t</a>*&amp;         stats, 
<a name="l00922"></a>00922                             vote_t&amp;                   vote); 
<a name="l00923"></a>00923 <span class="comment"></span>
<a name="l00924"></a>00924 <span class="comment">    /**\brief Prepare a thread of a distributed transaction.</span>
<a name="l00925"></a>00925 <span class="comment">     *\ingroup SSM2PC</span>
<a name="l00926"></a>00926 <span class="comment">     * @param[out] vote     This thread's vote. See \ref w_base_t::vote_t.</span>
<a name="l00927"></a>00927 <span class="comment">     *</span>
<a name="l00928"></a>00928 <span class="comment">     * The storage manager will prepare the attached transaction (a thread</span>
<a name="l00929"></a>00929 <span class="comment">     * of a distributed transaction) for commit.</span>
<a name="l00930"></a>00930 <span class="comment">     * If this transaction has performed no logged updates, the </span>
<a name="l00931"></a>00931 <span class="comment">     * vote returned will be vote_readonly.</span>
<a name="l00932"></a>00932 <span class="comment">     * If this transaction can commit, the vote returned will be vote_commit.</span>
<a name="l00933"></a>00933 <span class="comment">     * If an error occurs during the prepare, the vote will be vote_abort.</span>
<a name="l00934"></a>00934 <span class="comment">     */</span>
<a name="l00935"></a>00935     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>           <a class="code" href="../../d2/dae/group___s_s_m2_p_c.html#ge9b472f3492b226aa00c30134e35fc91">prepare_xct</a>(vote_t &amp;vote); 
<a name="l00936"></a>00936 <span class="comment"></span>
<a name="l00937"></a>00937 <span class="comment">    /**\brief Force the transaction to vote "read-only" in a two-phase commit. </span>
<a name="l00938"></a>00938 <span class="comment">     *\ingroup SSM2PC</span>
<a name="l00939"></a>00939 <span class="comment">     * \details</span>
<a name="l00940"></a>00940 <span class="comment">     * This will override the storage manager's determination of </span>
<a name="l00941"></a>00941 <span class="comment">     * whether this thread of a distributed transaction is read-only, which is</span>
<a name="l00942"></a>00942 <span class="comment">     * based on whether the local transaction thread logged anything. This</span>
<a name="l00943"></a>00943 <span class="comment">     * method may be useful if the local transaction rolled back to </span>
<a name="l00944"></a>00944 <span class="comment">     * a savepoint.</span>
<a name="l00945"></a>00945 <span class="comment">     * See  \ref w_base_t::vote_t.</span>
<a name="l00946"></a>00946 <span class="comment">     */</span>
<a name="l00947"></a>00947     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>           <a class="code" href="../../d2/dae/group___s_s_m2_p_c.html#ge6a7ff8f0dbf022c8d1436382da63cf2">force_vote_readonly</a>(); 
<a name="l00948"></a>00948 <span class="comment"></span>
<a name="l00949"></a>00949 <span class="comment">    /**\brief Given a global transaction id, find the local prepared </span>
<a name="l00950"></a>00950 <span class="comment">     * transaction associated with it. </span>
<a name="l00951"></a>00951 <span class="comment">     *\ingroup SSM2PC</span>
<a name="l00952"></a>00952 <span class="comment">     * @param[in] gtid     A global transaction ID (an opaque quantity </span>
<a name="l00953"></a>00953 <span class="comment">     * to the storage manager).</span>
<a name="l00954"></a>00954 <span class="comment">     * @param[in] mayblock Not used.</span>
<a name="l00955"></a>00955 <span class="comment">     * @param[out] local   Return the transaction ID of the prepared </span>
<a name="l00956"></a>00956 <span class="comment">     * SM transaction.</span>
<a name="l00957"></a>00957 <span class="comment">     * \details</span>
<a name="l00958"></a>00958 <span class="comment">     * Searches the transaction list for a prepared transaction with the given</span>
<a name="l00959"></a>00959 <span class="comment">     * global transaction id. If found, it returns a reference to the </span>
<a name="l00960"></a>00960 <span class="comment">     * local transaction.  The transaction is attached to the running</span>
<a name="l00961"></a>00961 <span class="comment">     * thread before it is returned.</span>
<a name="l00962"></a>00962 <span class="comment">     */</span>
<a name="l00963"></a>00963     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>           <a class="code" href="../../d2/dae/group___s_s_m2_p_c.html#gef8777a2f9556ec3e6e21d94078eda6d">recover_2pc</a>(<span class="keyword">const</span> <a class="code" href="../../d5/de1/classopaque__quantity.html">gtid_t</a> &amp; gtid,
<a name="l00964"></a>00964         <span class="keywordtype">bool</span>                      mayblock,
<a name="l00965"></a>00965         <a class="code" href="../../d8/d12/classtid__t.html">tid_t</a> &amp;                   local
<a name="l00966"></a>00966         );
<a name="l00967"></a>00967 <span class="comment"></span>
<a name="l00968"></a>00968 <span class="comment">    /**\brief  Return the number of prepared transactions.</span>
<a name="l00969"></a>00969 <span class="comment">     *\ingroup SSM2PC</span>
<a name="l00970"></a>00970 <span class="comment">     * @param[out] numtids   The number of in-doubt transactions.</span>
<a name="l00971"></a>00971 <span class="comment">     * \details</span>
<a name="l00972"></a>00972 <span class="comment">     * Used by a server at start-up, after recovery, to find out if</span>
<a name="l00973"></a>00973 <span class="comment">     * there are any in-doubt transactions.  If so, the server must</span>
<a name="l00974"></a>00974 <span class="comment">     * use the second form of query_prepared_xct to find the global</span>
<a name="l00975"></a>00975 <span class="comment">     * transaction IDs of these in-doubt transactions.</span>
<a name="l00976"></a>00976 <span class="comment">     */</span>
<a name="l00977"></a>00977     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>           <a class="code" href="../../d2/dae/group___s_s_m2_p_c.html#gc5f9a81198429ccb309df5d4e684c51b">query_prepared_xct</a>(<span class="keywordtype">int</span> &amp;numtids);
<a name="l00978"></a>00978 <span class="comment"></span>
<a name="l00979"></a>00979 <span class="comment">    /**\brief  Return the global transaction IDs of in-doubt transactions. </span>
<a name="l00980"></a>00980 <span class="comment">     *\ingroup SSM2PC</span>
<a name="l00981"></a>00981 <span class="comment">     * @param[in] numtids   The number of global transaction ids in the list.</span>
<a name="l00982"></a>00982 <span class="comment">     * @param[in] l   The caller-provided list into which to write the </span>
<a name="l00983"></a>00983 <span class="comment">     * global transaction-ids.</span>
<a name="l00984"></a>00984 <span class="comment">     * \details</span>
<a name="l00985"></a>00985 <span class="comment">     * Used by a server at start-up, after recovery, to find out the</span>
<a name="l00986"></a>00986 <span class="comment">     * global transaction IDs of the prepared transactions.  The storage</span>
<a name="l00987"></a>00987 <span class="comment">     * manager fills in the first numtids entries of the pre-allocated list.</span>
<a name="l00988"></a>00988 <span class="comment">     * The server may have first called the first form of query_prepared_xct</span>
<a name="l00989"></a>00989 <span class="comment">     * to find out how many such transactions there are after recovery.</span>
<a name="l00990"></a>00990 <span class="comment">     *</span>
<a name="l00991"></a>00991 <span class="comment">     * \attention Read-only transactions </span>
<a name="l00992"></a>00992 <span class="comment">     * do not appear as in-doubt transactions. Because they did not</span>
<a name="l00993"></a>00993 <span class="comment">     * generate any log records, they will not be "discovered" by analysis.</span>
<a name="l00994"></a>00994 <span class="comment">     * The server must determine that any thread of a global transaction that</span>
<a name="l00995"></a>00995 <span class="comment">     * does not appear to be in doubt was a read-only thread or</span>
<a name="l00996"></a>00996 <span class="comment">     * it never prepared and thus has been aborted.</span>
<a name="l00997"></a>00997 <span class="comment">     * Read-only transactions that were prepared would have voted read-only,</span>
<a name="l00998"></a>00998 <span class="comment">     * and if the coordinator recorded that vote on stable storage, it</span>
<a name="l00999"></a>00999 <span class="comment">     * should not be concerned with these transaction threads any further.</span>
<a name="l01000"></a>01000 <span class="comment">     * If the coordinator does not have this information recorded, the</span>
<a name="l01001"></a>01001 <span class="comment">     * transaction thread could have been an aborted non-read-only transaction,</span>
<a name="l01002"></a>01002 <span class="comment">     * so the coordinator must, in this case, presume that the thread aborted</span>
<a name="l01003"></a>01003 <span class="comment">     * and thus make the global transaction abort.</span>
<a name="l01004"></a>01004 <span class="comment">     */</span>
<a name="l01005"></a>01005     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>           <a class="code" href="../../d2/dae/group___s_s_m2_p_c.html#gc5f9a81198429ccb309df5d4e684c51b">query_prepared_xct</a>(<span class="keywordtype">int</span> numtids, <a class="code" href="../../d5/de1/classopaque__quantity.html">gtid_t</a> l[]);
<a name="l01006"></a>01006 
<a name="l01007"></a>01007 <span class="comment"></span>
<a name="l01008"></a>01008 <span class="comment">    /**\brief Commit a transaction.</span>
<a name="l01009"></a>01009 <span class="comment">     *\ingroup SSMXCT</span>
<a name="l01010"></a>01010 <span class="comment">     * @param[in] lazy   Optional, controls flushing of log.</span>
<a name="l01011"></a>01011 <span class="comment">     * @param[out] plastlsn   If non-null, this is a pointer to a</span>
<a name="l01012"></a>01012 <span class="comment">     *                    log sequence number into which the storage</span>
<a name="l01013"></a>01013 <span class="comment">     *                    manager writes the that of the last log record</span>
<a name="l01014"></a>01014 <span class="comment">     *                    inserted for this transaction.</span>
<a name="l01015"></a>01015 <span class="comment">     * \details</span>
<a name="l01016"></a>01016 <span class="comment">     *</span>
<a name="l01017"></a>01017 <span class="comment">     * Commit the attached transaction and detach it, destroy it.</span>
<a name="l01018"></a>01018 <span class="comment">     * If \a lazy is true, the log is not synced.  This means that</span>
<a name="l01019"></a>01019 <span class="comment">     * recovery of this transaction might not be possible.</span>
<a name="l01020"></a>01020 <span class="comment">     */</span>
<a name="l01021"></a>01021     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>           <a class="code" href="../../d8/d1e/group___s_s_m_x_c_t.html#gdcc84a1d655f398fa9a054b79eb6e544">commit_xct</a>(
<a name="l01022"></a>01022                                      <span class="keywordtype">bool</span>   lazy = <span class="keyword">false</span>,
<a name="l01023"></a>01023                                      <a class="code" href="../../d2/d19/classlsn__t.html">lsn_t</a>* plastlsn=NULL);
<a name="l01024"></a>01024 <span class="comment"></span>
<a name="l01025"></a>01025 <span class="comment">    /**\brief Commit an instrumented transaction and get its statistics.</span>
<a name="l01026"></a>01026 <span class="comment">     *\ingroup SSMXCT</span>
<a name="l01027"></a>01027 <span class="comment">     * @param[out] stats   Get a copy of the statistics for this transaction.</span>
<a name="l01028"></a>01028 <span class="comment">     * @param[in] lazy   Optional, controls flushing of log.</span>
<a name="l01029"></a>01029 <span class="comment">     * @param[out] plastlsn   If non-null, this is a pointer to a</span>
<a name="l01030"></a>01030 <span class="comment">     *                    log sequence number into which the storage</span>
<a name="l01031"></a>01031 <span class="comment">     *                    manager writes the that of the last log record</span>
<a name="l01032"></a>01032 <span class="comment">     *                    inserted for this transaction.</span>
<a name="l01033"></a>01033 <span class="comment">     * \details</span>
<a name="l01034"></a>01034 <span class="comment">     *</span>
<a name="l01035"></a>01035 <span class="comment">     * Commit the attached transaction and detach it, destroy it.</span>
<a name="l01036"></a>01036 <span class="comment">     * If \a lazy is true, the log is not synced.  This means that</span>
<a name="l01037"></a>01037 <span class="comment">     * recovery of this transaction might not be possible.</span>
<a name="l01038"></a>01038 <span class="comment">     */</span>
<a name="l01039"></a>01039     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d8/d1e/group___s_s_m_x_c_t.html#gdcc84a1d655f398fa9a054b79eb6e544">commit_xct</a>(
<a name="l01040"></a>01040                                     <a class="code" href="../../d9/dee/classsm__stats__info__t.html">sm_stats_info_t</a>*&amp; stats, 
<a name="l01041"></a>01041                                     <span class="keywordtype">bool</span>              lazy = <span class="keyword">false</span>,
<a name="l01042"></a>01042                                     <a class="code" href="../../d2/d19/classlsn__t.html">lsn_t</a>*            plastlsn=NULL);
<a name="l01043"></a>01043 <span class="comment"></span>
<a name="l01044"></a>01044 <span class="comment">    /**\brief Commit an instrumented transaction and start a new one.</span>
<a name="l01045"></a>01045 <span class="comment">     *\ingroup SSMXCT</span>
<a name="l01046"></a>01046 <span class="comment">     * @param[out] stats   Get a copy of the statistics for the first transaction.</span>
<a name="l01047"></a>01047 <span class="comment">     * @param[in] lazy   Optional, controls flushing of log.</span>
<a name="l01048"></a>01048 <span class="comment">     * \details</span>
<a name="l01049"></a>01049 <span class="comment">     *</span>
<a name="l01050"></a>01050 <span class="comment">     * Commit the attached transaction and detach it, destroy it.</span>
<a name="l01051"></a>01051 <span class="comment">     * Start a new transaction and attach it to this thread.</span>
<a name="l01052"></a>01052 <span class="comment">     * \note \e The \e new </span>
<a name="l01053"></a>01053 <span class="comment">     * \e transaction \e inherits \e the \e locks \e of \e the \e old </span>
<a name="l01054"></a>01054 <span class="comment">     * \e transaction.</span>
<a name="l01055"></a>01055 <span class="comment">     *</span>
<a name="l01056"></a>01056 <span class="comment">     * If \a lazy is true, the log is not synced.  This means that</span>
<a name="l01057"></a>01057 <span class="comment">     * recovery of this transaction might not be possible.</span>
<a name="l01058"></a>01058 <span class="comment">     */</span>
<a name="l01059"></a>01059     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d8/d1e/group___s_s_m_x_c_t.html#g6d01a3863578576383768a5456808393">chain_xct</a>(
<a name="l01060"></a>01060         <a class="code" href="../../d9/dee/classsm__stats__info__t.html">sm_stats_info_t</a>*&amp;         stats,    <span class="comment">/* in w/new, out w/old */</span>
<a name="l01061"></a>01061         <span class="keywordtype">bool</span>                      lazy = <span class="keyword">false</span>);  
<a name="l01062"></a>01062 <span class="comment"></span>
<a name="l01063"></a>01063 <span class="comment">    /**\brief Commit a transaction and start a new one, inheriting locks.</span>
<a name="l01064"></a>01064 <span class="comment">     *\ingroup SSMXCT</span>
<a name="l01065"></a>01065 <span class="comment">     * @param[in] lazy   Optional, controls flushing of log.</span>
<a name="l01066"></a>01066 <span class="comment">     * \details</span>
<a name="l01067"></a>01067 <span class="comment">     *</span>
<a name="l01068"></a>01068 <span class="comment">     * Commit the attached transaction and detach it, destroy it.</span>
<a name="l01069"></a>01069 <span class="comment">     * Start a new transaction and attach it to this thread.</span>
<a name="l01070"></a>01070 <span class="comment">     * \note \e The \e new </span>
<a name="l01071"></a>01071 <span class="comment">     * \e transaction \e inherits \e the \e locks \e of \e the \e old </span>
<a name="l01072"></a>01072 <span class="comment">     * \e transaction.</span>
<a name="l01073"></a>01073 <span class="comment">     *</span>
<a name="l01074"></a>01074 <span class="comment">     * If \a lazy is true, the log is not synced.  This means that</span>
<a name="l01075"></a>01075 <span class="comment">     * recovery of the committed transaction might not be possible.</span>
<a name="l01076"></a>01076 <span class="comment">     */</span>
<a name="l01077"></a>01077     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d8/d1e/group___s_s_m_x_c_t.html#g6d01a3863578576383768a5456808393">chain_xct</a>(<span class="keywordtype">bool</span> lazy = <span class="keyword">false</span>);  
<a name="l01078"></a>01078 
<a name="l01079"></a>01079 <span class="comment"></span>
<a name="l01080"></a>01080 <span class="comment">    /**\brief Commit a group of transactions.</span>
<a name="l01081"></a>01081 <span class="comment">     *\ingroup SSMXCT</span>
<a name="l01082"></a>01082 <span class="comment">     * @param[in] list      List of pointers to transactions to commit.</span>
<a name="l01083"></a>01083 <span class="comment">     * @param[in] listlen   Number of transactions in the list.</span>
<a name="l01084"></a>01084 <span class="comment">     * \details</span>
<a name="l01085"></a>01085 <span class="comment">     *</span>
<a name="l01086"></a>01086 <span class="comment">     * Commit each transaction in the list as an all-or-none affair.</span>
<a name="l01087"></a>01087 <span class="comment">     * Any transaction that is attached to the thread will be</span>
<a name="l01088"></a>01088 <span class="comment">     * detached before anything is done.</span>
<a name="l01089"></a>01089 <span class="comment">     *</span>
<a name="l01090"></a>01090 <span class="comment">     * The purpose of this method is to allow multiple transactions </span>
<a name="l01091"></a>01091 <span class="comment">     * to commit together with a single log record. No voting takes place.</span>
<a name="l01092"></a>01092 <span class="comment">     * The entire list of transaction identifiers must fit in a single</span>
<a name="l01093"></a>01093 <span class="comment">     * log record. If it does not, a descriptive error will be returned and no </span>
<a name="l01094"></a>01094 <span class="comment">     * transaction will be committed. In this case, the server has the</span>
<a name="l01095"></a>01095 <span class="comment">     * option to singly commit each transaction.</span>
<a name="l01096"></a>01096 <span class="comment">     *</span>
<a name="l01097"></a>01097 <span class="comment">     * If any other error occurs during one of the commits, the error</span>
<a name="l01098"></a>01098 <span class="comment">     * will be returned to the caller and none of the transactions</span>
<a name="l01099"></a>01099 <span class="comment">     * will be committed; they \b must be aborted thereafter.</span>
<a name="l01100"></a>01100 <span class="comment">     *</span>
<a name="l01101"></a>01101 <span class="comment">     * This is not intended to be used with transactions that are</span>
<a name="l01102"></a>01102 <span class="comment">     * participating in two-phase commit, but if</span>
<a name="l01103"></a>01103 <span class="comment">     * one of the transactions is participating in two-phase commit,</span>
<a name="l01104"></a>01104 <span class="comment">     * they all must be and they all must be prepared.  </span>
<a name="l01105"></a>01105 <span class="comment">     *</span>
<a name="l01106"></a>01106 <span class="comment">     * Chaining and lazy commit are not offered with this form of commit.</span>
<a name="l01107"></a>01107 <span class="comment">     * If a transaction in the list is instrumented, its statistics</span>
<a name="l01108"></a>01108 <span class="comment">     * resources will be deleted upon successful commit.</span>
<a name="l01109"></a>01109 <span class="comment">     *</span>
<a name="l01110"></a>01110 <span class="comment">     * \note </span>
<a name="l01111"></a>01111 <span class="comment">     * By taking a list of transaction pointers, this avoids a the tid_to_xct lookup </span>
<a name="l01112"></a>01112 <span class="comment">     * for each transaction, but the server must regard the transaction pointers as</span>
<a name="l01113"></a>01113 <span class="comment">     * invalid after this method returns.</span>
<a name="l01114"></a>01114 <span class="comment">     * The transactions, once committed, do not exist anymore. </span>
<a name="l01115"></a>01115 <span class="comment">     * If an error is returned, the server has to re-verify the transaction pointers </span>
<a name="l01116"></a>01116 <span class="comment">     * by using ss_m::tid_to_xct from a separate list of transaction ids to determine</span>
<a name="l01117"></a>01117 <span class="comment">     * which transactions are extant.</span>
<a name="l01118"></a>01118 <span class="comment">     */</span>
<a name="l01119"></a>01119     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d8/d1e/group___s_s_m_x_c_t.html#ge608513aae569ee9514abcc33dd47c53">commit_xct_group</a>(
<a name="l01120"></a>01120         <a class="code" href="../../df/d32/classxct__t.html">xct_t</a> *               list[],
<a name="l01121"></a>01121         <span class="keywordtype">int</span>                   listlen);
<a name="l01122"></a>01122 <span class="comment"></span>
<a name="l01123"></a>01123 <span class="comment">    /**\brief Abort an instrumented transaction and get its statistics.</span>
<a name="l01124"></a>01124 <span class="comment">     *\ingroup SSMXCT</span>
<a name="l01125"></a>01125 <span class="comment">     * @param[out] stats   Get a copy of the statistics for this transaction.</span>
<a name="l01126"></a>01126 <span class="comment">     * \details</span>
<a name="l01127"></a>01127 <span class="comment">     *</span>
<a name="l01128"></a>01128 <span class="comment">     * Abort the attached transaction and detach it, destroy it.</span>
<a name="l01129"></a>01129 <span class="comment">     */</span>
<a name="l01130"></a>01130     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d8/d1e/group___s_s_m_x_c_t.html#g4d196fdd42c4822f8c71befa57495ad2">abort_xct</a>(<a class="code" href="../../d9/dee/classsm__stats__info__t.html">sm_stats_info_t</a>*&amp;  stats);<span class="comment"></span>
<a name="l01131"></a>01131 <span class="comment">    /**\brief Abort a transaction.</span>
<a name="l01132"></a>01132 <span class="comment">     *\ingroup SSMXCT</span>
<a name="l01133"></a>01133 <span class="comment">     * \details</span>
<a name="l01134"></a>01134 <span class="comment">     *</span>
<a name="l01135"></a>01135 <span class="comment">     * Abort the attached transaction and detach it, destroy it.</span>
<a name="l01136"></a>01136 <span class="comment">     */</span>
<a name="l01137"></a>01137     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d8/d1e/group___s_s_m_x_c_t.html#g4d196fdd42c4822f8c71befa57495ad2">abort_xct</a>();
<a name="l01138"></a>01138 <span class="comment"></span>
<a name="l01139"></a>01139 <span class="comment">    /**\brief Populate a save point.</span>
<a name="l01140"></a>01140 <span class="comment">     *\ingroup SSMSP</span>
<a name="l01141"></a>01141 <span class="comment">     * @param[out] sp   An sm_save_point_t owned by the caller.</span>
<a name="l01142"></a>01142 <span class="comment">     *\details</span>
<a name="l01143"></a>01143 <span class="comment">     * Store in sp the needed information to be able to roll back </span>
<a name="l01144"></a>01144 <span class="comment">     * to this point. </span>
<a name="l01145"></a>01145 <span class="comment">     * For use with rollback_work.</span>
<a name="l01146"></a>01146 <span class="comment">     * \note Only one thread may be attached to a transaction when this</span>
<a name="l01147"></a>01147 <span class="comment">     * is called.</span>
<a name="l01148"></a>01148 <span class="comment">     */</span>
<a name="l01149"></a>01149     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d0/d4e/group___s_s_m_s_p.html#g90a637501fe6e70de18742dfd9d59d20">save_work</a>(<a class="code" href="../../d1/da9/classsm__save__point__t.html">sm_save_point_t</a>&amp; sp);
<a name="l01150"></a>01150 <span class="comment"></span>
<a name="l01151"></a>01151 <span class="comment">    /**\brief Roll back to a savepoint.</span>
<a name="l01152"></a>01152 <span class="comment">     *\ingroup SSMSP</span>
<a name="l01153"></a>01153 <span class="comment">     * @param[in] sp   An sm_save_point_t owned by the caller and</span>
<a name="l01154"></a>01154 <span class="comment">     * populated by save_work.</span>
<a name="l01155"></a>01155 <span class="comment">     *\details</span>
<a name="l01156"></a>01156 <span class="comment">     * Undo everything that was </span>
<a name="l01157"></a>01157 <span class="comment">     * done from the time save_work was called on this savepoint.</span>
<a name="l01158"></a>01158 <span class="comment">     * \note Locks are not freed.</span>
<a name="l01159"></a>01159 <span class="comment">     *</span>
<a name="l01160"></a>01160 <span class="comment">     * \note Only one thread may be attached to a transaction when this</span>
<a name="l01161"></a>01161 <span class="comment">     * is called.</span>
<a name="l01162"></a>01162 <span class="comment">     */</span>
<a name="l01163"></a>01163     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d0/d4e/group___s_s_m_s_p.html#g888b894a58102d61794d91758f9032e1">rollback_work</a>(<span class="keyword">const</span> <a class="code" href="../../d1/da9/classsm__save__point__t.html">sm_save_point_t</a>&amp; sp);
<a name="l01164"></a>01164 <span class="comment"></span>
<a name="l01165"></a>01165 <span class="comment">    /**\brief Return the number of transactions in active state.</span>
<a name="l01166"></a>01166 <span class="comment">     *\ingroup SSMXCT</span>
<a name="l01167"></a>01167 <span class="comment">     * \details</span>
<a name="l01168"></a>01168 <span class="comment">     * While this is thread-safe, the moment a value is returned, it could</span>
<a name="l01169"></a>01169 <span class="comment">     * be out of date.</span>
<a name="l01170"></a>01170 <span class="comment">     * Useful only for debugging.</span>
<a name="l01171"></a>01171 <span class="comment">     */</span>
<a name="l01172"></a>01172     <span class="keyword">static</span> <a class="code" href="../../d9/da0/classw__base__t.html#7d1c7ae407200662fd16b64de4dcde46">w_base_t::uint4_t</a>     <a class="code" href="../../d8/d1e/group___s_s_m_x_c_t.html#g8c6df270f40ca4f3de2fc362f35b6dff">num_active_xcts</a>();
<a name="l01173"></a>01173 <span class="comment"></span>
<a name="l01174"></a>01174 <span class="comment">    /**\brief Attach the given transaction to the currently-running smthread_t.</span>
<a name="l01175"></a>01175 <span class="comment">     *\ingroup SSMXCT</span>
<a name="l01176"></a>01176 <span class="comment">     * \details</span>
<a name="l01177"></a>01177 <span class="comment">     * It is assumed that the currently running thread is an smthread_t.</span>
<a name="l01178"></a>01178 <span class="comment">     */</span>
<a name="l01179"></a><a class="code" href="../../d8/d1e/group___s_s_m_x_c_t.html#g44eff1b2893c1ada85b61f8f6a989a4a">01179</a>     <span class="keyword">static</span> <span class="keywordtype">void</span>           <a class="code" href="../../d8/d1e/group___s_s_m_x_c_t.html#g44eff1b2893c1ada85b61f8f6a989a4a">attach_xct</a>(<a class="code" href="../../df/d32/classxct__t.html">xct_t</a> *x) { me()-&gt;attach_xct(x); }
<a name="l01180"></a>01180 <span class="comment"></span>
<a name="l01181"></a>01181 <span class="comment">    /**\addtogroup SSMMULTIXCT </span>
<a name="l01182"></a>01182 <span class="comment">     * </span>
<a name="l01183"></a>01183 <span class="comment">     * Certain operations may be performed while more than one</span>
<a name="l01184"></a>01184 <span class="comment">     * thread is attached to a transaction (this functionality might be</span>
<a name="l01185"></a>01185 <span class="comment">     * removed in a future release).</span>
<a name="l01186"></a>01186 <span class="comment">     * Any number of attached threads may be read-only.</span>
<a name="l01187"></a>01187 <span class="comment">     * The kinds of updates that can be made by multiple threads are limited by</span>
<a name="l01188"></a>01188 <span class="comment">     * the need to avoid latch-mutex and latch-latch deadlocks. </span>
<a name="l01189"></a>01189 <span class="comment">     *</span>
<a name="l01190"></a>01190 <span class="comment">     * There are several reasons for this.</span>
<a name="l01191"></a>01191 <span class="comment">     * 1) The multiple threads are not protected from each other by locks.</span>
<a name="l01192"></a>01192 <span class="comment">     * 2) Interleaving of top-level actions is not supported with rollback;</span>
<a name="l01193"></a>01193 <span class="comment">     * this means that for the duration of a top-level action, a thread needs</span>
<a name="l01194"></a>01194 <span class="comment">     * access to the log that excludes all other threads in </span>
<a name="l01195"></a>01195 <span class="comment">     * the same transaction.</span>
<a name="l01196"></a>01196 <span class="comment">     *</span>
<a name="l01197"></a>01197 <span class="comment">     * The internal logging protocol is this:</span>
<a name="l01198"></a>01198 <span class="comment">     * T1: latch page, log update. Logging requires acquiring a mutex</span>
<a name="l01199"></a>01199 <span class="comment">     * on the xct's log buffer.</span>
<a name="l01200"></a>01200 <span class="comment">     * T2: performing any top-level action, acquires the mutex on the</span>
<a name="l01201"></a>01201 <span class="comment">     * xct's log buffer before doing the action (latching the page).</span>
<a name="l01202"></a>01202 <span class="comment">     *</span>
<a name="l01203"></a>01203 <span class="comment">     * Thus, anything involving top-level actions is suspect.  B-trees</span>
<a name="l01204"></a>01204 <span class="comment">     * use top-level actions, as does file-page allocation, and creation/</span>
<a name="l01205"></a>01205 <span class="comment">     * destruction of stores (files, indexes).  Thus, just about</span>
<a name="l01206"></a>01206 <span class="comment">     * any kind of concurrent updates on the same page</span>
<a name="l01207"></a>01207 <span class="comment">     * in the same transaction is problematic, and just about any update</span>
<a name="l01208"></a>01208 <span class="comment">     * can result in latching extent-map or store-map pages.</span>
<a name="l01209"></a>01209 <span class="comment">     * This activity could be disallowed by enforcing a strict </span>
<a name="l01210"></a>01210 <span class="comment">     * rule that at most  one update operation can be going on </span>
<a name="l01211"></a>01211 <span class="comment">     * in a transaction at any time, however this is too restrictive.</span>
<a name="l01212"></a>01212 <span class="comment">     *</span>
<a name="l01213"></a>01213 <span class="comment">     * Multiple updating threads can</span>
<a name="l01214"></a>01214 <span class="comment">     * work \b if \b the \b data \b are \b partitioned by volume.</span>
<a name="l01215"></a>01215 <span class="comment">     * So a well-behaved server may use multiple-threaded transactions</span>
<a name="l01216"></a>01216 <span class="comment">     * to do updates as long as the updates are on different \b volumes.</span>
<a name="l01217"></a>01217 <span class="comment">     * It might also allow read-only transaction threads to be</span>
<a name="l01218"></a>01218 <span class="comment">     * concurrent with a single updating thread.</span>
<a name="l01219"></a>01219 <span class="comment">     *</span>
<a name="l01220"></a>01220 <span class="comment">     * Savepoints and partial rollback may \e not be used with </span>
<a name="l01221"></a>01221 <span class="comment">     * multi-threaded transactions. This is not enforced by the storage</span>
<a name="l01222"></a>01222 <span class="comment">     * manager; it is poor behavior on the part of a server.</span>
<a name="l01223"></a>01223 <span class="comment">     * For example, the behavior of the following is undefined:</span>
<a name="l01224"></a>01224 <span class="comment">     * - thread 1: attach, read,      read,   read, ...</span>
<a name="l01225"></a>01225 <span class="comment">     * - thread 2: attach, save work, update, rollback</span>
<a name="l01226"></a>01226 <span class="comment">     * If the two threads are reading and possibly updating the same </span>
<a name="l01227"></a>01227 <span class="comment">     * data, the results are timing-dependent and could produce a latch-</span>
<a name="l01228"></a>01228 <span class="comment">     * latch or latch-mutex deadlock.</span>
<a name="l01229"></a>01229 <span class="comment">     *</span>
<a name="l01230"></a>01230 <span class="comment">     * Ongoing research at DIAS is investigating ways to extend the usefulness</span>
<a name="l01231"></a>01231 <span class="comment">     * of parallelism within a transaction (multi-threaded transactions).</span>
<a name="l01232"></a>01232 <span class="comment">     * Current thoughts about this are for servers to coordinate multiple </span>
<a name="l01233"></a>01233 <span class="comment">     * transactions using two-phase commit or an optimized version</span>
<a name="l01234"></a>01234 <span class="comment">     * of commit and abort for groups of local transactions.</span>
<a name="l01235"></a>01235 <span class="comment">     */</span>
<a name="l01236"></a>01236 <span class="comment"></span>
<a name="l01237"></a>01237 <span class="comment">    /**\brief Detach any attached from the currently-running smthread_t.</span>
<a name="l01238"></a>01238 <span class="comment">     *\ingroup SSMXCT</span>
<a name="l01239"></a>01239 <span class="comment">     * \details</span>
<a name="l01240"></a>01240 <span class="comment">     * Sever the connection between the running thread and the transaction.</span>
<a name="l01241"></a>01241 <span class="comment">     * This allow the running thread to attach a different </span>
<a name="l01242"></a>01242 <span class="comment">     * transaction and to perform work in its behalf.</span>
<a name="l01243"></a>01243 <span class="comment">     */</span>
<a name="l01244"></a><a class="code" href="../../d8/d1e/group___s_s_m_x_c_t.html#g62a2b3ff069b05b4178dfc5c15cb9cf4">01244</a>     <span class="keyword">static</span> <span class="keywordtype">void</span>           <a class="code" href="../../d8/d1e/group___s_s_m_x_c_t.html#g62a2b3ff069b05b4178dfc5c15cb9cf4">detach_xct</a>() { <a class="code" href="../../df/d32/classxct__t.html">xct_t</a> *x = me()-&gt;xct();
<a name="l01245"></a>01245                                         <span class="keywordflow">if</span>(x) me()-&gt;detach_xct(x); }
<a name="l01246"></a>01246 <span class="comment"></span>
<a name="l01247"></a>01247 <span class="comment">    /**\brief Get the transaction structure for a given a transaction id.</span>
<a name="l01248"></a>01248 <span class="comment">     *\ingroup SSMXCT</span>
<a name="l01249"></a>01249 <span class="comment">     * @param[in] tid   Transaction ID.</span>
<a name="l01250"></a>01250 <span class="comment">     *\details</span>
<a name="l01251"></a>01251 <span class="comment">     * Return a pointer to the storage manager's transaction structure.</span>
<a name="l01252"></a>01252 <span class="comment">     * Can be used with detach_xct and attach_xct.</span>
<a name="l01253"></a>01253 <span class="comment">     */</span>
<a name="l01254"></a>01254     <span class="keyword">static</span> <a class="code" href="../../df/d32/classxct__t.html">xct_t</a>*          <a class="code" href="../../d8/d1e/group___s_s_m_x_c_t.html#g5ab27cd8421f0f60c2701f89349ee299">tid_to_xct</a>(<span class="keyword">const</span> <a class="code" href="../../d8/d12/classtid__t.html">tid_t</a>&amp; tid);<span class="comment"></span>
<a name="l01255"></a>01255 <span class="comment">    /**\brief Get the transaction ID for a given a transaction structure.</span>
<a name="l01256"></a>01256 <span class="comment">     *\ingroup SSMXCT</span>
<a name="l01257"></a>01257 <span class="comment">     * @param[in] x   Pointer to transaction structure.</span>
<a name="l01258"></a>01258 <span class="comment">     *\details</span>
<a name="l01259"></a>01259 <span class="comment">     * Return the transaction ID for the given transaction.</span>
<a name="l01260"></a>01260 <span class="comment">     */</span>
<a name="l01261"></a>01261     <span class="keyword">static</span> <a class="code" href="../../d8/d12/classtid__t.html">tid_t</a>           <a class="code" href="../../d8/d1e/group___s_s_m_x_c_t.html#ga1e0f29ece464c1a489887c3f16f0fbc">xct_to_tid</a>(<span class="keyword">const</span> <a class="code" href="../../df/d32/classxct__t.html">xct_t</a>* x);
<a name="l01262"></a>01262 <span class="comment"></span>
<a name="l01263"></a>01263 <span class="comment">    /**\brief Print transaction information to an output stream.</span>
<a name="l01264"></a>01264 <span class="comment">     *\ingroup SSMAPIDEBUG</span>
<a name="l01265"></a>01265 <span class="comment">     * @param[in] o   Stream to which to write the information.</span>
<a name="l01266"></a>01266 <span class="comment">     * \details</span>
<a name="l01267"></a>01267 <span class="comment">     * This is for debugging only, and is not thread-safe. </span>
<a name="l01268"></a>01268 <span class="comment">     */</span>
<a name="l01269"></a>01269     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../df/d27/group___s_s_m_a_p_i_d_e_b_u_g.html#gd876a811b60d41cfb0fc8a7809a68570">dump_xcts</a>(ostream &amp;o);
<a name="l01270"></a>01270 <span class="comment"></span>
<a name="l01271"></a>01271 <span class="comment">    /**\brief Get the transaction state for a given transaction (structure).</span>
<a name="l01272"></a>01272 <span class="comment">     *\ingroup SSMXCT</span>
<a name="l01273"></a>01273 <span class="comment">     * @param[in] x   Pointer to transaction structure.</span>
<a name="l01274"></a>01274 <span class="comment">     * \details</span>
<a name="l01275"></a>01275 <span class="comment">     * Returns the state of the transaction (active, prepared). It is</span>
<a name="l01276"></a>01276 <span class="comment">     * hard to get the state of an aborted or committed transaction, since</span>
<a name="l01277"></a>01277 <span class="comment">     * their structures no longer exist.</span>
<a name="l01278"></a>01278 <span class="comment">     */</span>
<a name="l01279"></a>01279     <span class="keyword">static</span> <a class="code" href="../../da/d44/classss__m.html#edafe8929d794c719d04856aac3621a4">xct_state_t</a>     <a class="code" href="../../d8/d1e/group___s_s_m_x_c_t.html#g6724730bfb2c8faaf3a445150984a26a">state_xct</a>(<span class="keyword">const</span> <a class="code" href="../../df/d32/classxct__t.html">xct_t</a>* x);
<a name="l01280"></a>01280 <span class="comment"></span>
<a name="l01281"></a>01281 <span class="comment">    /**\brief Return the amount of log this transaction would consume</span>
<a name="l01282"></a>01282 <span class="comment">     * if it rolled back.</span>
<a name="l01283"></a>01283 <span class="comment">     *\ingroup SSMXCT</span>
<a name="l01284"></a>01284 <span class="comment">     *</span>
<a name="l01285"></a>01285 <span class="comment">     * If a transaction aborts with eOUTOFLOGSPACE this function can</span>
<a name="l01286"></a>01286 <span class="comment">     * be used in conjunction with xct_reserve_log_space to</span>
<a name="l01287"></a>01287 <span class="comment">     * pre-allocate the needed amount of log space before retrying.</span>
<a name="l01288"></a>01288 <span class="comment">     */</span>
<a name="l01289"></a>01289     <span class="keyword">static</span> smlevel_0::fileoff_t        <a class="code" href="../../d8/d1e/group___s_s_m_x_c_t.html#g31f44e953b0cedc9f16789db27ffa135">xct_log_space_needed</a>();
<a name="l01290"></a>01290 <span class="comment"></span>
<a name="l01291"></a>01291 <span class="comment">    /**\brief Require the specified amount of log space to be</span>
<a name="l01292"></a>01292 <span class="comment">     * available for this transaction before continuing.</span>
<a name="l01293"></a>01293 <span class="comment">     *\ingroup SSMXCT</span>
<a name="l01294"></a>01294 <span class="comment">     *</span>
<a name="l01295"></a>01295 <span class="comment">     * If a transaction risks running out of log space it can</span>
<a name="l01296"></a>01296 <span class="comment">     * pre-request some or all of the needed amount before starting in</span>
<a name="l01297"></a>01297 <span class="comment">     * order to improve its chances of success. Other new transactions</span>
<a name="l01298"></a>01298 <span class="comment">     * will be unable to acquire log space before this request is</span>
<a name="l01299"></a>01299 <span class="comment">     * granted (existing ones will be able to commit, unless they also</span>
<a name="l01300"></a>01300 <span class="comment">     * run out of space, because that tends to free up log space and</span>
<a name="l01301"></a>01301 <span class="comment">     * avoids wasting work).</span>
<a name="l01302"></a>01302 <span class="comment">     */</span>
<a name="l01303"></a>01303     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d8/d1e/group___s_s_m_x_c_t.html#gbcb91e9cdd7cd5c2946e49bbffc1852e">xct_reserve_log_space</a>(fileoff_t amt);
<a name="l01304"></a>01304     <span class="comment"></span>
<a name="l01305"></a>01305 <span class="comment">    /**\brief Get the locking granularity for the attached transaction.</span>
<a name="l01306"></a>01306 <span class="comment">     * \ingroup SSMLOCK</span>
<a name="l01307"></a>01307 <span class="comment">     */</span>
<a name="l01308"></a>01308     <span class="keyword">static</span> <a class="code" href="../../da/d44/classss__m.html#50662c89c6fd0f384a655ca11e78b861">concurrency_t</a>   <a class="code" href="../../d8/da8/group___s_s_m_l_o_c_k.html#ge8bc22b762bfcb64be1f4f987cd8a482">xct_lock_level</a>();<span class="comment"></span>
<a name="l01309"></a>01309 <span class="comment">    /**\brief Set the default locking level for the attached transaction.</span>
<a name="l01310"></a>01310 <span class="comment">     * \ingroup SSMLOCK</span>
<a name="l01311"></a>01311 <span class="comment">     * \details</span>
<a name="l01312"></a>01312 <span class="comment">     * @param[in] l  The level to use for the balance of this transaction.</span>
<a name="l01313"></a>01313 <span class="comment">     * Legitimate values are t_cc_record,  t_cc_page,  t_cc_file.</span>
<a name="l01314"></a>01314 <span class="comment">     *</span>
<a name="l01315"></a>01315 <span class="comment">     * \note Only one thread may be attached to the transaction when this</span>
<a name="l01316"></a>01316 <span class="comment">     * is called. If more than one thread is attached, a fatal error</span>
<a name="l01317"></a>01317 <span class="comment">     * will ensue.</span>
<a name="l01318"></a>01318 <span class="comment">     */</span>
<a name="l01319"></a>01319     <span class="keyword">static</span> <span class="keywordtype">void</span>            <a class="code" href="../../d8/da8/group___s_s_m_l_o_c_k.html#g99f0470376465f6f6e9feac47da1eb5f">set_xct_lock_level</a>(<a class="code" href="../../da/d44/classss__m.html#50662c89c6fd0f384a655ca11e78b861">concurrency_t</a> l);
<a name="l01320"></a>01320 <span class="comment"></span>
<a name="l01321"></a>01321 <span class="comment">    /**\brief Collect transaction information in a virtual table.</span>
<a name="l01322"></a>01322 <span class="comment">     * \ingroup SSMVTABLE</span>
<a name="l01323"></a>01323 <span class="comment">     * \details</span>
<a name="l01324"></a>01324 <span class="comment">     * @param[out] v  The virtual table to populate.</span>
<a name="l01325"></a>01325 <span class="comment">     * @param[in] names_too  If true, make the </span>
<a name="l01326"></a>01326 <span class="comment">     *            first row of the table a list of the attribute names.</span>
<a name="l01327"></a>01327 <span class="comment">     *</span>
<a name="l01328"></a>01328 <span class="comment">     * All attribute values will be strings.</span>
<a name="l01329"></a>01329 <span class="comment">     * The virtual table v can be printed with its output operator</span>
<a name="l01330"></a>01330 <span class="comment">     * operator&lt;&lt; for ostreams.</span>
<a name="l01331"></a>01331 <span class="comment">     *</span>
<a name="l01332"></a>01332 <span class="comment">     * \attention Not atomic. Can yield stale data. </span>
<a name="l01333"></a>01333 <span class="comment">     */</span>
<a name="l01334"></a>01334     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d5/d38/group___s_s_m_v_t_a_b_l_e.html#g0cf43b09eb1eff38cf5d838cab820320">xct_collect</a>(<a class="code" href="../../d3/d76/classvtable__t.html">vtable_t</a>&amp;v, <span class="keywordtype">bool</span> names_too=<span class="keyword">true</span>);
<a name="l01335"></a>01335 <span class="comment"></span>
<a name="l01336"></a>01336 <span class="comment">    /**\brief Collect buffer pool information in a virtual table.</span>
<a name="l01337"></a>01337 <span class="comment">     * \ingroup SSMVTABLE</span>
<a name="l01338"></a>01338 <span class="comment">     * \details</span>
<a name="l01339"></a>01339 <span class="comment">     * @param[out] v  The virtual table to populate.</span>
<a name="l01340"></a>01340 <span class="comment">     * @param[in] names_too  If true, make the </span>
<a name="l01341"></a>01341 <span class="comment">     *            first row of the table a list of the attribute names.</span>
<a name="l01342"></a>01342 <span class="comment">     *</span>
<a name="l01343"></a>01343 <span class="comment">     * \attention Be wary of using this with a large buffer pool.</span>
<a name="l01344"></a>01344 <span class="comment">     *</span>
<a name="l01345"></a>01345 <span class="comment">     * All attribute values will be strings.</span>
<a name="l01346"></a>01346 <span class="comment">     * The virtual table v can be printed with its output operator</span>
<a name="l01347"></a>01347 <span class="comment">     * operator&lt;&lt; for ostreams.</span>
<a name="l01348"></a>01348 <span class="comment">     *</span>
<a name="l01349"></a>01349 <span class="comment">     * \attention Not atomic. Can yield stale data. </span>
<a name="l01350"></a>01350 <span class="comment">     */</span>
<a name="l01351"></a>01351     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d5/d38/group___s_s_m_v_t_a_b_l_e.html#ge6ba6155478bd1cea2000e1bd7e24a2d">bp_collect</a>(<a class="code" href="../../d3/d76/classvtable__t.html">vtable_t</a>&amp;v, <span class="keywordtype">bool</span> names_too=<span class="keyword">true</span>);
<a name="l01352"></a>01352 <span class="comment"></span>
<a name="l01353"></a>01353 <span class="comment">    /**\brief Collect lock table information in a virtual table.</span>
<a name="l01354"></a>01354 <span class="comment">     * \ingroup SSMVTABLE</span>
<a name="l01355"></a>01355 <span class="comment">     * \details</span>
<a name="l01356"></a>01356 <span class="comment">     * @param[out] v  The virtual table to populate.</span>
<a name="l01357"></a>01357 <span class="comment">     * @param[in] names_too  If true, make the </span>
<a name="l01358"></a>01358 <span class="comment">     *            first row of the table a list of the attribute names.</span>
<a name="l01359"></a>01359 <span class="comment">     *</span>
<a name="l01360"></a>01360 <span class="comment">     * All attribute values will be strings.</span>
<a name="l01361"></a>01361 <span class="comment">     * The virtual table v can be printed with its output operator</span>
<a name="l01362"></a>01362 <span class="comment">     * operator&lt;&lt; for ostreams.</span>
<a name="l01363"></a>01363 <span class="comment">     *</span>
<a name="l01364"></a>01364 <span class="comment">     * \attention Not atomic. Can yield stale data. </span>
<a name="l01365"></a>01365 <span class="comment">     * Cannot be used in a multi-threaded-transaction context.</span>
<a name="l01366"></a>01366 <span class="comment">     */</span>
<a name="l01367"></a>01367     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d5/d38/group___s_s_m_v_t_a_b_l_e.html#g4273cdd41fa6a4550d92f20c4e7279c5">lock_collect</a>(<a class="code" href="../../d3/d76/classvtable__t.html">vtable_t</a>&amp;v, <span class="keywordtype">bool</span> names_too=<span class="keyword">true</span>);
<a name="l01368"></a>01368 <span class="comment"></span>
<a name="l01369"></a>01369 <span class="comment">    /**\brief Collect thread information in a virtual table.</span>
<a name="l01370"></a>01370 <span class="comment">     * \ingroup SSMVTABLE</span>
<a name="l01371"></a>01371 <span class="comment">     * \details</span>
<a name="l01372"></a>01372 <span class="comment">     * @param[out] v  The virtual table to populate.</span>
<a name="l01373"></a>01373 <span class="comment">     * @param[in] names_too  If true, make the </span>
<a name="l01374"></a>01374 <span class="comment">     *            first row of the table a list of the attribute names.</span>
<a name="l01375"></a>01375 <span class="comment">     *</span>
<a name="l01376"></a>01376 <span class="comment">     * All attribute values will be strings.</span>
<a name="l01377"></a>01377 <span class="comment">     * The virtual table v can be printed with its output operator</span>
<a name="l01378"></a>01378 <span class="comment">     * operator&lt;&lt; for ostreams.</span>
<a name="l01379"></a>01379 <span class="comment">     *</span>
<a name="l01380"></a>01380 <span class="comment">     * \attention Not thread-safe. Can yield stale data. </span>
<a name="l01381"></a>01381 <span class="comment">     */</span>
<a name="l01382"></a>01382     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d5/d38/group___s_s_m_v_t_a_b_l_e.html#ga7911fec511c19e66edd7ca3e10b0445">thread_collect</a>(<a class="code" href="../../d3/d76/classvtable__t.html">vtable_t</a>&amp;v, <span class="keywordtype">bool</span> names_too=<span class="keyword">true</span>);
<a name="l01383"></a>01383 <span class="comment"></span>
<a name="l01384"></a>01384 <span class="comment">    /**\brief Take a checkpoint.</span>
<a name="l01385"></a>01385 <span class="comment">     * \ingroup SSMAPIDEBUG</span>
<a name="l01386"></a>01386 <span class="comment">     * \note For debugging only!</span>
<a name="l01387"></a>01387 <span class="comment">     *</span>
<a name="l01388"></a>01388 <span class="comment">     * Force the storage manager to take a checkpoint.</span>
<a name="l01389"></a>01389 <span class="comment">     * Checkpoints are fuzzy : they can be taken while most other</span>
<a name="l01390"></a>01390 <span class="comment">     * storage manager activity is happening, even though they have</span>
<a name="l01391"></a>01391 <span class="comment">     * to be serialized with respect to each other, and with respect to</span>
<a name="l01392"></a>01392 <span class="comment">     * a few other activities.</span>
<a name="l01393"></a>01393 <span class="comment">     *</span>
<a name="l01394"></a>01394 <span class="comment">     * This is thread-safe.</span>
<a name="l01395"></a>01395 <span class="comment">     */</span>
<a name="l01396"></a>01396     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../df/d27/group___s_s_m_a_p_i_d_e_b_u_g.html#g0705323643d815dbf66352a60dcbcc3d">checkpoint</a>();
<a name="l01397"></a>01397 <span class="comment"></span>
<a name="l01398"></a>01398 <span class="comment">    /**\brief Force the buffer pool to flush its pages to disk.</span>
<a name="l01399"></a>01399 <span class="comment">     * \ingroup SSMAPIDEBUG</span>
<a name="l01400"></a>01400 <span class="comment">     * @param[in] invalidate   True means discard pages after flush.</span>
<a name="l01401"></a>01401 <span class="comment">     * \note For debugging only!</span>
<a name="l01402"></a>01402 <span class="comment">     * \attention Do not call force_buffers with anything pinned.</span>
<a name="l01403"></a>01403 <span class="comment">     * You may cause latch-latch deadlocks, as this method has</span>
<a name="l01404"></a>01404 <span class="comment">     * to scan the entire buffer pool and possibly EX-latch pages to prevent</span>
<a name="l01405"></a>01405 <span class="comment">     * others from updating while it forces to disk.</span>
<a name="l01406"></a>01406 <span class="comment">     * Since the page-order is essentially random, we cannot</span>
<a name="l01407"></a>01407 <span class="comment">     * preclude latch-latch deadlocks with other threads.</span>
<a name="l01408"></a>01408 <span class="comment">     */</span>
<a name="l01409"></a>01409     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../df/d27/group___s_s_m_a_p_i_d_e_b_u_g.html#ge908fac62c57192828afae9108257cba">force_buffers</a>(<span class="keywordtype">bool</span> invalidate = <span class="keyword">false</span>);
<a name="l01410"></a>01410 <span class="comment"></span>
<a name="l01411"></a>01411 <span class="comment">    /**\brief Force the buffer pool to flush the volume header page(s)</span>
<a name="l01412"></a>01412 <span class="comment">     * to disk.</span>
<a name="l01413"></a>01413 <span class="comment">     * \ingroup SSMAPIDEBUG</span>
<a name="l01414"></a>01414 <span class="comment">     * @param[in] vid   ID of the volume of interest</span>
<a name="l01415"></a>01415 <span class="comment">     * \note For debugging only!</span>
<a name="l01416"></a>01416 <span class="comment">     * \attention Do not call force_vol_hdr_buffers with anything pinned.</span>
<a name="l01417"></a>01417 <span class="comment">     * You could cause latch-latch deadlocks, as this method has</span>
<a name="l01418"></a>01418 <span class="comment">     * to scan the entire buffer pool and possibly EX-latch some pages.</span>
<a name="l01419"></a>01419 <span class="comment">     * Since the page-order is essentially random, we cannot</span>
<a name="l01420"></a>01420 <span class="comment">     * preclude latch-latch deadlocks with other threads.</span>
<a name="l01421"></a>01421 <span class="comment">     */</span>
<a name="l01422"></a>01422     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../df/d27/group___s_s_m_a_p_i_d_e_b_u_g.html#gebb5eaa965d5f087bef3f844b23dc3c1">force_vol_hdr_buffers</a>( <span class="keyword">const</span> <a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a>&amp;   vid);
<a name="l01423"></a>01423 <span class="comment"></span>
<a name="l01424"></a>01424 <span class="comment">    /**\brief Force the buffer pool to flush to disk all pages</span>
<a name="l01425"></a>01425 <span class="comment">     * for the given store.</span>
<a name="l01426"></a>01426 <span class="comment">     * \ingroup SSMAPIDEBUG</span>
<a name="l01427"></a>01427 <span class="comment">     * @param[in] stid   Store whose pages are to be flushed.</span>
<a name="l01428"></a>01428 <span class="comment">     * @param[in] invalidate   True means discard the pages after flushing.</span>
<a name="l01429"></a>01429 <span class="comment">     * \note For debugging only!</span>
<a name="l01430"></a>01430 <span class="comment">     * \attention Do not call force_store_buffers with anything pinned.</span>
<a name="l01431"></a>01431 <span class="comment">     * You may cause latch-latch deadlocks, as this method has</span>
<a name="l01432"></a>01432 <span class="comment">     * to scan the entire buffer pool and, if invalide==true,</span>
<a name="l01433"></a>01433 <span class="comment">     * EX-latch pages to prevent others from updating </span>
<a name="l01434"></a>01434 <span class="comment">     * while it forces to disk.</span>
<a name="l01435"></a>01435 <span class="comment">     * Since the page-order is essentially random, we cannot</span>
<a name="l01436"></a>01436 <span class="comment">     * preclude latch-latch deadlocks with other threads.</span>
<a name="l01437"></a>01437 <span class="comment">     */</span>
<a name="l01438"></a>01438     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../df/d27/group___s_s_m_a_p_i_d_e_b_u_g.html#g6e341363a0b149196809a8a7a4cd32e7">force_store_buffers</a>(<span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a> &amp; stid,
<a name="l01439"></a>01439                                                <span class="keywordtype">bool</span> invalidate);
<a name="l01440"></a>01440 <span class="comment"></span>
<a name="l01441"></a>01441 <span class="comment">    /**\cond skip </span>
<a name="l01442"></a>01442 <span class="comment">     * Do not document. Very un-thread-safe.</span>
<a name="l01443"></a>01443 <span class="comment">     */</span>
<a name="l01444"></a>01444     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            dump_buffers(ostream &amp;o);
<a name="l01445"></a>01445     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            dump_locks(ostream &amp;o);
<a name="l01446"></a>01446     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            dump_locks(); <span class="comment">// defaults to std::cout</span>
<a name="l01447"></a>01447     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            dump_exts(ostream &amp;o, 
<a name="l01448"></a>01448         <a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a>                    v, 
<a name="l01449"></a>01449         <a class="code" href="../../d3/dc7/group___i_d_s.html#g63cc4d3d5947f96ad7277d34eff2fab3">extnum_t</a>                 start, 
<a name="l01450"></a>01450         <a class="code" href="../../d3/dc7/group___i_d_s.html#g63cc4d3d5947f96ad7277d34eff2fab3">extnum_t</a>                 end);
<a name="l01451"></a>01451 
<a name="l01452"></a>01452     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            dump_stores(ostream &amp;o, 
<a name="l01453"></a>01453         <a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a>                    v, 
<a name="l01454"></a>01454         <span class="keywordtype">int</span>                      start, 
<a name="l01455"></a>01455         <span class="keywordtype">int</span>                      end);
<a name="l01456"></a>01456 
<a name="l01457"></a>01457     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            dump_histo(ostream &amp;o, <span class="keywordtype">bool</span> locked);
<a name="l01458"></a>01458 
<a name="l01459"></a>01459     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            snapshot_buffers(
<a name="l01460"></a>01460         u_int&amp;                 ndirty, 
<a name="l01461"></a>01461         u_int&amp;                 nclean, 
<a name="l01462"></a>01462         u_int&amp;                 nfree,
<a name="l01463"></a>01463         u_int&amp;                 nfixed);<span class="comment"></span>
<a name="l01464"></a>01464 <span class="comment">    /**\endcond skip */</span>
<a name="l01465"></a>01465 <span class="comment"></span>
<a name="l01466"></a>01466 <span class="comment">    /**\brief Get a copy of the statistics from an attached instrumented transaction.</span>
<a name="l01467"></a>01467 <span class="comment">     * \ingroup SSMXCT</span>
<a name="l01468"></a>01468 <span class="comment">     * \details</span>
<a name="l01469"></a>01469 <span class="comment">     * @param[out] stats Returns a copy of the statistics for this transaction.</span>
<a name="l01470"></a>01470 <span class="comment">     * @param[in] reset  If true, the statistics for this transaction will be zeroed.</span>
<a name="l01471"></a>01471 <span class="comment">     */</span>
<a name="l01472"></a>01472     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d8/d1e/group___s_s_m_x_c_t.html#geb3c76f7ef4cecb2edd02afbf3c1fa97">gather_xct_stats</a>(
<a name="l01473"></a>01473         <a class="code" href="../../d9/dee/classsm__stats__info__t.html">sm_stats_info_t</a>&amp;       stats, 
<a name="l01474"></a>01474         <span class="keywordtype">bool</span>                   reset = <span class="keyword">false</span>);
<a name="l01475"></a>01475 <span class="comment"></span>
<a name="l01476"></a>01476 <span class="comment">    /**\brief Get a copy of the global statistics.</span>
<a name="l01477"></a>01477 <span class="comment">     * \ingroup SSMSTATS</span>
<a name="l01478"></a>01478 <span class="comment">     * \details</span>
<a name="l01479"></a>01479 <span class="comment">     * @param[out] stats A pre-allocated structure.</span>
<a name="l01480"></a>01480 <span class="comment">     */</span>
<a name="l01481"></a>01481     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d9/d76/group___s_s_m_s_t_a_t_s.html#g030ca9bdf4802a1b4dee5410e4a5e9e0">gather_stats</a>(
<a name="l01482"></a>01482         <a class="code" href="../../d9/dee/classsm__stats__info__t.html">sm_stats_info_t</a>&amp;       stats
<a name="l01483"></a>01483         );
<a name="l01484"></a>01484 <span class="comment"></span>
<a name="l01485"></a>01485 <span class="comment">    /**\brief Get a copy of configuration-dependent information.</span>
<a name="l01486"></a>01486 <span class="comment">     * \ingroup OPT</span>
<a name="l01487"></a>01487 <span class="comment">     * \details</span>
<a name="l01488"></a>01488 <span class="comment">     * @param[out] info A pre-allocated structure.</span>
<a name="l01489"></a>01489 <span class="comment">     */</span>
<a name="l01490"></a>01490     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d5/d46/group___o_p_t.html#g5d712983ca1189ce8e7f81a8116962e8">config_info</a>(<a class="code" href="../../db/d3e/structsm__config__info__t.html">sm_config_info_t</a>&amp; info);
<a name="l01491"></a>01491 <span class="comment"></span>
<a name="l01492"></a>01492 <span class="comment">    /**\brief Set sleep time before I/O operations.</span>
<a name="l01493"></a>01493 <span class="comment">     * \ingroup SSMVOL</span>
<a name="l01494"></a>01494 <span class="comment">     * \details</span>
<a name="l01495"></a>01495 <span class="comment">     * This method sets a milli_sec delay to occur before </span>
<a name="l01496"></a>01496 <span class="comment">     * each disk read/write operation.  This is for debugging.</span>
<a name="l01497"></a>01497 <span class="comment">     * It is useful in discovering thread sync bugs.</span>
<a name="l01498"></a>01498 <span class="comment">     * This delay applies to all threads.</span>
<a name="l01499"></a>01499 <span class="comment">    */</span>
<a name="l01500"></a>01500     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d1/d92/group___s_s_m_v_o_l.html#gb0bda000aa63b5dbbafab3a4289f8396">set_disk_delay</a>(u_int milli_sec);
<a name="l01501"></a>01501 <span class="comment"></span>
<a name="l01502"></a>01502 <span class="comment">    /**\cond skip */</span>
<a name="l01503"></a>01503     <span class="comment">// TODO : document crash testing facilities</span><span class="comment"></span>
<a name="l01504"></a>01504 <span class="comment">    /**\brief Simulate a crash</span>
<a name="l01505"></a>01505 <span class="comment">     * \details</span>
<a name="l01506"></a>01506 <span class="comment">     * This method tells the log manager to start generating corrupted</span>
<a name="l01507"></a>01507 <span class="comment">     * log records.  This will make it appear that a crash occurred</span>
<a name="l01508"></a>01508 <span class="comment">     * at that point in the log.  A call to this method should be</span>
<a name="l01509"></a>01509 <span class="comment">     * followed immediately by a dirty shutdown of the ssm.</span>
<a name="l01510"></a>01510 <span class="comment">     */</span>
<a name="l01511"></a>01511     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            start_log_corruption();
<a name="l01512"></a>01512 
<a name="l01513"></a>01513     <span class="comment">/* for smsh/debugging:   </span>
<a name="l01514"></a>01514 <span class="comment">     * log an arbitrary message */</span>
<a name="l01515"></a>01515     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            log_message(<span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> msg);<span class="comment"></span>
<a name="l01516"></a>01516 <span class="comment">    /**\endcond skip */</span>
<a name="l01517"></a>01517 
<a name="l01518"></a>01518     <span class="comment">// Forces a log flush</span>
<a name="l01519"></a>01519     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            sync_log(<span class="keywordtype">bool</span> block=<span class="keyword">true</span>);
<a name="l01520"></a>01520     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            flush_until(<a class="code" href="../../d2/d19/classlsn__t.html">lsn_t</a>&amp; anlsn, <span class="keywordtype">bool</span> block=<span class="keyword">true</span>);
<a name="l01521"></a>01521 
<a name="l01522"></a>01522     <span class="comment">// Allowing to access info about the important lsns (curr and durable)</span>
<a name="l01523"></a>01523     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            get_curr_lsn(<a class="code" href="../../d2/d19/classlsn__t.html">lsn_t</a>&amp; anlsn);
<a name="l01524"></a>01524     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            get_durable_lsn(<a class="code" href="../../d2/d19/classlsn__t.html">lsn_t</a>&amp; anlsn);
<a name="l01525"></a>01525 
<a name="l01526"></a>01526 
<a name="l01527"></a>01527     <span class="comment">/*</span>
<a name="l01528"></a>01528 <span class="comment">       Device and Volume Management</span>
<a name="l01529"></a>01529 <span class="comment">       ----------------------------</span>
<a name="l01530"></a>01530 <span class="comment">       A device is either an operating system file or operating system</span>
<a name="l01531"></a>01531 <span class="comment">       device and is identified by a path name (absolute or relative).</span>
<a name="l01532"></a>01532 <span class="comment">       A device has a quota.  In theory, a device may have </span>
<a name="l01533"></a>01533 <span class="comment">       multiple volumes on it but</span>
<a name="l01534"></a>01534 <span class="comment">       in the current implementation the maximum number of volumes</span>
<a name="l01535"></a>01535 <span class="comment">       is 1.</span>
<a name="l01536"></a>01536 <span class="comment"></span>
<a name="l01537"></a>01537 <span class="comment">       A volume is where data is stored.  A volume is identified</span>
<a name="l01538"></a>01538 <span class="comment">       uniquely and persistently by a long volume ID (lvid_t).</span>
<a name="l01539"></a>01539 <span class="comment">       Volumes can be used whenever the device they are located</span>
<a name="l01540"></a>01540 <span class="comment">       on is mounted by the SM.  Volumes have a quota.  The</span>
<a name="l01541"></a>01541 <span class="comment">       sum of the quotas of all the volumes on a device cannot</span>
<a name="l01542"></a>01542 <span class="comment">       exceed the device quota.</span>
<a name="l01543"></a>01543 <span class="comment"></span>
<a name="l01544"></a>01544 <span class="comment">       The basic steps to begin using a new device/volume are:</span>
<a name="l01545"></a>01545 <span class="comment">        format_dev: initialize the device</span>
<a name="l01546"></a>01546 <span class="comment">        mount_dev: allow use of the device and all its volumes</span>
<a name="l01547"></a>01547 <span class="comment">        generate_new_lvid: generate a unique ID for the volume</span>
<a name="l01548"></a>01548 <span class="comment">        create_vol: create a volume on the device</span>
<a name="l01549"></a>01549 <span class="comment">     */</span>
<a name="l01550"></a>01550 
<a name="l01551"></a>01551     <span class="comment">/*</span>
<a name="l01552"></a>01552 <span class="comment">     * Device management functions</span>
<a name="l01553"></a>01553 <span class="comment">     */</span><span class="comment"></span>
<a name="l01554"></a>01554 <span class="comment">     /**\addtogroup SSMVOL </span>
<a name="l01555"></a>01555 <span class="comment">      * The storage manager was designed to permit multiple \e volumes</span>
<a name="l01556"></a>01556 <span class="comment">      * on a \e device, with \e volume analogous to a Unix \e parition and</span>
<a name="l01557"></a>01557 <span class="comment">      * a \e device analogous to a disk, and the original SHORE contained</span>
<a name="l01558"></a>01558 <span class="comment">      * symmetric peer servers.  </span>
<a name="l01559"></a>01559 <span class="comment">      * However good that intention, multiple volumes on a device were never</span>
<a name="l01560"></a>01560 <span class="comment">      * implemented, and times have changed, and the storage manager no</span>
<a name="l01561"></a>01561 <span class="comment">      * longer has any notion of remote and local volumes.</span>
<a name="l01562"></a>01562 <span class="comment">      * The notion a volume, separate from a device, remains, but may</span>
<a name="l01563"></a>01563 <span class="comment">      * some day disappear.</span>
<a name="l01564"></a>01564 <span class="comment">      *</span>
<a name="l01565"></a>01565 <span class="comment">      * For the time being, a device contains at most one volume. </span>
<a name="l01566"></a>01566 <span class="comment">      *</span>
<a name="l01567"></a>01567 <span class="comment">     * A device is either an operating system file or </span>
<a name="l01568"></a>01568 <span class="comment">     * an operating system device (e.g., raw disk partition) and  </span>
<a name="l01569"></a>01569 <span class="comment">     * is identified by a path name (absolute or relative).</span>
<a name="l01570"></a>01570 <span class="comment">     *</span>
<a name="l01571"></a>01571 <span class="comment">     * A device has a quota.  </span>
<a name="l01572"></a>01572 <span class="comment">     * A device is intended to have multiple volumes on it, but</span>
<a name="l01573"></a>01573 <span class="comment">     * in the current implementation the maximum number of volumes</span>
<a name="l01574"></a>01574 <span class="comment">     * is exactly 1.</span>
<a name="l01575"></a>01575 <span class="comment">     *</span>
<a name="l01576"></a>01576 <span class="comment">     * A volume is where data are stored.  </span>
<a name="l01577"></a>01577 <span class="comment">     * Each volume is a header and a set of pages. All pages are</span>
<a name="l01578"></a>01578 <span class="comment">     * the same size (this is a compile-time constant, the default being</span>
<a name="l01579"></a>01579 <span class="comment">     * 8K and sizes up to 64K permissible).</span>
<a name="l01580"></a>01580 <span class="comment">     *</span>
<a name="l01581"></a>01581 <span class="comment">     * A volume is identified uniquely and persistently by a </span>
<a name="l01582"></a>01582 <span class="comment">     * long volume ID (lvid_t), which is stored in its header.</span>
<a name="l01583"></a>01583 <span class="comment">     * Volumes can be used whenever the device they are located</span>
<a name="l01584"></a>01584 <span class="comment">     * on is mounted by the SM.  </span>
<a name="l01585"></a>01585 <span class="comment">     * Volumes have a quota.  The</span>
<a name="l01586"></a>01586 <span class="comment">     * sum of the quotas of all the volumes on a device cannot</span>
<a name="l01587"></a>01587 <span class="comment">     * exceed the device quota.</span>
<a name="l01588"></a>01588 <span class="comment">     *</span>
<a name="l01589"></a>01589 <span class="comment">     * A volume contains a variety of data structures. All user</span>
<a name="l01590"></a>01590 <span class="comment">     * data reside in \e stores.  A store is a collection of the</span>
<a name="l01591"></a>01591 <span class="comment">     * pages on the volume, allocated in \e extents of a size that</span>
<a name="l01592"></a>01592 <span class="comment">     * is a compile-time constant. (The storage manager has only</span>
<a name="l01593"></a>01593 <span class="comment">     * been tested with an extent-size of 8 pages. The compile-time constant</span>
<a name="l01594"></a>01594 <span class="comment">     * can be changed, but it also requires changes elsewhere in the code</span>
<a name="l01595"></a>01595 <span class="comment">     * to maintain alignment of persistent structures.</span>
<a name="l01596"></a>01596 <span class="comment">     * See the comments in config/shore.def.) Thus, the minimum size</span>
<a name="l01597"></a>01597 <span class="comment">     * of a store is one extent's worth of pages.</span>
<a name="l01598"></a>01598 <span class="comment">     * Larger extents provide better clustering, but more wasted space if</span>
<a name="l01599"></a>01599 <span class="comment">     * small files and small indexes will be common.</span>
<a name="l01600"></a>01600 <span class="comment">     *</span>
<a name="l01601"></a>01601 <span class="comment">     * Stores are identified by a store number (snum_t).</span>
<a name="l01602"></a>01602 <span class="comment">     *</span>
<a name="l01603"></a>01603 <span class="comment">     * Each volume contains a few stores that are "overhead":</span>
<a name="l01604"></a>01604 <span class="comment">     * 0 -- is reserved for an extent map and a store map</span>
<a name="l01605"></a>01605 <span class="comment">     * 1 -- directory (dir_m)</span>
<a name="l01606"></a>01606 <span class="comment">     * 2 -- root index </span>
<a name="l01607"></a>01607 <span class="comment">     *</span>
<a name="l01608"></a>01608 <span class="comment">     * Beyond that, for each (user) file created, 2 stores are used, one for</span>
<a name="l01609"></a>01609 <span class="comment">     * small objects, one for large objects, and for each index (btree, rtree) </span>
<a name="l01610"></a>01610 <span class="comment">     * created 1 store is used.</span>
<a name="l01611"></a>01611 <span class="comment">     *</span>
<a name="l01612"></a>01612 <span class="comment">     * Each volume is laid out thus:</span>
<a name="l01613"></a>01613 <span class="comment">     * - volume header, which identifies the number of extents on</span>
<a name="l01614"></a>01614 <span class="comment">     *   the volume, determined when the volume is formatted.</span>
<a name="l01615"></a>01615 <span class="comment">     *   This is always in page 1 of the volume.</span>
<a name="l01616"></a>01616 <span class="comment">     * - store map: some number of pages describing the stores on the volume,</span>
<a name="l01617"></a>01617 <span class="comment">     *   namely, being the heads of linked-lists of extents that make up</span>
<a name="l01618"></a>01618 <span class="comment">     *   the stores. The number of such pages is determined when the</span>
<a name="l01619"></a>01619 <span class="comment">     *   volume is formatted.  The worst case is assumed, which is one</span>
<a name="l01620"></a>01620 <span class="comment">     *   might fill the volume with one-extent stores.</span>
<a name="l01621"></a>01621 <span class="comment">     * - extent map: some number of pages of bitmaps, one bitmap for each </span>
<a name="l01622"></a>01622 <span class="comment">     *   extent,  describe which pages in the extents are allocated or free.</span>
<a name="l01623"></a>01623 <span class="comment">     * - data pages: the rest of the volume.</span>
<a name="l01624"></a>01624 <span class="comment">     *</span>
<a name="l01625"></a>01625 <span class="comment">     */</span>
<a name="l01626"></a>01626 <span class="comment"></span>
<a name="l01627"></a>01627 <span class="comment">    /**\brief Format a device.</span>
<a name="l01628"></a>01628 <span class="comment">     * \ingroup SSMVOL</span>
<a name="l01629"></a>01629 <span class="comment">     * \details</span>
<a name="l01630"></a>01630 <span class="comment">     * @param[in] device   Operating-system file name of the "device".</span>
<a name="l01631"></a>01631 <span class="comment">     * @param[in] quota_in_KB  Quota in kilobytes.</span>
<a name="l01632"></a>01632 <span class="comment">     * @param[in] force If true, format the device even if it already exists.</span>
<a name="l01633"></a>01633 <span class="comment">     *</span>
<a name="l01634"></a>01634 <span class="comment">     * Since raw devices always "exist", \a force should be given as true </span>
<a name="l01635"></a>01635 <span class="comment">     * for raw devices.</span>
<a name="l01636"></a>01636 <span class="comment">     *</span>
<a name="l01637"></a>01637 <span class="comment">     * A device may not be formatted if it is already mounted.</span>
<a name="l01638"></a>01638 <span class="comment">     *</span>
<a name="l01639"></a>01639 <span class="comment">     * \note This method should \b not </span>
<a name="l01640"></a>01640 <span class="comment">     * be called in the context of a transaction.</span>
<a name="l01641"></a>01641 <span class="comment">     */</span>
<a name="l01642"></a>01642     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d1/d92/group___s_s_m_v_o_l.html#g0ad23033dcc850c62191e199b1ce9c71">format_dev</a>(
<a name="l01643"></a>01643         <span class="keyword">const</span> <span class="keywordtype">char</span>*            device,
<a name="l01644"></a>01644         smksize_t              quota_in_KB,
<a name="l01645"></a>01645         <span class="keywordtype">bool</span>                   force);
<a name="l01646"></a>01646     <span class="comment"></span>
<a name="l01647"></a>01647 <span class="comment">    /**\brief Mount a device.</span>
<a name="l01648"></a>01648 <span class="comment">     * \ingroup SSMVOL</span>
<a name="l01649"></a>01649 <span class="comment">     * \details</span>
<a name="l01650"></a>01650 <span class="comment">     * @param[in] device   Operating-system file name of the "device".</span>
<a name="l01651"></a>01651 <span class="comment">     * @param[out] vol_cnt Number of volumes on the device.</span>
<a name="l01652"></a>01652 <span class="comment">     * @param[out] devid  A local device id assigned by the storage manager.</span>
<a name="l01653"></a>01653 <span class="comment">     * @param[in] local_vid A local handle to the (only) volume on the device,</span>
<a name="l01654"></a>01654 <span class="comment">     * to be used when a volume is mounted.  The default, vid_t::null, </span>
<a name="l01655"></a>01655 <span class="comment">     * indicates that the storage manager can chose a value for this. </span>
<a name="l01656"></a>01656 <span class="comment">     *</span>
<a name="l01657"></a>01657 <span class="comment">     * \note It is fine to mount a device more than once, as long as device</span>
<a name="l01658"></a>01658 <span class="comment">     * is always the same (you cannot specify a hard link or soft link to</span>
<a name="l01659"></a>01659 <span class="comment">     * an entity mounted under a different path). </span>
<a name="l01660"></a>01660 <span class="comment">     * Device mounts are \b not reference-counted, so a single dismount_dev</span>
<a name="l01661"></a>01661 <span class="comment">     * renders the volumes on the device unusable.</span>
<a name="l01662"></a>01662 <span class="comment">     *</span>
<a name="l01663"></a>01663 <span class="comment">     * \note This method should \b not </span>
<a name="l01664"></a>01664 <span class="comment">     * be called in the context of a transaction.</span>
<a name="l01665"></a>01665 <span class="comment">     */</span>
<a name="l01666"></a>01666     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d1/d92/group___s_s_m_v_o_l.html#g7d4ada660b41abd232dbc16749799348">mount_dev</a>(
<a name="l01667"></a>01667         <span class="keyword">const</span> <span class="keywordtype">char</span>*            device,
<a name="l01668"></a>01668         u_int&amp;                 vol_cnt,
<a name="l01669"></a>01669         <a class="code" href="../../d1/d0c/structdevid__t.html">devid_t</a>&amp;               devid,
<a name="l01670"></a>01670         <a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a>                  local_vid = <a class="code" href="../../d3/d3f/structvid__t.html#3d605b56dec1a5e6fa3cb0201f8a28fd">vid_t::null</a>);
<a name="l01671"></a>01671 <span class="comment"></span>
<a name="l01672"></a>01672 <span class="comment">    /**\brief Dismount a device.</span>
<a name="l01673"></a>01673 <span class="comment">     * \ingroup SSMVOL</span>
<a name="l01674"></a>01674 <span class="comment">     * \details</span>
<a name="l01675"></a>01675 <span class="comment">     * @param[in] device   Operating-system file name of the "device".</span>
<a name="l01676"></a>01676 <span class="comment">     *</span>
<a name="l01677"></a>01677 <span class="comment">     * \note It is fine to mount a device more than once, as long as device</span>
<a name="l01678"></a>01678 <span class="comment">     * is always the same (you cannot specify a hard link or soft link to</span>
<a name="l01679"></a>01679 <span class="comment">     * an entity mounted under a different path). </span>
<a name="l01680"></a>01680 <span class="comment">     * Device mounts are \b not reference-counted, so a single dismount_dev</span>
<a name="l01681"></a>01681 <span class="comment">     * renders the volumes on the device unusable.</span>
<a name="l01682"></a>01682 <span class="comment">     *</span>
<a name="l01683"></a>01683 <span class="comment">     * \note This method should \b not </span>
<a name="l01684"></a>01684 <span class="comment">     * be called in the context of a transaction.</span>
<a name="l01685"></a>01685 <span class="comment">     */</span>
<a name="l01686"></a>01686 
<a name="l01687"></a>01687     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d1/d92/group___s_s_m_v_o_l.html#g096f7782e312f404ffbc0640e0ee3921">dismount_dev</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* device);
<a name="l01688"></a>01688 <span class="comment"></span>
<a name="l01689"></a>01689 <span class="comment">    /**\brief Dismount all mounted devices.</span>
<a name="l01690"></a>01690 <span class="comment">     * \ingroup SSMVOL</span>
<a name="l01691"></a>01691 <span class="comment">     *</span>
<a name="l01692"></a>01692 <span class="comment">     * \note This method should \b not </span>
<a name="l01693"></a>01693 <span class="comment">     * be called in the context of a transaction.</span>
<a name="l01694"></a>01694 <span class="comment">     */</span>
<a name="l01695"></a>01695     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d1/d92/group___s_s_m_v_o_l.html#g99057cd5ae7842f51649c0dfd5155878">dismount_all</a>();
<a name="l01696"></a>01696 
<a name="l01697"></a>01697     <span class="comment">// list_devices returns an array of char* pointers to the names of</span>
<a name="l01698"></a>01698     <span class="comment">// all mounted devices.  Note that the use of a char*'s is </span>
<a name="l01699"></a>01699     <span class="comment">// a temporary hack until a standard string class is available.</span>
<a name="l01700"></a>01700     <span class="comment">// the char* pointers are pointing directly into the device</span>
<a name="l01701"></a>01701     <span class="comment">// mount table.</span>
<a name="l01702"></a>01702     <span class="comment">// dev_cnt is the length of the list returned.</span>
<a name="l01703"></a>01703     <span class="comment">// dev_list and devid_list must be deleted with delete [] by the</span>
<a name="l01704"></a>01704     <span class="comment">// caller if they are not null (0).  They should be null</span>
<a name="l01705"></a>01705     <span class="comment">// if an error is returned or if there are no devices.</span><span class="comment"></span>
<a name="l01706"></a>01706 <span class="comment">    /**\brief Return a list of all mounted devices.</span>
<a name="l01707"></a>01707 <span class="comment">     * \ingroup SSMVOL</span>
<a name="l01708"></a>01708 <span class="comment">     * \details</span>
<a name="l01709"></a>01709 <span class="comment">     * @param[out] dev_list   Returned list of pointers directly into the mount table.</span>
<a name="l01710"></a>01710 <span class="comment">     * @param[out] devid_list   Returned list of associated device ids.</span>
<a name="l01711"></a>01711 <span class="comment">     * @param[out] dev_cnt   Returned number of entries in the two above lists.</span>
<a name="l01712"></a>01712 <span class="comment">     *</span>
<a name="l01713"></a>01713 <span class="comment">     * The storage manager allocates the arrays returned with new[], and the</span>
<a name="l01714"></a>01714 <span class="comment">     * caller must return these to the heap with delete[] if they are not null.</span>
<a name="l01715"></a>01715 <span class="comment">     * They will be null if an error is returned or if no devices are mounted.</span>
<a name="l01716"></a>01716 <span class="comment">     *</span>
<a name="l01717"></a>01717 <span class="comment">     * The strings to which dev_list[*] point are \b not to be deleted by</span>
<a name="l01718"></a>01718 <span class="comment">     * the caller.</span>
<a name="l01719"></a>01719 <span class="comment">     */</span>
<a name="l01720"></a>01720     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d1/d92/group___s_s_m_v_o_l.html#g567c81260c9251d122145de047646079">list_devices</a>(
<a name="l01721"></a>01721         <span class="keyword">const</span> <span class="keywordtype">char</span>**&amp;            dev_list, 
<a name="l01722"></a>01722         <a class="code" href="../../d1/d0c/structdevid__t.html">devid_t</a>*&amp;                devid_list, 
<a name="l01723"></a>01723         u_int&amp;                   dev_cnt);
<a name="l01724"></a>01724 <span class="comment"></span>
<a name="l01725"></a>01725 <span class="comment">    /**\brief Return a list of all volume on a device.</span>
<a name="l01726"></a>01726 <span class="comment">     * \ingroup SSMVOL</span>
<a name="l01727"></a>01727 <span class="comment">     * \details</span>
<a name="l01728"></a>01728 <span class="comment">     * @param[in] device   Operating-system file name of the "device".</span>
<a name="l01729"></a>01729 <span class="comment">     * @param[out] lvid_list   Returned list of pointers directly into the mount table.</span>
<a name="l01730"></a>01730 <span class="comment">     * @param[out] lvid_cnt   Returned length of list lvid_list.</span>
<a name="l01731"></a>01731 <span class="comment">     *</span>
<a name="l01732"></a>01732 <span class="comment">     * The storage manager allocates the array lvid_list </span>
<a name="l01733"></a>01733 <span class="comment">     * with new[], and the</span>
<a name="l01734"></a>01734 <span class="comment">     * caller must return it to the heap with delete[] if it is not null.</span>
<a name="l01735"></a>01735 <span class="comment">     * It will be null if an error is returned. </span>
<a name="l01736"></a>01736 <span class="comment">     *</span>
<a name="l01737"></a>01737 <span class="comment">     * \note This method should \b not </span>
<a name="l01738"></a>01738 <span class="comment">     * be called in the context of a transaction.</span>
<a name="l01739"></a>01739 <span class="comment">     */</span>
<a name="l01740"></a>01740     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d1/d92/group___s_s_m_v_o_l.html#gc060c984b9a423f3106640dd316e6ea5">list_volumes</a>(
<a name="l01741"></a>01741         <span class="keyword">const</span> <span class="keywordtype">char</span>*            device,
<a name="l01742"></a>01742         <a class="code" href="../../d8/d94/structlvid__t.html">lvid_t</a>*&amp;               lvid_list,
<a name="l01743"></a>01743         u_int&amp;                 lvid_cnt
<a name="l01744"></a>01744     );
<a name="l01745"></a>01745 
<a name="l01746"></a>01746     <span class="comment">// get_device_quota the "quota" (in KB) of the device</span>
<a name="l01747"></a>01747     <span class="comment">// and the amount of the quota allocated to volumes on the device.</span><span class="comment"></span>
<a name="l01748"></a>01748 <span class="comment">    /**\brief Get the device quota.</span>
<a name="l01749"></a>01749 <span class="comment">     * \ingroup SSMVOL</span>
<a name="l01750"></a>01750 <span class="comment">     * \details</span>
<a name="l01751"></a>01751 <span class="comment">     * @param[in] device   Operating-system file name of the "device".</span>
<a name="l01752"></a>01752 <span class="comment">     * @param[out] quota_KB   Returned quota in kilobytes</span>
<a name="l01753"></a>01753 <span class="comment">     * @param[out] quota_used_KB   Returned portion of quota allocated to volumes</span>
<a name="l01754"></a>01754 <span class="comment">     *</span>
<a name="l01755"></a>01755 <span class="comment">     * The quota_used_KB is the portion of the quota allocated to volumes on the device.</span>
<a name="l01756"></a>01756 <span class="comment">     *</span>
<a name="l01757"></a>01757 <span class="comment">     * \note This method \b may </span>
<a name="l01758"></a>01758 <span class="comment">     * be called in the context of a transaction.</span>
<a name="l01759"></a>01759 <span class="comment">     *</span>
<a name="l01760"></a>01760 <span class="comment">     * \note This method \b may </span>
<a name="l01761"></a>01761 <span class="comment">     * be called in the context of a transaction.</span>
<a name="l01762"></a>01762 <span class="comment">     */</span>
<a name="l01763"></a>01763     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d1/d92/group___s_s_m_v_o_l.html#gaf46484d848b32c603afb327e865d430">get_device_quota</a>(
<a name="l01764"></a>01764         <span class="keyword">const</span> <span class="keywordtype">char</span>*             device, 
<a name="l01765"></a>01765         smksize_t&amp;              quota_KB, 
<a name="l01766"></a>01766         smksize_t&amp;              quota_used_KB);
<a name="l01767"></a>01767 
<a name="l01768"></a>01768 
<a name="l01769"></a>01769     <span class="comment">/*</span>
<a name="l01770"></a>01770 <span class="comment">     * Volume management functions</span>
<a name="l01771"></a>01771 <span class="comment">     */</span>
<a name="l01772"></a>01772 <span class="comment"></span>
<a name="l01773"></a>01773 <span class="comment">    /**\brief Change the fake disk latency before I/Os on this volume, </span>
<a name="l01774"></a>01774 <span class="comment">     * for debugging purposes</span>
<a name="l01775"></a>01775 <span class="comment">     * \ingroup SSMVOL</span>
<a name="l01776"></a>01776 <span class="comment">     * \details</span>
<a name="l01777"></a>01777 <span class="comment">     * @param[in] vid  The ID of the volume of interest.</span>
<a name="l01778"></a>01778 <span class="comment">     * @param[in] adelay  Nanoseconds to sleep with ::nanosleep()</span>
<a name="l01779"></a>01779 <span class="comment">     *</span>
<a name="l01780"></a>01780 <span class="comment">     * This is for debugging only.</span>
<a name="l01781"></a>01781 <span class="comment">     * Changing the value of the latency for a volume does not enable the</span>
<a name="l01782"></a>01782 <span class="comment">     * delay.</span>
<a name="l01783"></a>01783 <span class="comment">     */</span>
<a name="l01784"></a>01784     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a> <a class="code" href="../../d1/d92/group___s_s_m_v_o_l.html#g91d92425e9b418d16b82965280c4653a">set_fake_disk_latency</a>(<a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a> vid, <span class="keyword">const</span> <span class="keywordtype">int</span> adelay);
<a name="l01785"></a>01785 <span class="comment"></span>
<a name="l01786"></a>01786 <span class="comment">    /**\brief Enable the fake disk latency before I/Os on this volume, for debugging purposes</span>
<a name="l01787"></a>01787 <span class="comment">     * \ingroup SSMVOL</span>
<a name="l01788"></a>01788 <span class="comment">     * \details</span>
<a name="l01789"></a>01789 <span class="comment">     * @param[in] vid  The ID of the volume of interest.</span>
<a name="l01790"></a>01790 <span class="comment">     *</span>
<a name="l01791"></a>01791 <span class="comment">     * This is for debugging only.</span>
<a name="l01792"></a>01792 <span class="comment">     * When this is enabled, is uses whatever disk latency was set with</span>
<a name="l01793"></a>01793 <span class="comment">     * ss_m::create_vol() or the last applied ss_m::set_fake_disk_latency().</span>
<a name="l01794"></a>01794 <span class="comment">     */</span>
<a name="l01795"></a>01795     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a> <a class="code" href="../../d1/d92/group___s_s_m_v_o_l.html#ge01f240196a7b99b573dd876863f6143">enable_fake_disk_latency</a>(<a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a> vid);<span class="comment"></span>
<a name="l01796"></a>01796 <span class="comment">    /**\brief Disable the fake disk latency before I/Os on this volume, for debugging purposes</span>
<a name="l01797"></a>01797 <span class="comment">     * \ingroup SSMVOL</span>
<a name="l01798"></a>01798 <span class="comment">     * \details</span>
<a name="l01799"></a>01799 <span class="comment">     * @param[in] vid  The ID of the volume of interest.</span>
<a name="l01800"></a>01800 <span class="comment">     *</span>
<a name="l01801"></a>01801 <span class="comment">     * This is for debugging only.</span>
<a name="l01802"></a>01802 <span class="comment">     */</span>
<a name="l01803"></a>01803     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a> <a class="code" href="../../d1/d92/group___s_s_m_v_o_l.html#g03b27b3f635dd5524819d9dd81355499">disable_fake_disk_latency</a>(<a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a> vid);
<a name="l01804"></a>01804 
<a name="l01805"></a>01805 <span class="comment"></span>
<a name="l01806"></a>01806 <span class="comment">    /**\brief Add a volume to a device.</span>
<a name="l01807"></a>01807 <span class="comment">     * \ingroup SSMVOL</span>
<a name="l01808"></a>01808 <span class="comment">     * \details</span>
<a name="l01809"></a>01809 <span class="comment">     * @param[in] lvid  Long volume id to be used on ss_m::create_vol().</span>
<a name="l01810"></a>01810 <span class="comment">     * @param[in] hostname  Name to use for local host. Default is one of:</span>
<a name="l01811"></a>01811 <span class="comment">     * host name derived from gethostbyname/uname or "localhost.localdomain", </span>
<a name="l01812"></a>01812 <span class="comment">     * depending on whether the requisite functions exist on the </span>
<a name="l01813"></a>01813 <span class="comment">     * local machine.  Using a non-null</span>
<a name="l01814"></a>01814 <span class="comment">     * argument obviates the use of any other mechanism to derive a </span>
<a name="l01815"></a>01815 <span class="comment">     * host name.  The host name is used to get a host address, </span>
<a name="l01816"></a>01816 <span class="comment">     * which is part of the unique identifier.</span>
<a name="l01817"></a>01817 <span class="comment">     *</span>
<a name="l01818"></a>01818 <span class="comment">     * This generates a unique volume identifier to be written persistently</span>
<a name="l01819"></a>01819 <span class="comment">     * on the volume when it is formatted.</span>
<a name="l01820"></a>01820 <span class="comment">     * This enables us to avoid the mistake of doubly-mounting a volume.</span>
<a name="l01821"></a>01821 <span class="comment">     * The identifer is constructed from the machine network address and the</span>
<a name="l01822"></a>01822 <span class="comment">     * time of day.</span>
<a name="l01823"></a>01823 <span class="comment">     */</span>
<a name="l01824"></a>01824     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a> <a class="code" href="../../d1/d92/group___s_s_m_v_o_l.html#gcb2dde937240003bf5341df4b3556932">generate_new_lvid</a>(<a class="code" href="../../d8/d94/structlvid__t.html">lvid_t</a>&amp; lvid, <span class="keyword">const</span> <span class="keywordtype">char</span> *hostname=NULL);
<a name="l01825"></a>01825      <span class="comment"></span>
<a name="l01826"></a>01826 <span class="comment">    /**\brief Add a volume to a device.</span>
<a name="l01827"></a>01827 <span class="comment">     * \ingroup SSMVOL</span>
<a name="l01828"></a>01828 <span class="comment">     * \details</span>
<a name="l01829"></a>01829 <span class="comment">     * @param[in] device_name   Operating-system file name of the "device".</span>
<a name="l01830"></a>01830 <span class="comment">     * @param[in] lvid  Long volume id to use when formatting the new volume.</span>
<a name="l01831"></a>01831 <span class="comment">     * @param[in] quota_KB  Quota in kilobytes.</span>
<a name="l01832"></a>01832 <span class="comment">     * @param[in] skip_raw_init  Do not initialize the volume if on a raw device.</span>
<a name="l01833"></a>01833 <span class="comment">     * @param[in] local_vid Short volume id by which to refer to this volume.</span>
<a name="l01834"></a>01834 <span class="comment">     *            If null, the storage manager will assign one.</span>
<a name="l01835"></a>01835 <span class="comment">     * @param[in] apply_fake_io_latency See ss_m::enable_fake_disk_latency()</span>
<a name="l01836"></a>01836 <span class="comment">     * @param[in] fake_disk_latency See ss_m::set_fake_disk_latency()</span>
<a name="l01837"></a>01837 <span class="comment">     *</span>
<a name="l01838"></a>01838 <span class="comment">     * \note This method should \b not </span>
<a name="l01839"></a>01839 <span class="comment">     * be called in the context of a transaction.</span>
<a name="l01840"></a>01840 <span class="comment">     *</span>
<a name="l01841"></a>01841 <span class="comment">     * The pages on the volume \b must be zeroed; you can only use</span>
<a name="l01842"></a>01842 <span class="comment">     * \a skip_raw_init = true if you have by some other means</span>
<a name="l01843"></a>01843 <span class="comment">     * already initialized the volume.</span>
<a name="l01844"></a>01844 <span class="comment">     */</span>
<a name="l01845"></a>01845     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d1/d92/group___s_s_m_v_o_l.html#ga929561cfc19fdc1b50e9ce46d0cff70">create_vol</a>(
<a name="l01846"></a>01846         <span class="keyword">const</span> <span class="keywordtype">char</span>*             device_name,
<a name="l01847"></a>01847         <span class="keyword">const</span> <a class="code" href="../../d8/d94/structlvid__t.html">lvid_t</a>&amp;           lvid,
<a name="l01848"></a>01848         smksize_t               quota_KB,
<a name="l01849"></a>01849         <span class="keywordtype">bool</span>                    skip_raw_init = <span class="keyword">false</span>,
<a name="l01850"></a>01850         <a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a>                   local_vid = <a class="code" href="../../d3/d3f/structvid__t.html#3d605b56dec1a5e6fa3cb0201f8a28fd">vid_t::null</a>,
<a name="l01851"></a>01851         <span class="keyword">const</span> <span class="keywordtype">bool</span>              apply_fake_io_latency = <span class="keyword">false</span>,
<a name="l01852"></a>01852         <span class="keyword">const</span> <span class="keywordtype">int</span>               fake_disk_latency = 0);
<a name="l01853"></a>01853 <span class="comment"></span>
<a name="l01854"></a>01854 <span class="comment">    /**\brief Destroy a volume.</span>
<a name="l01855"></a>01855 <span class="comment">     * \ingroup SSMVOL</span>
<a name="l01856"></a>01856 <span class="comment">     * \details</span>
<a name="l01857"></a>01857 <span class="comment">     * @param[in] lvid  Long volume id by which the volume is known.</span>
<a name="l01858"></a>01858 <span class="comment">     *</span>
<a name="l01859"></a>01859 <span class="comment">     * \note This method should \b not </span>
<a name="l01860"></a>01860 <span class="comment">     * be called in the context of a transaction.</span>
<a name="l01861"></a>01861 <span class="comment">     */</span>
<a name="l01862"></a>01862     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d1/d92/group___s_s_m_v_o_l.html#gbee51ea551de351f36eaef35a9eeeab3">destroy_vol</a>(<span class="keyword">const</span> <a class="code" href="../../d8/d94/structlvid__t.html">lvid_t</a>&amp; lvid);
<a name="l01863"></a>01863 <span class="comment"></span>
<a name="l01864"></a>01864 <span class="comment">    /**\brief Gets the quotas associated with the volume.</span>
<a name="l01865"></a>01865 <span class="comment">     * \ingroup SSMVOL</span>
<a name="l01866"></a>01866 <span class="comment">     * @param[in] lvid  Long volume id by which the volume is known.</span>
<a name="l01867"></a>01867 <span class="comment">     * @param[out] quota_KB  Quota given when the volume was created.</span>
<a name="l01868"></a>01868 <span class="comment">     * @param[out] quota_used_KB  Portion of the quota has been used by</span>
<a name="l01869"></a>01869 <span class="comment">     * allocated extents.</span>
<a name="l01870"></a>01870 <span class="comment">     */</span>
<a name="l01871"></a>01871     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d1/d92/group___s_s_m_v_o_l.html#g66e014c5ce487f12e9ecd7bc030960d5">get_volume_quota</a>(
<a name="l01872"></a>01872         <span class="keyword">const</span> <a class="code" href="../../d8/d94/structlvid__t.html">lvid_t</a>&amp;             lvid, 
<a name="l01873"></a>01873         smksize_t&amp;                quota_KB, 
<a name="l01874"></a>01874         smksize_t&amp;                quota_used_KB);
<a name="l01875"></a>01875 <span class="comment"></span>
<a name="l01876"></a>01876 <span class="comment">    /**\cond skip */</span>
<a name="l01877"></a>01877     <span class="comment">// check_volume_page_types: strictly for debugging/testing</span>
<a name="l01878"></a>01878     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>             check_volume_page_types(<a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a> vid);<span class="comment"></span>
<a name="l01879"></a>01879 <span class="comment">    /**\endcond skip */</span>
<a name="l01880"></a>01880 
<a name="l01881"></a>01881 <span class="comment"></span>
<a name="l01882"></a>01882 <span class="comment">    /**\brief Analyze a volume and report statistics regarding disk usage.</span>
<a name="l01883"></a>01883 <span class="comment">     * \ingroup SSMVOL</span>
<a name="l01884"></a>01884 <span class="comment">     * @param[in] vid The volume of interest.</span>
<a name="l01885"></a>01885 <span class="comment">     * @param[out] du The structure that will hold the collected statistics.</span>
<a name="l01886"></a>01886 <span class="comment">     * @param[in] audit If "true", the method acquires a share lock on the</span>
<a name="l01887"></a>01887 <span class="comment">     * volume and then will check assertions about the</span>
<a name="l01888"></a>01888 <span class="comment">     * correctness of the data structures on the volume. </span>
<a name="l01889"></a>01889 <span class="comment">     * If the audit fails an internal fatal error is generated </span>
<a name="l01890"></a>01890 <span class="comment">     * to facilitate debugging. (It will generate a core file if your</span>
<a name="l01891"></a>01891 <span class="comment">     * shell permits such.)</span>
<a name="l01892"></a>01892 <span class="comment">     * If "false" an IS lock is acquired, which means that the</span>
<a name="l01893"></a>01893 <span class="comment">     * statistics will be fuzzy.</span>
<a name="l01894"></a>01894 <span class="comment">     *</span>
<a name="l01895"></a>01895 <span class="comment">     * Using the audit feature is useful for debugging.</span>
<a name="l01896"></a>01896 <span class="comment">     * It is the only safe way to use this method.</span>
<a name="l01897"></a>01897 <span class="comment">     * \note The statistics are added to the sm_du_stats_t structure passed in.</span>
<a name="l01898"></a>01898 <span class="comment">     * This structure is not cleared by the storage manager.</span>
<a name="l01899"></a>01899 <span class="comment">     */</span>
<a name="l01900"></a>01900     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d1/d92/group___s_s_m_v_o_l.html#gc2fa23322a74cbae9e1cf1e72b1734d5">get_du_statistics</a>(
<a name="l01901"></a>01901         <a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a>                 vid,
<a name="l01902"></a>01902         sm_du_stats_t&amp;        du,
<a name="l01903"></a>01903         <span class="keywordtype">bool</span>                  audit = <span class="keyword">true</span>); 
<a name="l01904"></a>01904 <span class="comment"></span>
<a name="l01905"></a>01905 <span class="comment">    /**\brief Analyze a store and report statistics regarding disk usage.</span>
<a name="l01906"></a>01906 <span class="comment">     * \ingroup SSMVOL</span>
<a name="l01907"></a>01907 <span class="comment">     * @param[in] stid The store of interest.</span>
<a name="l01908"></a>01908 <span class="comment">     * @param[out] du The structure that will hold the collected statistics.</span>
<a name="l01909"></a>01909 <span class="comment">     * @param[in] audit If "true", the method acquires a share lock on the</span>
<a name="l01910"></a>01910 <span class="comment">     * store and then will check assertions about the</span>
<a name="l01911"></a>01911 <span class="comment">     * correctness of the data structures on the store. </span>
<a name="l01912"></a>01912 <span class="comment">     *</span>
<a name="l01913"></a>01913 <span class="comment">     * Using the audit feature is useful for debugging.</span>
<a name="l01914"></a>01914 <span class="comment">     * It is the only safe way to use this method.</span>
<a name="l01915"></a>01915 <span class="comment">     *</span>
<a name="l01916"></a>01916 <span class="comment">     */</span>
<a name="l01917"></a>01917     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d1/d92/group___s_s_m_v_o_l.html#gc2fa23322a74cbae9e1cf1e72b1734d5">get_du_statistics</a>(
<a name="l01918"></a>01918         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;        stid, 
<a name="l01919"></a>01919         sm_du_stats_t&amp;       du,
<a name="l01920"></a>01920         <span class="keywordtype">bool</span>                 audit = <span class="keyword">true</span>);
<a name="l01921"></a>01921     <span class="comment"></span>
<a name="l01922"></a>01922 <span class="comment">    /**\brief Dump disk information about the indicated volume.</span>
<a name="l01923"></a>01923 <span class="comment">     * \ingroup SSMVOL</span>
<a name="l01924"></a>01924 <span class="comment">     * @param[in] vid The volume of interest.</span>
<a name="l01925"></a>01925 <span class="comment">     *</span>
<a name="l01926"></a>01926 <span class="comment">     * This function is for debugging.</span>
<a name="l01927"></a>01927 <span class="comment">     * It dumps, to the error log, at info_prio priority,</span>
<a name="l01928"></a>01928 <span class="comment">     * metadata about the given volume, including the number of extents</span>
<a name="l01929"></a>01929 <span class="comment">     * on the volume, the extent size, and the number of pages dedicated</span>
<a name="l01930"></a>01930 <span class="comment">     * to store maps and extent maps. Then, for each store on the volume,</span>
<a name="l01931"></a>01931 <span class="comment">     * it dumps the status of the store and the extents allocated to </span>
<a name="l01932"></a>01932 <span class="comment">     * that store.</span>
<a name="l01933"></a>01933 <span class="comment">     *</span>
<a name="l01934"></a>01934 <span class="comment">     * This function must be run in a transaction, though the function</span>
<a name="l01935"></a>01935 <span class="comment">     * is read-only.</span>
<a name="l01936"></a>01936 <span class="comment">     */</span>
<a name="l01937"></a>01937     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d1/d92/group___s_s_m_v_o_l.html#g76a1ad8c02285b95d7677483d1783e1e">dump_vol_store_info</a>(<span class="keyword">const</span> <a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a> &amp;vid);
<a name="l01938"></a>01938 <span class="comment"></span>
<a name="l01939"></a>01939 <span class="comment">    /**\brief Analyze  a volume and collect brief statistics about its usage.</span>
<a name="l01940"></a>01940 <span class="comment">     * \ingroup SSMVOL</span>
<a name="l01941"></a>01941 <span class="comment">     * @param[in] vid The volume of interest.</span>
<a name="l01942"></a>01942 <span class="comment">     * @param[out] volume_stats The statistics are written here.</span>
<a name="l01943"></a>01943 <span class="comment">     * @param[in] cc Indicates whether the volume is to be locked </span>
<a name="l01944"></a>01944 <span class="comment">     * by this method. Acceptable values are t_cc_none and t_cc_volume.</span>
<a name="l01945"></a>01945 <span class="comment">     *</span>
<a name="l01946"></a>01946 <span class="comment">     * If no lock is acquired, the method can fail with eRETRY.</span>
<a name="l01947"></a>01947 <span class="comment">     *</span>
<a name="l01948"></a>01948 <span class="comment">     */</span>
<a name="l01949"></a>01949     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d1/d92/group___s_s_m_v_o_l.html#gf8eb87487de0644945f509ccdbff320b">get_volume_meta_stats</a>(
<a name="l01950"></a>01950         <a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a>                vid,
<a name="l01951"></a>01951         SmVolumeMetaStats&amp;   volume_stats,
<a name="l01952"></a>01952         <a class="code" href="../../da/d44/classss__m.html#50662c89c6fd0f384a655ca11e78b861">concurrency_t</a>        cc = t_cc_none
<a name="l01953"></a>01953     );
<a name="l01954"></a>01954 <span class="comment"></span>
<a name="l01955"></a>01955 <span class="comment">    /**\brief Analyze  a volume and collect brief statistics about its usage.</span>
<a name="l01956"></a>01956 <span class="comment">     * \ingroup SSMVOL</span>
<a name="l01957"></a>01957 <span class="comment">     * @param[in] vid The volume of interest.</span>
<a name="l01958"></a>01958 <span class="comment">     * @param[in] num_files The size of the array file_stats.</span>
<a name="l01959"></a>01959 <span class="comment">     * @param[out] file_stats Preallocated array of structs into which to</span>
<a name="l01960"></a>01960 <span class="comment">     * write the statistics for the individual files inspected.</span>
<a name="l01961"></a>01961 <span class="comment">     * @param[in] batch_calculate  True means make one pass over the volume.</span>
<a name="l01962"></a>01962 <span class="comment">     * @param[in] cc Indicates whether the volume is to be locked </span>
<a name="l01963"></a>01963 <span class="comment">     * by this method. Acceptable values are t_cc_none and t_cc_volume.</span>
<a name="l01964"></a>01964 <span class="comment">     *</span>
<a name="l01965"></a>01965 <span class="comment">     * If no lock is acquired and batch_calculate is not set, </span>
<a name="l01966"></a>01966 <span class="comment">     * the method can fail with eRETRY.</span>
<a name="l01967"></a>01967 <span class="comment">     *</span>
<a name="l01968"></a>01968 <span class="comment">     *</span>
<a name="l01969"></a>01969 <span class="comment">     * If batch_calculate is true then this works by making one pass</span>
<a name="l01970"></a>01970 <span class="comment">     * over the meta data, but it looks at all the meta data.  This</span>
<a name="l01971"></a>01971 <span class="comment">     * should be the faster way to do the analysis when there are </span>
<a name="l01972"></a>01972 <span class="comment">     * many files, and when files use a large portion of the volume.</span>
<a name="l01973"></a>01973 <span class="comment">     *</span>
<a name="l01974"></a>01974 <span class="comment">     * If batch_calculate is false then each file is updated</span>
<a name="l01975"></a>01975 <span class="comment">     * indidually, only looking at the extent information for that</span>
<a name="l01976"></a>01976 <span class="comment">     * particular file. This requires a pass over the volume for each</span>
<a name="l01977"></a>01977 <span class="comment">     * file. (Seek-wise it is less efficient).</span>
<a name="l01978"></a>01978 <span class="comment">     *</span>
<a name="l01979"></a>01979 <span class="comment">     */</span>
<a name="l01980"></a>01980     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d1/d92/group___s_s_m_v_o_l.html#gbdbd758de7fd4f8246b25d36c07780d5">get_file_meta_stats</a>(
<a name="l01981"></a>01981         <a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a>                vid,
<a name="l01982"></a>01982         <a class="code" href="../../d9/da0/classw__base__t.html#7d1c7ae407200662fd16b64de4dcde46">w_base_t::uint4_t</a>    num_files,
<a name="l01983"></a>01983         SmFileMetaStats*     file_stats,
<a name="l01984"></a>01984         <span class="keywordtype">bool</span>                 batch_calculate = <span class="keyword">false</span>,
<a name="l01985"></a>01985         <a class="code" href="../../da/d44/classss__m.html#50662c89c6fd0f384a655ca11e78b861">concurrency_t</a>        cc = t_cc_none
<a name="l01986"></a>01986     );
<a name="l01987"></a>01987    <span class="comment"></span>
<a name="l01988"></a>01988 <span class="comment">    /**\brief Get the index ID of the root index of the volume.</span>
<a name="l01989"></a>01989 <span class="comment">     * \ingroup SSMVOL</span>
<a name="l01990"></a>01990 <span class="comment">     *</span>
<a name="l01991"></a>01991 <span class="comment">     * @param[in] v Volume of interest.</span>
<a name="l01992"></a>01992 <span class="comment">     * @param[out] iid Store ID of the root index.</span>
<a name="l01993"></a>01993 <span class="comment">     * \details</span>
<a name="l01994"></a>01994 <span class="comment">     *</span>
<a name="l01995"></a>01995 <span class="comment">     * Each volume has a root index, which is a well-known</span>
<a name="l01996"></a>01996 <span class="comment">     * index available to the server for bootstrapping a database.</span>
<a name="l01997"></a>01997 <span class="comment">     *</span>
<a name="l01998"></a>01998 <span class="comment">     */</span>
<a name="l01999"></a><a class="code" href="../../d1/d92/group___s_s_m_v_o_l.html#gac7948d4e08ac1c5c713dd5307919d35">01999</a>     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d1/d92/group___s_s_m_v_o_l.html#gac7948d4e08ac1c5c713dd5307919d35">vol_root_index</a>(
<a name="l02000"></a>02000         <span class="keyword">const</span> <a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a>&amp;        v, 
<a name="l02001"></a>02001         <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;             iid
<a name="l02002"></a>02002     )    { iid.<a class="code" href="../../da/d5b/structstid__t.html#9401c203b02338403a5227f18e27af6c">vol</a> = v; iid.<a class="code" href="../../da/d5b/structstid__t.html#ba17babad0254a9bd7108b7489c6a64e">store</a> = store_id_root_index; <span class="keywordflow">return</span> <a class="code" href="../../d1/d83/w__rc_8h.html#0f25e1835ee19d3905bd8ee2d2f0c86c">RCOK</a>; }
<a name="l02003"></a>02003 
<a name="l02004"></a>02004     <span class="comment">/*****************************************************************</span>
<a name="l02005"></a>02005 <span class="comment">     * storage operations: smfile.cpp</span>
<a name="l02006"></a>02006 <span class="comment">     *****************************************************************/</span><span class="comment"></span>
<a name="l02007"></a>02007 <span class="comment">    /**\addtogroup SSMSTORE </span>
<a name="l02008"></a>02008 <span class="comment">     * Indexes and files are special cases of "stores".</span>
<a name="l02009"></a>02009 <span class="comment">     * A store is a linked list of extents, and an extent is a</span>
<a name="l02010"></a>02010 <span class="comment">     * contiguous group of pages.  So the store is the structure</span>
<a name="l02011"></a>02011 <span class="comment">     * that holds together an ordered set of pages that can be</span>
<a name="l02012"></a>02012 <span class="comment">     * used by a server and have an identifier (a store ID or stid_t).</span>
<a name="l02013"></a>02013 <span class="comment">     *</span>
<a name="l02014"></a>02014 <span class="comment">     * Indexes and files of records are built on stores.</span>
<a name="l02015"></a>02015 <span class="comment">     *</span>
<a name="l02016"></a>02016 <span class="comment">     * Stores have logging properties and </span>
<a name="l02017"></a>02017 <span class="comment">     * other metadata associated with them.</span>
<a name="l02018"></a>02018 <span class="comment">     * </span>
<a name="l02019"></a>02019 <span class="comment">     * The property that determines the logging level of the store is</span>
<a name="l02020"></a>02020 <span class="comment">     * \ref sm_store_property_t.</span>
<a name="l02021"></a>02021 <span class="comment">     *</span>
<a name="l02022"></a>02022 <span class="comment">     * Methods that let you get and change the metatdata are:</span>
<a name="l02023"></a>02023 <span class="comment">     * - ss_m::get_store_property</span>
<a name="l02024"></a>02024 <span class="comment">     * - ss_m::set_store_property</span>
<a name="l02025"></a>02025 <span class="comment">     * - ss_m::get_store_info</span>
<a name="l02026"></a>02026 <span class="comment">     * - \ref snum_t</span>
<a name="l02027"></a>02027 <span class="comment">     *</span>
<a name="l02028"></a>02028 <span class="comment">     * When a transaction deletes a file or index, the deletion of the</span>
<a name="l02029"></a>02029 <span class="comment">     * underlying stores is delayed until the transaction commits so that</span>
<a name="l02030"></a>02030 <span class="comment">     * the pages allocated to the stores remain reserved (lest the</span>
<a name="l02031"></a>02031 <span class="comment">     * transaction aborts). The deleting transaction could, in theory,</span>
<a name="l02032"></a>02032 <span class="comment">     * reuse the pages for another store, but in practice that is not done.</span>
<a name="l02033"></a>02033 <span class="comment">     * Instead, when a store is deleted, the store is marked</span>
<a name="l02034"></a>02034 <span class="comment">     * for deletion an put in a list for the transaction to delete upon</span>
<a name="l02035"></a>02035 <span class="comment">     * commit.   At commit time, stores that have property t_load_file</span>
<a name="l02036"></a>02036 <span class="comment">     * or t_insert_file are converted to t_regular.</span>
<a name="l02037"></a>02037 <span class="comment">     */</span>
<a name="l02038"></a>02038 <span class="comment"></span>
<a name="l02039"></a>02039 <span class="comment">    /**\brief Change the store property of a file or index.</span>
<a name="l02040"></a>02040 <span class="comment">     * \ingroup SSMSTORE</span>
<a name="l02041"></a>02041 <span class="comment">     * @param[in] stid   File ID or index ID of the store to change.</span>
<a name="l02042"></a>02042 <span class="comment">     * @param[in] property   Enumeration store_property_t (alias for</span>
<a name="l02043"></a>02043 <span class="comment">     *                   smlevel_3::sm_store_property_t, q.v.)</span>
<a name="l02044"></a>02044 <span class="comment">     *</span>
<a name="l02045"></a>02045 <span class="comment">     * \details</span>
<a name="l02046"></a>02046 <span class="comment">     * The possible uses of store properties are described with </span>
<a name="l02047"></a>02047 <span class="comment">     * smlevel_3::sm_store_property_t.</span>
<a name="l02048"></a>02048 <span class="comment">     */</span>
<a name="l02049"></a>02049     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d2/dc6/group___s_s_m_s_t_o_r_e.html#ga2c0c195a649854ecab5913a941ea2f8">set_store_property</a>(
<a name="l02050"></a>02050         <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>                stid,
<a name="l02051"></a>02051         <a class="code" href="../../da/d44/classss__m.html#a7a0a9b5677337b6d5a4e3f42d9fa149">store_property_t</a>      property
<a name="l02052"></a>02052         );
<a name="l02053"></a>02053 <span class="comment"></span>
<a name="l02054"></a>02054 <span class="comment">    /**\brief Get the store property of a file or index.</span>
<a name="l02055"></a>02055 <span class="comment">     * \ingroup SSMSTORE</span>
<a name="l02056"></a>02056 <span class="comment">     * @param[in] stid   File ID or index ID of the store of interest.</span>
<a name="l02057"></a>02057 <span class="comment">     * @param[in] property   Reference to enumeration store_property_t </span>
<a name="l02058"></a>02058 <span class="comment">     *                  (alias for smlevel_3::sm_store_property_t, q.v.)</span>
<a name="l02059"></a>02059 <span class="comment">     *</span>
<a name="l02060"></a>02060 <span class="comment">     * \details</span>
<a name="l02061"></a>02061 <span class="comment">     * The possible uses of store properties are described with </span>
<a name="l02062"></a>02062 <span class="comment">     * smlevel_3::sm_store_property_t.</span>
<a name="l02063"></a>02063 <span class="comment">     */</span>
<a name="l02064"></a>02064     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d2/dc6/group___s_s_m_s_t_o_r_e.html#g14c74fa39b62b687be709d38790118b3">get_store_property</a>(
<a name="l02065"></a>02065         <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>                stid,
<a name="l02066"></a>02066         <a class="code" href="../../da/d44/classss__m.html#a7a0a9b5677337b6d5a4e3f42d9fa149">store_property_t</a>&amp;     property);
<a name="l02067"></a>02067 <span class="comment"></span>
<a name="l02068"></a>02068 <span class="comment">    /**\brief Get various store information of a file or index.</span>
<a name="l02069"></a>02069 <span class="comment">     * \ingroup SSMSTORE</span>
<a name="l02070"></a>02070 <span class="comment">     * @param[in] stid   File ID or index ID of the store of interest.</span>
<a name="l02071"></a>02071 <span class="comment">     * @param[out] info  Reference to sm_store_info_t into which to</span>
<a name="l02072"></a>02072 <span class="comment">     * write the results.</span>
<a name="l02073"></a>02073 <span class="comment">     *</span>
<a name="l02074"></a>02074 <span class="comment">     * \details</span>
<a name="l02075"></a>02075 <span class="comment">     * Get internally stored information about a store.</span>
<a name="l02076"></a>02076 <span class="comment">     */</span>
<a name="l02077"></a>02077     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d2/dc6/group___s_s_m_s_t_o_r_e.html#g9dccea70316f63f876c29aa44098388e">get_store_info</a>( 
<a name="l02078"></a>02078         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;         stid, 
<a name="l02079"></a>02079         <a class="code" href="../../d3/d8b/classsm__store__info__t.html">sm_store_info_t</a>&amp;      info);
<a name="l02080"></a>02080 
<a name="l02081"></a>02081     <span class="comment">//</span>
<a name="l02082"></a>02082     <span class="comment">// Functions for B+tree Indexes</span>
<a name="l02083"></a>02083     <span class="comment">//</span><span class="comment"></span>
<a name="l02084"></a>02084 <span class="comment">    /**\addtogroup SSMBTREE </span>
<a name="l02085"></a>02085 <span class="comment">     * The storage manager supports B+-Tree indexes provide associative access </span>
<a name="l02086"></a>02086 <span class="comment">     * to data by associating keys with values in 1:1 or many:1 relationships.</span>
<a name="l02087"></a>02087 <span class="comment">     * Keys may be composed of any of the basic C-language types (integer,</span>
<a name="l02088"></a>02088 <span class="comment">     * unsigned, floating-point of several sizes) or</span>
<a name="l02089"></a>02089 <span class="comment">     * variable-length character strings (wide characters are \b not supported).</span>
<a name="l02090"></a>02090 <span class="comment">     *</span>
<a name="l02091"></a>02091 <span class="comment">     * The number of key-value pairs that an index can hold is limited by the</span>
<a name="l02092"></a>02092 <span class="comment">     * space available on the volume containing the index.</span>
<a name="l02093"></a>02093 <span class="comment">     * \anchor max_entry_size </span>
<a name="l02094"></a>02094 <span class="comment">     * The combined sizes of the key and value must</span>
<a name="l02095"></a>02095 <span class="comment">     * be less than or equal to \ref max_entry_size, which is</span>
<a name="l02096"></a>02096 <span class="comment">     * a function of the page size, and is </span>
<a name="l02097"></a>02097 <span class="comment">     * such that two entries of this size fit on a page along with all</span>
<a name="l02098"></a>02098 <span class="comment">     * the page and entry metadata.  See sm_config_info_t and ss_m::config_info.</span>
<a name="l02099"></a>02099 <span class="comment">     *</span>
<a name="l02100"></a>02100 <span class="comment">     * The minimum size of a B-Tree index is 8 pages (1 extent).</span>
<a name="l02101"></a>02101 <span class="comment">     *</span>
<a name="l02102"></a>02102 <span class="comment">     * A variety of locking protocols is supported:</span>
<a name="l02103"></a>02103 <span class="comment">     * - none : acquire no locks on the {key,value} pairs in the index,</span>
<a name="l02104"></a>02104 <span class="comment">     *   although an intention lock might be acquired on the index.</span>
<a name="l02105"></a>02105 <span class="comment">     * - kvl : key-value locking See \ref MOH1.  The key or</span>
<a name="l02106"></a>02106 <span class="comment">     *   key-value pair is hashed into a 4-byte value and used with the</span>
<a name="l02107"></a>02107 <span class="comment">     *   given store id to make a lock id.</span>
<a name="l02108"></a>02108 <span class="comment">     * - im : index-management locking See \ref MOH1.  </span>
<a name="l02109"></a>02109 <span class="comment">     *   The "value" portion of</span>
<a name="l02110"></a>02110 <span class="comment">     *   the key-value lock is taken to be a record id, which is used </span>
<a name="l02111"></a>02111 <span class="comment">     *   for the lock id.</span>
<a name="l02112"></a>02112 <span class="comment">     * - modified kvl : an ad-hoc protocol used by the Paradise project. See \ref MODKVL "the scan_index_i constructor". As with index-management locking, </span>
<a name="l02113"></a>02113 <span class="comment">     *   the "value" portion of</span>
<a name="l02114"></a>02114 <span class="comment">     *   the key-value lock is taken to be a record id, which is used </span>
<a name="l02115"></a>02115 <span class="comment">     *   for the lock id.</span>
<a name="l02116"></a>02116 <span class="comment">     * - file : full-index locking.</span>
<a name="l02117"></a>02117 <span class="comment">     *</span>
<a name="l02118"></a>02118 <span class="comment">     * \section key_description Key Types</span>
<a name="l02119"></a>02119 <span class="comment">     * A B+-Tree index key has a type determined when the index is created.</span>
<a name="l02120"></a>02120 <span class="comment">     * All keys are stored in lexicographic format based on an interpretation of</span>
<a name="l02121"></a>02121 <span class="comment">     * the key determined by the key description given when the index is</span>
<a name="l02122"></a>02122 <span class="comment">     * created.</span>
<a name="l02123"></a>02123 <span class="comment">     * Lookups on the B+-Tree then involve a single byte-by-byte</span>
<a name="l02124"></a>02124 <span class="comment">     * comparison of two byte-strings, each composed of its concatenated</span>
<a name="l02125"></a>02125 <span class="comment">     * sub-keys.</span>
<a name="l02126"></a>02126 <span class="comment">     *</span>
<a name="l02127"></a>02127 <span class="comment">     * The key description is a null-terminated string as follows:</span>
<a name="l02128"></a>02128 <span class="comment">     \verbatim</span>
<a name="l02129"></a>02129 <span class="comment">     &lt;key_decription&gt;     ::=  &lt;fixed_len_part&gt;*  &lt;variable_len_part&gt;  |</span>
<a name="l02130"></a>02130 <span class="comment">                               &lt;fixed_len_part&gt;+ </span>
<a name="l02131"></a>02131 <span class="comment">     &lt;fixed_len_part&gt;     ::=  &lt;type&gt; &lt;len&gt; </span>
<a name="l02132"></a>02132 <span class="comment">     &lt;variable_len_part&gt;  ::=  &lt;type&gt; '*' &lt;len&gt;</span>
<a name="l02133"></a>02133 <span class="comment">     &lt;type&gt;               ::=  'i' | 'u' | 'f' | 'b' | 'I' | 'U' | 'F' | 'B'</span>
<a name="l02134"></a>02134 <span class="comment">     &lt;len&gt;                ::=   [1-9][0-9]*</span>
<a name="l02135"></a>02135 <span class="comment">     \endverbatim</span>
<a name="l02136"></a>02136 <span class="comment">     * Thus, a key may have any number of fixed-length parts followed by at</span>
<a name="l02137"></a>02137 <span class="comment">     * most one variable-length part.</span>
<a name="l02138"></a>02138 <span class="comment">     *</span>
<a name="l02139"></a>02139 <span class="comment">     * The fixed-length parts (if present) consist of a type and a length.</span>
<a name="l02140"></a>02140 <span class="comment">     *</span>
<a name="l02141"></a>02141 <span class="comment">     * The variable-length part (if present) consists of a type and a length</span>
<a name="l02142"></a>02142 <span class="comment">     * separated by an asterisk, which is what distinguishes a variable-length</span>
<a name="l02143"></a>02143 <span class="comment">     * from a fixed-length part.</span>
<a name="l02144"></a>02144 <span class="comment">     *</span>
<a name="l02145"></a>02145 <span class="comment">     * Types and permissible lengths are:</span>
<a name="l02146"></a>02146 <span class="comment">     * - integer (1,2,4,8)</span>
<a name="l02147"></a>02147 <span class="comment">     * - unsigned (1,2,4,8)</span>
<a name="l02148"></a>02148 <span class="comment">     * - floating (4,8)</span>
<a name="l02149"></a>02149 <span class="comment">     * - uninterpreted byte (any length greater than zero)</span>
<a name="l02150"></a>02150 <span class="comment">     *</span>
<a name="l02151"></a>02151 <span class="comment">     * A capital letter indicates that the key part may be compressed. Only prefix</span>
<a name="l02152"></a>02152 <span class="comment">     * compression is implemented, so it makes sense to compress if the</span>
<a name="l02153"></a>02153 <span class="comment">     * first part of the key is compressible.</span>
<a name="l02154"></a>02154 <span class="comment">     *</span>
<a name="l02155"></a>02155 <span class="comment">     * Examples:</span>
<a name="l02156"></a>02156 <span class="comment">     * - "B40u4u2u2" : 40-byte character string followed by a 4-byte integer,</span>
<a name="l02157"></a>02157 <span class="comment">     *                 a 2-byte integer and a 2-byte integer, such as one might</span>
<a name="l02158"></a>02158 <span class="comment">     *                 use for name.year.mo.day.  The character string is</span>
<a name="l02159"></a>02159 <span class="comment">     *                 prefix-compressed.</span>
<a name="l02160"></a>02160 <span class="comment">     * - "f8"        : an 8-byte floating-point number (double)</span>
<a name="l02161"></a>02161 <span class="comment">     * - "I8B*1000"  : An 8-byte integer followed by an uninterpreted string</span>
<a name="l02162"></a>02162 <span class="comment">     *                 of up to 1000 bytes, all prefix-compressed.</span>
<a name="l02163"></a>02163 <span class="comment">     *</span>
<a name="l02164"></a>02164 <span class="comment">     * \note Wide characters are not supported.</span>
<a name="l02165"></a>02165 <span class="comment">     *</span>
<a name="l02166"></a>02166 <span class="comment">     * This key descriptor is stored in the sm_store_info_t, which is</span>
<a name="l02167"></a>02167 <span class="comment">     * stored on the volume and is available with the method ss_m::get_store_info.</span>
<a name="l02168"></a>02168 <span class="comment">     * Keys are stored in \ref LEXICOFORMAT "lexicographic format". The</span>
<a name="l02169"></a>02169 <span class="comment">     * storage manager knows how to convert all the key types listed above.</span>
<a name="l02170"></a>02170 <span class="comment">     * When duplicates are permitted, the index assumes that the elements</span>
<a name="l02171"></a>02171 <span class="comment">     * are in lexicographic order when searching for a &lt;key,element&gt; pair.</span>
<a name="l02172"></a>02172 <span class="comment">     *</span>
<a name="l02173"></a>02173 <span class="comment">     * \section XXXX1 Bulk Loading </span>
<a name="l02174"></a>02174 <span class="comment">     * Bulk-loading of all index types is supported. See \ref SSMBULKLD.</span>
<a name="l02175"></a>02175 <span class="comment">     */</span>
<a name="l02176"></a>02176 
<a name="l02177"></a>02177 <span class="comment"></span>
<a name="l02178"></a>02178 <span class="comment">    /**\brief Create a B+-Tree index.</span>
<a name="l02179"></a>02179 <span class="comment">     * \ingroup SSMBTREE</span>
<a name="l02180"></a>02180 <span class="comment">     * @param[in] vid   Volume on which to create the index.</span>
<a name="l02181"></a>02181 <span class="comment">     * @param[in] ntype   Type of index. Legitimate values are: </span>
<a name="l02182"></a>02182 <span class="comment">     *  - t_btree : B+-Tree with duplicate keys allowed</span>
<a name="l02183"></a>02183 <span class="comment">     *  - t_uni_btree : B+-Tree without duplicate keys </span>
<a name="l02184"></a>02184 <span class="comment">     * @param[in] property Logging level of store. Legitimate values are:</span>
<a name="l02185"></a>02185 <span class="comment">     *  - t_regular</span>
<a name="l02186"></a>02186 <span class="comment">     *  - t_load_file</span>
<a name="l02187"></a>02187 <span class="comment">     *  - t_insert_file</span>
<a name="l02188"></a>02188 <span class="comment">     *  See sm_store_property_t for details.</span>
<a name="l02189"></a>02189 <span class="comment">     * @param[in] key_desc Description of key type.</span>
<a name="l02190"></a>02190 <span class="comment">     *  See \ref key_description for details.</span>
<a name="l02191"></a>02191 <span class="comment">     * @param[in] cc The locking protocol to use with this index. See</span>
<a name="l02192"></a>02192 <span class="comment">     * smlevel_0::concurrency_t and \ref SSMBTREE.</span>
<a name="l02193"></a>02193 <span class="comment">     * @param[out] stid New store ID will be returned here.</span>
<a name="l02194"></a>02194 <span class="comment">     */</span>
<a name="l02195"></a>02195     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d4/df6/group___s_s_m_b_t_r_e_e.html#g03630884ad995c97b819482a41b9edce">create_index</a>(
<a name="l02196"></a>02196                 <a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a>                 vid, 
<a name="l02197"></a>02197                 <a class="code" href="../../da/d44/classss__m.html#901caa62fd2c03e33bec050c30dd828b">ndx_t</a>                 ntype, 
<a name="l02198"></a>02198                 <a class="code" href="../../da/d44/classss__m.html#a7a0a9b5677337b6d5a4e3f42d9fa149">store_property_t</a>      property,
<a name="l02199"></a>02199                 <span class="keyword">const</span> <span class="keywordtype">char</span>*           key_desc,
<a name="l02200"></a>02200                 <a class="code" href="../../da/d44/classss__m.html#50662c89c6fd0f384a655ca11e78b861">concurrency_t</a>         cc, 
<a name="l02201"></a>02201                 <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;               stid
<a name="l02202"></a>02202     );
<a name="l02203"></a>02203 <span class="comment"></span>
<a name="l02204"></a>02204 <span class="comment">    /**\brief Create a B+-Tree or R*-Tree index.</span>
<a name="l02205"></a>02205 <span class="comment">     * \ingroup SSMBTREE</span>
<a name="l02206"></a>02206 <span class="comment">     *\attention For backward compatibility. Will be deprecated later.</span>
<a name="l02207"></a>02207 <span class="comment">     */</span>
<a name="l02208"></a>02208     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d4/df6/group___s_s_m_b_t_r_e_e.html#g03630884ad995c97b819482a41b9edce">create_index</a>(
<a name="l02209"></a>02209                 <a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a>                 vid, 
<a name="l02210"></a>02210                 <a class="code" href="../../da/d44/classss__m.html#901caa62fd2c03e33bec050c30dd828b">ndx_t</a>                 ntype, 
<a name="l02211"></a>02211                 <a class="code" href="../../da/d44/classss__m.html#a7a0a9b5677337b6d5a4e3f42d9fa149">store_property_t</a>      property,
<a name="l02212"></a>02212                 <span class="keyword">const</span> <span class="keywordtype">char</span>*           key_desc,
<a name="l02213"></a>02213                 <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;               stid
<a name="l02214"></a>02214     );
<a name="l02215"></a>02215 <span class="comment"></span>
<a name="l02216"></a>02216 <span class="comment">    /**\brief Destroy a B+-Tree index.</span>
<a name="l02217"></a>02217 <span class="comment">     * \ingroup SSMBTREE</span>
<a name="l02218"></a>02218 <span class="comment">     *</span>
<a name="l02219"></a>02219 <span class="comment">     * @param[in] iid  ID of the index to be destroyed.</span>
<a name="l02220"></a>02220 <span class="comment">     */</span>
<a name="l02221"></a>02221     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d4/df6/group___s_s_m_b_t_r_e_e.html#g06b024a25161b482b5a0c462abb9fd2e">destroy_index</a>(<span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp; iid); 
<a name="l02222"></a>02222 <span class="comment"></span>
<a name="l02223"></a>02223 <span class="comment">    /**\brief Bulk-load a B+-Tree index from multiple data sources.</span>
<a name="l02224"></a>02224 <span class="comment">     * \ingroup SSMBULKLD</span>
<a name="l02225"></a>02225 <span class="comment">     *</span>
<a name="l02226"></a>02226 <span class="comment">     * @param[in] stid  ID of the index to be loaded.</span>
<a name="l02227"></a>02227 <span class="comment">     * @param[in] nsrcs  Number of files used for data sources.</span>
<a name="l02228"></a>02228 <span class="comment">     * @param[in] source  Array of IDs of files used for data sources.</span>
<a name="l02229"></a>02229 <span class="comment">     * @param[out] stats  Statistics concerning the load activity will be</span>
<a name="l02230"></a>02230 <span class="comment">     *                     written here.</span>
<a name="l02231"></a>02231 <span class="comment">     * @param[in] sort_duplicates  If "true" the bulk-load will sort</span>
<a name="l02232"></a>02232 <span class="comment">     * duplicates by value.</span>
<a name="l02233"></a>02233 <span class="comment">     * @param[in] lexify_keys  If "true" the keys are assumed not to</span>
<a name="l02234"></a>02234 <span class="comment">     * be in </span>
<a name="l02235"></a>02235 <span class="comment">     * lexicographic format, and the bulk-load will reformat the key before</span>
<a name="l02236"></a>02236 <span class="comment">     * storing it in the index,</span>
<a name="l02237"></a>02237 <span class="comment">     * otherwise they are assumed already to be in lexicographic format.</span>
<a name="l02238"></a>02238 <span class="comment">     *</span>
<a name="l02239"></a>02239 <span class="comment">     * \anchor LEXICOFORMAT </span>
<a name="l02240"></a>02240 <span class="comment">     * \b Lexicographic \b format</span>
<a name="l02241"></a>02241 <span class="comment">     * is the translation of numbers </span>
<a name="l02242"></a>02242 <span class="comment">     * (int, float, double, unsigned, etc) into byte strings</span>
<a name="l02243"></a>02243 <span class="comment">     * such that a lexicographic comparison of the byte strings</span>
<a name="l02244"></a>02244 <span class="comment">     * yields the same result as the numeric comparison of the</span>
<a name="l02245"></a>02245 <span class="comment">     * original data.</span>
<a name="l02246"></a>02246 <span class="comment">     *</span>
<a name="l02247"></a>02247 <span class="comment">     * \note The data must already have been sorted by </span>
<a name="l02248"></a>02248 <span class="comment">     * key in lexicographic format, but the keys themselves don't have</span>
<a name="l02249"></a>02249 <span class="comment">     * to be in lexicographic format; if the keys are not already in</span>
<a name="l02250"></a>02250 <span class="comment">     * lexicographic format, the \a lexify_keys must be given the value "true".</span>
<a name="l02251"></a>02251 <span class="comment">     *</span>
<a name="l02252"></a>02252 <span class="comment">     * In the case of duplicate keys, the bulk-load will handle the</span>
<a name="l02253"></a>02253 <span class="comment">     * sorting of the elements if \a sort_duplicates is "true"; this</span>
<a name="l02254"></a>02254 <span class="comment">     * sort will be done by a lexicographic comparison of the </span>
<a name="l02255"></a>02255 <span class="comment">     * byte strings that compose the elements.</span>
<a name="l02256"></a>02256 <span class="comment">     */</span>
<a name="l02257"></a>02257     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d6/d82/group___s_s_m_b_u_l_k_l_d.html#g9e6d6ba6150d24f9048eb0f95d5fa573">bulkld_index</a>(
<a name="l02258"></a>02258         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;             stid, 
<a name="l02259"></a>02259         <span class="keywordtype">int</span>                       nsrcs,
<a name="l02260"></a>02260         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>*             source,
<a name="l02261"></a>02261         sm_du_stats_t&amp;            stats,
<a name="l02262"></a>02262         <span class="keywordtype">bool</span>                      sort_duplicates = <span class="keyword">true</span>,
<a name="l02263"></a>02263         <span class="keywordtype">bool</span>                      lexify_keys = <span class="keyword">true</span>
<a name="l02264"></a>02264     );<span class="comment"></span>
<a name="l02265"></a>02265 <span class="comment">    /**\brief Bulk-load a B+-Tree index from a single data source.</span>
<a name="l02266"></a>02266 <span class="comment">     * \ingroup SSMBULKLD</span>
<a name="l02267"></a>02267 <span class="comment">     *</span>
<a name="l02268"></a>02268 <span class="comment">     * @param[in] stid  ID of the index to be loaded.</span>
<a name="l02269"></a>02269 <span class="comment">     * @param[in] source  IDs of file used for data source.</span>
<a name="l02270"></a>02270 <span class="comment">     * @param[out] stats  Statistics concerning the load activity will be</span>
<a name="l02271"></a>02271 <span class="comment">     *                     written here.</span>
<a name="l02272"></a>02272 <span class="comment">     * @param[in] sort_duplicates  If "true" the bulk-load will sort</span>
<a name="l02273"></a>02273 <span class="comment">     * duplicates by value.</span>
<a name="l02274"></a>02274 <span class="comment">     * @param[in] lexify_keys  If "true" the keys are assumed not to</span>
<a name="l02275"></a>02275 <span class="comment">     * be in </span>
<a name="l02276"></a>02276 <span class="comment">     * lexicographic format, and the bulk-load will reformat the key before</span>
<a name="l02277"></a>02277 <span class="comment">     * storing it in the index,</span>
<a name="l02278"></a>02278 <span class="comment">     * otherwise they are assumed already to be in lexicographic format.</span>
<a name="l02279"></a>02279 <span class="comment">     */</span>
<a name="l02280"></a>02280     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d6/d82/group___s_s_m_b_u_l_k_l_d.html#g9e6d6ba6150d24f9048eb0f95d5fa573">bulkld_index</a>(
<a name="l02281"></a>02281         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;             stid, 
<a name="l02282"></a>02282         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;             source,
<a name="l02283"></a>02283         sm_du_stats_t&amp;            stats,
<a name="l02284"></a>02284         <span class="keywordtype">bool</span>                      sort_duplicates = <span class="keyword">true</span>,
<a name="l02285"></a>02285         <span class="keywordtype">bool</span>                      lexify_keys = <span class="keyword">true</span>
<a name="l02286"></a>02286     );<span class="comment"></span>
<a name="l02287"></a>02287 <span class="comment">    /**\brief Bulk-load a B+-Tree index from a single data stream.</span>
<a name="l02288"></a>02288 <span class="comment">     * \ingroup SSMBULKLD</span>
<a name="l02289"></a>02289 <span class="comment">     *</span>
<a name="l02290"></a>02290 <span class="comment">     * @param[in] stid  ID of the index to be loaded.</span>
<a name="l02291"></a>02291 <span class="comment">     * @param[in] sorted_stream  Iterator that serves as the data source.</span>
<a name="l02292"></a>02292 <span class="comment">     * @param[out] stats  Statistics concerning the load activity will be</span>
<a name="l02293"></a>02293 <span class="comment">     *                     written here.</span>
<a name="l02294"></a>02294 <span class="comment">     *</span>
<a name="l02295"></a>02295 <span class="comment">     * See sort_stream_i.</span>
<a name="l02296"></a>02296 <span class="comment">     */</span>
<a name="l02297"></a>02297     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d6/d82/group___s_s_m_b_u_l_k_l_d.html#g9e6d6ba6150d24f9048eb0f95d5fa573">bulkld_index</a>(
<a name="l02298"></a>02298         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;             stid, 
<a name="l02299"></a>02299         <a class="code" href="../../da/d1c/classsort__stream__i.html">sort_stream_i</a>&amp;            sorted_stream,
<a name="l02300"></a>02300         sm_du_stats_t&amp;            stats);
<a name="l02301"></a>02301 <span class="comment"></span>
<a name="l02302"></a>02302 <span class="comment">    /**\cond skip */</span>
<a name="l02303"></a>02303     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            print_index(<a class="code" href="../../da/d5b/structstid__t.html">stid_t</a> stid);<span class="comment"></span>
<a name="l02304"></a>02304 <span class="comment">    /**\endcond skip */</span>
<a name="l02305"></a>02305 <span class="comment"></span>
<a name="l02306"></a>02306 <span class="comment">    /**\brief Create an entry in a B+-Tree index.</span>
<a name="l02307"></a>02307 <span class="comment">     * \ingroup SSMBTREE</span>
<a name="l02308"></a>02308 <span class="comment">     *</span>
<a name="l02309"></a>02309 <span class="comment">     * @param[in] stid  ID of the index. </span>
<a name="l02310"></a>02310 <span class="comment">     * @param[in] key  Key for the association to be created.</span>
<a name="l02311"></a>02311 <span class="comment">     * @param[in] el  Element for the association to be created.</span>
<a name="l02312"></a>02312 <span class="comment">     *</span>
<a name="l02313"></a>02313 <span class="comment">     * The combined sizes of the key and element vectors must</span>
<a name="l02314"></a>02314 <span class="comment">     * be less than or equal to \ref max_entry_size.</span>
<a name="l02315"></a>02315 <span class="comment">     */</span>
<a name="l02316"></a>02316     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d4/df6/group___s_s_m_b_t_r_e_e.html#geb4a23f372a7aa3acf3e37cb7af8f1c6">create_assoc</a>(
<a name="l02317"></a>02317         <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>                   stid, 
<a name="l02318"></a>02318         <span class="keyword">const</span> <a class="code" href="../../d8/ddb/classvec__t.html">vec_t</a>&amp;             key, 
<a name="l02319"></a>02319         <span class="keyword">const</span> <a class="code" href="../../d8/ddb/classvec__t.html">vec_t</a>&amp;             el
<a name="l02320"></a>02320 #ifdef SM_DORA
<a name="l02321"></a>02321         , <span class="keyword">const</span> <span class="keywordtype">bool</span>             bIgnoreLocks = <span class="keyword">false</span>
<a name="l02322"></a>02322 #endif
<a name="l02323"></a>02323     );<span class="comment"></span>
<a name="l02324"></a>02324 <span class="comment">    /**\brief Remove an entry from a B+-Tree index.</span>
<a name="l02325"></a>02325 <span class="comment">     * If your index is non-unique (i.e., it may contain</span>
<a name="l02326"></a>02326 <span class="comment">     * multiple entries per key), use destroy_all_assoc.</span>
<a name="l02327"></a>02327 <span class="comment">     *</span>
<a name="l02328"></a>02328 <span class="comment">     * \ingroup SSMBTREE</span>
<a name="l02329"></a>02329 <span class="comment">     *</span>
<a name="l02330"></a>02330 <span class="comment">     * @param[in] stid  ID of the index. </span>
<a name="l02331"></a>02331 <span class="comment">     * @param[in] key   Key of the entry to be removed.</span>
<a name="l02332"></a>02332 <span class="comment">     * @param[in] el   Element (value) of the entry to be removed.</span>
<a name="l02333"></a>02333 <span class="comment">     */</span>
<a name="l02334"></a>02334     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d4/df6/group___s_s_m_b_t_r_e_e.html#g693ae9e22e6ff19608c737427f37c3e7">destroy_assoc</a>(
<a name="l02335"></a>02335         <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>                   stid, 
<a name="l02336"></a>02336         <span class="keyword">const</span> <a class="code" href="../../d8/ddb/classvec__t.html">vec_t</a>&amp;             key,
<a name="l02337"></a>02337         <span class="keyword">const</span> <a class="code" href="../../d8/ddb/classvec__t.html">vec_t</a>&amp;             el
<a name="l02338"></a>02338 #ifdef SM_DORA
<a name="l02339"></a>02339         , <span class="keyword">const</span> <span class="keywordtype">bool</span>             bIgnoreLocks = <span class="keyword">false</span>
<a name="l02340"></a>02340 #endif
<a name="l02341"></a>02341     );<span class="comment"></span>
<a name="l02342"></a>02342 <span class="comment">    /**\brief Destroy all entries associated with a key in a B+-Tree index.</span>
<a name="l02343"></a>02343 <span class="comment">     * \ingroup SSMBTREE</span>
<a name="l02344"></a>02344 <span class="comment">     *</span>
<a name="l02345"></a>02345 <span class="comment">     * @param[in] stid  ID of the index. </span>
<a name="l02346"></a>02346 <span class="comment">     * @param[in] key   Key of the entries to be removed.</span>
<a name="l02347"></a>02347 <span class="comment">     * @param[out] num_removed   The number of entries removed is returned here.</span>
<a name="l02348"></a>02348 <span class="comment">     */</span>
<a name="l02349"></a>02349     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d4/df6/group___s_s_m_b_t_r_e_e.html#ge2cd584f6f96cdda4d5f1f9698f11c87">destroy_all_assoc</a>(
<a name="l02350"></a>02350         <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>                  stid, 
<a name="l02351"></a>02351         <span class="keyword">const</span> <a class="code" href="../../d8/ddb/classvec__t.html">vec_t</a>&amp;            key,
<a name="l02352"></a>02352         <span class="keywordtype">int</span>&amp;                    num_removed
<a name="l02353"></a>02353     );<span class="comment"></span>
<a name="l02354"></a>02354 <span class="comment">    /**\brief Find an entry associated with a key in a B+-Tree index. </span>
<a name="l02355"></a>02355 <span class="comment">     * \ingroup SSMBTREE</span>
<a name="l02356"></a>02356 <span class="comment">     *</span>
<a name="l02357"></a>02357 <span class="comment">     * @param[in] stid  ID of the index. </span>
<a name="l02358"></a>02358 <span class="comment">     * @param[in] key   Key of the entries to be removed.</span>
<a name="l02359"></a>02359 <span class="comment">     * @param[out] el   Element associated with the given key will be copied into this buffer.</span>
<a name="l02360"></a>02360 <span class="comment">     * @param[in] elen Length of buffer into which the </span>
<a name="l02361"></a>02361 <span class="comment">     *                  result will be written. If too small, eRECWONTFIT will</span>
<a name="l02362"></a>02362 <span class="comment">     *                  be returned.</span>
<a name="l02363"></a>02363 <span class="comment">     *                 Length of result will be returned here.</span>
<a name="l02364"></a>02364 <span class="comment">     * @param[out] found   True if an entry is found.</span>
<a name="l02365"></a>02365 <span class="comment">     *</span>
<a name="l02366"></a>02366 <span class="comment">     * If the index is not unique (allows duplicates), the first</span>
<a name="l02367"></a>02367 <span class="comment">     * element found with the given key will be returned.</span>
<a name="l02368"></a>02368 <span class="comment">     *</span>
<a name="l02369"></a>02369 <span class="comment">     * To locate all entries associated with a non-unique key, you must</span>
<a name="l02370"></a>02370 <span class="comment">     * use scan_index_i, q.v.. </span>
<a name="l02371"></a>02371 <span class="comment">     */</span>
<a name="l02372"></a>02372     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d4/df6/group___s_s_m_b_t_r_e_e.html#g53f904bc1820680bdd05640ec4224d76">find_assoc</a>(
<a name="l02373"></a>02373         <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>                  stid, 
<a name="l02374"></a>02374         <span class="keyword">const</span> <a class="code" href="../../d8/ddb/classvec__t.html">vec_t</a>&amp;            key, 
<a name="l02375"></a>02375         <span class="keywordtype">void</span>*                   el, 
<a name="l02376"></a>02376         smsize_t&amp;               elen, 
<a name="l02377"></a>02377         <span class="keywordtype">bool</span>&amp;                   found
<a name="l02378"></a>02378 #ifdef SM_DORA
<a name="l02379"></a>02379         , <span class="keyword">const</span> <span class="keywordtype">bool</span>             bIgnoreLocks = <span class="keyword">false</span>
<a name="l02380"></a>02380 #endif
<a name="l02381"></a>02381     );
<a name="l02382"></a>02382 
<a name="l02383"></a>02383     <span class="comment">//</span>
<a name="l02384"></a>02384     <span class="comment">// Functions for R*tree (multi-dimensional(MD), spatial) Indexes</span>
<a name="l02385"></a>02385     <span class="comment">//</span>
<a name="l02386"></a>02386 <span class="comment"></span>
<a name="l02387"></a>02387 <span class="comment">    /**\addtogroup SSMRTREE </span>
<a name="l02388"></a>02388 <span class="comment">     *</span>
<a name="l02389"></a>02389 <span class="comment">     * An R-tree is a height-balanced structure designed for indexing</span>
<a name="l02390"></a>02390 <span class="comment">     * multi-dimensional spatial objects.  </span>
<a name="l02391"></a>02391 <span class="comment">     * It stores the minimial bounding box (with 2 or higher dimension) of </span>
<a name="l02392"></a>02392 <span class="comment">     * a spatial object as the key in the leaf pages.</span>
<a name="l02393"></a>02393 <span class="comment">     * This implementation is a variant of an R-Tree called an R*-Tree, which</span>
<a name="l02394"></a>02394 <span class="comment">     * improves the search performance by using a heuristic for redistributing</span>
<a name="l02395"></a>02395 <span class="comment">     * entries and dynamically reorganizing the tree during insertion.</span>
<a name="l02396"></a>02396 <span class="comment">     *</span>
<a name="l02397"></a>02397 <span class="comment">     * An R*-Tree stores key,value pairs where the key is of type nbox_t</span>
<a name="l02398"></a>02398 <span class="comment">     * and the value is of type vec_t.</span>
<a name="l02399"></a>02399 <span class="comment">     *</span>
<a name="l02400"></a>02400 <span class="comment">     * The number of key-value pairs an index can hold is limited by the space</span>
<a name="l02401"></a>02401 <span class="comment">     * available on the volume containing the index.</span>
<a name="l02402"></a>02402 <span class="comment">     * The minimum size of an R*-tree index is 8 pages.</span>
<a name="l02403"></a>02403 <span class="comment">     *</span>
<a name="l02404"></a>02404 <span class="comment">     * </span>
<a name="l02405"></a>02405 <span class="comment">     * \note This implementation </span>
<a name="l02406"></a>02406 <span class="comment">     * uses coarse-grained (index-level) locking and </span>
<a name="l02407"></a>02407 <span class="comment">     * supports only 2 dimensions and integer coordinates.</span>
<a name="l02408"></a>02408 <span class="comment">     * For information about R*-trees, see the \ref BKSS.</span>
<a name="l02409"></a>02409 <span class="comment">     *</span>
<a name="l02410"></a>02410 <span class="comment">     * Example:</span>
<a name="l02411"></a>02411 <span class="comment">     * \code</span>
<a name="l02412"></a>02412 <span class="comment">     scan_rt_i scan(idx, nbox_t::t_overlap, universe, true);</span>
<a name="l02413"></a>02413 <span class="comment">     bool      eof;</span>
<a name="l02414"></a>02414 <span class="comment">     nbox_t    k;</span>
<a name="l02415"></a>02415 <span class="comment">     char*     e;</span>
<a name="l02416"></a>02416 <span class="comment">     smsize_t  elen;</span>
<a name="l02417"></a>02417 <span class="comment"></span>
<a name="l02418"></a>02418 <span class="comment">     for(int i=0; </span>
<a name="l02419"></a>02419 <span class="comment">             (!(rc = scanp-&gt;next(k,e,elen,eof)).is_error() &amp;&amp; !eof);</span>
<a name="l02420"></a>02420 <span class="comment">             i++) ;</span>
<a name="l02421"></a>02421 <span class="comment">     cout &lt;&lt; "Rtree " &lt;&lt; idx &lt;&lt; " contains " &lt;&lt; i &lt;&lt; " entries." &lt;&lt; endl;</span>
<a name="l02422"></a>02422 <span class="comment">     \endcode</span>
<a name="l02423"></a>02423 <span class="comment">     * </span>
<a name="l02424"></a>02424 <span class="comment">     *</span>
<a name="l02425"></a>02425 <span class="comment">     * \section XXXX2 Bulk Loading </span>
<a name="l02426"></a>02426 <span class="comment">     * Bulk-loading of all index types is supported. See \ref SSMBULKLD.</span>
<a name="l02427"></a>02427 <span class="comment">     */</span>
<a name="l02428"></a>02428      <span class="comment">/*\example rtree_example.cpp*/</span>
<a name="l02429"></a>02429 
<a name="l02430"></a>02430 <span class="comment"></span>
<a name="l02431"></a>02431 <span class="comment">    /**\brief Create an R*-Tree (multi-dimensional spatial) index.</span>
<a name="l02432"></a>02432 <span class="comment">     * The storage manager does not provide</span>
<a name="l02433"></a>02433 <span class="comment">     * complete support for non-unique multidimensional indexes.</span>
<a name="l02434"></a>02434 <span class="comment">     * While you may insert multiple (distinct) entries for the same key in </span>
<a name="l02435"></a>02435 <span class="comment">     * a multi-dimensional index, you will not be able to use them; only</span>
<a name="l02436"></a>02436 <span class="comment">     * the first can be retrieved.  </span>
<a name="l02437"></a>02437 <span class="comment">     * \ingroup SSMRTREE</span>
<a name="l02438"></a>02438 <span class="comment">     * @param[in] vid   Volume on which to create the index.</span>
<a name="l02439"></a>02439 <span class="comment">     * @param[in] ntype   Type of index. Legitimate values are: </span>
<a name="l02440"></a>02440 <span class="comment">     *  - t_rtree : R*-Tree </span>
<a name="l02441"></a>02441 <span class="comment">     * @param[in] property Logging level of store. Legitimate values are:</span>
<a name="l02442"></a>02442 <span class="comment">     *  - t_temporary</span>
<a name="l02443"></a>02443 <span class="comment">     *  - t_regular</span>
<a name="l02444"></a>02444 <span class="comment">     *  - t_load_file</span>
<a name="l02445"></a>02445 <span class="comment">     *  - t_insert_file</span>
<a name="l02446"></a>02446 <span class="comment">     *  See sm_store_property_t for details.</span>
<a name="l02447"></a>02447 <span class="comment">     * @param[in] dim Number of dimensions of the key.</span>
<a name="l02448"></a>02448 <span class="comment">     * They key type is an nbox_t.</span>
<a name="l02449"></a>02449 <span class="comment">     * See \ref nbox_t for details. </span>
<a name="l02450"></a>02450 <span class="comment">     * @param[out] stid New store ID will be returned here.</span>
<a name="l02451"></a>02451 <span class="comment">     */</span>
<a name="l02452"></a>02452     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d0/d7d/group___s_s_m_r_t_r_e_e.html#g4dc01416311533a4a546b66328bf802f">create_md_index</a>(
<a name="l02453"></a>02453         <a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a>                   vid, 
<a name="l02454"></a>02454         <a class="code" href="../../da/d44/classss__m.html#901caa62fd2c03e33bec050c30dd828b">ndx_t</a>                   ntype, 
<a name="l02455"></a>02455         <a class="code" href="../../da/d44/classss__m.html#a7a0a9b5677337b6d5a4e3f42d9fa149">store_property_t</a>        property,
<a name="l02456"></a>02456         <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;                 stid, 
<a name="l02457"></a>02457         int2_t                  dim = 2
<a name="l02458"></a>02458     );
<a name="l02459"></a>02459 <span class="comment"></span>
<a name="l02460"></a>02460 <span class="comment">    /**\brief Destroy an R*-Tree index.</span>
<a name="l02461"></a>02461 <span class="comment">     * \ingroup SSMRTREE</span>
<a name="l02462"></a>02462 <span class="comment">     *</span>
<a name="l02463"></a>02463 <span class="comment">     * @param[in] iid  ID of the index to be destroyed.</span>
<a name="l02464"></a>02464 <span class="comment">     */</span>
<a name="l02465"></a>02465     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d0/d7d/group___s_s_m_r_t_r_e_e.html#g1eca28c45832a08e8492f38f57b16d4c">destroy_md_index</a>(<span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp; iid);
<a name="l02466"></a>02466 <span class="comment"></span>
<a name="l02467"></a>02467 <span class="comment">    /**\brief Bulk-load a multi-dimensional index from multiple sources.</span>
<a name="l02468"></a>02468 <span class="comment">     * \ingroup SSMBULKLD</span>
<a name="l02469"></a>02469 <span class="comment">     * @param[in] stid  ID of the index to be loaded.</span>
<a name="l02470"></a>02470 <span class="comment">     * @param[in] nsrcs  Number of files used for data sources.</span>
<a name="l02471"></a>02471 <span class="comment">     * @param[in] source  Array of IDs of files used for data sources.</span>
<a name="l02472"></a>02472 <span class="comment">     * @param[out] stats  Statistics concerning the load activity will be</span>
<a name="l02473"></a>02473 <span class="comment">     *                     written here.</span>
<a name="l02474"></a>02474 <span class="comment">     * @param[in] hff   Heuristic fill factor. Not used.</span>
<a name="l02475"></a>02475 <span class="comment">     * @param[in] hef   Heuristic expansion factor. Not used.</span>
<a name="l02476"></a>02476 <span class="comment">     * @param[in] universe  Universal bounding box of all spatial objects indexed.</span>
<a name="l02477"></a>02477 <span class="comment">    */</span>
<a name="l02478"></a>02478     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d6/d82/group___s_s_m_b_u_l_k_l_d.html#g9b77fb1e5d190ae8391c59a4bddb06c7">bulkld_md_index</a>(
<a name="l02479"></a>02479         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;             stid, 
<a name="l02480"></a>02480         <span class="keywordtype">int</span>                       nsrcs,
<a name="l02481"></a>02481         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>*             source, 
<a name="l02482"></a>02482         sm_du_stats_t&amp;            stats,
<a name="l02483"></a>02483         int2_t                    hff=75,
<a name="l02484"></a>02484         int2_t                    hef=120,
<a name="l02485"></a>02485         <a class="code" href="../../d2/dd1/classnbox__t.html">nbox_t</a>*                   universe=NULL);
<a name="l02486"></a>02486 <span class="comment"></span>
<a name="l02487"></a>02487 <span class="comment">    /**\brief Bulk-load a multi-dimensional index from a single source.</span>
<a name="l02488"></a>02488 <span class="comment">     * The storage manager does not provide</span>
<a name="l02489"></a>02489 <span class="comment">     * complete support for non-unique multidimensional indexes.</span>
<a name="l02490"></a>02490 <span class="comment">     * While you may insert multiple (distinct) entries for the same key in </span>
<a name="l02491"></a>02491 <span class="comment">     * a multi-dimensional index, you will not be able to use them; only</span>
<a name="l02492"></a>02492 <span class="comment">     * the first can be retrieved.  </span>
<a name="l02493"></a>02493 <span class="comment">     * \ingroup SSMBULKLD</span>
<a name="l02494"></a>02494 <span class="comment">     * @param[in] stid  ID of the index to be loaded.</span>
<a name="l02495"></a>02495 <span class="comment">     * @param[in] source  ID of file to be used for data source.</span>
<a name="l02496"></a>02496 <span class="comment">     * @param[out] stats  Statistics concerning the load activity will be</span>
<a name="l02497"></a>02497 <span class="comment">     *                     written here.</span>
<a name="l02498"></a>02498 <span class="comment">     * @param[in] hff   Heuristic fill factor. Not used.</span>
<a name="l02499"></a>02499 <span class="comment">     * @param[in] hef   Heuristic expansion factor. Not used.</span>
<a name="l02500"></a>02500 <span class="comment">     * @param[in] universe  Universal bounding box of all spatial objects indexed.</span>
<a name="l02501"></a>02501 <span class="comment">    */</span>
<a name="l02502"></a>02502     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d6/d82/group___s_s_m_b_u_l_k_l_d.html#g9b77fb1e5d190ae8391c59a4bddb06c7">bulkld_md_index</a>(
<a name="l02503"></a>02503         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;             stid, 
<a name="l02504"></a>02504         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;             source, 
<a name="l02505"></a>02505         sm_du_stats_t&amp;            stats,
<a name="l02506"></a>02506         int2_t                    hff=75,
<a name="l02507"></a>02507         int2_t                    hef=120,
<a name="l02508"></a>02508         <a class="code" href="../../d2/dd1/classnbox__t.html">nbox_t</a>*                   universe=NULL);
<a name="l02509"></a>02509 <span class="comment"></span>
<a name="l02510"></a>02510 <span class="comment">    /**\brief Bulk-load a multi-dimensional index from a sorted stream source.</span>
<a name="l02511"></a>02511 <span class="comment">     * The storage manager does not provide</span>
<a name="l02512"></a>02512 <span class="comment">     * complete support for non-unique multidimensional indexes.</span>
<a name="l02513"></a>02513 <span class="comment">     * While you may insert multiple (distinct) entries for the same key in </span>
<a name="l02514"></a>02514 <span class="comment">     * a multi-dimensional index, you will not be able to use them; only</span>
<a name="l02515"></a>02515 <span class="comment">     * the first can be retrieved.  </span>
<a name="l02516"></a>02516 <span class="comment">     * \ingroup SSMBULKLD</span>
<a name="l02517"></a>02517 <span class="comment">     * @param[in] stid  ID of the index to be loaded.</span>
<a name="l02518"></a>02518 <span class="comment">     * @param[in] sorted_stream  Input stream that is data source.</span>
<a name="l02519"></a>02519 <span class="comment">     * @param[out] stats  Statistics concerning the load activity will be</span>
<a name="l02520"></a>02520 <span class="comment">     *                     written here.</span>
<a name="l02521"></a>02521 <span class="comment">     * @param[in] hff   Heuristic fill factor. Not used.</span>
<a name="l02522"></a>02522 <span class="comment">     * @param[in] hef   Heuristic expansion factor. Not used.</span>
<a name="l02523"></a>02523 <span class="comment">     * @param[in] universe  Universal bounding box of all spatial objects indexed.</span>
<a name="l02524"></a>02524 <span class="comment">    */</span>
<a name="l02525"></a>02525     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d6/d82/group___s_s_m_b_u_l_k_l_d.html#g9b77fb1e5d190ae8391c59a4bddb06c7">bulkld_md_index</a>(
<a name="l02526"></a>02526         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;             stid, 
<a name="l02527"></a>02527         <a class="code" href="../../da/d1c/classsort__stream__i.html">sort_stream_i</a>&amp;            sorted_stream,
<a name="l02528"></a>02528         sm_du_stats_t&amp;            stats,
<a name="l02529"></a>02529         int2_t                    hff=75,
<a name="l02530"></a>02530         int2_t                    hef=120,
<a name="l02531"></a>02531         <a class="code" href="../../d2/dd1/classnbox__t.html">nbox_t</a>*                   universe=NULL);
<a name="l02532"></a>02532 <span class="comment"></span>
<a name="l02533"></a>02533 <span class="comment">    /**\brief Print a representation of the rtree.</span>
<a name="l02534"></a>02534 <span class="comment">     * \ingroup SSMRTREE</span>
<a name="l02535"></a>02535 <span class="comment">     * @param[in] stid  ID of the index to be printed.</span>
<a name="l02536"></a>02536 <span class="comment">     * @param[in] out   I/O stream to which to write the output.</span>
<a name="l02537"></a>02537 <span class="comment">    */</span>
<a name="l02538"></a>02538     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d0/d7d/group___s_s_m_r_t_r_e_e.html#g8ac7592dbed365681951ff23c2c09fe1">print_md_index</a>(<a class="code" href="../../da/d5b/structstid__t.html">stid_t</a> stid, ostream &amp;out);
<a name="l02539"></a>02539 <span class="comment"></span>
<a name="l02540"></a>02540 <span class="comment">    /**\brief Look up an entry in a multi-dimensional index.</span>
<a name="l02541"></a>02541 <span class="comment">     * \ingroup SSMRTREE</span>
<a name="l02542"></a>02542 <span class="comment">     *</span>
<a name="l02543"></a>02543 <span class="comment">     * @param[in] stid  ID of the index. </span>
<a name="l02544"></a>02544 <span class="comment">     * @param[in] key   Key associated with the entry to look up.</span>
<a name="l02545"></a>02545 <span class="comment">     * @param[out] el   Element associated with the given key will be copied into this buffer.</span>
<a name="l02546"></a>02546 <span class="comment">     * @param[in] elen Length of buffer into which the </span>
<a name="l02547"></a>02547 <span class="comment">     *                  result will be written. If too small, eRECWONTFIT will</span>
<a name="l02548"></a>02548 <span class="comment">     *                  be returned.</span>
<a name="l02549"></a>02549 <span class="comment">     *                 Length of result will be returned here.</span>
<a name="l02550"></a>02550 <span class="comment">     * @param[out] found   True if an entry is found.</span>
<a name="l02551"></a>02551 <span class="comment">     *</span>
<a name="l02552"></a>02552 <span class="comment">     * If the index is not unique (allows duplicates), the first</span>
<a name="l02553"></a>02553 <span class="comment">     * element found with the given key will be returned.</span>
<a name="l02554"></a>02554 <span class="comment">     *</span>
<a name="l02555"></a>02555 <span class="comment">     * The storage manager does not provide a method to locate all </span>
<a name="l02556"></a>02556 <span class="comment">     * entries associated with a non-unique key.</span>
<a name="l02557"></a>02557 <span class="comment">     */</span>
<a name="l02558"></a>02558     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d0/d7d/group___s_s_m_r_t_r_e_e.html#gac4dd2a9858a855723bbe6f6ef065f6e">find_md_assoc</a>(
<a name="l02559"></a>02559         <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>                    stid, 
<a name="l02560"></a>02560         <span class="keyword">const</span> <a class="code" href="../../d2/dd1/classnbox__t.html">nbox_t</a>&amp;             key, 
<a name="l02561"></a>02561         <span class="keywordtype">void</span>*                     el, 
<a name="l02562"></a>02562         smsize_t&amp;                 elen, 
<a name="l02563"></a>02563         <span class="keywordtype">bool</span>&amp;                     found);
<a name="l02564"></a>02564 <span class="comment"></span>
<a name="l02565"></a>02565 <span class="comment">    /**\brief Create an entry in a multi-dimensional index.</span>
<a name="l02566"></a>02566 <span class="comment">     * The storage manager does not provide</span>
<a name="l02567"></a>02567 <span class="comment">     * complete support for non-unique multidimensional indexes.</span>
<a name="l02568"></a>02568 <span class="comment">     * While you may insert multiple (distinct) entries for the same key in </span>
<a name="l02569"></a>02569 <span class="comment">     * a multi-dimensional index, you will not be able to use them; only</span>
<a name="l02570"></a>02570 <span class="comment">     * the first can be retrieved.  </span>
<a name="l02571"></a>02571 <span class="comment">     * \ingroup SSMRTREE</span>
<a name="l02572"></a>02572 <span class="comment">     *</span>
<a name="l02573"></a>02573 <span class="comment">     * @param[in] stid  ID of the index. </span>
<a name="l02574"></a>02574 <span class="comment">     * @param[in] key  Key for the association to be created.</span>
<a name="l02575"></a>02575 <span class="comment">     * @param[in] el  Element for the association to be created.</span>
<a name="l02576"></a>02576 <span class="comment">    */</span>
<a name="l02577"></a>02577     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d0/d7d/group___s_s_m_r_t_r_e_e.html#g5230e9def9f2f2d295bf2dc5410fc03e">create_md_assoc</a>(
<a name="l02578"></a>02578         <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>                    stid, 
<a name="l02579"></a>02579         <span class="keyword">const</span> <a class="code" href="../../d2/dd1/classnbox__t.html">nbox_t</a>&amp;             key,
<a name="l02580"></a>02580         <span class="keyword">const</span> <a class="code" href="../../d8/ddb/classvec__t.html">vec_t</a>&amp;              el);
<a name="l02581"></a>02581 <span class="comment"></span>
<a name="l02582"></a>02582 <span class="comment">    /**\brief Destroy an entry in a multi-dimensional index.</span>
<a name="l02583"></a>02583 <span class="comment">     * \ingroup SSMRTREE</span>
<a name="l02584"></a>02584 <span class="comment">     *</span>
<a name="l02585"></a>02585 <span class="comment">     * @param[in] stid  ID of the index. </span>
<a name="l02586"></a>02586 <span class="comment">     * @param[in] key   Key of the entry to be removed.</span>
<a name="l02587"></a>02587 <span class="comment">     * @param[in] el   Element (value) of the entry to be removed.</span>
<a name="l02588"></a>02588 <span class="comment">    */</span>
<a name="l02589"></a>02589     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d0/d7d/group___s_s_m_r_t_r_e_e.html#g6e08bebf1981995a5c62766e57307707">destroy_md_assoc</a>(
<a name="l02590"></a>02590         <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>                    stid, 
<a name="l02591"></a>02591         <span class="keyword">const</span> <a class="code" href="../../d2/dd1/classnbox__t.html">nbox_t</a>&amp;             key,
<a name="l02592"></a>02592         <span class="keyword">const</span> <a class="code" href="../../d8/ddb/classvec__t.html">vec_t</a>&amp;              el);
<a name="l02593"></a>02593 <span class="comment"></span>
<a name="l02594"></a>02594 <span class="comment">    /**\cond skip */</span>
<a name="l02595"></a>02595     <span class="comment">// for debugging</span>
<a name="l02596"></a>02596     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            draw_rtree(<span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp; stid, ostream &amp;);<span class="comment"></span>
<a name="l02597"></a>02597 <span class="comment">    /**\endcond skip */</span>
<a name="l02598"></a>02598 <span class="comment"></span>
<a name="l02599"></a>02599 <span class="comment">    /**\brief Gather usage statistics about an R*-Tree index.</span>
<a name="l02600"></a>02600 <span class="comment">     * \ingroup SSMRTREE</span>
<a name="l02601"></a>02601 <span class="comment">     * @param[in] stid  ID of the index. </span>
<a name="l02602"></a>02602 <span class="comment">     * @param[out] stat  Usage statistics will be written here.</span>
<a name="l02603"></a>02603 <span class="comment">     * @param[in] size  Number of uint2_t's in the array ovp.</span>
<a name="l02604"></a>02604 <span class="comment">     * @param[out] ovp   Pre-allocated array of integers into which</span>
<a name="l02605"></a>02605 <span class="comment">     * the method will write the overlap percentages for each level of the</span>
<a name="l02606"></a>02606 <span class="comment">     * tree.</span>
<a name="l02607"></a>02607 <span class="comment">     * @param[in] audit If "true", the method </span>
<a name="l02608"></a>02608 <span class="comment">     * will check assertions about the</span>
<a name="l02609"></a>02609 <span class="comment">     * correctness of the rtree.</span>
<a name="l02610"></a>02610 <span class="comment">     * If the audit fails an internal fatal error is generated </span>
<a name="l02611"></a>02611 <span class="comment">     * to facilitate debugging. (It will generate a core file if your</span>
<a name="l02612"></a>02612 <span class="comment">     * shell permits such.)</span>
<a name="l02613"></a>02613 <span class="comment">     *</span>
<a name="l02614"></a>02614 <span class="comment">     * \note for debugging</span>
<a name="l02615"></a>02615 <span class="comment">    */</span>
<a name="l02616"></a>02616     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d0/d7d/group___s_s_m_r_t_r_e_e.html#g7fece7de8cd58a13b730f0d03d4eb43e">rtree_stats</a>(
<a name="l02617"></a>02617         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;             stid,
<a name="l02618"></a>02618         rtree_stats_t&amp;            stat,
<a name="l02619"></a>02619         uint2_t                   size = 0,
<a name="l02620"></a>02620         uint2_t*                  ovp = NULL,
<a name="l02621"></a>02621         <span class="keywordtype">bool</span>                      audit = <span class="keyword">false</span>);
<a name="l02622"></a>02622 <span class="comment"></span>
<a name="l02623"></a>02623 <span class="comment">    /**\addtogroup SSMFILE </span>
<a name="l02624"></a>02624 <span class="comment">     * You can create, destroy, and scan files of records. You may exert some</span>
<a name="l02625"></a>02625 <span class="comment">     * control over the order in which records appear in the file (a physical</span>
<a name="l02626"></a>02626 <span class="comment">     * scan), but, in general, the storage manager decides where to put records.</span>
<a name="l02627"></a>02627 <span class="comment">     *</span>
<a name="l02628"></a>02628 <span class="comment">     * Pages in a file are slotted pages: Each page contains an array of</span>
<a name="l02629"></a>02629 <span class="comment">     * slots.</span>
<a name="l02630"></a>02630 <span class="comment">     * Records take one of three forms: small, large, and very large.</span>
<a name="l02631"></a>02631 <span class="comment">     * - Small records fit in the slots on the file pages.</span>
<a name="l02632"></a>02632 <span class="comment">     * - Large records are too big to fit on a slotted page, so they are put</span>
<a name="l02633"></a>02633 <span class="comment">     * elsewhere, and the slots point to these records.  Actually, what is</span>
<a name="l02634"></a>02634 <span class="comment">     * in a slot is a small array of page pointers to the data of the large record.</span>
<a name="l02635"></a>02635 <span class="comment">     * - A very large record is one whose slot in the file page contains</span>
<a name="l02636"></a>02636 <span class="comment">     *   a single reference to a page that is an index of data pages.</span>
<a name="l02637"></a>02637 <span class="comment">     *</span>
<a name="l02638"></a>02638 <span class="comment">     * Because records may take these forms, the API for creating records</span>
<a name="l02639"></a>02639 <span class="comment">     * contains the opportunity for you to provide a hint about the ultimate</span>
<a name="l02640"></a>02640 <span class="comment">     * size of the record so that the storage manager can create the proper</span>
<a name="l02641"></a>02641 <span class="comment">     * structure for the record immediately, rather than creating a small</span>
<a name="l02642"></a>02642 <span class="comment">     * record that is soon to be converted to a large, then a very large record</span>
<a name="l02643"></a>02643 <span class="comment">     * by subsequent appends. </span>
<a name="l02644"></a>02644 <span class="comment">     *</span>
<a name="l02645"></a>02645 <span class="comment">     * All records contain a client-defined header.  This is for the convenience</span>
<a name="l02646"></a>02646 <span class="comment">     * of server-writers.  The header must fit on the slotted page, so it should</span>
<a name="l02647"></a>02647 <span class="comment">     * never be very large.</span>
<a name="l02648"></a>02648 <span class="comment">     *</span>
<a name="l02649"></a>02649 <span class="comment">     * The following methods manipulate files of records and the records found </span>
<a name="l02650"></a>02650 <span class="comment">     * there.</span>
<a name="l02651"></a>02651 <span class="comment">     *</span>
<a name="l02652"></a>02652 <span class="comment">     * Modules below describe file traversal and</span>
<a name="l02653"></a>02653 <span class="comment">     * appending to files (\ref SSMSCANF), </span>
<a name="l02654"></a>02654 <span class="comment">     * and pinning individual records in the buffer pool for extended operations </span>
<a name="l02655"></a>02655 <span class="comment">     * (\ref SSMPIN).</span>
<a name="l02656"></a>02656 <span class="comment">     *</span>
<a name="l02657"></a>02657 <span class="comment">     * \section UNINIT Uninitialized Data</span>
<a name="l02658"></a>02658 <span class="comment">     * The functions create_rec, append_rec, and update_rec can be used to</span>
<a name="l02659"></a>02659 <span class="comment">     * write blocks of data that are all zeroes,  with minimal logging. </span>
<a name="l02660"></a>02660 <span class="comment">     * This is useful for creating records of known size but with uninitialized data.  </span>
<a name="l02661"></a>02661 <span class="comment">     * The type zvec_t, a special case of vec_t, is for this purpose. </span>
<a name="l02662"></a>02662 <span class="comment">     * Construct it with only a size, as follows:</span>
<a name="l02663"></a>02663 <span class="comment">     * \code</span>
<a name="l02664"></a>02664 <span class="comment">     * zvec_t zdata(100000);</span>
<a name="l02665"></a>02665 <span class="comment">     * \endcode</span>
<a name="l02666"></a>02666 <span class="comment">     * The underlying logging code recognizes that this is a vector of zeroes and</span>
<a name="l02667"></a>02667 <span class="comment">     * logs only a count, not the data themselves. </span>
<a name="l02668"></a>02668 <span class="comment">     *</span>
<a name="l02669"></a>02669 <span class="comment">     * \section Errors</span>
<a name="l02670"></a>02670 <span class="comment">     * If an error occurs in the middle of one of these methods that is updating persistent data,</span>
<a name="l02671"></a>02671 <span class="comment">     * the record or file \e could be in an inconsistent state. </span>
<a name="l02672"></a>02672 <span class="comment">     * The caller has the choice of aborting the transaction or rolling back to the nearest savepoint (see \ref SSMXCT).</span>
<a name="l02673"></a>02673 <span class="comment">     *</span>
<a name="l02674"></a>02674 <span class="comment">     * \sa SSMSCAN, SSMPIN, vec_t, zvec_t, IDs.</span>
<a name="l02675"></a>02675 <span class="comment">     */</span>
<a name="l02676"></a>02676     <span class="comment"></span>
<a name="l02677"></a>02677 <span class="comment">    /**\brief Create a file of records.</span>
<a name="l02678"></a>02678 <span class="comment">     * \ingroup SSMFILE</span>
<a name="l02679"></a>02679 <span class="comment">     * \details</span>
<a name="l02680"></a>02680 <span class="comment">     * @param[in] vid   Volume on which to create a file.</span>
<a name="l02681"></a>02681 <span class="comment">     * @param[out] fid  Returns (store) ID of the new file here.</span>
<a name="l02682"></a>02682 <span class="comment">     * @param[in] property Give the file the this property.</span>
<a name="l02683"></a>02683 <span class="comment">     * @param[in] cluster_hint Not used. </span>
<a name="l02684"></a>02684 <span class="comment">     *</span>
<a name="l02685"></a>02685 <span class="comment">     * The cluster hint is included in the API for future use. </span>
<a name="l02686"></a>02686 <span class="comment">     * It has no effect.</span>
<a name="l02687"></a>02687 <span class="comment">     */</span>
<a name="l02688"></a>02688     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d8/db0/group___s_s_m_f_i_l_e.html#gd35373a32c3480b5437e7d602065d6e5">create_file</a>( 
<a name="l02689"></a>02689         <a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a>                   vid, 
<a name="l02690"></a>02690         <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;                 fid,
<a name="l02691"></a>02691         <a class="code" href="../../da/d44/classss__m.html#a7a0a9b5677337b6d5a4e3f42d9fa149">store_property_t</a>        property,
<a name="l02692"></a>02692         shpid_t                 cluster_hint = 0
<a name="l02693"></a>02693     ); 
<a name="l02694"></a>02694 <span class="comment"></span>
<a name="l02695"></a>02695 <span class="comment">    /**\brief Destroy a file of records.</span>
<a name="l02696"></a>02696 <span class="comment">     * \ingroup SSMFILE</span>
<a name="l02697"></a>02697 <span class="comment">     * \details</span>
<a name="l02698"></a>02698 <span class="comment">     * @param[in] fid  ID of the file to destroy.</span>
<a name="l02699"></a>02699 <span class="comment">     */</span>
<a name="l02700"></a>02700     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d8/db0/group___s_s_m_f_i_l_e.html#gf95f62e06fea7149fd0503a194c7a548">destroy_file</a>(<span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp; fid); 
<a name="l02701"></a>02701 <span class="comment"></span>
<a name="l02702"></a>02702 <span class="comment">    /**\brief Create a new record.</span>
<a name="l02703"></a>02703 <span class="comment">     * \ingroup SSMFILE</span>
<a name="l02704"></a>02704 <span class="comment">     * \details</span>
<a name="l02705"></a>02705 <span class="comment">     * @param[in] fid  ID of the file in which to create a record.</span>
<a name="l02706"></a>02706 <span class="comment">     * @param[in] hdr  What to put in the record's header.</span>
<a name="l02707"></a>02707 <span class="comment">     * @param[in] len_hint  Hint about how big the record will ultimately be.</span>
<a name="l02708"></a>02708 <span class="comment">     * This is used to determine the initial format of the record. If you plan</span>
<a name="l02709"></a>02709 <span class="comment">     * to append to the record and know that it will ultimately become a large</span>
<a name="l02710"></a>02710 <span class="comment">     * record, it is more efficient to give a size hint that is larger than</span>
<a name="l02711"></a>02711 <span class="comment">     * a page here. Otherwise, the record will be made small (as determined by</span>
<a name="l02712"></a>02712 <span class="comment">     * the size of the parameter \a data ), and subsequent appends will cause </span>
<a name="l02713"></a>02713 <span class="comment">     * the record to be converted to a large record.</span>
<a name="l02714"></a>02714 <span class="comment">     * @param[in] data  What to put in the record's body. </span>
<a name="l02715"></a>02715 <span class="comment">     * @param[out] new_rid  ID of the newly created record.</span>
<a name="l02716"></a>02716 <span class="comment">     * @param[in] policy  File compaction policy to use. See \ref pg_policy_t</span>
<a name="l02717"></a>02717 <span class="comment">     * for possible values.</span>
<a name="l02718"></a>02718 <span class="comment">     */</span>
<a name="l02719"></a>02719     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d8/db0/group___s_s_m_f_i_l_e.html#gdbce031cbb0a1e53741a43a536c3f1c9">create_rec</a>(
<a name="l02720"></a>02720         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;            fid, 
<a name="l02721"></a>02721         <span class="keyword">const</span> <a class="code" href="../../d8/ddb/classvec__t.html">vec_t</a>&amp;             hdr, 
<a name="l02722"></a>02722         smsize_t                 len_hint, 
<a name="l02723"></a>02723         <span class="keyword">const</span> <a class="code" href="../../d8/ddb/classvec__t.html">vec_t</a>&amp;             data, 
<a name="l02724"></a>02724         <a class="code" href="../../d7/df5/classrid__t.html">rid_t</a>&amp;                   new_rid,
<a name="l02725"></a>02725 #ifdef SM_DORA
<a name="l02726"></a>02726         <span class="keyword">const</span> <span class="keywordtype">bool</span>               bIgnoreLocks = <span class="keyword">false</span>,
<a name="l02727"></a>02727 #endif
<a name="l02728"></a>02728         uint4_t                  policy = t_cache | t_compact | t_append
<a name="l02729"></a>02729     ); 
<a name="l02730"></a>02730 <span class="comment"></span>
<a name="l02731"></a>02731 <span class="comment">    /**\brief Destroy a record.</span>
<a name="l02732"></a>02732 <span class="comment">     * \ingroup SSMFILE</span>
<a name="l02733"></a>02733 <span class="comment">     * \details</span>
<a name="l02734"></a>02734 <span class="comment">     * @param[in] rid  ID of the record to destroy.</span>
<a name="l02735"></a>02735 <span class="comment">     */</span>
<a name="l02736"></a>02736     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d8/db0/group___s_s_m_f_i_l_e.html#g5ff61de1252e8429d60c0eb997854649">destroy_rec</a>(<span class="keyword">const</span> <a class="code" href="../../d7/df5/classrid__t.html">rid_t</a>&amp; rid
<a name="l02737"></a>02737 #ifdef SM_DORA
<a name="l02738"></a>02738         , <span class="keyword">const</span> <span class="keywordtype">bool</span>             bIgnoreLocks = <span class="keyword">false</span>
<a name="l02739"></a>02739 #endif
<a name="l02740"></a>02740                                        );
<a name="l02741"></a>02741 <span class="comment"></span>
<a name="l02742"></a>02742 <span class="comment">    /**\brief Modify the body of an existing record.</span>
<a name="l02743"></a>02743 <span class="comment">     * \ingroup SSMFILE</span>
<a name="l02744"></a>02744 <span class="comment">     * \details</span>
<a name="l02745"></a>02745 <span class="comment">     * @param[in] rid  ID of the record to modify.</span>
<a name="l02746"></a>02746 <span class="comment">     * @param[in] start  First byte to change.</span>
<a name="l02747"></a>02747 <span class="comment">     * @param[in] data  What to put in the record's body.  </span>
<a name="l02748"></a>02748 <span class="comment">     *</span>
<a name="l02749"></a>02749 <span class="comment">     * This overwrites</span>
<a name="l02750"></a>02750 <span class="comment">     * the existing bytes, starting at the offset \a start through the</span>
<a name="l02751"></a>02751 <span class="comment">     * byte at \a start + \a data.size().</span>
<a name="l02752"></a>02752 <span class="comment">     * This method \b cannot \b be \b used to change the size of a record.</span>
<a name="l02753"></a>02753 <span class="comment">     * Attempting this will result in an error.</span>
<a name="l02754"></a>02754 <span class="comment">     */</span>
<a name="l02755"></a>02755     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d8/db0/group___s_s_m_f_i_l_e.html#g4d13fe9309464735e9e70272f19d59b7">update_rec</a>(
<a name="l02756"></a>02756         <span class="keyword">const</span> <a class="code" href="../../d7/df5/classrid__t.html">rid_t</a>&amp;             rid, 
<a name="l02757"></a>02757         smsize_t                 start, 
<a name="l02758"></a>02758         <span class="keyword">const</span> <a class="code" href="../../d8/ddb/classvec__t.html">vec_t</a>&amp;             data);
<a name="l02759"></a>02759 <span class="comment"></span>
<a name="l02760"></a>02760 <span class="comment">    /**\brief Modify the header of an existing record.</span>
<a name="l02761"></a>02761 <span class="comment">     * \ingroup SSMFILE</span>
<a name="l02762"></a>02762 <span class="comment">     * \details</span>
<a name="l02763"></a>02763 <span class="comment">     * @param[in] rid  ID of the record to modify.</span>
<a name="l02764"></a>02764 <span class="comment">     * @param[in] start  First byte to change.</span>
<a name="l02765"></a>02765 <span class="comment">     * @param[in] hdr  What to put in the record's header.  </span>
<a name="l02766"></a>02766 <span class="comment">     *</span>
<a name="l02767"></a>02767 <span class="comment">     * This overwrites</span>
<a name="l02768"></a>02768 <span class="comment">     * the existing bytes, starting at the offset \a start through the</span>
<a name="l02769"></a>02769 <span class="comment">     * byte at \a start + \a data.size().</span>
<a name="l02770"></a>02770 <span class="comment">     * This method \b cannot \b be \b used to change the size of a record</span>
<a name="l02771"></a>02771 <span class="comment">     * header. There are no methods for appending to or truncating a</span>
<a name="l02772"></a>02772 <span class="comment">     * record header.</span>
<a name="l02773"></a>02773 <span class="comment">     *</span>
<a name="l02774"></a>02774 <span class="comment">     * \sa pin_i::update_rec, \ref SSMPIN</span>
<a name="l02775"></a>02775 <span class="comment">     */</span>
<a name="l02776"></a>02776     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d8/db0/group___s_s_m_f_i_l_e.html#g959214374f6bc2cc288a0bb5e1aedf5e">update_rec_hdr</a>(
<a name="l02777"></a>02777         <span class="keyword">const</span> <a class="code" href="../../d7/df5/classrid__t.html">rid_t</a>&amp;             rid, 
<a name="l02778"></a>02778         smsize_t                 start, 
<a name="l02779"></a>02779         <span class="keyword">const</span> <a class="code" href="../../d8/ddb/classvec__t.html">vec_t</a>&amp;             hdr);
<a name="l02780"></a>02780     <span class="comment">// see also pin_i::update_rec*()</span>
<a name="l02781"></a>02781 <span class="comment"></span>
<a name="l02782"></a>02782 <span class="comment">    /**\brief Append bytes to a record body.</span>
<a name="l02783"></a>02783 <span class="comment">     * \ingroup SSMFILE</span>
<a name="l02784"></a>02784 <span class="comment">     * \details</span>
<a name="l02785"></a>02785 <span class="comment">     * @param[in] rid  ID of the record to modify.</span>
<a name="l02786"></a>02786 <span class="comment">     * @param[in] data  What to append to the record.</span>
<a name="l02787"></a>02787 <span class="comment">     *</span>
<a name="l02788"></a>02788 <span class="comment">     * \note This appends \b to a record; it does \b not append a record to a file!</span>
<a name="l02789"></a>02789 <span class="comment">     * \sa pin_i::append_rec, \ref SSMPIN</span>
<a name="l02790"></a>02790 <span class="comment">     */</span>
<a name="l02791"></a>02791     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d8/db0/group___s_s_m_f_i_l_e.html#gc0a68cce342341fb85880207d548fa6d">append_rec</a>(
<a name="l02792"></a>02792         <span class="keyword">const</span> <a class="code" href="../../d7/df5/classrid__t.html">rid_t</a>&amp;             rid, 
<a name="l02793"></a>02793         <span class="keyword">const</span> <a class="code" href="../../d8/ddb/classvec__t.html">vec_t</a>&amp;             data
<a name="l02794"></a>02794                 );
<a name="l02795"></a>02795 <span class="comment"></span>
<a name="l02796"></a>02796 <span class="comment">    /**\brief Chop bytes off the end of a record body.</span>
<a name="l02797"></a>02797 <span class="comment">     * \ingroup SSMFILE</span>
<a name="l02798"></a>02798 <span class="comment">     * \details</span>
<a name="l02799"></a>02799 <span class="comment">     * @param[in] rid  ID of the record to modify.</span>
<a name="l02800"></a>02800 <span class="comment">     * @param[in] amount  How many bytes to lop off.</span>
<a name="l02801"></a>02801 <span class="comment">     *</span>
<a name="l02802"></a>02802 <span class="comment">     * \sa pin_i::truncate_rec, \ref SSMPIN</span>
<a name="l02803"></a>02803 <span class="comment">     */</span>
<a name="l02804"></a>02804     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d8/db0/group___s_s_m_f_i_l_e.html#gc857905ab45dd35d8931bcfa8271d8b6">truncate_rec</a>(
<a name="l02805"></a>02805         <span class="keyword">const</span> <a class="code" href="../../d7/df5/classrid__t.html">rid_t</a>&amp;             rid, 
<a name="l02806"></a>02806         smsize_t                 amount
<a name="l02807"></a>02807     );
<a name="l02808"></a>02808 <span class="comment"></span>
<a name="l02809"></a>02809 <span class="comment">    /**\brief Chop bytes off the end of a record body.</span>
<a name="l02810"></a>02810 <span class="comment">     * \ingroup SSMFILE</span>
<a name="l02811"></a>02811 <span class="comment">     * \details</span>
<a name="l02812"></a>02812 <span class="comment">     * @param[in] rid  ID of the record to modify.</span>
<a name="l02813"></a>02813 <span class="comment">     * @param[in] amount  How many bytes to lop off.</span>
<a name="l02814"></a>02814 <span class="comment">     * @param[out] should_forward  Returns true if the record started out</span>
<a name="l02815"></a>02815 <span class="comment">     * large but is now small as a result of the truncation.  </span>
<a name="l02816"></a>02816 <span class="comment">     * This enables a value-added server to take action in this event,</span>
<a name="l02817"></a>02817 <span class="comment">     * should it so desire.</span>
<a name="l02818"></a>02818 <span class="comment">     *</span>
<a name="l02819"></a>02819 <span class="comment">     * \sa pin_i::truncate_rec, \ref SSMPIN</span>
<a name="l02820"></a>02820 <span class="comment">     */</span>
<a name="l02821"></a>02821     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d8/db0/group___s_s_m_f_i_l_e.html#gc857905ab45dd35d8931bcfa8271d8b6">truncate_rec</a>(
<a name="l02822"></a>02822         <span class="keyword">const</span> <a class="code" href="../../d7/df5/classrid__t.html">rid_t</a>&amp;             rid, 
<a name="l02823"></a>02823         smsize_t                 amount,
<a name="l02824"></a>02824         <span class="keywordtype">bool</span>&amp;                    should_forward 
<a name="l02825"></a>02825     );
<a name="l02826"></a>02826 
<a name="l02827"></a>02827 <span class="preprocessor">#ifdef OLDSORT_COMPATIBILITY</span>
<a name="l02828"></a>02828 <span class="preprocessor"></span>    <span class="keyword">typedef</span> <a class="code" href="../../d1/dbb/structssm__sort_1_1key__info__t.html">ssm_sort::key_info_t</a> key_info_t;
<a name="l02829"></a>02829 
<a name="l02830"></a>02830     <span class="comment">/* old sort physical version */</span><span class="comment"></span>
<a name="l02831"></a>02831 <span class="comment">    /**\brief Sort a file. Deprecated.</span>
<a name="l02832"></a>02832 <span class="comment">     * \details</span>
<a name="l02833"></a>02833 <span class="comment">     */</span>
<a name="l02834"></a>02834     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d4/de8/group___s_s_m_s_o_r_t.html#gaff9edeb900d2b62af637138849d08aa">sort_file</a>(
<a name="l02835"></a>02835         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;             fid, 
<a name="l02836"></a>02836         <a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a>                     vid, 
<a name="l02837"></a>02837         <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;                   sfid, 
<a name="l02838"></a>02838         <a class="code" href="../../da/d44/classss__m.html#a7a0a9b5677337b6d5a4e3f42d9fa149">store_property_t</a>          property,
<a name="l02839"></a>02839         <span class="keyword">const</span> key_info_t&amp;         key_info, 
<a name="l02840"></a>02840         <span class="keywordtype">int</span>                       run_size,
<a name="l02841"></a>02841         <span class="keywordtype">bool</span>                      ascending = <span class="keyword">true</span>,
<a name="l02842"></a>02842         <span class="keywordtype">bool</span>                      unique = <span class="keyword">false</span>,
<a name="l02843"></a>02843         <span class="keywordtype">bool</span>                      destructive = <span class="keyword">false</span>,
<a name="l02844"></a>02844         <span class="keywordtype">bool</span>                      use_new_sort = <span class="keyword">true</span>);
<a name="l02845"></a>02845 <span class="comment"></span>
<a name="l02846"></a>02846 <span class="comment">    /**\brief Sort a file. Deprecated.</span>
<a name="l02847"></a>02847 <span class="comment">     * \details</span>
<a name="l02848"></a>02848 <span class="comment">     */</span>
<a name="l02849"></a>02849     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            new_sort_file(
<a name="l02850"></a>02850         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;             fid, 
<a name="l02851"></a>02851         <a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a>                     vid, 
<a name="l02852"></a>02852         <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;                   sfid, 
<a name="l02853"></a>02853         <a class="code" href="../../da/d44/classss__m.html#a7a0a9b5677337b6d5a4e3f42d9fa149">store_property_t</a>          property,
<a name="l02854"></a>02854         <span class="keyword">const</span> key_info_t&amp;         key_info, 
<a name="l02855"></a>02855         <span class="keywordtype">int</span>                       run_size,
<a name="l02856"></a>02856         <span class="keywordtype">bool</span>                      ascending = <span class="keyword">true</span>,
<a name="l02857"></a>02857         <span class="keywordtype">bool</span>                      unique = <span class="keyword">false</span>,
<a name="l02858"></a>02858         <span class="keywordtype">bool</span>                      destructive = <span class="keyword">false</span>
<a name="l02859"></a>02859         );
<a name="l02860"></a>02860 <span class="preprocessor">#endif </span><span class="comment">/* OLDSORT_COMPATIBILITY */</span>
<a name="l02861"></a>02861 
<a name="l02862"></a><a class="code" href="../../da/d44/classss__m.html#a1d3c7a8be5a64061a5d79d1b2ef68bb">02862</a>     <span class="keyword">typedef</span> <a class="code" href="../../d7/d50/classssm__sort_1_1sort__keys__t.html">ssm_sort::sort_keys_t</a> <a class="code" href="../../d7/d50/classssm__sort_1_1sort__keys__t.html">sort_keys_t</a>;
<a name="l02863"></a>02863 
<a name="l02864"></a>02864     <span class="comment">/* new sort physical version : see notes below */</span><span class="comment"></span>
<a name="l02865"></a>02865 <span class="comment">    /**\brief Sort a file.</span>
<a name="l02866"></a>02866 <span class="comment">     * \ingroup SSMSORT</span>
<a name="l02867"></a>02867 <span class="comment">     * @param[in] fid File to sort.</span>
<a name="l02868"></a>02868 <span class="comment">     * @param[in] sorted_fid File to which to write the results. </span>
<a name="l02869"></a>02869 <span class="comment">     * @param[in] nvids Size of array \a vid.</span>
<a name="l02870"></a>02870 <span class="comment">     * @param[in] vid Array of IDs of scratch files created by the caller.</span>
<a name="l02871"></a>02871 <span class="comment">     * @param[in] kl See sort_keys_t.</span>
<a name="l02872"></a>02872 <span class="comment">     * @param[in] min_rec_sz Hint of minimum record size in input file.</span>
<a name="l02873"></a>02873 <span class="comment">     * @param[in] run_size Number of pages in buffer pool to use for a run. </span>
<a name="l02874"></a>02874 <span class="comment">     * @param[in] temp_space Number of pages to use for scratch space.</span>
<a name="l02875"></a>02875 <span class="comment">     * (This limits the amount of memory used by the sort).</span>
<a name="l02876"></a>02876 <span class="comment">     *</span>
<a name="l02877"></a>02877 <span class="comment">     * \details</span>
<a name="l02878"></a>02878 <span class="comment">     * Before you call sort_file, you must create an output file \a sorted_fid</span>
<a name="l02879"></a>02879 <span class="comment">     * into which sort_file will write the results.</span>
<a name="l02880"></a>02880 <span class="comment">     *</span>
<a name="l02881"></a>02881 <span class="comment">     * The sort uses temporary files when the input file contains more records</span>
<a name="l02882"></a>02882 <span class="comment">     * than can fit in one run (determined by \a run_size). These temporary files</span>
<a name="l02883"></a>02883 <span class="comment">     * may be spread across multiple volumes, which is useful if the</span>
<a name="l02884"></a>02884 <span class="comment">     * volumes reside on different spindles.  The arguments \a nvids</span>
<a name="l02885"></a>02885 <span class="comment">     * and \a vid are for indicating the volumes to use for these scratch</span>
<a name="l02886"></a>02886 <span class="comment">     * files.</span>
<a name="l02887"></a>02887 <span class="comment">     *</span>
<a name="l02888"></a>02888 <span class="comment">     * The caller can provide a clue in \a min_rec_size</span>
<a name="l02889"></a>02889 <span class="comment">     * about the minimum record size of the</span>
<a name="l02890"></a>02890 <span class="comment">     * input file, which can help the sort's efficiency.</span>
<a name="l02891"></a>02891 <span class="comment">     *</span>
<a name="l02892"></a>02892 <span class="comment">     * The \a run_size indicates how many buffer-pool pages to use</span>
<a name="l02893"></a>02893 <span class="comment">     * for each run.</span>
<a name="l02894"></a>02894 <span class="comment">     * Since at all times one page is fixed for output, while the rest are </span>
<a name="l02895"></a>02895 <span class="comment">     * for reading the input in runs, the real run size is \a run_size-1.</span>
<a name="l02896"></a>02896 <span class="comment">     * </span>
<a name="l02897"></a>02897 <span class="comment">     */</span>
<a name="l02898"></a>02898     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d4/de8/group___s_s_m_s_o_r_t.html#gaff9edeb900d2b62af637138849d08aa">sort_file</a>(
<a name="l02899"></a>02899         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;            fid,     <span class="comment">// input file</span>
<a name="l02900"></a>02900         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;            sorted_fid, <span class="comment">// output file </span>
<a name="l02901"></a>02901         <span class="keywordtype">int</span>                      nvids,    <span class="comment">// array size for vids</span>
<a name="l02902"></a>02902         <span class="keyword">const</span> <a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a>*             vid,     <span class="comment">// array of vids for temp</span>
<a name="l02903"></a>02903                         <span class="comment">// files</span>
<a name="l02904"></a>02904                         <span class="comment">// created by caller--</span>
<a name="l02905"></a>02905                         <span class="comment">// can be same as input file</span>
<a name="l02906"></a>02906         <a class="code" href="../../d7/d50/classssm__sort_1_1sort__keys__t.html">sort_keys_t</a>&amp;            kl, <span class="comment">// kl &amp;</span>
<a name="l02907"></a>02907         smsize_t                min_rec_sz, <span class="comment">// for estimating space use</span>
<a name="l02908"></a>02908         <span class="keywordtype">int</span>                     run_size,   <span class="comment">// # pages to use for a run</span>
<a name="l02909"></a>02909         <span class="keywordtype">int</span>                     temp_space <span class="comment">// # pages VM to use for scratch </span>
<a name="l02910"></a>02910     );
<a name="l02911"></a>02911 <span class="comment"></span>
<a name="l02912"></a>02912 <span class="comment">    /**\brief Return the short volume ID of a volume.</span>
<a name="l02913"></a>02913 <span class="comment">     * \ingroup SSMVOL</span>
<a name="l02914"></a>02914 <span class="comment">     *</span>
<a name="l02915"></a>02915 <span class="comment">     * @param[in] lvid Long (persistent) volume ID found on the volume's</span>
<a name="l02916"></a>02916 <span class="comment">     * header.</span>
<a name="l02917"></a>02917 <span class="comment">     * @param[out] vid Short volume ID of a mounted volume.</span>
<a name="l02918"></a>02918 <span class="comment">     */</span>
<a name="l02919"></a>02919     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d1/d92/group___s_s_m_v_o_l.html#ged476303a8f697b978bba37897ef866d">lvid_to_vid</a>(
<a name="l02920"></a>02920         <span class="keyword">const</span> <a class="code" href="../../d8/d94/structlvid__t.html">lvid_t</a>&amp;          lvid,
<a name="l02921"></a>02921         <a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a>&amp;                 vid);
<a name="l02922"></a>02922 <span class="comment"></span>
<a name="l02923"></a>02923 <span class="comment">    /**\brief Return the long volume ID of a volume.</span>
<a name="l02924"></a>02924 <span class="comment">     * \ingroup SSMVOL</span>
<a name="l02925"></a>02925 <span class="comment">     *</span>
<a name="l02926"></a>02926 <span class="comment">     * @param[in] vid Short volume ID of a mounted volume.</span>
<a name="l02927"></a>02927 <span class="comment">     * @param[out] lvid Long (persistent) volume ID found on the volume's</span>
<a name="l02928"></a>02928 <span class="comment">     * header.</span>
<a name="l02929"></a>02929 <span class="comment">     */</span>
<a name="l02930"></a>02930     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d1/d92/group___s_s_m_v_o_l.html#g79d6a03fe68956196506f964a2e5894e">vid_to_lvid</a>(
<a name="l02931"></a>02931         <a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a>                  vid,
<a name="l02932"></a>02932         <a class="code" href="../../d8/d94/structlvid__t.html">lvid_t</a>&amp;                lvid);
<a name="l02933"></a>02933 
<a name="l02934"></a>02934     <span class="comment">/*****************************************************************</span>
<a name="l02935"></a>02935 <span class="comment">     * Locking related functions</span>
<a name="l02936"></a>02936 <span class="comment">     *</span>
<a name="l02937"></a>02937 <span class="comment">     * NOTE: there are standard conversions from lpid_t, rid_t, and</span>
<a name="l02938"></a>02938 <span class="comment">     *       stid_t to lockid_t, so wherever a lockid_t parameter is</span>
<a name="l02939"></a>02939 <span class="comment">     *         specified a lpid_t, rid_t, or stid_t can be used.</span>
<a name="l02940"></a>02940 <span class="comment">     *</span>
<a name="l02941"></a>02941 <span class="comment">     *****************************************************************/</span>
<a name="l02942"></a>02942 
<a name="l02943"></a>02943 <span class="preprocessor">#ifdef SLI_HOOKS</span>
<a name="l02944"></a>02944 <span class="preprocessor"></span>    <span class="comment">/* enable/disable SLI globally for all threads created after this</span>
<a name="l02945"></a>02945 <span class="comment">       point. Does *NOT* disable SLI for existing threads.</span>
<a name="l02946"></a>02946 <span class="comment">     */</span>
<a name="l02947"></a>02947     <span class="keyword">static</span> <span class="keywordtype">void</span>            set_sli_enabled(<span class="keywordtype">bool</span> enabled);
<a name="l02948"></a>02948     <span class="keyword">static</span> <span class="keywordtype">void</span>            set_elr_enabled(<span class="keywordtype">bool</span> enabled);
<a name="l02949"></a>02949 
<a name="l02950"></a>02950     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            set_log_features(<span class="keywordtype">char</span> <span class="keyword">const</span>* features);
<a name="l02951"></a>02951     <span class="keyword">static</span> <span class="keywordtype">char</span> <span class="keyword">const</span>*         get_log_features();
<a name="l02952"></a>02952 <span class="preprocessor">#endif</span>
<a name="l02953"></a>02953 <span class="preprocessor"></span><span class="comment"></span>
<a name="l02954"></a>02954 <span class="comment">    /**\brief Acquire a lock.</span>
<a name="l02955"></a>02955 <span class="comment">     * \ingroup SSMLOCK</span>
<a name="l02956"></a>02956 <span class="comment">     * @param[in]  n  Lock id of the entity to lock. There are</span>
<a name="l02957"></a>02957 <span class="comment">     * conversions from record ids, volume ids, store ids, and page ids to</span>
<a name="l02958"></a>02958 <span class="comment">     * lockid_t.</span>
<a name="l02959"></a>02959 <span class="comment">     * @param[in]  m  Desired lock mode.  Values: EX, SH.</span>
<a name="l02960"></a>02960 <span class="comment">     * @param[in]  d  Desired duration.  Values: </span>
<a name="l02961"></a>02961 <span class="comment">     * - t_very_long : Held across transaction boundaries; </span>
<a name="l02962"></a>02962 <span class="comment">     *             cannot be released by unlock()</span>
<a name="l02963"></a>02963 <span class="comment">     * - t_long : Released at commit; cannot be released by unlock()</span>
<a name="l02964"></a>02964 <span class="comment">     * - t_medium : May be released early by explicit unlock()</span>
<a name="l02965"></a>02965 <span class="comment">     * - t_short  : May be released early by explicit unlock()</span>
<a name="l02966"></a>02966 <span class="comment">     * - t_instant : Not held: acquired and released immediately.  Useful</span>
<a name="l02967"></a>02967 <span class="comment">     *             to see if any other transaction holds an incompatible lock.</span>
<a name="l02968"></a>02968 <span class="comment">     * @param[in]  timeout  Milliseconds willing to block.  See timeout_in_ms.</span>
<a name="l02969"></a>02969 <span class="comment">     *</span>
<a name="l02970"></a>02970 <span class="comment">     * The lock manager is written with these durations in mind, but the</span>
<a name="l02971"></a>02971 <span class="comment">     * only durations used by the storage manager are t_instant and t_long.</span>
<a name="l02972"></a>02972 <span class="comment">     * Medium-duration locks are used internally in a one place.  </span>
<a name="l02973"></a>02973 <span class="comment">     *</span>
<a name="l02974"></a>02974 <span class="comment">     * Durations other than long and instant are not well-tested.</span>
<a name="l02975"></a>02975 <span class="comment">     */</span>
<a name="l02976"></a>02976     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d8/da8/group___s_s_m_l_o_c_k.html#ge958b3890b3c62fe1bf0944de20eca6e">lock</a>(
<a name="l02977"></a>02977         <span class="keyword">const</span> <a class="code" href="../../d0/d34/classlockid__t.html">lockid_t</a>&amp;         n, 
<a name="l02978"></a>02978         lock_mode_t             m,
<a name="l02979"></a>02979         lock_duration_t         d = t_long,
<a name="l02980"></a>02980         <a class="code" href="../../d8/d69/smthread_8h.html#cf834513ff7853bf96601820e038ec9a">timeout_in_ms</a>           timeout = WAIT_SPECIFIED_BY_XCT
<a name="l02981"></a>02981     );
<a name="l02982"></a>02982     <span class="comment"></span>
<a name="l02983"></a>02983 <span class="comment">    /**\brief Release a lock.</span>
<a name="l02984"></a>02984 <span class="comment">     * \ingroup SSMLOCK</span>
<a name="l02985"></a>02985 <span class="comment">     * @param[in]  n  Lock id of the entity to lock. There are</span>
<a name="l02986"></a>02986 <span class="comment">     * conversions from record ids, volume ids, store ids, and page ids to</span>
<a name="l02987"></a>02987 <span class="comment">     * lockid_t.</span>
<a name="l02988"></a>02988 <span class="comment">     */</span>
<a name="l02989"></a>02989     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d8/da8/group___s_s_m_l_o_c_k.html#g90cc2cc0f95397a82a94a119313219d2">unlock</a>(<span class="keyword">const</span> <a class="code" href="../../d0/d34/classlockid__t.html">lockid_t</a>&amp; n);
<a name="l02990"></a>02990 <span class="comment"></span>
<a name="l02991"></a>02991 <span class="comment">    /**\brief  Disable lock escalation on the given entity. </span>
<a name="l02992"></a>02992 <span class="comment">     * \ingroup SSMLOCK</span>
<a name="l02993"></a>02993 <span class="comment">     * @param[in]  n  Lock id of the entity to lock. There are</span>
<a name="l02994"></a>02994 <span class="comment">     * conversions from record ids, volume ids, store ids, and page ids to</span>
<a name="l02995"></a>02995 <span class="comment">     * lockid_t.</span>
<a name="l02996"></a>02996 <span class="comment">     * @param[in]  passOnToDescendants If true, apply this to the descendants</span>
<a name="l02997"></a>02997 <span class="comment">     * of \a n.</span>
<a name="l02998"></a>02998 <span class="comment">     */</span>
<a name="l02999"></a>02999     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d8/da8/group___s_s_m_l_o_c_k.html#ge79315df001e97d59ede0293107b88f4">dont_escalate</a>(
<a name="l03000"></a>03000         <span class="keyword">const</span> <a class="code" href="../../d0/d34/classlockid__t.html">lockid_t</a>&amp;           n,
<a name="l03001"></a>03001         <span class="keywordtype">bool</span>                      passOnToDescendants = <span class="keyword">true</span>
<a name="l03002"></a>03002     );
<a name="l03003"></a>03003 <span class="comment"></span>
<a name="l03004"></a>03004 <span class="comment">    /**\brief  Find the storage-manager-wide escalation thresholds</span>
<a name="l03005"></a>03005 <span class="comment">     * \ingroup SSMLOCK</span>
<a name="l03006"></a>03006 <span class="comment">     * Default values (used for all transactions until they change</span>
<a name="l03007"></a>03007 <span class="comment">     * their per-transaction thresholds) are determined by the</span>
<a name="l03008"></a>03008 <span class="comment">     * storage-manager-wide options.</span>
<a name="l03009"></a>03009 <span class="comment">     * See \ref SSMOPT.</span>
<a name="l03010"></a>03010 <span class="comment">     */</span>
<a name="l03011"></a>03011     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d8/da8/group___s_s_m_l_o_c_k.html#gbef0834a41336d8d65c093636f918a21">get_escalation_thresholds</a>(
<a name="l03012"></a>03012         <a class="code" href="../../d9/da0/classw__base__t.html#1a9601702a65daae96f2e11b6896eed3">w_base_t::int4_t</a>&amp;        toPage,
<a name="l03013"></a>03013         <a class="code" href="../../d9/da0/classw__base__t.html#1a9601702a65daae96f2e11b6896eed3">w_base_t::int4_t</a>&amp;        toStore,
<a name="l03014"></a>03014         <a class="code" href="../../d9/da0/classw__base__t.html#1a9601702a65daae96f2e11b6896eed3">w_base_t::int4_t</a>&amp;        toVolume);
<a name="l03015"></a>03015 <span class="comment"></span>
<a name="l03016"></a>03016 <span class="comment">    /**\brief  Change the storage-manager-wide escalation thresholds</span>
<a name="l03017"></a>03017 <span class="comment">     * \ingroup SSMLOCK</span>
<a name="l03018"></a>03018 <span class="comment">     * Default values (used for all transactions until they change</span>
<a name="l03019"></a>03019 <span class="comment">     * their per-transaction thresholds) are determined by the</span>
<a name="l03020"></a>03020 <span class="comment">     * storage-manager-wide options.</span>
<a name="l03021"></a>03021 <span class="comment">     * See \ref SSMOPT.</span>
<a name="l03022"></a>03022 <span class="comment">     */</span>
<a name="l03023"></a>03023     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d8/da8/group___s_s_m_l_o_c_k.html#g8e63489932334bf09df5889182592324">set_escalation_thresholds</a>(
<a name="l03024"></a>03024         <a class="code" href="../../d9/da0/classw__base__t.html#1a9601702a65daae96f2e11b6896eed3">w_base_t::int4_t</a>       toPage,
<a name="l03025"></a>03025         <a class="code" href="../../d9/da0/classw__base__t.html#1a9601702a65daae96f2e11b6896eed3">w_base_t::int4_t</a>       toStore,
<a name="l03026"></a>03026         <a class="code" href="../../d9/da0/classw__base__t.html#1a9601702a65daae96f2e11b6896eed3">w_base_t::int4_t</a>       toVolume);
<a name="l03027"></a>03027 <span class="comment"></span>
<a name="l03028"></a>03028 <span class="comment">    /**\brief  Find out if the attached transaction has an entity locked.</span>
<a name="l03029"></a>03029 <span class="comment">     * \ingroup SSMLOCK</span>
<a name="l03030"></a>03030 <span class="comment">     * @param[in]  n  Lock id of the entity to lock. There are</span>
<a name="l03031"></a>03031 <span class="comment">     * conversions from record ids, volume ids, store ids, and page ids to</span>
<a name="l03032"></a>03032 <span class="comment">     * lockid_t.</span>
<a name="l03033"></a>03033 <span class="comment">     * @param[out]  m  Mode of lock held. NL if none.</span>
<a name="l03034"></a>03034 <span class="comment">     * @param[in]  implicit If "true" the query will returns a lock mode if</span>
<a name="l03035"></a>03035 <span class="comment">     * an implicit lock is held, otherwise the lock must be held explicitly.</span>
<a name="l03036"></a>03036 <span class="comment">     */</span>
<a name="l03037"></a>03037     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d8/da8/group___s_s_m_l_o_c_k.html#g3dc0c3114a47e829a2cf2ddcf19ea4f9">query_lock</a>(
<a name="l03038"></a>03038         <span class="keyword">const</span> <a class="code" href="../../d0/d34/classlockid__t.html">lockid_t</a>&amp;        n, 
<a name="l03039"></a>03039         lock_mode_t&amp;           m,
<a name="l03040"></a>03040         <span class="keywordtype">bool</span>                   implicit = <span class="keyword">false</span>
<a name="l03041"></a>03041     );
<a name="l03042"></a>03042 
<a name="l03043"></a>03043     <span class="comment">/*****************************************************************</span>
<a name="l03044"></a>03044 <span class="comment">     * Lock Cache related functions</span>
<a name="l03045"></a>03045 <span class="comment">     *</span>
<a name="l03046"></a>03046 <span class="comment">     * Each transaction has a cache of recently acquired locks</span>
<a name="l03047"></a>03047 <span class="comment">     * The following functions control the use of the cache.</span>
<a name="l03048"></a>03048 <span class="comment">     * Note that the functions affect the transaction currently</span>
<a name="l03049"></a>03049 <span class="comment">     * associated with the thread.</span>
<a name="l03050"></a>03050 <span class="comment">     *****************************************************************/</span>
<a name="l03051"></a>03051     <span class="comment">// turn on(enable=true) or  off/(enable=false) the lock cache </span>
<a name="l03052"></a>03052     <span class="comment">// return previous state.</span><span class="comment"></span>
<a name="l03053"></a>03053 <span class="comment">    /**\brief Control  lock caching for attached transaction.</span>
<a name="l03054"></a>03054 <span class="comment">     * \ingroup SSMLOCK</span>
<a name="l03055"></a>03055 <span class="comment">     *</span>
<a name="l03056"></a>03056 <span class="comment">     * @param[in] enable Set to true if you want to turn on lock caching</span>
<a name="l03057"></a>03057 <span class="comment">     * for the attached transaction.  The default is that it is turned on.</span>
<a name="l03058"></a>03058 <span class="comment">     *</span>
<a name="l03059"></a>03059 <span class="comment">     * Only long-duration locks are cached.</span>
<a name="l03060"></a>03060 <span class="comment">     * Lock caching can be turned off by default using the </span>
<a name="l03061"></a>03061 <span class="comment">     * sm_lock_caching option.  Even with it turned off by default, it</span>
<a name="l03062"></a>03062 <span class="comment">     * can be turned on for a given transcation with this method.</span>
<a name="l03063"></a>03063 <span class="comment">     *</span>
<a name="l03064"></a>03064 <span class="comment">     */</span>
<a name="l03065"></a>03065     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d8/da8/group___s_s_m_l_o_c_k.html#g26b2abbd950f88e855d98ad8dee70ac3">set_lock_cache_enable</a>(<span class="keywordtype">bool</span> enable);
<a name="l03066"></a>03066 <span class="comment"></span>
<a name="l03067"></a>03067 <span class="comment">    /**\brief True if lock cache is enabled for the attached transaction </span>
<a name="l03068"></a>03068 <span class="comment">     * \ingroup SSMLOCK</span>
<a name="l03069"></a>03069 <span class="comment">     *</span>
<a name="l03070"></a>03070 <span class="comment">     * @param[out] enabled Will be set to true if the attached transaction has</span>
<a name="l03071"></a>03071 <span class="comment">     * lock caching enabled, false otherwise.</span>
<a name="l03072"></a>03072 <span class="comment">     */</span>
<a name="l03073"></a>03073     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            <a class="code" href="../../d8/da8/group___s_s_m_l_o_c_k.html#g771dbeb67bdb5ad4db06dc20e585d03c">lock_cache_enabled</a>(<span class="keywordtype">bool</span>&amp; enabled);
<a name="l03074"></a>03074 
<a name="l03075"></a>03075 <span class="keyword">private</span>:
<a name="l03076"></a>03076 
<a name="l03077"></a>03077     <span class="keyword">static</span> <span class="keywordtype">int</span> _instance_cnt;
<a name="l03078"></a>03078     <span class="keyword">static</span> <a class="code" href="../../d7/da2/classoption__group__t.html">option_group_t</a>* _options;
<a name="l03079"></a>03079     <span class="keyword">static</span> <a class="code" href="../../d9/d6e/classoption__t.html">option_t</a>* _hugetlbfs_path;
<a name="l03080"></a>03080     <span class="keyword">static</span> <a class="code" href="../../d9/d6e/classoption__t.html">option_t</a>* _reformat_log;
<a name="l03081"></a>03081     <span class="keyword">static</span> <a class="code" href="../../d9/d6e/classoption__t.html">option_t</a>* _prefetch;
<a name="l03082"></a>03082     <span class="keyword">static</span> <a class="code" href="../../d9/d6e/classoption__t.html">option_t</a>* _bufpoolsize;
<a name="l03083"></a>03083     <span class="keyword">static</span> <a class="code" href="../../d9/d6e/classoption__t.html">option_t</a>* _locktablesize;
<a name="l03084"></a>03084     <span class="keyword">static</span> <a class="code" href="../../d9/d6e/classoption__t.html">option_t</a>* _logdir;
<a name="l03085"></a>03085     <span class="keyword">static</span> <a class="code" href="../../d9/d6e/classoption__t.html">option_t</a>* _logsize;
<a name="l03086"></a>03086     <span class="keyword">static</span> <a class="code" href="../../d9/d6e/classoption__t.html">option_t</a>* _logbufsize;
<a name="l03087"></a>03087     <span class="keyword">static</span> <a class="code" href="../../d9/d6e/classoption__t.html">option_t</a>* _error_log;
<a name="l03088"></a>03088     <span class="keyword">static</span> <a class="code" href="../../d9/d6e/classoption__t.html">option_t</a>* _error_loglevel;
<a name="l03089"></a>03089     <span class="keyword">static</span> <a class="code" href="../../d9/d6e/classoption__t.html">option_t</a>* _lockEscalateToPageThreshold;
<a name="l03090"></a>03090     <span class="keyword">static</span> <a class="code" href="../../d9/d6e/classoption__t.html">option_t</a>* _lockEscalateToStoreThreshold;
<a name="l03091"></a>03091     <span class="keyword">static</span> <a class="code" href="../../d9/d6e/classoption__t.html">option_t</a>* _lockEscalateToVolumeThreshold;
<a name="l03092"></a>03092     <span class="keyword">static</span> <a class="code" href="../../d9/d6e/classoption__t.html">option_t</a>* _cc_alg_option;
<a name="l03093"></a>03093     <span class="keyword">static</span> <a class="code" href="../../d9/d6e/classoption__t.html">option_t</a>* _log_warn_percent;
<a name="l03094"></a>03094     <span class="keyword">static</span> <a class="code" href="../../d9/d6e/classoption__t.html">option_t</a>* _num_page_writers;
<a name="l03095"></a>03095     <span class="keyword">static</span> <a class="code" href="../../d9/d6e/classoption__t.html">option_t</a>* _logging;
<a name="l03096"></a>03096     <span class="keyword">static</span> <a class="code" href="../../d9/d6e/classoption__t.html">option_t</a>* _lock_caching_default;
<a name="l03097"></a>03097 
<a name="l03098"></a>03098 
<a name="l03099"></a>03099     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _set_option_logsize(
<a name="l03100"></a>03100         <a class="code" href="../../d9/d6e/classoption__t.html">option_t</a>*              opt,
<a name="l03101"></a>03101         <span class="keyword">const</span> <span class="keywordtype">char</span>*            value,
<a name="l03102"></a>03102         ostream*               err_stream);
<a name="l03103"></a>03103     
<a name="l03104"></a>03104     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _set_option_lock_escalate_to_page(
<a name="l03105"></a>03105         <a class="code" href="../../d9/d6e/classoption__t.html">option_t</a>*              opt,
<a name="l03106"></a>03106         <span class="keyword">const</span> <span class="keywordtype">char</span>*            value,
<a name="l03107"></a>03107         ostream*               err_stream);
<a name="l03108"></a>03108     
<a name="l03109"></a>03109     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _set_option_lock_escalate_to_store(
<a name="l03110"></a>03110         <a class="code" href="../../d9/d6e/classoption__t.html">option_t</a>*              opt,
<a name="l03111"></a>03111         <span class="keyword">const</span> <span class="keywordtype">char</span>*            value,
<a name="l03112"></a>03112         ostream*               err_stream);
<a name="l03113"></a>03113     
<a name="l03114"></a>03114     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _set_option_lock_escalate_to_volume(
<a name="l03115"></a>03115         <a class="code" href="../../d9/d6e/classoption__t.html">option_t</a>*              opt,
<a name="l03116"></a>03116         <span class="keyword">const</span> <span class="keywordtype">char</span>*            value,
<a name="l03117"></a>03117         ostream*               err_stream);
<a name="l03118"></a>03118     
<a name="l03119"></a>03119     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _set_store_property(
<a name="l03120"></a>03120         <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>                stid,
<a name="l03121"></a>03121         <a class="code" href="../../da/d44/classss__m.html#a7a0a9b5677337b6d5a4e3f42d9fa149">store_property_t</a>      property);
<a name="l03122"></a>03122 
<a name="l03123"></a>03123     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _get_store_property(
<a name="l03124"></a>03124         <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>                stid,
<a name="l03125"></a>03125         <a class="code" href="../../da/d44/classss__m.html#a7a0a9b5677337b6d5a4e3f42d9fa149">store_property_t</a>&amp;     property);
<a name="l03126"></a>03126 
<a name="l03127"></a>03127     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>         _begin_xct(
<a name="l03128"></a>03128         <a class="code" href="../../d9/dee/classsm__stats__info__t.html">sm_stats_info_t</a>*      stats,  <span class="comment">// allocated by caller</span>
<a name="l03129"></a>03129         <a class="code" href="../../d8/d12/classtid__t.html">tid_t</a>&amp;                tid, 
<a name="l03130"></a>03130         <a class="code" href="../../d8/d69/smthread_8h.html#cf834513ff7853bf96601820e038ec9a">timeout_in_ms</a>         timeout);
<a name="l03131"></a>03131 
<a name="l03132"></a>03132     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _commit_xct(
<a name="l03133"></a>03133         <a class="code" href="../../d9/dee/classsm__stats__info__t.html">sm_stats_info_t</a>*&amp;     stats,
<a name="l03134"></a>03134         <span class="keywordtype">bool</span>                  lazy,
<a name="l03135"></a>03135         <a class="code" href="../../d2/d19/classlsn__t.html">lsn_t</a>* plastlsn);
<a name="l03136"></a>03136 
<a name="l03137"></a>03137     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _commit_xct_group(
<a name="l03138"></a>03138         <a class="code" href="../../df/d32/classxct__t.html">xct_t</a> *               list[],
<a name="l03139"></a>03139         <span class="keywordtype">int</span>                   listlen);
<a name="l03140"></a>03140 
<a name="l03141"></a>03141     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _prepare_xct(
<a name="l03142"></a>03142         <a class="code" href="../../d9/dee/classsm__stats__info__t.html">sm_stats_info_t</a>*&amp;     stats,
<a name="l03143"></a>03143         vote_t&amp;                v);
<a name="l03144"></a>03144 
<a name="l03145"></a>03145     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _set_coordinator(<span class="keyword">const</span> <a class="code" href="../../d5/de1/classopaque__quantity.html">server_handle_t</a> &amp;); 
<a name="l03146"></a>03146     
<a name="l03147"></a>03147     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _enter_2pc(<span class="keyword">const</span> <a class="code" href="../../d5/de1/classopaque__quantity.html">gtid_t</a> &amp;); 
<a name="l03148"></a>03148     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _force_vote_readonly(); 
<a name="l03149"></a>03149     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _recover_2pc(<span class="keyword">const</span> <a class="code" href="../../d5/de1/classopaque__quantity.html">gtid_t</a> &amp;,<span class="comment">// in</span>
<a name="l03150"></a>03150                                 <span class="keywordtype">bool</span>    mayblock,
<a name="l03151"></a>03151                                 <a class="code" href="../../d8/d12/classtid__t.html">tid_t</a>    &amp;    <span class="comment">//out -- attached if found(?)</span>
<a name="l03152"></a>03152                             );
<a name="l03153"></a>03153     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _chain_xct(
<a name="l03154"></a>03154         <a class="code" href="../../d9/dee/classsm__stats__info__t.html">sm_stats_info_t</a>*&amp;      stats,
<a name="l03155"></a>03155         <span class="keywordtype">bool</span>                   lazy);
<a name="l03156"></a>03156 
<a name="l03157"></a>03157     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _abort_xct(
<a name="l03158"></a>03158         <a class="code" href="../../d9/dee/classsm__stats__info__t.html">sm_stats_info_t</a>*&amp;      stats);
<a name="l03159"></a>03159 
<a name="l03160"></a>03160     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _save_work(<a class="code" href="../../d1/da9/classsm__save__point__t.html">sm_save_point_t</a>&amp; sp);
<a name="l03161"></a>03161 
<a name="l03162"></a>03162     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _rollback_work(<span class="keyword">const</span> <a class="code" href="../../d1/da9/classsm__save__point__t.html">sm_save_point_t</a>&amp;        sp);
<a name="l03163"></a>03163     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _mount_dev(
<a name="l03164"></a>03164         <span class="keyword">const</span> <span class="keywordtype">char</span>*            device,
<a name="l03165"></a>03165         u_int&amp;                 vol_cnt,
<a name="l03166"></a>03166         <a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a>                  local_vid);
<a name="l03167"></a>03167 
<a name="l03168"></a>03168     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _dismount_dev(
<a name="l03169"></a>03169         <span class="keyword">const</span> <span class="keywordtype">char</span>*            device,
<a name="l03170"></a>03170         <span class="keywordtype">bool</span>                   dismount_if_locked = <span class="keyword">true</span>
<a name="l03171"></a>03171     );
<a name="l03172"></a>03172     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _create_vol(
<a name="l03173"></a>03173         <span class="keyword">const</span> <span class="keywordtype">char</span>*            device_name,
<a name="l03174"></a>03174         <span class="keyword">const</span> <a class="code" href="../../d8/d94/structlvid__t.html">lvid_t</a>&amp;          lvid,
<a name="l03175"></a>03175         smksize_t              quota_KB,
<a name="l03176"></a>03176         <span class="keywordtype">bool</span>                   skip_raw_init,
<a name="l03177"></a>03177         <span class="keyword">const</span> <span class="keywordtype">bool</span>             apply_fake_io_latency,
<a name="l03178"></a>03178         <span class="keyword">const</span> <span class="keywordtype">int</span>              fake_disk_latency);
<a name="l03179"></a>03179 
<a name="l03180"></a>03180     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _create_index(
<a name="l03181"></a>03181         <a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a>                 vid, 
<a name="l03182"></a>03182         <a class="code" href="../../da/d44/classss__m.html#901caa62fd2c03e33bec050c30dd828b">ndx_t</a>                 ntype, 
<a name="l03183"></a>03183         <a class="code" href="../../da/d44/classss__m.html#a7a0a9b5677337b6d5a4e3f42d9fa149">store_property_t</a>      property,
<a name="l03184"></a>03184         <span class="keyword">const</span> <span class="keywordtype">char</span>*           key_desc,
<a name="l03185"></a>03185         <a class="code" href="../../da/d44/classss__m.html#50662c89c6fd0f384a655ca11e78b861">concurrency_t</a>         cc,
<a name="l03186"></a>03186         <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;               stid
<a name="l03187"></a>03187     );
<a name="l03188"></a>03188 
<a name="l03189"></a>03189     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _destroy_index(<span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp; iid); 
<a name="l03190"></a>03190 
<a name="l03191"></a>03191     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _get_store_info( 
<a name="l03192"></a>03192         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>  &amp;       stid, 
<a name="l03193"></a>03193         <a class="code" href="../../d3/d8b/classsm__store__info__t.html">sm_store_info_t</a>&amp;      info);
<a name="l03194"></a>03194 
<a name="l03195"></a>03195     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _bulkld_index(
<a name="l03196"></a>03196         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;         stid,
<a name="l03197"></a>03197         <span class="keywordtype">int</span>                   nsrcs,
<a name="l03198"></a>03198         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>*         source,
<a name="l03199"></a>03199         sm_du_stats_t&amp;        stats,
<a name="l03200"></a>03200         <span class="keywordtype">bool</span>                  sort_duplicates = <span class="keyword">true</span>,
<a name="l03201"></a>03201         <span class="keywordtype">bool</span>                  lexify_keys = <span class="keyword">true</span>
<a name="l03202"></a>03202     );
<a name="l03203"></a>03203 
<a name="l03204"></a>03204     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _bulkld_index(
<a name="l03205"></a>03205         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;          stid, 
<a name="l03206"></a>03206         <a class="code" href="../../da/d1c/classsort__stream__i.html">sort_stream_i</a>&amp;         sorted_stream,
<a name="l03207"></a>03207         sm_du_stats_t&amp;         stats
<a name="l03208"></a>03208     );
<a name="l03209"></a>03209 
<a name="l03210"></a>03210     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _print_index(<span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a> &amp;iid);
<a name="l03211"></a>03211 
<a name="l03212"></a>03212     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _create_assoc(
<a name="l03213"></a>03213         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>  &amp;        stid, 
<a name="l03214"></a>03214         <span class="keyword">const</span> <a class="code" href="../../d8/ddb/classvec__t.html">vec_t</a>&amp;           key, 
<a name="l03215"></a>03215         <span class="keyword">const</span> <a class="code" href="../../d8/ddb/classvec__t.html">vec_t</a>&amp;           el
<a name="l03216"></a>03216 #ifdef SM_DORA
<a name="l03217"></a>03217         , <span class="keyword">const</span> <span class="keywordtype">bool</span>             bIgnoreLocks = <span class="keyword">false</span>
<a name="l03218"></a>03218 #endif
<a name="l03219"></a>03219     );
<a name="l03220"></a>03220 
<a name="l03221"></a>03221     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _destroy_assoc(
<a name="l03222"></a>03222         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a> &amp;        stid, 
<a name="l03223"></a>03223         <span class="keyword">const</span> <a class="code" href="../../d8/ddb/classvec__t.html">vec_t</a>&amp;          key,
<a name="l03224"></a>03224         <span class="keyword">const</span> <a class="code" href="../../d8/ddb/classvec__t.html">vec_t</a>&amp;          el
<a name="l03225"></a>03225 #ifdef SM_DORA
<a name="l03226"></a>03226         , <span class="keyword">const</span> <span class="keywordtype">bool</span>             bIgnoreLocks = <span class="keyword">false</span>
<a name="l03227"></a>03227 #endif
<a name="l03228"></a>03228     );
<a name="l03229"></a>03229 
<a name="l03230"></a>03230     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _destroy_all_assoc(
<a name="l03231"></a>03231         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;        stid, 
<a name="l03232"></a>03232         <span class="keyword">const</span> <a class="code" href="../../d8/ddb/classvec__t.html">vec_t</a>&amp;         key,
<a name="l03233"></a>03233         <span class="keywordtype">int</span>&amp;                 num_removed
<a name="l03234"></a>03234     );
<a name="l03235"></a>03235     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _find_assoc(
<a name="l03236"></a>03236         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;        stid, 
<a name="l03237"></a>03237         <span class="keyword">const</span> <a class="code" href="../../d8/ddb/classvec__t.html">vec_t</a>&amp;         key, 
<a name="l03238"></a>03238         <span class="keywordtype">void</span>*                el, 
<a name="l03239"></a>03239         smsize_t&amp;            elen, 
<a name="l03240"></a>03240         <span class="keywordtype">bool</span>&amp;                found
<a name="l03241"></a>03241 #ifdef SM_DORA
<a name="l03242"></a>03242         , <span class="keyword">const</span> <span class="keywordtype">bool</span>             bIgnoreLocks = <span class="keyword">false</span>
<a name="l03243"></a>03243 #endif
<a name="l03244"></a>03244     );
<a name="l03245"></a>03245 
<a name="l03246"></a>03246     <span class="comment">// below method overloaded for rtree</span>
<a name="l03247"></a>03247     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _create_md_index(
<a name="l03248"></a>03248         <a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a>                 vid, 
<a name="l03249"></a>03249         <a class="code" href="../../da/d44/classss__m.html#901caa62fd2c03e33bec050c30dd828b">ndx_t</a>                 ntype, 
<a name="l03250"></a>03250         <a class="code" href="../../da/d44/classss__m.html#a7a0a9b5677337b6d5a4e3f42d9fa149">store_property_t</a>      property,
<a name="l03251"></a>03251         <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;               stid, 
<a name="l03252"></a>03252         int2_t                dim=2
<a name="l03253"></a>03253     );
<a name="l03254"></a>03254 
<a name="l03255"></a>03255     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _destroy_md_index(<span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp; iid);
<a name="l03256"></a>03256 
<a name="l03257"></a>03257     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _destroy_md_assoc(
<a name="l03258"></a>03258         <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>                stid,
<a name="l03259"></a>03259         <span class="keyword">const</span> <a class="code" href="../../d2/dd1/classnbox__t.html">nbox_t</a>&amp;         key,
<a name="l03260"></a>03260         <span class="keyword">const</span> <a class="code" href="../../d8/ddb/classvec__t.html">vec_t</a>&amp;          el);
<a name="l03261"></a>03261 
<a name="l03262"></a>03262     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _bulkld_md_index(
<a name="l03263"></a>03263         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;         stid, 
<a name="l03264"></a>03264         <span class="keywordtype">int</span>                   nsrcs,
<a name="l03265"></a>03265         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>*         source, 
<a name="l03266"></a>03266         sm_du_stats_t&amp;        stats,
<a name="l03267"></a>03267         int2_t                hff,           <span class="comment">// for rtree only</span>
<a name="l03268"></a>03268         int2_t                hef,           <span class="comment">// for rtree only</span>
<a name="l03269"></a>03269         <a class="code" href="../../d2/dd1/classnbox__t.html">nbox_t</a>*               universe);<span class="comment">// for rtree only</span>
<a name="l03270"></a>03270 
<a name="l03271"></a>03271     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _bulkld_md_index(
<a name="l03272"></a>03272         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;         stid, 
<a name="l03273"></a>03273         <a class="code" href="../../da/d1c/classsort__stream__i.html">sort_stream_i</a>&amp;        sorted_stream,
<a name="l03274"></a>03274         sm_du_stats_t&amp;        stats,
<a name="l03275"></a>03275         int2_t                hff,           <span class="comment">// for rtree only</span>
<a name="l03276"></a>03276         int2_t                hef,           <span class="comment">// for rtree only</span>
<a name="l03277"></a>03277         <a class="code" href="../../d2/dd1/classnbox__t.html">nbox_t</a>*               universe);<span class="comment">// for rtree only</span>
<a name="l03278"></a>03278 
<a name="l03279"></a>03279     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _print_md_index(<a class="code" href="../../da/d5b/structstid__t.html">stid_t</a> stid, ostream &amp;);
<a name="l03280"></a>03280 
<a name="l03281"></a>03281     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _create_md_assoc(
<a name="l03282"></a>03282         <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>                stid, 
<a name="l03283"></a>03283         <span class="keyword">const</span> <a class="code" href="../../d2/dd1/classnbox__t.html">nbox_t</a>&amp;         key,
<a name="l03284"></a>03284         <span class="keyword">const</span> <a class="code" href="../../d8/ddb/classvec__t.html">vec_t</a>&amp;          el);
<a name="l03285"></a>03285 
<a name="l03286"></a>03286     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _find_md_assoc(
<a name="l03287"></a>03287         <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>                stid, 
<a name="l03288"></a>03288         <span class="keyword">const</span> <a class="code" href="../../d2/dd1/classnbox__t.html">nbox_t</a>&amp;         key, 
<a name="l03289"></a>03289         <span class="keywordtype">void</span>*                 el, 
<a name="l03290"></a>03290         smsize_t&amp;             elen, 
<a name="l03291"></a>03291         <span class="keywordtype">bool</span>&amp;                 found);
<a name="l03292"></a>03292 
<a name="l03293"></a>03293     <span class="comment">//</span>
<a name="l03294"></a>03294     <span class="comment">// The following functions deal with files of records.</span>
<a name="l03295"></a>03295     <span class="comment">//</span>
<a name="l03296"></a>03296     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _destroy_n_swap_file(
<a name="l03297"></a>03297         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;         old_fid,
<a name="l03298"></a>03298         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;         new_fid);
<a name="l03299"></a>03299 
<a name="l03300"></a>03300     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _create_file(
<a name="l03301"></a>03301         <a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a>                 vid, 
<a name="l03302"></a>03302         <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;               fid,
<a name="l03303"></a>03303         <a class="code" href="../../da/d44/classss__m.html#a7a0a9b5677337b6d5a4e3f42d9fa149">store_property_t</a>     property,
<a name="l03304"></a>03304         shpid_t              cluster_hint = 0
<a name="l03305"></a>03305     ); 
<a name="l03306"></a>03306 
<a name="l03307"></a>03307     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _destroy_file(<span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp; fid); 
<a name="l03308"></a>03308 
<a name="l03309"></a>03309     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _create_rec(
<a name="l03310"></a>03310         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;            fid, 
<a name="l03311"></a>03311         <span class="keyword">const</span> <a class="code" href="../../d8/ddb/classvec__t.html">vec_t</a>&amp;             hdr, 
<a name="l03312"></a>03312         smsize_t                 len_hint, 
<a name="l03313"></a>03313         <span class="keyword">const</span> <a class="code" href="../../d8/ddb/classvec__t.html">vec_t</a>&amp;             data, 
<a name="l03314"></a>03314         <a class="code" href="../../d7/df5/classrid__t.html">rid_t</a>&amp;                   new_rid,
<a name="l03315"></a>03315         uint4_t                  policy 
<a name="l03316"></a>03316 #ifdef SM_DORA
<a name="l03317"></a>03317         , <span class="keyword">const</span> <span class="keywordtype">bool</span>             bIgnoreLocks = <span class="keyword">false</span>
<a name="l03318"></a>03318 #endif
<a name="l03319"></a>03319         ); 
<a name="l03320"></a>03320 
<a name="l03321"></a>03321     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _destroy_rec(
<a name="l03322"></a>03322         <span class="keyword">const</span> <a class="code" href="../../d7/df5/classrid__t.html">rid_t</a>&amp;             rid
<a name="l03323"></a>03323 #ifdef SM_DORA
<a name="l03324"></a>03324         , <span class="keyword">const</span> <span class="keywordtype">bool</span>             bIgnoreLocks = <span class="keyword">false</span>
<a name="l03325"></a>03325 #endif
<a name="l03326"></a>03326         );
<a name="l03327"></a>03327 
<a name="l03328"></a>03328     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _update_rec(
<a name="l03329"></a>03329         <span class="keyword">const</span> <a class="code" href="../../d7/df5/classrid__t.html">rid_t</a>&amp;             rid, 
<a name="l03330"></a>03330         smsize_t                 start, 
<a name="l03331"></a>03331         <span class="keyword">const</span> <a class="code" href="../../d8/ddb/classvec__t.html">vec_t</a>&amp;             data
<a name="l03332"></a>03332 #ifdef SM_DORA
<a name="l03333"></a>03333         , <span class="keyword">const</span> <span class="keywordtype">bool</span>             bIgnoreLocks = <span class="keyword">false</span>
<a name="l03334"></a>03334 #endif
<a name="l03335"></a>03335         );
<a name="l03336"></a>03336 
<a name="l03337"></a>03337     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _update_rec_hdr(
<a name="l03338"></a>03338         <span class="keyword">const</span> <a class="code" href="../../d7/df5/classrid__t.html">rid_t</a>&amp;             rid, 
<a name="l03339"></a>03339         smsize_t                 start, 
<a name="l03340"></a>03340         <span class="keyword">const</span> <a class="code" href="../../d8/ddb/classvec__t.html">vec_t</a>&amp;             hdr
<a name="l03341"></a>03341 #ifdef SM_DORA
<a name="l03342"></a>03342         , <span class="keyword">const</span> <span class="keywordtype">bool</span>             bIgnoreLocks = <span class="keyword">false</span>
<a name="l03343"></a>03343 #endif
<a name="l03344"></a>03344         );
<a name="l03345"></a>03345 
<a name="l03346"></a>03346     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _append_rec(
<a name="l03347"></a>03347         <span class="keyword">const</span> <a class="code" href="../../d7/df5/classrid__t.html">rid_t</a>&amp;             rid, 
<a name="l03348"></a>03348         <span class="keyword">const</span> <a class="code" href="../../d8/ddb/classvec__t.html">vec_t</a>&amp;             data
<a name="l03349"></a>03349         );
<a name="l03350"></a>03350 
<a name="l03351"></a>03351     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _truncate_rec(
<a name="l03352"></a>03352             <span class="keyword">const</span> <a class="code" href="../../d7/df5/classrid__t.html">rid_t</a>&amp;         rid, 
<a name="l03353"></a>03353             smsize_t             amount,
<a name="l03354"></a>03354             <span class="keywordtype">bool</span>&amp;                should_forward
<a name="l03355"></a>03355         );
<a name="l03356"></a>03356 
<a name="l03357"></a>03357     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _draw_rtree(<span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp; stid, ostream &amp;);
<a name="l03358"></a>03358 
<a name="l03359"></a>03359     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _rtree_stats(
<a name="l03360"></a>03360             <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;       stid,
<a name="l03361"></a>03361             rtree_stats_t&amp;      stat,
<a name="l03362"></a>03362             uint2_t             size,
<a name="l03363"></a>03363             uint2_t*            ovp,
<a name="l03364"></a>03364             <span class="keywordtype">bool</span>                audit
<a name="l03365"></a>03365         );
<a name="l03366"></a>03366 
<a name="l03367"></a>03367 <span class="preprocessor">#ifdef OLDSORT_COMPATIBILITY</span>
<a name="l03368"></a>03368 <span class="preprocessor"></span>    <span class="comment">/* old sort internal, physical */</span>
<a name="l03369"></a>03369     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _sort_file(
<a name="l03370"></a>03370         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;           fid, 
<a name="l03371"></a>03371         <a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a>                   vid, 
<a name="l03372"></a>03372         <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;                 sfid, 
<a name="l03373"></a>03373         <a class="code" href="../../da/d44/classss__m.html#a7a0a9b5677337b6d5a4e3f42d9fa149">store_property_t</a>        property,
<a name="l03374"></a>03374         <span class="keyword">const</span> key_info_t&amp;       key_info, 
<a name="l03375"></a>03375         <span class="keywordtype">int</span>                     run_size,
<a name="l03376"></a>03376         <span class="keywordtype">bool</span>                    ascending,
<a name="l03377"></a>03377         <span class="keywordtype">bool</span>                    unique,
<a name="l03378"></a>03378         <span class="keywordtype">bool</span>                    destructive
<a name="l03379"></a>03379     );
<a name="l03380"></a>03380 <span class="preprocessor">#endif </span><span class="comment">/* OLDSORT_COMPATIBILITY */</span>
<a name="l03381"></a>03381 
<a name="l03382"></a>03382     <span class="comment">/* new sort internal, physical */</span>
<a name="l03383"></a>03383     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _sort_file(
<a name="l03384"></a>03384         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;             fid,     <span class="comment">// input file</span>
<a name="l03385"></a>03385         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;             sorted_fid, <span class="comment">// output file -- </span>
<a name="l03386"></a>03386                         <span class="comment">// created by caller--</span>
<a name="l03387"></a>03387                         <span class="comment">// can be same as input file</span>
<a name="l03388"></a>03388         <span class="keywordtype">int</span>                      nvids,    <span class="comment">// array size for vids</span>
<a name="l03389"></a>03389         <span class="keyword">const</span> <a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a>*             vid,     <span class="comment">// array of vids for temp</span>
<a name="l03390"></a>03390         <a class="code" href="../../d7/d50/classssm__sort_1_1sort__keys__t.html">sort_keys_t</a>&amp;             kl,     <span class="comment">// key location info &amp;</span>
<a name="l03391"></a>03391         smsize_t                 min_rec_sz, <span class="comment">// for estimating space use</span>
<a name="l03392"></a>03392         <span class="keywordtype">int</span>                      run_size,   <span class="comment">// # pages to use for a run</span>
<a name="l03393"></a>03393         <span class="keywordtype">int</span>                      temp_space <span class="comment">//# pages VM to use for scratch </span>
<a name="l03394"></a>03394     );
<a name="l03395"></a>03395 
<a name="l03396"></a>03396 
<a name="l03397"></a>03397 <span class="preprocessor">#ifdef OLDSORT_COMPATIBILITY</span>
<a name="l03398"></a>03398 <span class="preprocessor"></span>    <span class="comment">/* internal compatibility old sort-&gt; new sort */</span>
<a name="l03399"></a>03399     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _new_sort_file(
<a name="l03400"></a>03400             <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;         in_fid, 
<a name="l03401"></a>03401             <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp;         out_fid, 
<a name="l03402"></a>03402             <span class="keyword">const</span> key_info_t&amp;    ki, 
<a name="l03403"></a>03403             <span class="keywordtype">int</span>                  run_size,
<a name="l03404"></a>03404             <span class="keywordtype">bool</span>                  ascending, 
<a name="l03405"></a>03405             <span class="keywordtype">bool</span>                  unique, 
<a name="l03406"></a>03406             <span class="keywordtype">bool</span>                  keep_orig <span class="comment">//!destructive</span>
<a name="l03407"></a>03407 <span class="comment"></span>            ); 
<a name="l03408"></a>03408 <span class="preprocessor">#endif </span><span class="comment">/* OLDSORT_COMPATIBILITY */</span>
<a name="l03409"></a>03409 
<a name="l03410"></a>03410     <span class="keyword">static</span> store_flag_t     _make_store_flag(<a class="code" href="../../da/d44/classss__m.html#a7a0a9b5677337b6d5a4e3f42d9fa149">store_property_t</a> property);
<a name="l03411"></a>03411     <span class="comment">// reverse function:</span>
<a name="l03412"></a>03412     <span class="comment">// static store_property_t    _make_store_property(w_base_t::uint4_t flag);</span>
<a name="l03413"></a>03413     <span class="comment">// is in dir_vol_m</span>
<a name="l03414"></a>03414 
<a name="l03415"></a>03415     <span class="comment">// this is for df statistics  DU DF</span>
<a name="l03416"></a>03416     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _get_du_statistics(
<a name="l03417"></a>03417         <a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a>                  vid, 
<a name="l03418"></a>03418         sm_du_stats_t&amp;         du,
<a name="l03419"></a>03419         <span class="keywordtype">bool</span>                   audit);
<a name="l03420"></a>03420 
<a name="l03421"></a>03421     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _get_du_statistics(
<a name="l03422"></a>03422         <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>  &amp;        stid, 
<a name="l03423"></a>03423         sm_du_stats_t&amp;         du,
<a name="l03424"></a>03424         <span class="keywordtype">bool</span>                   audit);
<a name="l03425"></a>03425 
<a name="l03426"></a>03426     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _get_volume_meta_stats(
<a name="l03427"></a>03427         <a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a>                  vid,
<a name="l03428"></a>03428         SmVolumeMetaStats&amp;     volume_stats,
<a name="l03429"></a>03429         <a class="code" href="../../da/d44/classss__m.html#50662c89c6fd0f384a655ca11e78b861">concurrency_t</a>          cc);
<a name="l03430"></a>03430 
<a name="l03431"></a>03431     <span class="keyword">static</span> <a class="code" href="../../db/dc7/classw__rc__t.html">rc_t</a>            _get_file_meta_stats(
<a name="l03432"></a>03432         <a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a>                  vid,
<a name="l03433"></a>03433         <a class="code" href="../../d9/da0/classw__base__t.html#7d1c7ae407200662fd16b64de4dcde46">w_base_t::uint4_t</a>      num_files,
<a name="l03434"></a>03434         SmFileMetaStats*       file_stats,
<a name="l03435"></a>03435         <span class="keywordtype">bool</span>                   batch_calculate,
<a name="l03436"></a>03436         <a class="code" href="../../da/d44/classss__m.html#50662c89c6fd0f384a655ca11e78b861">concurrency_t</a>          cc);
<a name="l03437"></a>03437 };
<a name="l03438"></a>03438 <span class="comment"></span>
<a name="l03439"></a>03439 <span class="comment">/**\brief Information about a store that can be queried by the client.</span>
<a name="l03440"></a>03440 <span class="comment"> * \details</span>
<a name="l03441"></a>03441 <span class="comment"> * This information is stored in a store directory on the volume.</span>
<a name="l03442"></a>03442 <span class="comment"> * It can be queried with ss_m::get_store_info.</span>
<a name="l03443"></a>03443 <span class="comment"> */</span>
<a name="l03444"></a><a class="code" href="../../d3/d8b/classsm__store__info__t.html">03444</a> <span class="keyword">class </span><a class="code" href="../../d3/d8b/classsm__store__info__t.html">sm_store_info_t</a> {
<a name="l03445"></a>03445 <span class="keyword">public</span>:
<a name="l03446"></a><a class="code" href="../../d3/d8b/classsm__store__info__t.html#c82e4188b72d400bd71f7b857a55ac00">03446</a>     <a class="code" href="../../dd/d93/w__base_8h.html#45d83e292de0c4c2a60998a0b9e82332">NORET</a> <a class="code" href="../../d3/d8b/classsm__store__info__t.html#c82e4188b72d400bd71f7b857a55ac00">sm_store_info_t</a>(<span class="keywordtype">int</span> len) :
<a name="l03447"></a>03447                 <a class="code" href="../../d3/d8b/classsm__store__info__t.html#678f7b61ce804cfba84e7e0468bc267e">store</a>(0), <a class="code" href="../../d3/d8b/classsm__store__info__t.html#0361f6eb9d61e49c041c5277c5ffd190">stype</a>(<a class="code" href="../../da/d44/classss__m.html">ss_m</a>::t_bad_store_t), 
<a name="l03448"></a>03448                 <a class="code" href="../../d3/d8b/classsm__store__info__t.html#557dd31abf3bbbf1ede932ac7b9eaf63">ntype</a>(<a class="code" href="../../da/d44/classss__m.html">ss_m</a>::t_bad_ndx_t), <a class="code" href="../../d3/d8b/classsm__store__info__t.html#6072a2b9a1f2eace98b5f2a0fe7f6f58">cc</a>(<a class="code" href="../../da/d44/classss__m.html">ss_m</a>::t_cc_bad),
<a name="l03449"></a>03449                 <a class="code" href="../../d3/d8b/classsm__store__info__t.html#96be60ccceb2a6acade88458c7c11c15">eff</a>(0), <a class="code" href="../../d3/d8b/classsm__store__info__t.html#038357eb47949e436ec6988463a74054">large_store</a>(0), <a class="code" href="../../d3/d8b/classsm__store__info__t.html#e7c4b571b21174dd9760610a55f6d901">root</a>(0),
<a name="l03450"></a>03450                 <a class="code" href="../../d3/d8b/classsm__store__info__t.html#a1dcaf5b07a6e590de14e1398c0619ba">nkc</a>(0), <a class="code" href="../../d3/d8b/classsm__store__info__t.html#c2cf10dd7e28ce30a57454427438fcfa">keydescrlen</a>(len)
<a name="l03451"></a>03451                 {  <a class="code" href="../../d3/d8b/classsm__store__info__t.html#b344b8d658c6304e6690b7043a72747c">keydescr</a> = <span class="keyword">new</span> <span class="keywordtype">char</span>[len]; }
<a name="l03452"></a>03452 
<a name="l03453"></a><a class="code" href="../../d3/d8b/classsm__store__info__t.html#873794e89c4d641e277fe2239ff807fa">03453</a>     <a class="code" href="../../dd/d93/w__base_8h.html#45d83e292de0c4c2a60998a0b9e82332">NORET</a> <a class="code" href="../../d3/d8b/classsm__store__info__t.html#873794e89c4d641e277fe2239ff807fa">~sm_store_info_t</a>() { <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8b/classsm__store__info__t.html#b344b8d658c6304e6690b7043a72747c">keydescr</a>) <span class="keyword">delete</span>[] <a class="code" href="../../d3/d8b/classsm__store__info__t.html#b344b8d658c6304e6690b7043a72747c">keydescr</a>; }
<a name="l03454"></a>03454 <span class="comment"></span>
<a name="l03455"></a>03455 <span class="comment">    /// store number</span>
<a name="l03456"></a><a class="code" href="../../d3/d8b/classsm__store__info__t.html#678f7b61ce804cfba84e7e0468bc267e">03456</a> <span class="comment"></span>    <a class="code" href="../../d3/dc7/group___i_d_s.html#g10c5a5843330e5c585b0527169f25029">snum_t</a>    <a class="code" href="../../d3/d8b/classsm__store__info__t.html#678f7b61ce804cfba84e7e0468bc267e">store</a>;        <span class="comment"></span>
<a name="l03457"></a>03457 <span class="comment">    /// t_index, t_file, ... See ss_m::store_t.</span>
<a name="l03458"></a><a class="code" href="../../d3/d8b/classsm__store__info__t.html#0361f6eb9d61e49c041c5277c5ffd190">03458</a> <span class="comment"></span>    u_char    <a class="code" href="../../d3/d8b/classsm__store__info__t.html#0361f6eb9d61e49c041c5277c5ffd190">stype</a>;        <span class="comment"></span>
<a name="l03459"></a>03459 <span class="comment">    /// t_btree, t_rtree,... See ss_m::ndx_t</span>
<a name="l03460"></a><a class="code" href="../../d3/d8b/classsm__store__info__t.html#557dd31abf3bbbf1ede932ac7b9eaf63">03460</a> <span class="comment"></span>    u_char    <a class="code" href="../../d3/d8b/classsm__store__info__t.html#557dd31abf3bbbf1ede932ac7b9eaf63">ntype</a>;        <span class="comment"></span>
<a name="l03461"></a>03461 <span class="comment">    /// t_cc_kvl, t_cc_record,... See ss_m::concurrency_t</span>
<a name="l03462"></a><a class="code" href="../../d3/d8b/classsm__store__info__t.html#6072a2b9a1f2eace98b5f2a0fe7f6f58">03462</a> <span class="comment"></span>    u_char    <a class="code" href="../../d3/d8b/classsm__store__info__t.html#6072a2b9a1f2eace98b5f2a0fe7f6f58">cc</a>;         
<a name="l03463"></a>03463 <span class="comment"></span>
<a name="l03464"></a>03464 <span class="comment">    /// Unused:</span>
<a name="l03465"></a><a class="code" href="../../d3/d8b/classsm__store__info__t.html#96be60ccceb2a6acade88458c7c11c15">03465</a> <span class="comment"></span>    u_char    <a class="code" href="../../d3/d8b/classsm__store__info__t.html#96be60ccceb2a6acade88458c7c11c15">eff</a>;        
<a name="l03466"></a>03466 <span class="comment"></span>
<a name="l03467"></a>03467 <span class="comment">    /// Store number for associated large-page store, if there is one.</span>
<a name="l03468"></a><a class="code" href="../../d3/d8b/classsm__store__info__t.html#038357eb47949e436ec6988463a74054">03468</a> <span class="comment"></span>    <a class="code" href="../../d3/dc7/group___i_d_s.html#g10c5a5843330e5c585b0527169f25029">snum_t</a>    <a class="code" href="../../d3/d8b/classsm__store__info__t.html#038357eb47949e436ec6988463a74054">large_store</a>; <span class="comment"></span>
<a name="l03469"></a>03469 <span class="comment">    /// Root page if this is an index.</span>
<a name="l03470"></a><a class="code" href="../../d3/d8b/classsm__store__info__t.html#e7c4b571b21174dd9760610a55f6d901">03470</a> <span class="comment"></span>    shpid_t    <a class="code" href="../../d3/d8b/classsm__store__info__t.html#e7c4b571b21174dd9760610a55f6d901">root</a>;        <span class="comment"></span>
<a name="l03471"></a>03471 <span class="comment">    /// Number of key components if this is an index.</span>
<a name="l03472"></a><a class="code" href="../../d3/d8b/classsm__store__info__t.html#a1dcaf5b07a6e590de14e1398c0619ba">03472</a> <span class="comment"></span>    <a class="code" href="../../d9/da0/classw__base__t.html#7d1c7ae407200662fd16b64de4dcde46">w_base_t::uint4_t</a>    <a class="code" href="../../d3/d8b/classsm__store__info__t.html#a1dcaf5b07a6e590de14e1398c0619ba">nkc</a>;  <span class="comment"></span>
<a name="l03473"></a>03473 <span class="comment">    /// Size of key description (if this is an index)</span>
<a name="l03474"></a><a class="code" href="../../d3/d8b/classsm__store__info__t.html#c2cf10dd7e28ce30a57454427438fcfa">03474</a> <span class="comment"></span>    <span class="keywordtype">int</span>        <a class="code" href="../../d3/d8b/classsm__store__info__t.html#c2cf10dd7e28ce30a57454427438fcfa">keydescrlen</a>;    <span class="comment"></span>
<a name="l03475"></a>03475 <span class="comment">    /**\brief Variable length string.</span>
<a name="l03476"></a>03476 <span class="comment">     *</span>
<a name="l03477"></a>03477 <span class="comment">     * He who creates a sm_store_info_t for use with get_store_info()</span>
<a name="l03478"></a>03478 <span class="comment">     * is responsible for allocating enough space for </span>
<a name="l03479"></a>03479 <span class="comment">     * key descriptors if he expects to find them.</span>
<a name="l03480"></a>03480 <span class="comment">     * See \ref key_description.</span>
<a name="l03481"></a>03481 <span class="comment">     */</span>
<a name="l03482"></a><a class="code" href="../../d3/d8b/classsm__store__info__t.html#b344b8d658c6304e6690b7043a72747c">03482</a>     <span class="keywordtype">char</span>        *<a class="code" href="../../d3/d8b/classsm__store__info__t.html#b344b8d658c6304e6690b7043a72747c">keydescr</a>;    
<a name="l03483"></a>03483 };
<a name="l03484"></a>03484 
<a name="l03485"></a>03485 
<a name="l03486"></a>03486 ostream&amp; <a class="code" href="../../de/d94/w__hash_8h.html#7c2e56bc1ff4f3aa420f06b5e25dd768">operator&lt;&lt;</a>(ostream&amp; o, <span class="keyword">const</span> <a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a>&amp; v);
<a name="l03487"></a>03487 istream&amp; operator&gt;&gt;(istream&amp; i, <a class="code" href="../../d3/d3f/structvid__t.html">vid_t</a>&amp; v);
<a name="l03488"></a>03488 ostream&amp; <a class="code" href="../../de/d94/w__hash_8h.html#7c2e56bc1ff4f3aa420f06b5e25dd768">operator&lt;&lt;</a>(ostream&amp; o, <span class="keyword">const</span> <a class="code" href="../../d0/d87/classextid__t.html">extid_t</a>&amp; x);
<a name="l03489"></a>03489 istream&amp; operator&gt;&gt;(istream&amp; o, <a class="code" href="../../d0/d87/classextid__t.html">extid_t</a> &amp;x);
<a name="l03490"></a>03490 ostream&amp; <a class="code" href="../../de/d94/w__hash_8h.html#7c2e56bc1ff4f3aa420f06b5e25dd768">operator&lt;&lt;</a>(ostream&amp; o, <span class="keyword">const</span> <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp; stid);
<a name="l03491"></a>03491 istream&amp; operator&gt;&gt;(istream&amp; i, <a class="code" href="../../da/d5b/structstid__t.html">stid_t</a>&amp; stid);
<a name="l03492"></a>03492 ostream&amp; <a class="code" href="../../de/d94/w__hash_8h.html#7c2e56bc1ff4f3aa420f06b5e25dd768">operator&lt;&lt;</a>(ostream&amp; o, <span class="keyword">const</span> <a class="code" href="../../d5/d47/classlpid__t.html">lpid_t</a>&amp; pid);
<a name="l03493"></a>03493 istream&amp; operator&gt;&gt;(istream&amp; i, <a class="code" href="../../d5/d47/classlpid__t.html">lpid_t</a>&amp; pid);
<a name="l03494"></a>03494 ostream&amp; <a class="code" href="../../de/d94/w__hash_8h.html#7c2e56bc1ff4f3aa420f06b5e25dd768">operator&lt;&lt;</a>(ostream&amp; o, <span class="keyword">const</span> <a class="code" href="../../de/de9/classshrid__t.html">shrid_t</a>&amp; r);
<a name="l03495"></a>03495 istream&amp; operator&gt;&gt;(istream&amp; i, <a class="code" href="../../de/de9/classshrid__t.html">shrid_t</a>&amp; r);
<a name="l03496"></a>03496 ostream&amp; <a class="code" href="../../de/d94/w__hash_8h.html#7c2e56bc1ff4f3aa420f06b5e25dd768">operator&lt;&lt;</a>(ostream&amp; o, <span class="keyword">const</span> <a class="code" href="../../d7/df5/classrid__t.html">rid_t</a>&amp; rid);
<a name="l03497"></a>03497 istream&amp; operator&gt;&gt;(istream&amp; i, <a class="code" href="../../d7/df5/classrid__t.html">rid_t</a>&amp; rid);
<a name="l03498"></a>03498 ostream&amp; <a class="code" href="../../de/d94/w__hash_8h.html#7c2e56bc1ff4f3aa420f06b5e25dd768">operator&lt;&lt;</a>(ostream&amp; o, <span class="keyword">const</span> <a class="code" href="../../d9/dee/classsm__stats__info__t.html">sm_stats_info_t</a>&amp; s);
<a name="l03499"></a>03499 <span class="keyword">template</span>&lt;<span class="keyword">class</span> ostream&gt;
<a name="l03500"></a><a class="code" href="../../db/d3e/structsm__config__info__t.html#cbc899479093e264ceaf89aecfd78ded">03500</a> ostream&amp; <a class="code" href="../../de/d94/w__hash_8h.html#7c2e56bc1ff4f3aa420f06b5e25dd768">operator&lt;&lt;</a>(ostream&amp; o, <span class="keyword">const</span> <a class="code" href="../../db/d3e/structsm__config__info__t.html">sm_config_info_t</a>&amp; s)
<a name="l03501"></a>03501 {
<a name="l03502"></a>03502     o    &lt;&lt; <span class="stringliteral">"  page_size "</span> &lt;&lt; s.<a class="code" href="../../db/d3e/structsm__config__info__t.html#693d8ab5272435cca29f4bc6e32af55d">page_size</a>
<a name="l03503"></a>03503      &lt;&lt; <span class="stringliteral">"  max_small_rec "</span> &lt;&lt; s.<a class="code" href="../../db/d3e/structsm__config__info__t.html#863df52a2d6681529bb4424caa3fdac3">max_small_rec</a>
<a name="l03504"></a>03504      &lt;&lt; <span class="stringliteral">"  lg_rec_page_space "</span> &lt;&lt; s.<a class="code" href="../../db/d3e/structsm__config__info__t.html#6fc608b307d1d9307a7128fa7073f0a7">lg_rec_page_space</a>
<a name="l03505"></a>03505      &lt;&lt; <span class="stringliteral">"  buffer_pool_size "</span> &lt;&lt; s.<a class="code" href="../../db/d3e/structsm__config__info__t.html#c59ddb661df0589eddc2a3077f495c31">buffer_pool_size</a>
<a name="l03506"></a>03506      &lt;&lt; <span class="stringliteral">"  max_btree_entry_size "</span> &lt;&lt; s.<a class="code" href="../../db/d3e/structsm__config__info__t.html#894a425dc66b1faa394dd645fb339251">max_btree_entry_size</a>
<a name="l03507"></a>03507      &lt;&lt; <span class="stringliteral">"  exts_on_page "</span> &lt;&lt; s.<a class="code" href="../../db/d3e/structsm__config__info__t.html#3579a8776d9e64605a92e5897c73711e">exts_on_page</a>
<a name="l03508"></a>03508      &lt;&lt; <span class="stringliteral">"  pages_per_ext "</span> &lt;&lt; s.<a class="code" href="../../db/d3e/structsm__config__info__t.html#aaad176b935ea88163e8ab8a04142412">pages_per_ext</a>
<a name="l03509"></a>03509      &lt;&lt; <span class="stringliteral">"  logging "</span> &lt;&lt; s.<a class="code" href="../../db/d3e/structsm__config__info__t.html#9edf0dbb57d6a377674c99a9ebd0da22">logging</a>
<a name="l03510"></a>03510       ;
<a name="l03511"></a>03511     <span class="keywordflow">return</span> o;
<a name="l03512"></a>03512 }
<a name="l03513"></a>03513 
<a name="l03514"></a>03514 
<a name="l03515"></a>03515 <span class="preprocessor">#ifndef VEC_T_H</span>
<a name="l03516"></a>03516 <span class="preprocessor"></span><span class="preprocessor">#include &lt;vec_t.h&gt;</span>
<a name="l03517"></a>03517 <span class="preprocessor">#endif</span>
<a name="l03518"></a>03518 <span class="preprocessor"></span>
<a name="l03519"></a>03519 <span class="preprocessor">#ifndef SM_ESCALATION_H</span>
<a name="l03520"></a>03520 <span class="preprocessor"></span><span class="preprocessor">#include &lt;sm_escalation.h&gt;</span>
<a name="l03521"></a>03521 <span class="preprocessor">#endif</span>
<a name="l03522"></a>03522 <span class="preprocessor"></span>
<a name="l03523"></a>03523 <span class="comment">/*&lt;std-footer incl-file-exclusion='SM_H'&gt;  -- do not edit anything below this line -- */</span>
<a name="l03524"></a>03524 
<a name="l03525"></a>03525 <span class="preprocessor">#endif          </span><span class="comment">/*&lt;/std-footer&gt;*/</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Mon Jan 2 15:13:57 2012 for Shore Storage Manager by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
