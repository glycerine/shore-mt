<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Shore Storage Manager: Storage Manager Statistics</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
<link href="../../tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="../../main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="../../modules.html"><span>Modules</span></a></li>
    <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="../../classes.html"><span>Classes</span></a></li>
    <li><a href="../../files.html"><span>Files</span></a></li>
    <li><a href="../../dirs.html"><span>Directories</span></a></li>
    <li><a href="../../pages.html"><span>Related&nbsp;Pages</span></a></li>
    <li><a href="../../examples.html"><span>Examples</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<h1>Storage Manager Statistics<br>
<small>
[<a class="el" href="../../dc/dc8/group___s_s_m_a_p_i.html">SHORE Storage Manager Application Programming Interface (SSM API)</a>]</small>
</h1>
<p>
Collaboration diagram for Storage Manager Statistics:<center><table><tr><td><img src="../../d9/d76/group___s_s_m_s_t_a_t_s.png" border="0" alt="" usemap="#db/d19/d9_2d76_2group______s__s__m__s__t__a__t__s_map">
<map name="db/d19/d9_2d76_2group______s__s__m__s__t__a__t__s_map">
<area href="../../dc/dc8/group___s_s_m_a_p_i.html" shape="rect" coords="5,5,472,32" alt="">
</map></td></tr></table></center>
<hr><a name="_details"></a><h2>Detailed Description</h2>
The storage manager contains functions to gather statistics that it collects. These are mostly counters and are described here.<p>
Volumes can be analyzed to gather usage statistics. See <a class="el" href="../../d1/d92/group___s_s_m_v_o_l.html#gc2fa23322a74cbae9e1cf1e72b1734d5">ss_m::get_du_statistics</a> and <a class="el" href="../../d1/d92/group___s_s_m_v_o_l.html#gf8eb87487de0644945f509ccdbff320b">ss_m::get_volume_meta_stats</a>.<p>
Bulk-loading indexes gathers statistics about the bulk-load activity. See <a class="el" href="../../d6/d82/group___s_s_m_b_u_l_k_l_d.html#g9e6d6ba6150d24f9048eb0f95d5fa573">ss_m::bulkld_index</a> and <a class="el" href="../../d6/d82/group___s_s_m_b_u_l_k_l_d.html#g9b77fb1e5d190ae8391c59a4bddb06c7">ss_m::bulkld_md_index</a>.<p>
<dl compact><dt><b>Note:</b></dt><dd>A Perl script facilitates modifying the statistics gathered by generating much of the supporting code, including structure definitions and output operators. The server-writer can generate her own sets of statistics using the same Perl tool. See <a class="el" href="../../stats.html">STATS</a> for more information about how these statistics sets are built.</dd></dl>
The storage manager API allows a server to gather statistics on a per-transaction basis or on a global basis. These counters are not segregated by the semantics of the counters. Rather, they are segregated by the thread that performed the action being measured. In other words, an action is attributed to a transaction if it was performed by a thread while attached to that transaction. This means that some actions, such as writing pages to disk, might not be attributable to a transaction even though they are in some sense logically associated with that transaction. If the write is performed by a page writer (background thread), it will show up in the global statistics but not in any per-transaction statistics. On the other hand, if a write is performed by <a class="el" href="../../d2/dc6/group___s_s_m_s_t_o_r_e.html#ga2c0c195a649854ecab5913a941ea2f8">ss_m::set_store_property</a> (which flushes to disk all pages for the store thus changed) it will be attributed to the transaction.<p>
All statistics are collected on a per-smthread_t basis (thus avoiding expensive atomic updates on a per-counter basis). Each smthread has its own local <a class="el" href="../../d9/dee/classsm__stats__info__t.html">sm_stats_info_t</a> structure for these statistics. Any time this structure is cleared, its contents are added to a single global statistics structure (protected by a mutex) before it is cleared. The clearing happens in two circumstances:<ul>
<li>when an <a class="el" href="../../d7/d2a/classsmthread__t.html">smthread_t</a> is destroyed (in its destructor)</li><li>when an attached instrumented transaction collects the statistics from the thread (see below).</li></ul>
<p>
Thus, the single global statistics structure's contents reflect the activities of finished threads and of instrumented transactions' collected statistics, and all other activities are reflected in per-thread statistics structures.<p>
A value-added server may collect the global statistics with the <a class="el" href="../../d9/d76/group___s_s_m_s_t_a_t_s.html#g030ca9bdf4802a1b4dee5410e4a5e9e0">ss_m::gather_stats</a> method. This method first adds together all the per-thread statistics, adds in the global statistics, and returns. The global statistics cannot be reset, and, indeed, they survive the storage manager so that they can be gathered after the storage manager shuts down. This means that to determine incremental statistics, the value-added server has to keep the prior copy of statistics and diff the current statistics from the prior statistics. The <a class="el" href="../../d9/dee/classsm__stats__info__t.html">sm_stats_info_t</a> has a difference operator to make this easy. <dl compact><dt><b>Attention:</b></dt><dd>Gathering the per-thread statistics from running threads is not atomic; in other words, if threads are updating their counters while the gathering of their counters is going on, some counts may be missed (become stale). (In any case, they will be stale soon after the statistics are gathered.)</dd></dl>
A transaction must be instrumented to collect its statistics.<p>
Instrumenting a transaction consists in allocating a structure in which to store the collected statistics, and passing in that structure to the storage manager using using the variants of begin_xct, commit_xct, etc that take an argument of this type.<p>
When a transaction is detached from a thread, the statistics it gathered up to that point by the thread are added to the per-transaction statistics, and the thread statistics are cleared so they don't get over-counted.<p>
A server may gather the per-transaction statistics for the attached running transaction with <a class="el" href="../../d8/d1e/group___s_s_m_x_c_t.html#geb3c76f7ef4cecb2edd02afbf3c1fa97">ss_m::gather_xct_stats</a>.<p>
A server may choose to reset the per-transaction statistics when it gathers them; this facilitates gathering incremental statistics. These counters aren't lost to the world, since their values were added to the global statistics before they were gathered in the first place.<p>
<dl compact><dt><b>Attention:</b></dt><dd>The per-transaction statistics structure is not protected against concurrently-attached threads, so its values are best collected and reset when the server knows that only one thread is attached to the transaction when making the call. </dd></dl>

<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static <a class="el" href="../../db/dc7/classw__rc__t.html">rc_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d76/group___s_s_m_s_t_a_t_s.html#g030ca9bdf4802a1b4dee5410e4a5e9e0">ss_m::gather_stats</a> (<a class="el" href="../../d9/dee/classsm__stats__info__t.html">sm_stats_info_t</a> &amp;stats)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get a copy of the global statistics.  <a href="#g030ca9bdf4802a1b4dee5410e4a5e9e0"></a><br></td></tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="g030ca9bdf4802a1b4dee5410e4a5e9e0"></a><!-- doxytag: member="ss_m::gather_stats" ref="g030ca9bdf4802a1b4dee5410e4a5e9e0" args="(sm_stats_info_t &amp;stats)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="../../db/dc7/classw__rc__t.html">rc_t</a> ss_m::gather_stats           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/dee/classsm__stats__info__t.html">sm_stats_info_t</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>stats</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [static, inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Get a copy of the global statistics. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>stats</em>&nbsp;</td><td>A pre-allocated structure. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Examples: </b></dt><dd>
<a class="el" href="../../df/d97/create__rec_8cpp-example.html#a22">create_rec.cpp</a>, and <a class="el" href="../../d0/d88/log__exceed_8cpp-example.html#a117">log_exceed.cpp</a>.</dl>
</div>
</div><p>
<hr size="1"><address style="align: right;"><small>Generated on Mon Jan 2 15:14:02 2012 for Shore Storage Manager by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
