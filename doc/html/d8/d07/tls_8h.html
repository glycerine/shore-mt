<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Shore Storage Manager: src/fc/tls.h File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
<link href="../../tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="../../main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="../../modules.html"><span>Modules</span></a></li>
    <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="../../classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="../../files.html"><span>Files</span></a></li>
    <li><a href="../../dirs.html"><span>Directories</span></a></li>
    <li><a href="../../pages.html"><span>Related&nbsp;Pages</span></a></li>
    <li><a href="../../examples.html"><span>Examples</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="../../globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="../../dir_ff5597eff5bf2afe4bf6bec877c08348.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="../../dir_057c78c0d01d30fe5600b42b19a200c4.html">fc</a></div>
<h1>tls.h File Reference</h1><hr><a name="_details"></a><h2>Detailed Description</h2>
Cause macro definitions to show up in doxygen-generated pages 
<p>
Definition in file <a class="el" href="../../d6/d09/tls_8h-source.html">tls.h</a>.
<p>

<p>
<a href="../../d6/d09/tls_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Namespaces</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d9e/namespacetls__tricks.html">tls_tricks</a></td></tr>

<tr><td colspan="2"><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/dbe/classtls__tricks_1_1tls__manager.html">tls_tricks::tls_manager</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A management class for non-POD thread-local storage.  <a href="../../d4/dbe/classtls__tricks_1_1tls__manager.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/db3/structtls__tricks_1_1tls__manager__schwarz.html">tls_tricks::tls_manager_schwarz</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Static struct to make sure tls_manager's global init() and fini() are called.  <a href="../../d8/db3/structtls__tricks_1_1tls__manager__schwarz.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d5d/structtls__tricks_1_1tls__blob.html">tls_tricks::tls_blob&lt; T &gt;</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Wrapper for a type, used by TLS_STRUCT helper macro.  <a href="../../de/d5d/structtls__tricks_1_1tls__blob.html#_details">More...</a><br></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d07/tls_8h.html#3c79cd28a5159d78fbf99a3186a36a31">TLS_STRUCT</a>(Type, Name, InitFn)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Helper macro for DECLARE_TLS. Do not use directly.  <a href="#3c79cd28a5159d78fbf99a3186a36a31"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d07/tls_8h.html#3a762880076e9d81bf05d188a9941521">DECLARE_TLS</a>(Type, Name)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Cause non-POD TLS object of Type to be created and initialized.  <a href="#3a762880076e9d81bf05d188a9941521"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d07/tls_8h.html#6df152377a83fe91f1b4f1bbd09f713f">DECLARE_TLS_SCHWARZ</a>(Name)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Cause a Schwarz counter to be declared (for use in header files).  <a href="#6df152377a83fe91f1b4f1bbd09f713f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d07/tls_8h.html#f693c803abc56f4948f5775bc73a7359">DEFINE_TLS_SCHWARZ</a>(Type, Name)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Cause a Schwarz counter to be defined (for use in .cpp files).  <a href="#f693c803abc56f4948f5775bc73a7359"></a><br></td></tr>
</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="3c79cd28a5159d78fbf99a3186a36a31"></a><!-- doxytag: member="tls.h::TLS_STRUCT" ref="3c79cd28a5159d78fbf99a3186a36a31" args="(Type, Name, InitFn)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TLS_STRUCT          </td>
          <td>(</td>
          <td class="paramtype">Type,         <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Name,         <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">InitFn&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keyword">struct </span>Name {                                            \
    <span class="keyword">typedef</span> <a class="code" href="../../de/d5d/structtls__tricks_1_1tls__blob.html">tls_tricks::tls_blob&lt; Type &gt;</a> Wrapper;                \
    Type &amp;operator*() { <span class="keywordflow">return</span> *get(); }                \
    Type* operator-&gt;() { <span class="keywordflow">return</span> get(); }                \
    operator Type*() { <span class="keywordflow">return</span> get(); }                \
    <span class="keyword">static</span> Wrapper* get_wrapper() {                    \
        <span class="keyword">static</span> __thread Wrapper val;                \
        <span class="keywordflow">return</span> &amp;val;                        \
    }                                \
    <span class="keyword">static</span> Type* get() { <span class="keywordflow">return</span> get_wrapper()-&gt;get(); }        \
    <span class="keyword">static</span> <span class="keywordtype">void</span> init() { get_wrapper()-&gt;init(); }            \
    <span class="keyword">static</span> <span class="keywordtype">void</span> fini() { get_wrapper()-&gt;fini(); }            \
    InitFn() {                            \
        <span class="keyword">static</span> <span class="keywordtype">bool</span> initialized = <span class="keyword">false</span>;                \
        <span class="keywordflow">if</span>(initialized)                        \
        <span class="keywordflow">return</span>;                            \
        <a class="code" href="../../d4/dbe/classtls__tricks_1_1tls__manager.html#890b837e8086c08e22ff77089a19e6c1">tls_tricks::tls_manager::register_tls</a>(&amp;init, &amp;fini);            \
        initialized = <span class="keyword">true</span>;                        \
    }                                \
}
</pre></div>Helper macro for DECLARE_TLS. Do not use directly. 
<p>
<p>
A helper macro for DECLARE_TLS. <dl compact><dt><b>Attention:</b></dt><dd>Do not use this macro directly.</dd></dl>
Creates a "smart pointer" structure with the given Name; the pointer is to an object of the given Type. Actually, it's a pointer to a tls_blob, which is a bunch of untyped bytes, but they get initialized via placement new when a thread starts and "destructed" when the thread goes away. Passing in the InitFn allows us to register a non-trivial constructor, i.e., it allows us to use non-POD types in thread-local storage. This *only* lets us use a default constructor, but the compiler's idea of trivial is more strict than just having a default constructor. 
<p>
Definition at line <a class="el" href="../../d6/d09/tls_8h-source.html#l00214">214</a> of file <a class="el" href="../../d6/d09/tls_8h-source.html">tls.h</a>.
</div>
</div><p>
<a class="anchor" name="3a762880076e9d81bf05d188a9941521"></a><!-- doxytag: member="tls.h::DECLARE_TLS" ref="3a762880076e9d81bf05d188a9941521" args="(Type, Name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DECLARE_TLS          </td>
          <td>(</td>
          <td class="paramtype">Type,         <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Name&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keyword">static</span> \
    <a class="code" href="../../d8/d07/tls_8h.html#3c79cd28a5159d78fbf99a3186a36a31">TLS_STRUCT</a>(Type, Name##_tls_wrapper, Name##_tls_wrapper) Name
</pre></div>Cause non-POD TLS object of Type to be created and initialized. 
<p>
This macro declares a static "smart pointer" named * Name_tls_wrapper to a thread-local variable of the given Type. When this static struct get initialized at static-init time, it registers with the tls manager its init and fini methods. Those methods invoke the init and fini methods of the item to which this "smart pointer" points, which is the actual TLS entity: a tls_tricks::tls_blobType.<p>
 
<p>
Definition at line <a class="el" href="../../d6/d09/tls_8h-source.html#l00251">251</a> of file <a class="el" href="../../d6/d09/tls_8h-source.html">tls.h</a>.
</div>
</div><p>
<a class="anchor" name="6df152377a83fe91f1b4f1bbd09f713f"></a><!-- doxytag: member="tls.h::DECLARE_TLS_SCHWARZ" ref="6df152377a83fe91f1b4f1bbd09f713f" args="(Name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DECLARE_TLS_SCHWARZ          </td>
          <td>(</td>
          <td class="paramtype">Name&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keyword">static</span> <span class="keyword">struct </span>Name##_tls_wrapper_schwarz {    \
            Name##_tls_wrapper_schwarz();        \
    } Name##_schwarz
</pre></div>Cause a Schwarz counter to be declared (for use in header files). 
<p>
<p>
Make a Schwarz counter (in a .h) to force initialization of the TLS defined in a .cpp by DEFINE_TLS_SCHWARZ. This is useful if there is a dependency between 2+ TLS variables so the correct one is initialized first. The only way you can control their order is to make sure their DECLARE_TLS_SCHWARZ macros are in the correct order b/c C++ guarantees static init order only for objects in the same translation unit. Note that the counter is really in the tls wrapper. 
<p>
Definition at line <a class="el" href="../../d6/d09/tls_8h-source.html#l00272">272</a> of file <a class="el" href="../../d6/d09/tls_8h-source.html">tls.h</a>.
</div>
</div><p>
<a class="anchor" name="f693c803abc56f4948f5775bc73a7359"></a><!-- doxytag: member="tls.h::DEFINE_TLS_SCHWARZ" ref="f693c803abc56f4948f5775bc73a7359" args="(Type, Name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEFINE_TLS_SCHWARZ          </td>
          <td>(</td>
          <td class="paramtype">Type,         <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Name&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keyword">static</span> <a class="code" href="../../d8/d07/tls_8h.html#3c79cd28a5159d78fbf99a3186a36a31">TLS_STRUCT</a>(Type, Name##_tls_wrapper, <span class="keyword">static</span> <span class="keywordtype">void</span> init_wrapper) Name; \
    Name##_tls_wrapper_schwarz::Name##_tls_wrapper_schwarz() {        \
        Name##_tls_wrapper::init_wrapper();                \
    }
</pre></div>Cause a Schwarz counter to be defined (for use in .cpp files). 
<p>
<p>
Define the TLS struct that DECLARE_TLS_SCHWARZ expects to initialize. 
<p>
Definition at line <a class="el" href="../../d6/d09/tls_8h-source.html#l00285">285</a> of file <a class="el" href="../../d6/d09/tls_8h-source.html">tls.h</a>.
</div>
</div><p>
<hr size="1"><address style="align: right;"><small>Generated on Mon Jan 2 15:13:57 2012 for Shore Storage Manager by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
