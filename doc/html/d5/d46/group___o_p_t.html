<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Shore Storage Manager: Configuring and Building the Storage Manager</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
<link href="../../tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="../../main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="../../modules.html"><span>Modules</span></a></li>
    <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="../../classes.html"><span>Classes</span></a></li>
    <li><a href="../../files.html"><span>Files</span></a></li>
    <li><a href="../../dirs.html"><span>Directories</span></a></li>
    <li><a href="../../pages.html"><span>Related&nbsp;Pages</span></a></li>
    <li><a href="../../examples.html"><span>Examples</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<h1>Configuring and Building the Storage Manager</h1><hr><a name="_details"></a><h2>Detailed Description</h2>
Configuring and building the storage manager consists of these steps, all done at the root of the distribution directory tree.<ul>
<li>bootstrap</li><li>configure</li><li>build (make)</li></ul>
<h2><a class="anchor" name="OPTBOOT">
Bootstrapping</a></h2>
Bootstrapping might not be necessary, but if you have the autotools installed, it might save time to bootstrap the first time you try to build, particularly if you are installing on a system other than Linux. To bootstrap, type ./bootstrap. You can also look at that script and run selected parts of it, since all it does is run the autotools.<p>
Autotools run abysmally slowly on Solaris.<h2><a class="anchor" name="OPTCONF">
Configuring</a></h2>
There are two parts to configuring the storage manager. The original configuration scheme of SHORE was encapsulated in <em>config/shore.def</em>, which described all or most pertinent CPP macros. We are moving away from that scheme and replacing it with autoconf options and features, but a few things still remain under the control of <em>shore.def</em>. These fall into three categories:<ul>
<li>details related to autoconf-controlled options, such as pathnames</li><li>basic compile-time constants that someone extending the storage manager might want to change</li><li>maintainer's tools</li></ul>
<p>
There remaining some CPP macros not described in <em>config/shore.def</em>:<ul>
<li>code of occasional utility for debugging purposes</li><li>code intended to be the subject of future experimentation</li></ul>
<p>
Configuring amounts to running ./configure from the root of the distribution directory tree, and, depending on the features you wish to use, editing <em>config/shore.def</em>.<p>
<dl compact><dt><b>Remarks:</b></dt><dd>The storage manager API contains a method <a class="el" href="../../d5/d46/group___o_p_t.html#g5d712983ca1189ce8e7f81a8116962e8">ss_m::config_info</a> (q.v.) that allows a server to determine, at run time, some of the compile-time limits determined by the configuration.</dd></dl>
<h3><a class="anchor" name="CONFIGOPT">
Configuration Options</a></h3>
To find the configuration options, type <div class="fragment"><pre class="fragment"> ./configure --help 
</pre></div>, the output of which is reproduced here.<p>
<div class="fragment"><pre class="fragment">SHORE-specific Features:
  --enable-pthread-mutex default:yes    Compile to use pthreads for mutexes for
                                        certain critical sections.
  --enable-lp64         default:yes     Compile to use LP 64 data model
                                        No other data model is supported yet.
                                        But we hope some day to port back to LP32.
  --enable-checkrc      default:no      Generate (expensive) code to verify return-code checking
                                        If a w_rc_t is set but not checked with
                                        method is_error(), upon destruction the
                                        w_rc_t will print a message to the effect
                                        "error not checked".
  --enable-trace        default:no      Include tracing code
                                        Run-time costly.  Good for debugging
                                        problems that are not timing-dependent.
                                        Use with DEBUG_FLAGS and DEBUG_FILE
                                        environment variables.  See \ref SSMTRACE.
  --enable-dbgsymbols   default:no      Turn on debugger symbols
                                        Use this to override what a given
                                        debugging level will normally do.
  --enable-explicit     default:no      Compile with explicit templates
                                        NOT TESTED. 
 \todo mainpage.h compile with or remove explicit templates

  --enable-valgrind     default:no      Enable running valgrind run-time behavior
                                        Includes some code for valgrind.
  --enable-purify       default:no      Enable build of &lt;prog&gt;.pure
  --enable-quantify     default:no      Enable build of &lt;prog&gt;.quant
  --enable-purecov      default:no      Enable build of &lt;prog&gt;.purecov

SHORE-specific Optional Packages:
  --with-page-size        1024, 2048, 4196, 8192(default), 16384, or 32768
  --with-hugetlbfs        Use the hugetlbfs for the buffer pool.
                          Depending on the target architecture, this might
                          be useful.  If you use it, you will need to set
                          a path for your hugetlbfs in config/shore.def.
                          The default is :
                          #define HUGETLBFS_PATH "/mnt/huge/SSM-BUFPOOL"
  --without-mmap          Do not use mmap for the buffer pool. Trumps
                          hugetlbfs option.
  --with-debug-level1     Include level 1 debug code, optimize.
                          This includes code in w_assert1 and 
                          #if W_DEBUG_LEVEL &gt; 0 /#endif pairs and 
                          #if W_DEBUG_LEVEL &gt;= 1 /#endif pairs and  and
                          W_IFDEBUG1
  --with-debug-level2     Include level 2 debug code, no optimize.
                          Equivalent to debug level 1 PLUS
                          code in w_assert2 and
                          #if W_DEBUG_LEVEL &gt; 1 /#endif pairs and
                          #if W_DEBUG_LEVEL &gt;= 2 /#endif pairs and
                          W_IFDEBUG2
  --with-debug-level3     Include level 3 debug code, no optimize.
                          Equivalent to debug level 2 PLUS
                          includes code in w_assert3  and
                          #if W_DEBUG_LEVEL &gt; 2 /#endif pairs and
                          #if W_DEBUG_LEVEL &gt;= 3 /#endif pairs and
                          W_IFDEBUG3
 </pre></div><p>
<dl compact><dt><b><a class="el" href="../../bug.html#_bug000001">Bug:</a></b></dt><dd>GNATS 136 Only 64-bit platforms are supported. The issue is that lsns and some other data structures need atomic methods.</dd></dl>
<dl compact><dt><b><a class="el" href="../../bug.html#_bug000001">Bug:</a></b></dt><dd>GNATS 143 The polyphase merge-sort does not handle this case: More than one run is required AND keys are embedded in objects AND the keys are already in lexicographic order in the object AND the keys are properly aligned AND the keys span multiple pages. It returns an error indication about a "broken key" comparison not being implemented. The workaround is to provide a marshal function or to put the sort key in the header of the object or to provide more memory (larger number of pages for the run size) for the sort.</dd></dl>
<dl compact><dt><b><a class="el" href="../../bug.html#_bug000001">Bug:</a></b></dt><dd>GNATS 139 Convert w_assert9 to w_assert3 where the asserts are still reasonable and remove the rest. Some of these are obsolete, some are racy in the new mt-context. All the w_assert9's are what used to be w_assert3; they were turned into 9 to disable them until they could be evaluated for usefulness, and many have been converted to 2 or 3-level asserts; many remain to be addressed.</dd></dl>
<h3><a class="anchor" name="SHOREDEFOPT">
Description of Selected CPP Macros</a></h3>
In this section we describe selected macros defined (or not) in <em>config/shore.def</em>.<p>
<ul>
<li>HUGETLBFS_PATH See --with-hugetlbfs in <a class="el" href="../../d5/d46/group___o_p_t.html#CONFIGOPT">Configuration Options</a>; see also <a class="el" href="../../references.html#REFHUGEPAGE1">Huge Pages</a> for use of hugetlbfs with Linux.</li></ul>
<p>
<ul>
<li>USE_SSMTEST Define this if you want to include crash test hooks in your smsh. This is for a maintainer's testing purposes and should not be defined for a release version of the storage manager.</li></ul>
<p>
<ul>
<li>COMMON_GTID_LENGTH : You can override the default length of a global transaction id. Useful only if your server implements distributed transactions.</li></ul>
<p>
<ul>
<li>COMMON_SERVER_HANDLE_LENGTH : You can override the default length of a server handle, the handle by which the server identifies a coordinator of distributed transaction. Useful only if your server implements distributed transactions.</li></ul>
<p>
<ul>
<li>SM_LOG_PARTITIONS : You can override the default maximum number of open partitions for the log by defining this.</li></ul>
<p>
<ul>
<li>SM_EXTENTSIZE : You can override the default extent size with this. Warning: you must also address the alignment of Pmap_Align4 based on the resulting size of a Pmap. See <a class="el" href="../../d6/d9f/extent_8h-source.html">extent.h</a>, logrec.h, pmap.h. Warning: this has never been tested. This information is included only for those whose hacking on the storage manager who may require larger extents.</li></ul>
<h3><a class="anchor" name="OPTTCL">
Tcl and smsh</a></h3>
The storage manager test shell, smsh, uses Tcl. Autoconf tries to find Tcl in a standard place; if it is found, fine. But if not, you must define two paths to your Tcl library and include files in <em>Makefile.local</em> at the top of the directory tree. If you Tcl installation is not built for multithreading, you must install such a copy and put its path in <em>Makefile.local</em>.<p>
Tcl is available from<ul>
<li>ActiveState (<a href="http://www.activestate.com/activetcl/">http://www.activestate.com/activetcl/</a>), or</li><li>SourceForge (<a href="http://sourceforge.net/projects/tcl/files/">http://sourceforge.net/projects/tcl/files/</a>).</li></ul>
<h2><a class="anchor" name="OPTBLD">
Building</a></h2>
Building the storage manager consist of running <div class="fragment"><pre class="fragment"> make
</pre></div><p>
Since it is not alway easy to tell what options were used for the most recent build in a directory, the compiler options used on the build are put in the file <em>makeflags</em> and the rest of the options are determined in <em>config/shore-config.h</em>, produced at configuration time.<p>
<dl compact><dt><b>Note:</b></dt><dd>For Solaris users: if you use CC rather than gcc, you will probably have to run configure with environment variable CXX defined as the path to your CC compiler, and you might also need <div class="fragment"><pre class="fragment"> configure --enable-dependency-tracking 
</pre></div>.</dd></dl>
<h2><a class="anchor" name="SHOREMKCHECK">
Checking the Release</a></h2>
After building the storage manager, you can check it by running <div class="fragment"><pre class="fragment"> make check
</pre></div> in the root of the directory tree. This runs unit tests for each libary.<p>
<dl compact><dt><b>Attention:</b></dt><dd>The storage manager test shell, smsh, is run by <div class="fragment"><pre class="fragment"> make check 
</pre></div>. Smsh uses Tcl. The path to you Tcl installation is given in <em>Makefile.local</em> at the top of the directory tree.</dd></dl>
<dl compact><dt><b>Note:</b></dt><dd>If you do not have Tcl installed and want to test the installation without smsh, you may run <em>make</em> <em>check</em> and ignore the fact that it chokes trying to build smsh, because smsh is the last test that <em>make</em> <em>check</em> runs.</dd></dl>
<h2><a class="anchor" name="SHOREMKINSTALL">
Installing the Release</a></h2>
You may run <div class="fragment"><pre class="fragment"> make install
</pre></div> This installs:<ul>
<li>the header files in<ul>
<li>&lt;includedir&gt; [default: &lt;prefix&gt;/include]</li></ul>
</li><li>the libraries in<ul>
<li>&lt;libdir&gt; [default: &lt;exec-prefix&gt;/lib]</li></ul>
</li></ul>
<p>
To change the prefixes, use one or more of these configure options: <div class="fragment"><pre class="fragment"> configure --prefix=\&lt;path\&gt; 
</pre></div> or <div class="fragment"><pre class="fragment"> configure --libdir=\&lt;path\&gt; 
</pre></div> or <div class="fragment"><pre class="fragment"> configure --includedir=\&lt;path\&gt; 
</pre></div> 
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static <a class="el" href="../../db/dc7/classw__rc__t.html">rc_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d46/group___o_p_t.html#g5d712983ca1189ce8e7f81a8116962e8">ss_m::config_info</a> (<a class="el" href="../../db/d3e/structsm__config__info__t.html">sm_config_info_t</a> &amp;info)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get a copy of configuration-dependent information.  <a href="#g5d712983ca1189ce8e7f81a8116962e8"></a><br></td></tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="g5d712983ca1189ce8e7f81a8116962e8"></a><!-- doxytag: member="ss_m::config_info" ref="g5d712983ca1189ce8e7f81a8116962e8" args="(sm_config_info_t &amp;info)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="../../db/dc7/classw__rc__t.html">rc_t</a> ss_m::config_info           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../db/d3e/structsm__config__info__t.html">sm_config_info_t</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>info</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [static, inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Get a copy of configuration-dependent information. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>info</em>&nbsp;</td><td>A pre-allocated structure. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Examples: </b></dt><dd>
<a class="el" href="../../df/d97/create__rec_8cpp-example.html#a48">create_rec.cpp</a>.</dl>
</div>
</div><p>
<hr size="1"><address style="align: right;"><small>Generated on Mon Jan 2 15:14:02 2012 for Shore Storage Manager by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
