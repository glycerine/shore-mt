<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Shore Storage Manager: Stores</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
<link href="../../tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="../../main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="../../modules.html"><span>Modules</span></a></li>
    <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="../../classes.html"><span>Classes</span></a></li>
    <li><a href="../../files.html"><span>Files</span></a></li>
    <li><a href="../../dirs.html"><span>Directories</span></a></li>
    <li><a href="../../pages.html"><span>Related&nbsp;Pages</span></a></li>
    <li><a href="../../examples.html"><span>Examples</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<h1>Stores<br>
<small>
[<a class="el" href="../../dd/d39/group___s_s_m_s_t_g.html">Storage Structures</a>]</small>
</h1>
<p>
Collaboration diagram for Stores:<center><table><tr><td><img src="../../d2/dc6/group___s_s_m_s_t_o_r_e.png" border="0" alt="" usemap="#d4/db6/d2_2dc6_2group______s__s__m__s__t__o__r__e_map">
<map name="d4/db6/d2_2dc6_2group______s__s__m__s__t__o__r__e_map">
<area href="../../dd/d39/group___s_s_m_s_t_g.html" shape="rect" coords="6,5,146,32" alt="">
</map></td></tr></table></center>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Indexes and files are special cases of "stores". A store is a linked list of extents, and an extent is a contiguous group of pages. So the store is the structure that holds together an ordered set of pages that can be used by a server and have an identifier (a store ID or <a class="el" href="../../da/d5b/structstid__t.html">stid_t</a>).<p>
Indexes and files of records are built on stores.<p>
Stores have logging properties and other metadata associated with them.<p>
The property that determines the logging level of the store is <a class="el" href="../../d2/dc6/group___s_s_m_s_t_o_r_e.html#g2ae901018445773c66b1a4efc5876629">sm_store_property_t</a>.<p>
Methods that let you get and change the metatdata are:<ul>
<li><a class="el" href="../../d2/dc6/group___s_s_m_s_t_o_r_e.html#g14c74fa39b62b687be709d38790118b3">ss_m::get_store_property</a></li><li><a class="el" href="../../d2/dc6/group___s_s_m_s_t_o_r_e.html#ga2c0c195a649854ecab5913a941ea2f8">ss_m::set_store_property</a></li><li><a class="el" href="../../d2/dc6/group___s_s_m_s_t_o_r_e.html#g9dccea70316f63f876c29aa44098388e">ss_m::get_store_info</a></li><li><a class="el" href="../../d3/dc7/group___i_d_s.html#g10c5a5843330e5c585b0527169f25029">snum_t</a></li></ul>
<p>
When a transaction deletes a file or index, the deletion of the underlying stores is delayed until the transaction commits so that the pages allocated to the stores remain reserved (lest the transaction aborts). The deleting transaction could, in theory, reuse the pages for another store, but in practice that is not done. Instead, when a store is deleted, the store is marked for deletion an put in a list for the transaction to delete upon commit. At commit time, stores that have property t_load_file or t_insert_file are converted to t_regular. 
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dc6/group___s_s_m_s_t_o_r_e.html#g2ae901018445773c66b1a4efc5876629">sm_store_property_t</a> { , <a class="el" href="../../d2/dc6/group___s_s_m_s_t_o_r_e.html#gg2ae901018445773c66b1a4efc58766298d65c010c0f41557d13aa024905a2db8">t_temporary</a> =  0x2, 
<a class="el" href="../../d2/dc6/group___s_s_m_s_t_o_r_e.html#gg2ae901018445773c66b1a4efc5876629fdc9391b959992c67a229219bcaff291">t_load_file</a> =  0x4, 
<a class="el" href="../../d2/dc6/group___s_s_m_s_t_o_r_e.html#gg2ae901018445773c66b1a4efc5876629f80e78cfe83b5c991e55b84eb82b5558">t_insert_file</a> =  0x08
 }</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Store property that controls logging of pages in the store.  <a href="../../d2/dc6/group___s_s_m_s_t_o_r_e.html#g2ae901018445773c66b1a4efc5876629">More...</a><br></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static <a class="el" href="../../db/dc7/classw__rc__t.html">rc_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dc6/group___s_s_m_s_t_o_r_e.html#ga2c0c195a649854ecab5913a941ea2f8">ss_m::set_store_property</a> (<a class="el" href="../../da/d5b/structstid__t.html">stid_t</a> stid, store_property_t property)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Change the store property of a file or index.  <a href="#ga2c0c195a649854ecab5913a941ea2f8"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static <a class="el" href="../../db/dc7/classw__rc__t.html">rc_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dc6/group___s_s_m_s_t_o_r_e.html#g14c74fa39b62b687be709d38790118b3">ss_m::get_store_property</a> (<a class="el" href="../../da/d5b/structstid__t.html">stid_t</a> stid, store_property_t &amp;property)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the store property of a file or index.  <a href="#g14c74fa39b62b687be709d38790118b3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static <a class="el" href="../../db/dc7/classw__rc__t.html">rc_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dc6/group___s_s_m_s_t_o_r_e.html#g9dccea70316f63f876c29aa44098388e">ss_m::get_store_info</a> (const <a class="el" href="../../da/d5b/structstid__t.html">stid_t</a> &amp;stid, <a class="el" href="../../d3/d8b/classsm__store__info__t.html">sm_store_info_t</a> &amp;info)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get various store information of a file or index.  <a href="#g9dccea70316f63f876c29aa44098388e"></a><br></td></tr>
</table>
<hr><h2>Enumeration Type Documentation</h2>
<a class="anchor" name="g2ae901018445773c66b1a4efc5876629"></a><!-- doxytag: member="sm_int_3.h::sm_store_property_t" ref="g2ae901018445773c66b1a4efc5876629" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="../../d2/dc6/group___s_s_m_s_t_o_r_e.html#g2ae901018445773c66b1a4efc5876629">sm_store_property_t</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Store property that controls logging of pages in the store. 
<p>
<ul>
<li>t_regular: All pages in the store are fully logged for ACID properties.</li><li>t_temporary: Structural changes to the store are guaranteed by logging but user data are not. In the case of indexes, the ihtegrity of the index is not guaranteed: only the integrity of the store is guaranteed. In the event of abort, the index must be destroyed. Temporary stores are destroyed when a volume is mounted or dismounted, so they do not survive restart, regardless whether a crash occurred.</li><li>t_load_file: A store that is created with this property starts out as a t_tempory store and is converted to a t_regular store upon commit.</li><li>t_insert_file: Updates to existing pages are fully logged (as if the store were t_regular), but pages allocated while the store has t_insert_file are not logged. This is useful for bulk-loading, e.g., a store is bulk-loaded in one transaction (t_load_file), which commits (now the file is t_regular); subsequent appends to the file would incur full logging, so the subsequent transaction can change the store's property to t_insert_file, append the data, and change the store's property back to t_regular.</li></ul>
<p>
<div class="fragment"><pre class="fragment">     * ------------------------------------------------------------
     * ------------------------------------------------------------
     * Permissible uses of store property by storage manager client:
     * ------------------------------------------------------------
     * Create a btree index: | Change it to:
     *    t_tmp NO
     *    t_load_file YES    | tmp NO load_file NO insert_file NO regular YES
     *    t_insert_file YES  | tmp NO load_file NO insert_file YES regular YES
     *    t_regular YES      | tmp NO load_file NO insert_file NO regular YES
     *
     * Create an rtree index:
     *    t_tmp YES          | tmp NO load_file NO insert_file NO regular YES
     *    t_load_file YES    | tmp NO load_file NO insert_file NO regular YES
     *    t_insert_file YES  | tmp NO load_file NO insert_file YES regular YES
     *    t_regular YES      | tmp NO load_file NO insert_file NO regular YES
     *
     * Create a file:        | Change it to:
     *    t_tmp YES          | tmp NO load_file NO insert_file YES regular YES
     *    t_load_file YES    | tmp NO load_file NO insert_file YES regular YES
     *    t_insert_file YES  | tmp NO load_file NO insert_file YES regular YES
     *    t_regular YES      | tmp NO load_file NO insert_file YES regular YES
     * ------------------------------------------------------------
     * Effects of changing a file to regular:
     *    This causes the buffer pool to 
     *    force to disk all dirty pages for the store, and 
     *    to discard (evict from the buffer pool) all the store's 
     *    pages, clean or dirty.  When these pages are next read 
     *    into the buffer pool, they will be tagged as regular. 
     * ------------------------------------------------------------
     * Effects of commit:
     *    t_tmp              remains t_tmp  
     *    t_load_file        store is t_regular**
     *    t_insert_file      store is t_regular**
     *    t_regular          ACID
     *          ** Upon creation of such a store, the storage manager pushes
     *          this store on a list to traverse and convert to regular
     *          upon commit.
     *          Upon changing a store's property to t_insert_file,
     *          the storage manager pushes the store on this same list. 
     * ------------------------------------------------------------
     * Effects of abort on user data:
     *    t_tmp              undefined: client must remove store
     *    t_load_file        undefined: client must remove store
     *    t_insert_file      undefined: client must remove store
     *    t_regular          ACID
     * ------------------------------------------------------------
     * Effects of dismount/mount/restart:
     *    t_tmp              store removed
     *    t_load_file        undefined if not commited
     *    t_insert_file      undefined if not commited
     *    t_regular          ACID
     * ------------------------------------------------------------
     * </pre></div> <dl compact><dt><b>Enumerator: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" name="gg2ae901018445773c66b1a4efc58766298d65c010c0f41557d13aa024905a2db8"></a><!-- doxytag: member="t_temporary" ref="gg2ae901018445773c66b1a4efc58766298d65c010c0f41557d13aa024905a2db8" args="" -->t_temporary</em>&nbsp;</td><td>
allowed only in create </td></tr>
<tr><td valign="top"><em><a class="anchor" name="gg2ae901018445773c66b1a4efc5876629fdc9391b959992c67a229219bcaff291"></a><!-- doxytag: member="t_load_file" ref="gg2ae901018445773c66b1a4efc5876629fdc9391b959992c67a229219bcaff291" args="" -->t_load_file</em>&nbsp;</td><td>
allowed only in create, these files start out as temp and are converted to regular on commit </td></tr>
<tr><td valign="top"><em><a class="anchor" name="gg2ae901018445773c66b1a4efc5876629f80e78cfe83b5c991e55b84eb82b5558"></a><!-- doxytag: member="t_insert_file" ref="gg2ae901018445773c66b1a4efc5876629f80e78cfe83b5c991e55b84eb82b5558" args="" -->t_insert_file</em>&nbsp;</td><td>
current pages logged, new pages not logged EX lock is acquired on file. only valid with a normal file, not indices. </td></tr>
</table>
</dl>

<p>
Definition at line <a class="el" href="../../d4/df6/sm__int__3_8h-source.html#l00131">131</a> of file <a class="el" href="../../d4/df6/sm__int__3_8h-source.html">sm_int_3.h</a>.
</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="ga2c0c195a649854ecab5913a941ea2f8"></a><!-- doxytag: member="ss_m::set_store_property" ref="ga2c0c195a649854ecab5913a941ea2f8" args="(stid_t stid, store_property_t property)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="../../db/dc7/classw__rc__t.html">rc_t</a> ss_m::set_store_property           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../da/d5b/structstid__t.html">stid_t</a>&nbsp;</td>
          <td class="paramname"> <em>stid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../da/d44/classss__m.html#a7a0a9b5677337b6d5a4e3f42d9fa149">store_property_t</a>&nbsp;</td>
          <td class="paramname"> <em>property</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static, inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Change the store property of a file or index. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>stid</em>&nbsp;</td><td>File ID or index ID of the store to change. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>property</em>&nbsp;</td><td>Enumeration store_property_t (alias for <a class="el" href="../../d2/dc6/group___s_s_m_s_t_o_r_e.html#g2ae901018445773c66b1a4efc5876629">smlevel_3::sm_store_property_t</a>, q.v.)</td></tr>
  </table>
</dl>
The possible uses of store properties are described with <a class="el" href="../../d2/dc6/group___s_s_m_s_t_o_r_e.html#g2ae901018445773c66b1a4efc5876629">smlevel_3::sm_store_property_t</a>. 
</div>
</div><p>
<a class="anchor" name="g14c74fa39b62b687be709d38790118b3"></a><!-- doxytag: member="ss_m::get_store_property" ref="g14c74fa39b62b687be709d38790118b3" args="(stid_t stid, store_property_t &amp;property)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="../../db/dc7/classw__rc__t.html">rc_t</a> ss_m::get_store_property           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../da/d5b/structstid__t.html">stid_t</a>&nbsp;</td>
          <td class="paramname"> <em>stid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../da/d44/classss__m.html#a7a0a9b5677337b6d5a4e3f42d9fa149">store_property_t</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>property</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static, inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Get the store property of a file or index. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>stid</em>&nbsp;</td><td>File ID or index ID of the store of interest. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>property</em>&nbsp;</td><td>Reference to enumeration store_property_t (alias for <a class="el" href="../../d2/dc6/group___s_s_m_s_t_o_r_e.html#g2ae901018445773c66b1a4efc5876629">smlevel_3::sm_store_property_t</a>, q.v.)</td></tr>
  </table>
</dl>
The possible uses of store properties are described with <a class="el" href="../../d2/dc6/group___s_s_m_s_t_o_r_e.html#g2ae901018445773c66b1a4efc5876629">smlevel_3::sm_store_property_t</a>. 
</div>
</div><p>
<a class="anchor" name="g9dccea70316f63f876c29aa44098388e"></a><!-- doxytag: member="ss_m::get_store_info" ref="g9dccea70316f63f876c29aa44098388e" args="(const stid_t &amp;stid, sm_store_info_t &amp;info)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="../../db/dc7/classw__rc__t.html">rc_t</a> ss_m::get_store_info           </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../da/d5b/structstid__t.html">stid_t</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>stid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d3/d8b/classsm__store__info__t.html">sm_store_info_t</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>info</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static, inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Get various store information of a file or index. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>stid</em>&nbsp;</td><td>File ID or index ID of the store of interest. </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>info</em>&nbsp;</td><td>Reference to <a class="el" href="../../d3/d8b/classsm__store__info__t.html">sm_store_info_t</a> into which to write the results.</td></tr>
  </table>
</dl>
Get internally stored information about a store. 
</div>
</div><p>
<hr size="1"><address style="align: right;"><small>Generated on Mon Jan 2 15:14:01 2012 for Shore Storage Manager by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
