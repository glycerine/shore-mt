<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Shore Storage Manager: Distributed Transactions: Two-Phase Commit</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
<link href="../../tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="../../main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="../../modules.html"><span>Modules</span></a></li>
    <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="../../classes.html"><span>Classes</span></a></li>
    <li><a href="../../files.html"><span>Files</span></a></li>
    <li><a href="../../dirs.html"><span>Directories</span></a></li>
    <li><a href="../../pages.html"><span>Related&nbsp;Pages</span></a></li>
    <li><a href="../../examples.html"><span>Examples</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<h1>Distributed Transactions: Two-Phase Commit<br>
<small>
[<a class="el" href="../../d8/d1e/group___s_s_m_x_c_t.html">Transactions, Locking and Logging</a>]</small>
</h1>
<p>
Collaboration diagram for Distributed Transactions: Two-Phase Commit:<center><table><tr><td><img src="../../d2/dae/group___s_s_m2_p_c.png" border="0" alt="" usemap="#d2/d32/d2_2dae_2group______s__s__m2__p__c_map">
<map name="d2/d32/d2_2dae_2group______s__s__m2__p__c_map">
<area href="../../d8/d1e/group___s_s_m_x_c_t.html" shape="rect" coords="5,5,245,32" alt="">
</map></td></tr></table></center>
<hr><a name="_details"></a><h2>Detailed Description</h2>
The storage manager contains support for externally-coordinated transactions that use two-phase-commit with presumed abort. The server must provide the coordination and the coordinator is assumed to have its own stable storage, and it is assumed to recover from failures in a "short time", the precise meaning of which is given below. A prepared transaction, like an active transaction, consumes log space and holds locks. Even if a prepared transaction does not hold locks needed by other transactions, it consumes resources in a way that can interfere with other transactions. If a prepared transaction remains in the system for a long time while other transactions are running, eventually the storage manager needs the log space used (reserved) by the prepared transaction. A coordinator must resolve its prepared transactions before the storage manager effectively runs out of log space for other transactions in the system. The amount of time involved is a function of the size of the log and of the demands of the other transactions in the system.<p>
For the purpose of this discussion, the portion of a global transaction that involves a single Shore Storage Manager transaction is called a thread of the global transaction.<p>
A Shore transaction participates as a thread of a global transaction as follows:<ul>
<li>Start a storage-manager transaction with <a class="el" href="../../d8/d1e/group___s_s_m_x_c_t.html#ga18b22291428a1c82a18f4c170298aeb">ss_m::begin_xct</a>.</li><li>Acquire a global transaction identifier from the coordinator.</li><li>Indicate to the storage manager that this transaction is a thread of a global transaction, and associate the global transaction identifier with this thread by calling <a class="el" href="../../d2/dae/group___s_s_m2_p_c.html#gd9037a378e29f807286e84bc156d0584">ss_m::enter_2pc</a>.</li><li>Associate a coordinator with the transaction for recovery purposes, by calling <a class="el" href="../../d2/dae/group___s_s_m2_p_c.html#ge150c0d31d4cb1c21e43e0ad2e98d8ec">ss_m::set_coordinator</a>.</li><li>Prepare the thread of the transaction and get the storage manager's vote with <a class="el" href="../../d2/dae/group___s_s_m2_p_c.html#ge9b472f3492b226aa00c30134e35fc91">ss_m::prepare_xct</a>. It is an error to commit a global transaction thread without first preparing it. It is an error to do anything else in a transaction after it is prepared, except to end the transaction or retry the prepare (to get the vote again).</li><li>Convey the vote to the coordinator, and determine the transaction's fate from the coordinator.</li><li>End the thread with <a class="el" href="../../d8/d1e/group___s_s_m_x_c_t.html#gdcc84a1d655f398fa9a054b79eb6e544">ss_m::commit_xct</a> or <a class="el" href="../../d8/d1e/group___s_s_m_x_c_t.html#g1ef08428870c5ad773dcb7d95dfe9bff">ss_m::abort_xct</a>.</li></ul>
<p>
The storage manager logs the minimal information required to effect a vote of the transaction threads that are storage manager transactions, and to recover such in-doubt transactions after restart. Thus, after a crash/restart, the server may query the storage manager about in-doubt (prepared) transactions with <a class="el" href="../../d2/dae/group___s_s_m2_p_c.html#gc5f9a81198429ccb309df5d4e684c51b">ss_m::query_prepared_xct</a>, which tells the caller the number and global transaction IDs associated with prepared transactions. Using this, the server contacts the coordinator and resumes the voting. The server may find the local transaction IDs and use <a class="el" href="../../d8/d1e/group___s_s_m_x_c_t.html#g5ab27cd8421f0f60c2701f89349ee299">ss_m::tid_to_xct</a> to attach these transactions and to resolve them.<p>
Commit and abort of read-only transactions are the same, as these transactions have no log entries. Preparing read-only transactions causes them to commit/abort and the vote returned is vote_readonly. Once this vote is communicated to the coordinator and the coordinator records it on stable storage, there is no need to involve this thread in any further processing. For this reason, read-only transactions do not appear as prepared transactions at recovery time. 
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static <a class="el" href="../../db/dc7/classw__rc__t.html">rc_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dae/group___s_s_m2_p_c.html#gd9037a378e29f807286e84bc156d0584">ss_m::enter_2pc</a> (const <a class="el" href="../../d5/de1/classopaque__quantity.html">gtid_t</a> &amp;gtid)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Make the attached transaction a thread of a distributed transaction.  <a href="#gd9037a378e29f807286e84bc156d0584"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static <a class="el" href="../../db/dc7/classw__rc__t.html">rc_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dae/group___s_s_m2_p_c.html#ge150c0d31d4cb1c21e43e0ad2e98d8ec">ss_m::set_coordinator</a> (const <a class="el" href="../../d5/de1/classopaque__quantity.html">server_handle_t</a> &amp;h)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Assign a coordinator handle to this distributed transaction.  <a href="#ge150c0d31d4cb1c21e43e0ad2e98d8ec"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static <a class="el" href="../../db/dc7/classw__rc__t.html">rc_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dae/group___s_s_m2_p_c.html#ge9b472f3492b226aa00c30134e35fc91">ss_m::prepare_xct</a> (<a class="el" href="../../d9/dee/classsm__stats__info__t.html">sm_stats_info_t</a> *&amp;stats, vote_t &amp;vote)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Prepare a thread of a distributed transaction.  <a href="#ge9b472f3492b226aa00c30134e35fc91"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static <a class="el" href="../../db/dc7/classw__rc__t.html">rc_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dae/group___s_s_m2_p_c.html#g304134f3085231ea6b6f79970d4bfb12">ss_m::prepare_xct</a> (vote_t &amp;vote)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Prepare a thread of a distributed transaction.  <a href="#g304134f3085231ea6b6f79970d4bfb12"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static <a class="el" href="../../db/dc7/classw__rc__t.html">rc_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dae/group___s_s_m2_p_c.html#ge6a7ff8f0dbf022c8d1436382da63cf2">ss_m::force_vote_readonly</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Force the transaction to vote "read-only" in a two-phase commit.  <a href="#ge6a7ff8f0dbf022c8d1436382da63cf2"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static <a class="el" href="../../db/dc7/classw__rc__t.html">rc_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dae/group___s_s_m2_p_c.html#gef8777a2f9556ec3e6e21d94078eda6d">ss_m::recover_2pc</a> (const <a class="el" href="../../d5/de1/classopaque__quantity.html">gtid_t</a> &amp;gtid, bool mayblock, <a class="el" href="../../d8/d12/classtid__t.html">tid_t</a> &amp;local)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Given a global transaction id, find the local prepared transaction associated with it.  <a href="#gef8777a2f9556ec3e6e21d94078eda6d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static <a class="el" href="../../db/dc7/classw__rc__t.html">rc_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dae/group___s_s_m2_p_c.html#gc5f9a81198429ccb309df5d4e684c51b">ss_m::query_prepared_xct</a> (int &amp;numtids)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return the number of prepared transactions.  <a href="#gc5f9a81198429ccb309df5d4e684c51b"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static <a class="el" href="../../db/dc7/classw__rc__t.html">rc_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/dae/group___s_s_m2_p_c.html#gfdc6da63b3e0e271ffa25f9303a8be0c">ss_m::query_prepared_xct</a> (int numtids, <a class="el" href="../../d5/de1/classopaque__quantity.html">gtid_t</a> l[])</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return the global transaction IDs of in-doubt transactions.  <a href="#gfdc6da63b3e0e271ffa25f9303a8be0c"></a><br></td></tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="gd9037a378e29f807286e84bc156d0584"></a><!-- doxytag: member="ss_m::enter_2pc" ref="gd9037a378e29f807286e84bc156d0584" args="(const gtid_t &amp;gtid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="../../db/dc7/classw__rc__t.html">rc_t</a> ss_m::enter_2pc           </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d5/de1/classopaque__quantity.html">gtid_t</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>gtid</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [static, inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Make the attached transaction a thread of a distributed transaction. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>gtid</em>&nbsp;</td><td>Global transaction ID to associate with this transaction. This will be logged when the transaction is prepared.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Note:</b></dt><dd>This can be called at most once for a given transaction. The transaction must be attached to the calling thread. No other threads may be attached to the transaction. </dd></dl>

</div>
</div><p>
<a class="anchor" name="ge150c0d31d4cb1c21e43e0ad2e98d8ec"></a><!-- doxytag: member="ss_m::set_coordinator" ref="ge150c0d31d4cb1c21e43e0ad2e98d8ec" args="(const server_handle_t &amp;h)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="../../db/dc7/classw__rc__t.html">rc_t</a> ss_m::set_coordinator           </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d5/de1/classopaque__quantity.html">server_handle_t</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>h</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [static, inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Assign a coordinator handle to this distributed transaction. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>h</em>&nbsp;</td><td>Handle of the coordinator. Not interpreted by the storage manager.</td></tr>
  </table>
</dl>
The storage manager associates this server handle with the transaction so that when the transaction is prepared, this information is written to the log. Upon recovery, if this transaction is still in doubt, the value-added server can query the storage manager for in-doubt transactions, get their server handles, and resolve the transactions. See query_prepared_xct and recover_2pc. 
</div>
</div><p>
<a class="anchor" name="ge9b472f3492b226aa00c30134e35fc91"></a><!-- doxytag: member="ss_m::prepare_xct" ref="ge9b472f3492b226aa00c30134e35fc91" args="(sm_stats_info_t *&amp;stats, vote_t &amp;vote)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="../../db/dc7/classw__rc__t.html">rc_t</a> ss_m::prepare_xct           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/dee/classsm__stats__info__t.html">sm_stats_info_t</a> *&amp;&nbsp;</td>
          <td class="paramname"> <em>stats</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">vote_t &amp;&nbsp;</td>
          <td class="paramname"> <em>vote</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static, inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Prepare a thread of a distributed transaction. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>stats</em>&nbsp;</td><td>Pointer to an allocated statistics-holding structure. </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>vote</em>&nbsp;</td><td>This thread's vote.</td></tr>
  </table>
</dl>
The storage manager will prepare the attached transaction (a thread of a distributed transaction) for commit. If this transaction has performed no logged updates, the vote returned will be vote_readonly. If this transaction can commit, the vote returned will be vote_commit. If an error occurs during the prepare, the vote will be vote_abort.<p>
If the transaction is being instrumented, the statistics-holding structure will be returned to the caller, and the caller is responsible for its deallocation. 
</div>
</div><p>
<a class="anchor" name="g304134f3085231ea6b6f79970d4bfb12"></a><!-- doxytag: member="ss_m::prepare_xct" ref="g304134f3085231ea6b6f79970d4bfb12" args="(vote_t &amp;vote)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="../../db/dc7/classw__rc__t.html">rc_t</a> ss_m::prepare_xct           </td>
          <td>(</td>
          <td class="paramtype">vote_t &amp;&nbsp;</td>
          <td class="paramname"> <em>vote</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [static, inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Prepare a thread of a distributed transaction. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>vote</em>&nbsp;</td><td>This thread's vote. See <a class="el" href="../../d9/da0/classw__base__t.html#e6e3441895f34ef21b4c9aa32ef5f133">w_base_t::vote_t</a>.</td></tr>
  </table>
</dl>
The storage manager will prepare the attached transaction (a thread of a distributed transaction) for commit. If this transaction has performed no logged updates, the vote returned will be vote_readonly. If this transaction can commit, the vote returned will be vote_commit. If an error occurs during the prepare, the vote will be vote_abort. 
</div>
</div><p>
<a class="anchor" name="ge6a7ff8f0dbf022c8d1436382da63cf2"></a><!-- doxytag: member="ss_m::force_vote_readonly" ref="ge6a7ff8f0dbf022c8d1436382da63cf2" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="../../db/dc7/classw__rc__t.html">rc_t</a> ss_m::force_vote_readonly           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [static, inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Force the transaction to vote "read-only" in a two-phase commit. 
<p>
This will override the storage manager's determination of whether this thread of a distributed transaction is read-only, which is based on whether the local transaction thread logged anything. This method may be useful if the local transaction rolled back to a savepoint. See <a class="el" href="../../d9/da0/classw__base__t.html#e6e3441895f34ef21b4c9aa32ef5f133">w_base_t::vote_t</a>. 
</div>
</div><p>
<a class="anchor" name="gef8777a2f9556ec3e6e21d94078eda6d"></a><!-- doxytag: member="ss_m::recover_2pc" ref="gef8777a2f9556ec3e6e21d94078eda6d" args="(const gtid_t &amp;gtid, bool mayblock, tid_t &amp;local)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="../../db/dc7/classw__rc__t.html">rc_t</a> ss_m::recover_2pc           </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d5/de1/classopaque__quantity.html">gtid_t</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>gtid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>mayblock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d8/d12/classtid__t.html">tid_t</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>local</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static, inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Given a global transaction id, find the local prepared transaction associated with it. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>gtid</em>&nbsp;</td><td>A global transaction ID (an opaque quantity to the storage manager). </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>mayblock</em>&nbsp;</td><td>Not used. </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>local</em>&nbsp;</td><td>Return the transaction ID of the prepared SM transaction.</td></tr>
  </table>
</dl>
Searches the transaction list for a prepared transaction with the given global transaction id. If found, it returns a reference to the local transaction. The transaction is attached to the running thread before it is returned. 
</div>
</div><p>
<a class="anchor" name="gc5f9a81198429ccb309df5d4e684c51b"></a><!-- doxytag: member="ss_m::query_prepared_xct" ref="gc5f9a81198429ccb309df5d4e684c51b" args="(int &amp;numtids)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="../../db/dc7/classw__rc__t.html">rc_t</a> ss_m::query_prepared_xct           </td>
          <td>(</td>
          <td class="paramtype">int &amp;&nbsp;</td>
          <td class="paramname"> <em>numtids</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [static, inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Return the number of prepared transactions. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>numtids</em>&nbsp;</td><td>The number of in-doubt transactions.</td></tr>
  </table>
</dl>
Used by a server at start-up, after recovery, to find out if there are any in-doubt transactions. If so, the server must use the second form of query_prepared_xct to find the global transaction IDs of these in-doubt transactions. 
</div>
</div><p>
<a class="anchor" name="gfdc6da63b3e0e271ffa25f9303a8be0c"></a><!-- doxytag: member="ss_m::query_prepared_xct" ref="gfdc6da63b3e0e271ffa25f9303a8be0c" args="(int numtids, gtid_t l[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="../../db/dc7/classw__rc__t.html">rc_t</a> ss_m::query_prepared_xct           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numtids</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d5/de1/classopaque__quantity.html">gtid_t</a>&nbsp;</td>
          <td class="paramname"> <em>l</em>[]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static, inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Return the global transaction IDs of in-doubt transactions. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>numtids</em>&nbsp;</td><td>The number of global transaction ids in the list. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>l</em>&nbsp;</td><td>The caller-provided list into which to write the global transaction-ids.</td></tr>
  </table>
</dl>
Used by a server at start-up, after recovery, to find out the global transaction IDs of the prepared transactions. The storage manager fills in the first numtids entries of the pre-allocated list. The server may have first called the first form of query_prepared_xct to find out how many such transactions there are after recovery.<p>
<dl compact><dt><b>Attention:</b></dt><dd>Read-only transactions do not appear as in-doubt transactions. Because they did not generate any log records, they will not be "discovered" by analysis. The server must determine that any thread of a global transaction that does not appear to be in doubt was a read-only thread or it never prepared and thus has been aborted. Read-only transactions that were prepared would have voted read-only, and if the coordinator recorded that vote on stable storage, it should not be concerned with these transaction threads any further. If the coordinator does not have this information recorded, the transaction thread could have been an aborted non-read-only transaction, so the coordinator must, in this case, presume that the thread aborted and thus make the global transaction abort. </dd></dl>

</div>
</div><p>
<hr size="1"><address style="align: right;"><small>Generated on Mon Jan 2 15:14:01 2012 for Shore Storage Manager by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
